<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Hexo</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://wzes.github.io/"/>
  <updated>2019-11-17T13:00:00.951Z</updated>
  <id>https://wzes.github.io/</id>
  
  <author>
    <name>Xuantang Cun</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Koa-ejs å…¥é—¨</title>
    <link href="https://wzes.github.io/2019/11/17/JavaScript/koa-ejs/"/>
    <id>https://wzes.github.io/2019/11/17/JavaScript/koa-ejs/</id>
    <published>2019-11-17T04:56:00.000Z</published>
    <updated>2019-11-17T13:00:00.951Z</updated>
    
    <content type="html"><![CDATA[<h3 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h3><p>åˆæ˜¯ä¸€å‘¨è¿‡å»äº†ï¼Œè¯¥ç»™è‡ªå·±å……å……ç”µäº†ï¼Œä½¿ç”¨äº† koa ä½œä¸ºæœåŠ¡ç«¯æ¸²æŸ“çš„æœåŠ¡å¼•æ“ï¼Œé‚£ä¹ˆä½¿ç”¨ koa-ejs ä½œä¸º HTML è¾“å‡ºä¹Ÿæ˜¯é¡ºå…¶è‡ªç„¶çš„äº‹äº†</p><h3 id="å¼€å§‹"><a class="markdownIt-Anchor" href="#å¼€å§‹"></a> å¼€å§‹</h3><p>å®‰è£… koaï¼Œkoa-ejs</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install koa koa-ejs</span><br></pre></td></tr></table></figure><p>index.js ç›®å½•ï¼Œåˆ›å»º <code>koa</code> å¯¹è±¡ï¼Œkoa-ejs è¿”å›ä¸€ä¸ª <code>render</code> å¯¹è±¡ï¼Œé€šè¿‡è¿™ä¸ªå¯¹è±¡ç»™ ctx å¯¹è±¡è¿›è¡Œ render èµ‹å€¼ï¼Œä¹‹åå°±å¯ä»¥åœ¨è·¯ç”±ä¸­ä½¿ç”¨ <code>ctx.render</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">const Koa = require(&apos;koa&apos;)</span><br><span class="line">const render = require(&apos;koa-ejs&apos;);</span><br><span class="line"></span><br><span class="line">const app = new Koa();</span><br><span class="line"></span><br><span class="line">render(app, &#123;</span><br><span class="line">// æ¨¡ç‰ˆæ ¹ç›®å½•</span><br><span class="line">  root: path.join(__dirname, &apos;view&apos;),</span><br><span class="line">  // æ ‡å‡†æ¨¡ç‰ˆåå­—</span><br><span class="line">  layout: &apos;template&apos;,</span><br><span class="line">  // æ¨¡ç‰ˆåç¼€ï¼Œé»˜è®¤æ˜¯ html</span><br><span class="line">  viewExt: &apos;html&apos;,</span><br><span class="line">  // æ˜¯å¦ä½¿ç”¨ç¼“å­˜</span><br><span class="line">  cache: false,</span><br><span class="line">  // æ˜¯å¦å¼€å¯ debug</span><br><span class="line">  debug: false,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.use(async function (ctx) &#123;</span><br><span class="line">  const users = [&#123; name: &apos;Dead Horse&apos; &#125;, &#123; name: &apos;Jack&apos; &#125;, &#123; name: &apos;Tom&apos; &#125;];</span><br><span class="line">  await ctx.render(&apos;content&apos;, &#123;</span><br><span class="line">    users</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>template.html æ–‡ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;title&gt;koa ejs&lt;/title&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    &lt;h3&gt;koa ejs&lt;/h3&gt;</span><br><span class="line">    &lt;%- body %&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>content.html æ–‡ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;</span><br><span class="line">  &lt;% include user.html %&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><p>user.html</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;ul&gt;</span><br><span class="line">  &lt;% users.forEach(function (user) &#123;%&gt;</span><br><span class="line">    &lt;li&gt;&lt;%= user.name %&gt;&lt;/li&gt;</span><br><span class="line">  &lt;% &#125;)%&gt;</span><br><span class="line">&lt;/ul&gt;</span><br></pre></td></tr></table></figure><h5 id="è¾“å‡º"><a class="markdownIt-Anchor" href="#è¾“å‡º"></a> è¾“å‡º</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Dead Horse</span><br><span class="line">Jack</span><br><span class="line">Tom</span><br></pre></td></tr></table></figure><h3 id="æºç è§£æ"><a class="markdownIt-Anchor" href="#æºç è§£æ"></a> æºç è§£æ</h3><p>å…¶å® koa-ejs çš„æºç å¾ˆç®€å•ï¼Œä¸»è¦æ˜¯å¼•ç”¨äº† ejs æ¡†æ¶ï¼Œç®€å•åšäº†å°è£…ï¼Œå°† render æŒ‚è½½åˆ° ctx ä¸Š</p><h5 id="å…¥å£"><a class="markdownIt-Anchor" href="#å…¥å£"></a> å…¥å£</h5><p>å½“å¼•å…¥çš„æ—¶å€™ï¼Œæ‰§è¡Œäº† render å°±ä¼šè¿›è¡Œåˆå§‹åŒ–ï¼Œå¹¶ä¸”å£°æ˜äº† render çš„å¼‚æ­¥æ–¹æ³•ï¼Œä¸»è¦æ˜¯è·å– template æ–‡ä»¶ï¼Œç„¶åä½¿ç”¨ <code>ejs.compile</code> å»æ„é€ å‡½æ•°ï¼Œè¯¥æ–¹æ³•ä¸»è¦çš„ä½œç”¨å°±æ˜¯æ›¿æ¢ ejs ä¸­çš„å˜é‡ï¼Œç”Ÿæˆ htmlã€‚å¦‚æœæœ‰ç¼“å­˜ï¼Œé‚£ä¹ˆåˆ™ä¸è¯»å–æ–‡ä»¶äº†ï¼Œç›´æ¥è¿›è¡Œæ›¿æ¢</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">exports = module.exports = function (app, settings) &#123;</span><br><span class="line">  if (app.context.render) &#123;</span><br><span class="line">    return;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  settings.root = path.resolve(process.cwd(), settings.root);</span><br><span class="line">  </span><br><span class="line">  /**</span><br><span class="line">   * cache the generate package</span><br><span class="line">   * @type &#123;Object&#125;</span><br><span class="line">   */</span><br><span class="line">  const cache = Object.create(null);</span><br><span class="line"></span><br><span class="line">  settings = Object.assign(&#123;&#125;, defaultSettings, settings);</span><br><span class="line"></span><br><span class="line">  settings.viewExt = settings.viewExt</span><br><span class="line">    ? &apos;.&apos; + settings.viewExt.replace(/^\./, &apos;&apos;)</span><br><span class="line">    : &apos;&apos;;</span><br><span class="line">    </span><br><span class="line">  async function render(view, options) &#123;</span><br><span class="line">    view += settings.viewExt;</span><br><span class="line">    const viewPath = path.join(settings.root, view);</span><br><span class="line">    debug(`render: $&#123;viewPath&#125;`);</span><br><span class="line">    // get from cache</span><br><span class="line">    if (settings.cache &amp;&amp; cache[viewPath]) &#123;</span><br><span class="line">      return cache[viewPath].call(options.scope, options);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    const tpl = await fs.readFile(viewPath, &apos;utf8&apos;);</span><br><span class="line"></span><br><span class="line">    // override `ejs` node_module `resolveInclude` function</span><br><span class="line">    ejs.resolveInclude = function(name, filename, isDir) &#123;</span><br><span class="line">      if (!path.extname(name)) &#123;</span><br><span class="line">        name += settings.viewExt;</span><br><span class="line">      &#125;</span><br><span class="line">      return parentResolveInclude(name, filename, isDir);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    const fn = ejs.compile(tpl, &#123;</span><br><span class="line">      filename: viewPath,</span><br><span class="line">      _with: settings._with,</span><br><span class="line">      compileDebug: settings.debug &amp;&amp; settings.compileDebug,</span><br><span class="line">      debug: settings.debug,</span><br><span class="line">      delimiter: settings.delimiter,</span><br><span class="line">      cache: settings.cache,</span><br><span class="line">      async: settings.async</span><br><span class="line">    &#125;);</span><br><span class="line">    if (settings.cache) &#123;</span><br><span class="line">      cache[viewPath] = fn;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return fn.call(options.scope, options);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  app.context.render = async function (view, _context) &#123;</span><br><span class="line">    //</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>æœ€åå°†ä¸º app çš„ context æ–°å¢ render æ–¹æ³•</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">app.context.render = async function (view, _context) &#123;</span><br><span class="line">  const ctx = this;</span><br><span class="line"></span><br><span class="line">  const context = Object.assign(&#123;&#125;, ctx.state, _context);</span><br><span class="line">// è·å– html</span><br><span class="line">  let html = await render(view, context);</span><br><span class="line">// å¦‚æœä½¿ç”¨äº† layoutï¼Œä¹Ÿå°±æ˜¯æœ‰äºŒçº§é¡µé¢ï¼Œå†ä¸€æ¬¡æ¸²æŸ“</span><br><span class="line">  const layout = context.layout === false ? false : (context.layout || settings.layout);</span><br><span class="line">  if (layout) &#123;</span><br><span class="line">    // if using layout</span><br><span class="line">    context.body = html;</span><br><span class="line">    html = await render(layout, context);</span><br><span class="line">  &#125;</span><br><span class="line">// ç›´æ¥èµ‹å€¼ç»™ body</span><br><span class="line">  const writeResp = context.writeResp === false ? false : (context.writeResp || settings.writeResp);</span><br><span class="line">  </span><br><span class="line">  if (writeResp) &#123;</span><br><span class="line">    // normal operation</span><br><span class="line">    ctx.type = &apos;html&apos;;</span><br><span class="line">    ctx.body = html;</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    // only return the html</span><br><span class="line">    return html;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ä¹‹åå°±å¯ä»¥ä½¿ç”¨ ctx.render</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">await ctx.render(&apos;content&apos;, &#123;</span><br><span class="line">    users</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>éå¸¸ç®€å•çš„æºç ï¼ŒåŒ…å«äº†ç¼“å­˜ç­‰é€»è¾‘ï¼ŒåŸºæœ¬æ»¡è¶³æˆ‘ä»¬çš„æ—¥å¸¸éœ€è¦</p><h3 id="æ€è€ƒ"><a class="markdownIt-Anchor" href="#æ€è€ƒ"></a> æ€è€ƒ</h3><p>ğŸ¤”å¥½å¥½å­¦ä¹ </p>]]></content>
    
    <summary type="html">
    
      åˆæ˜¯ä¸€å‘¨è¿‡å»äº†ï¼Œè¯¥ç»™è‡ªå·±å……å……ç”µäº†ï¼Œä½¿ç”¨äº† koa ä½œä¸ºæœåŠ¡ç«¯æ¸²æŸ“çš„æœåŠ¡å¼•æ“ï¼Œé‚£ä¹ˆä½¿ç”¨ koa-ejs ä½œä¸º HTML è¾“å‡ºä¹Ÿæ˜¯é¡ºå…¶è‡ªç„¶çš„äº‹äº†
    
    </summary>
    
      <category term="JavaScript" scheme="https://wzes.github.io/categories/JavaScript/"/>
    
    
      <category term="JavaScript" scheme="https://wzes.github.io/tags/JavaScript/"/>
    
      <category term="Koa" scheme="https://wzes.github.io/tags/Koa/"/>
    
  </entry>
  
  <entry>
    <title>NextJS å…¥é—¨æŒ‡å—</title>
    <link href="https://wzes.github.io/2019/11/09/JavaScript/NextJS/"/>
    <id>https://wzes.github.io/2019/11/09/JavaScript/NextJS/</id>
    <published>2019-11-09T10:30:16.000Z</published>
    <updated>2019-11-10T07:50:48.873Z</updated>
    
    <content type="html"><![CDATA[<h3 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h3><p>æœ€è¿‘åœ¨ç ”ç©¶SSRæœåŠ¡ç«¯æ¸²æŸ“ï¼ŒNextJS ç®—æ˜¯æ¯”è¾ƒç»å…¸çš„æ¡†æ¶äº†ï¼Œæ‰€ä»¥äº†è§£äº†è§£å…¶ç”¨æ³•å¯¹SSRæˆ–è®¸èƒ½åŠ æ·±ç†è§£ã€‚å¦‚æœèƒ½äº†è§£å…¶å®ç°åŸç†ï¼Œé‚£å°±æ›´å¥½äº†ã€‚</p><h3 id="æœåŠ¡ç«¯æ¸²æŸ“"><a class="markdownIt-Anchor" href="#æœåŠ¡ç«¯æ¸²æŸ“"></a> æœåŠ¡ç«¯æ¸²æŸ“</h3><p>ç®€å•ç†è§£å°±æ˜¯ï¼šä½ è®¿é—®ç½‘é¡µçš„æ—¶å€™ï¼Œä¼šä¸€æ¬¡æ€§æŠŠå®Œæ•´çš„HTMLè¿”å›ç»™ä½ ã€‚åŒºåˆ«äº Reactï¼ŒVue é¡¹ç›®ï¼ŒHTML æ–‡æ¡£åªæ˜¯ä¸€ä¸ªå£³å­ï¼Œéœ€è¦è¿è¡Œ js æ‰èƒ½å¾—åˆ°é¦–å±çš„ Domã€‚</p><h3 id="ç®€ä»‹"><a class="markdownIt-Anchor" href="#ç®€ä»‹"></a> ç®€ä»‹</h3><p><strong>Next.js</strong> æ˜¯ä¸€ä¸ªè½»é‡çº§çš„ React æœåŠ¡ç«¯æ¸²æŸ“åº”ç”¨æ¡†æ¶ã€‚</p><h3 id="get-started"><a class="markdownIt-Anchor" href="#get-started"></a> Get Started</h3><p>åˆå§‹åŒ–é¡¹ç›®ï¼Œå®‰è£… next</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save next react react-dom</span><br></pre></td></tr></table></figure><p>å°†ä¸‹é¢è„šæœ¬æ·»åŠ åˆ° package.json ä¸­:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;scripts&quot;: &#123;</span><br><span class="line">    &quot;dev&quot;: &quot;next&quot;,</span><br><span class="line">    &quot;build&quot;: &quot;next build&quot;,</span><br><span class="line">    &quot;start&quot;: &quot;next start&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ–°å»º <code>./pages/index.js</code> åˆ°ä½ çš„é¡¹ç›®ä¸­:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export default () =&gt; &lt;div&gt;Welcome to next.js!&lt;/div&gt;</span><br></pre></td></tr></table></figure><p>è¿è¡Œ <code>npm run dev</code> å‘½ä»¤å¹¶æ‰“å¼€ <code>http://localhost:3000</code>ã€‚ å¦‚æœä½ æƒ³ä½¿ç”¨å…¶ä»–ç«¯å£ï¼Œå¯è¿è¡Œ <code>npm run dev -- -p &lt;è®¾ç½®ç«¯å£å·&gt;</code>.</p><h3 id="å¦‚ä½•ä½¿ç”¨æœåŠ¡ç«¯æ¸²æŸ“"><a class="markdownIt-Anchor" href="#å¦‚ä½•ä½¿ç”¨æœåŠ¡ç«¯æ¸²æŸ“"></a> å¦‚ä½•ä½¿ç”¨æœåŠ¡ç«¯æ¸²æŸ“ï¼Ÿ</h3><p>é»˜è®¤æ”¯æŒæœåŠ¡ç«¯æ¸²æŸ“ï¼Œè·å–ç½‘ç»œè¯·æ±‚å†™åœ¨ getInitialProps å†…éƒ¨ï¼Œå°±å¯ä»¥åœ¨ render ä¸­è·å–æ•°æ®ï¼Œç›´æ¥æ¸²æŸ“ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">import React from &apos;react&apos;</span><br><span class="line"></span><br><span class="line">export default class extends React.Component &#123;</span><br><span class="line">  static async getInitialProps(&#123; req &#125;) &#123;</span><br><span class="line">    const userAgent = req ? req.headers[&apos;user-agent&apos;] : navigator.userAgent</span><br><span class="line">    return &#123; userAgent &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        Hello World  &#123;this.props.userAgent&#125;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åŸç†"><a class="markdownIt-Anchor" href="#åŸç†"></a> åŸç†</h3><h4 id="åº”ç”¨å…¥å£"><a class="markdownIt-Anchor" href="#åº”ç”¨å…¥å£"></a> åº”ç”¨å…¥å£</h4><p>ä½¿ç”¨äº† node command lineï¼Œèƒ½è®©æˆ‘ä»¬ä»…ä»…å†™äº† page çš„ä»£ç ï¼Œå°±èƒ½è®©æ•´ä¸ªåº”ç”¨è·‘èµ·æ¥ã€‚ä»¥è‡³äºæˆ‘ä»¬éƒ½æ‰¾ä¸åˆ°å…¥å£ã€‚nextjs çœŸçš„æ˜¯å¾ˆå‰å®³ï½å°è£…çš„å¾ˆå¥½</p><p>å¯ä»¥çœ‹åˆ°ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨ <code>yarn start</code> çš„æ—¶å€™ï¼Œåº”ç”¨æ‰§è¡Œäº† next-start</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">const commands: &#123; [command: string]: () =&gt; Promise&lt;cliCommand&gt; &#125; = &#123;</span><br><span class="line">  build: async () =&gt; await import(&apos;../cli/next-build&apos;).then(i =&gt; i.nextBuild),</span><br><span class="line">  start: async () =&gt; await import(&apos;../cli/next-start&apos;).then(i =&gt; i.nextStart),</span><br><span class="line">  export: async () =&gt;</span><br><span class="line">    await import(&apos;../cli/next-export&apos;).then(i =&gt; i.nextExport),</span><br><span class="line">  dev: async () =&gt; await import(&apos;../cli/next-dev&apos;).then(i =&gt; i.nextDev),</span><br><span class="line">  telemetry: async () =&gt;</span><br><span class="line">    await import(&apos;../cli/next-telemetry&apos;).then(i =&gt; i.nextTelemetry),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>next-start å¼€å¯äº†ä¸€ä¸ªæœåŠ¡</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">startServer(&#123; dir &#125;, port, args[&apos;--hostname&apos;])</span><br><span class="line">  .then(async app =&gt; &#123;</span><br><span class="line">    // tslint:disable-next-line</span><br><span class="line">    console.log(</span><br><span class="line">      `&gt; Ready on http://$&#123;args[&apos;--hostname&apos;] || &apos;localhost&apos;&#125;:$&#123;port&#125;`</span><br><span class="line">    )</span><br><span class="line">    await app.prepare()</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(err =&gt; &#123;</span><br><span class="line">    // tslint:disable-next-line</span><br><span class="line">    console.error(err)</span><br><span class="line">    process.exit(1)</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure><p>startServer çš„å®ç°ï¼Œè·å– next å®ä¾‹ï¼Œç„¶åä½¿ç”¨ http åˆ›å»ºæœåŠ¡ï¼Œä¸»è¦çš„è¯·æ±‚é€»è¾‘çš„ä»£ç éƒ½åœ¨ next çš„ getRequestHandler é‡Œé¢</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">export default async function start(</span><br><span class="line">  serverOptions: any,</span><br><span class="line">  port?: number,</span><br><span class="line">  hostname?: string</span><br><span class="line">) &#123;</span><br><span class="line">  const app = next(serverOptions)</span><br><span class="line">  const srv = http.createServer(app.getRequestHandler())</span><br><span class="line">  await new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">    // This code catches EADDRINUSE error if the port is already in use</span><br><span class="line">    srv.on(&apos;error&apos;, reject)</span><br><span class="line">    srv.on(&apos;listening&apos;, () =&gt; resolve())</span><br><span class="line">    srv.listen(port, hostname)</span><br><span class="line">  &#125;)</span><br><span class="line">  // It&apos;s up to caller to run `app.prepare()`, so it can notify that the server</span><br><span class="line">  // is listening before starting any intensive operations.</span><br><span class="line">  return app</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>handleRequest å¤„ç†è¯·æ±‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">private handleRequest(</span><br><span class="line">  req: IncomingMessage,</span><br><span class="line">  res: ServerResponse,</span><br><span class="line">  parsedUrl?: UrlWithParsedQuery</span><br><span class="line">): Promise&lt;void&gt; &#123;</span><br><span class="line">  res.statusCode = 200</span><br><span class="line">  return this.run(req, res, parsedUrl).catch(err =&gt; &#123;</span><br><span class="line">    this.logError(err)</span><br><span class="line">    res.statusCode = 500</span><br><span class="line">    res.end(&apos;Internal Server Error&apos;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>run è·å– route å®ä¾‹å¹¶è¿›è¡Œå¤„ç†</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">protected async run(</span><br><span class="line">  req: IncomingMessage,</span><br><span class="line">  res: ServerResponse,</span><br><span class="line">  parsedUrl: UrlWithParsedQuery</span><br><span class="line">) &#123;</span><br><span class="line">  this.handleCompression(req, res)</span><br><span class="line">  try &#123;</span><br><span class="line">    const fn = this.router.match(req, res, parsedUrl)</span><br><span class="line">    if (fn) &#123;</span><br><span class="line">      await fn()</span><br><span class="line">      return</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; catch (err) &#123;</span><br><span class="line">    if (err.code === &apos;DECODE_FAILED&apos;) &#123;</span><br><span class="line">      res.statusCode = 400</span><br><span class="line">      return this.renderError(null, req, res, &apos;/_error&apos;, &#123;&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    throw err</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  await this.render404(req, res, parsedUrl)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>router æ˜¯åœ¨é¡¹ç›®åˆå§‹åŒ–çš„æ—¶å€™è¿›è¡Œåˆ›å»ºçš„ï¼Œå…¶ä¸­ä¸€ä¸ªå°±æ˜¯æ ¹æ®ï¼Œé»˜è®¤éƒ½ä¼šæœ‰å¾ˆå¤šè·¯ç”±å¤„ç†å™¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">protected generateRoutes(): Route[] &#123;</span><br><span class="line">  const publicRoutes = fs.existsSync(this.publicDir)</span><br><span class="line">    ? this.generatePublicRoutes()</span><br><span class="line">    : []</span><br><span class="line">  const staticFilesRoute = fs.existsSync(join(this.dir, &apos;static&apos;))</span><br><span class="line">    ? [</span><br><span class="line">        &#123;</span><br><span class="line">          match: route(&apos;/static/:path*&apos;),</span><br><span class="line">          fn: async (req, res, params, parsedUrl) =&gt; &#123;</span><br><span class="line">            const p = join(this.dir, &apos;static&apos;, ...(params.path || []))</span><br><span class="line">            await this.serveStatic(req, res, p, parsedUrl)</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125; as Route,</span><br><span class="line">      ]</span><br><span class="line">    : []</span><br><span class="line">  const routes: Route[] = [</span><br><span class="line">    &#123;</span><br><span class="line">      match: route(&apos;/_next/static/:path*&apos;),</span><br><span class="line">      fn: async (req, res, params, parsedUrl) =&gt; &#123;</span><br><span class="line">        await this.serveStatic(req, res, p, parsedUrl)</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      match: route(&apos;/_next/data/:path*&apos;),</span><br><span class="line">      fn: async (req, res, params, _parsedUrl) =&gt; &#123;</span><br><span class="line">        await this.render(</span><br><span class="line">          req,</span><br><span class="line">          res,</span><br><span class="line">          pathname,</span><br><span class="line">          &#123; _nextSprData: &apos;1&apos; &#125;,</span><br><span class="line">          parsedUrl</span><br><span class="line">        )</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      match: route(&apos;/_next/:path*&apos;),</span><br><span class="line">      fn: async (req, res, _params, parsedUrl) =&gt; &#123;</span><br><span class="line">        await this.render404(req, res, parsedUrl)</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    ...publicRoutes,</span><br><span class="line">    ...staticFilesRoute,</span><br><span class="line">    &#123;</span><br><span class="line">      match: route(&apos;/api/:path*&apos;),</span><br><span class="line">      fn: async (req, res, params, parsedUrl) =&gt; &#123;</span><br><span class="line">        const &#123; pathname &#125; = parsedUrl</span><br><span class="line">        await this.handleApiRequest(</span><br><span class="line">          req as NextApiRequest,</span><br><span class="line">          res as NextApiResponse,</span><br><span class="line">          pathname!</span><br><span class="line">        )</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  ]</span><br><span class="line"></span><br><span class="line">  if (this.nextConfig.useFileSystemPublicRoutes) &#123;</span><br><span class="line">    this.dynamicRoutes = this.getDynamicRoutes()</span><br><span class="line">    routes.push(&#123;</span><br><span class="line">      match: route(&apos;/:path*&apos;),</span><br><span class="line">      fn: async (req, res, _params, parsedUrl) =&gt; &#123;</span><br><span class="line">        const &#123; pathname, query &#125; = parsedUrl</span><br><span class="line">        if (!pathname) &#123;</span><br><span class="line">          throw new Error(&apos;pathname is undefined&apos;)</span><br><span class="line">        &#125;</span><br><span class="line">        await this.render(req, res, pathname, query, parsedUrl)</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return routes</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é»˜è®¤é¡µé¢è·¯ç”±éƒ½æ˜¯èµ°åˆ°æœ€åï¼Œä¹Ÿå°±æ˜¯æ‰§è¡Œ renderï¼Œè·å–æ¸²æŸ“çš„ html</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">public async render(</span><br><span class="line">  req: IncomingMessage,</span><br><span class="line">  res: ServerResponse,</span><br><span class="line">  pathname: string,</span><br><span class="line">  query: ParsedUrlQuery = &#123;&#125;,</span><br><span class="line">  parsedUrl?: UrlWithParsedQuery</span><br><span class="line">): Promise&lt;void&gt; &#123;</span><br><span class="line">  const url: any = req.url</span><br><span class="line">  if (isInternalUrl(url)) &#123;</span><br><span class="line">    return this.handleRequest(req, res, parsedUrl)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  if (isBlockedPage(pathname)) &#123;</span><br><span class="line">    return this.render404(req, res, parsedUrl)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  const html = await this.renderToHTML(req, res, pathname, query, &#123;</span><br><span class="line">    dataOnly:</span><br><span class="line">      (this.renderOpts.ampBindInitData &amp;&amp; Boolean(query.dataOnly)) ||</span><br><span class="line">      (req.headers &amp;&amp;</span><br><span class="line">        (req.headers.accept || &apos;&apos;).indexOf(&apos;application/amp.bind+json&apos;) !==</span><br><span class="line">          -1),</span><br><span class="line">  &#125;)</span><br><span class="line">  // Request was ended by the user</span><br><span class="line">  if (html === null) &#123;</span><br><span class="line">    return</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return this.sendHTML(req, res, html)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ renderToHTML å®ç°äº†å…·ä½“é€»è¾‘ï¼Œé€šè¿‡ sendHTML è¿”å›é¡µé¢ HTML</p><p>renderToHTML å®ç°ï¼Œé¦–å…ˆé€šè¿‡ findPageComponents è·å–è·¯ç”±å…·ä½“é¡µé¢ Compenentï¼Œç„¶åä½¿ç”¨renderToHTMLWithComponents è¿›è¡Œ React è½¬æ¢ä¸º HTML</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">public renderToHTML(</span><br><span class="line">    ...</span><br><span class="line">    ): Promise&lt;string | null&gt; &#123;</span><br><span class="line">    return this.findPageComponents(pathname, query)</span><br><span class="line">      .then(</span><br><span class="line">        result =&gt; &#123;</span><br><span class="line">          return this.renderToHTMLWithComponents(</span><br><span class="line">          ....</span><br><span class="line">            result,</span><br><span class="line">            &#123; ...this.renderOpts, amphtml, hasAmp, dataOnly &#125;</span><br><span class="line">          )</span><br><span class="line">        &#125;,</span><br><span class="line">      )</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>renderToHTMLï¼Œåœ¨ renderToHTMLWithComponents å†…éƒ¨æ‰§è¡Œ</p><p>çœç•¥äº†å¾ˆå¤šä»£ç ï¼Œä¸ºäº†äº†è§£ä¸»è¦é€»è¾‘ã€‚</p><p>é¦–å…ˆä¼šæ‰§è¡Œ loadGetInitialPropsï¼Œä¹Ÿå°±æ˜¯ä¸šåŠ¡ä»£ç ä¸­çš„ props è·å–ï¼Œè¿è¡Œåœ¨æœåŠ¡ç«¯ã€‚</p><p>ç„¶åä½¿ç”¨ Document çš„ getInitialProps åˆ›å»º Documentï¼Œå¹¶æŠŠ component èµ‹å€¼ï¼Œè·å–æœ€ç»ˆçš„ html</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line">export async function renderToHTML(</span><br><span class="line">  req: IncomingMessage,</span><br><span class="line">  res: ServerResponse,</span><br><span class="line">  pathname: string,</span><br><span class="line">  query: ParsedUrlQuery,</span><br><span class="line">  renderOpts: RenderOpts</span><br><span class="line">): Promise&lt;string | null&gt; &#123;</span><br><span class="line">....</span><br><span class="line">  let props: any</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  const AppContainer = (&#123; children &#125;: any) =&gt; (</span><br><span class="line">    &lt;RouterContext.Provider value=&#123;router&#125;&gt;</span><br><span class="line">      &lt;DataManagerContext.Provider value=&#123;dataManager&#125;&gt;</span><br><span class="line">        &lt;AmpStateContext.Provider value=&#123;ampState&#125;&gt;</span><br><span class="line">          &lt;LoadableContext.Provider</span><br><span class="line">            value=&#123;moduleName =&gt; reactLoadableModules.push(moduleName)&#125;</span><br><span class="line">          &gt;</span><br><span class="line">            &#123;children&#125;</span><br><span class="line">          &lt;/LoadableContext.Provider&gt;</span><br><span class="line">        &lt;/AmpStateContext.Provider&gt;</span><br><span class="line">      &lt;/DataManagerContext.Provider&gt;</span><br><span class="line">    &lt;/RouterContext.Provider&gt;</span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">  try &#123;</span><br><span class="line">    props = await loadGetInitialProps(App, &#123;</span><br><span class="line">      AppTree: ctx.AppTree,</span><br><span class="line">      Component,</span><br><span class="line">      router,</span><br><span class="line">      ctx,</span><br><span class="line">    &#125;)</span><br><span class="line">    ......</span><br><span class="line"> &#125;</span><br><span class="line"> ....</span><br><span class="line">    renderPage = (</span><br><span class="line">      options: ComponentsEnhancer = &#123;&#125;</span><br><span class="line">    ): &#123; html: string; head: any &#125; =&gt; &#123;</span><br><span class="line">      const renderError = renderPageError()</span><br><span class="line">      if (renderError) return renderError</span><br><span class="line"></span><br><span class="line">      const &#123;</span><br><span class="line">        App: EnhancedApp,</span><br><span class="line">        Component: EnhancedComponent,</span><br><span class="line">      &#125; = enhanceComponents(options, App, Component)</span><br><span class="line"></span><br><span class="line">      return render(</span><br><span class="line">        renderElementToString,</span><br><span class="line">        &lt;AppContainer&gt;</span><br><span class="line">          &lt;EnhancedApp</span><br><span class="line">            Component=&#123;EnhancedComponent&#125;</span><br><span class="line">            router=&#123;router&#125;</span><br><span class="line">            &#123;...props&#125;</span><br><span class="line">          /&gt;</span><br><span class="line">        &lt;/AppContainer&gt;,</span><br><span class="line">        ampState</span><br><span class="line">      )</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line">  const documentCtx = &#123; ...ctx, renderPage &#125;</span><br><span class="line">  const docProps = await loadGetInitialProps(Document, documentCtx)</span><br><span class="line">  // the response might be finished on the getInitialProps call</span><br><span class="line">  if (isResSent(res) &amp;&amp; !isSpr) return null</span><br><span class="line"></span><br><span class="line">  let dataManagerData = &apos;[]&apos;</span><br><span class="line">  if (dataManager) &#123;</span><br><span class="line">    dataManagerData = JSON.stringify([...dataManager.getData()])</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  if (!docProps || typeof docProps.html !== &apos;string&apos;) &#123;</span><br><span class="line">    const message = `&quot;$&#123;getDisplayName(</span><br><span class="line">      Document</span><br><span class="line">    )&#125;.getInitialProps()&quot; should resolve to an object with a &quot;html&quot; prop set with a valid html string`</span><br><span class="line">    throw new Error(message)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  if (docProps.dataOnly) &#123;</span><br><span class="line">    return dataManagerData</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  const dynamicImportIdsSet = new Set&lt;string&gt;()</span><br><span class="line">  const dynamicImports: ManifestItem[] = []</span><br><span class="line"></span><br><span class="line">  for (const mod of reactLoadableModules) &#123;</span><br><span class="line">    const manifestItem = reactLoadableManifest[mod]</span><br><span class="line"></span><br><span class="line">    if (manifestItem) &#123;</span><br><span class="line">      manifestItem.map(item =&gt; &#123;</span><br><span class="line">        dynamicImports.push(item)</span><br><span class="line">        dynamicImportIdsSet.add(item.id as string)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  const dynamicImportsIds = [...dynamicImportIdsSet]</span><br><span class="line">  const inAmpMode = isInAmpMode(ampState)</span><br><span class="line">  const hybridAmp = ampState.hybrid</span><br><span class="line"></span><br><span class="line">  // update renderOpts so export knows current state</span><br><span class="line">  renderOpts.inAmpMode = inAmpMode</span><br><span class="line">  renderOpts.hybridAmp = hybridAmp</span><br><span class="line"></span><br><span class="line">  let html = renderDocument(Document, &#123;</span><br><span class="line">    ...renderOpts,</span><br><span class="line">    dangerousAsPath: router.asPath,</span><br><span class="line">    dataManagerData,</span><br><span class="line">    ampState,</span><br><span class="line">    props,</span><br><span class="line">    headTags: await headTags(documentCtx),</span><br><span class="line">    bodyTags: await bodyTags(documentCtx),</span><br><span class="line">    htmlProps: await htmlProps(documentCtx),</span><br><span class="line">    docProps,</span><br><span class="line">    pathname,</span><br><span class="line">    ampPath,</span><br><span class="line">    query,</span><br><span class="line">    inAmpMode,</span><br><span class="line">    hybridAmp,</span><br><span class="line">    dynamicImportsIds,</span><br><span class="line">    dynamicImports,</span><br><span class="line">    files,</span><br><span class="line">    devFiles,</span><br><span class="line">    polyfillFiles,</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  if (inAmpMode &amp;&amp; html) &#123;</span><br><span class="line">    // use replace to allow rendering directly to body in AMP mode</span><br><span class="line">    html = html.replace(</span><br><span class="line">      &apos;__NEXT_AMP_RENDER_TARGET__&apos;,</span><br><span class="line">      `&lt;!-- __NEXT_DATA__ --&gt;$&#123;docProps.html&#125;`</span><br><span class="line">    )</span><br><span class="line">    html = await optimizeAmp(html)</span><br><span class="line"></span><br><span class="line">    if (renderOpts.ampValidator) &#123;</span><br><span class="line">      await renderOpts.ampValidator(html, pathname)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  if (inAmpMode || hybridAmp) &#123;</span><br><span class="line">    // fix &amp;amp being escaped for amphtml rel link</span><br><span class="line">    html = html.replace(/&amp;amp;amp=1/g, &apos;&amp;amp=1&apos;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return html</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ renderElementToString æ¸²æŸ“è·å– html</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">function render(</span><br><span class="line">  renderElementToString: (element: React.ReactElement&lt;any&gt;) =&gt; string,</span><br><span class="line">  element: React.ReactElement&lt;any&gt;,</span><br><span class="line">  ampMode: any</span><br><span class="line">): &#123; html: string; head: React.ReactElement[] &#125; &#123;</span><br><span class="line">  let html</span><br><span class="line">  let head</span><br><span class="line"></span><br><span class="line">  try &#123;</span><br><span class="line">    html = renderElementToString(element)</span><br><span class="line">  &#125; finally &#123;</span><br><span class="line">    head = Head.rewind() || defaultHead(isInAmpMode(ampMode))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return &#123; html, head &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ°è¿™é‡ŒåŸºæœ¬å°±ç»“æŸäº†</p><p>Nextjs è¿˜å¯ä»¥æœ‰å¾ˆå¤šè‡ªå®šçš„ä¸œè¥¿ï¼Œä¸ koaï¼Œexpress ç»“åˆï½</p><h3 id="å‚è€ƒ"><a class="markdownIt-Anchor" href="#å‚è€ƒ"></a> å‚è€ƒ</h3><p><a href="https://nextjs.org/" target="_blank" rel="noopener">https://nextjs.org/</a></p><h3 id="åç»­"><a class="markdownIt-Anchor" href="#åç»­"></a> åç»­</h3><p>åšå¤§ç²¾æ·±å•Š</p>]]></content>
    
    <summary type="html">
    
      æœ€è¿‘åœ¨ç ”ç©¶SSRæœåŠ¡ç«¯æ¸²æŸ“ï¼ŒNextJS ç®—æ˜¯æ¯”è¾ƒç»å…¸çš„æ¡†æ¶äº†ï¼Œæ‰€ä»¥äº†è§£äº†è§£å…¶ç”¨æ³•å¯¹SSRæˆ–è®¸èƒ½åŠ æ·±ç†è§£ã€‚å¦‚æœèƒ½äº†è§£å…¶å®ç°åŸç†ï¼Œé‚£å°±æ›´å¥½äº†
    
    </summary>
    
      <category term="JavaScript" scheme="https://wzes.github.io/categories/JavaScript/"/>
    
    
      <category term="JavaScript" scheme="https://wzes.github.io/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>Intersection Obersever API ä¸­æ–‡</title>
    <link href="https://wzes.github.io/2019/10/26/JavaScript/IntersectionObserverAPI/"/>
    <id>https://wzes.github.io/2019/10/26/JavaScript/IntersectionObserverAPI/</id>
    <published>2019-10-26T07:30:16.000Z</published>
    <updated>2019-10-26T07:16:55.511Z</updated>
    
    <content type="html"><![CDATA[<h2 id="intersection-observer-ç®€ä»‹"><a class="markdownIt-Anchor" href="#intersection-observer-ç®€ä»‹"></a> Intersection observer ç®€ä»‹</h2><p><strong>Intersection Observer API</strong> æä¾›äº†ä¸€ç§å¼‚æ­¥è§‚å¯Ÿç›®æ ‡å…ƒç´ ä¸ç¥–å…ˆå…ƒç´ æˆ–é¡¶çº§æ–‡æ¡£çš„è§†å£ç›¸äº¤çš„æ–¹æ³•ã€‚</p><p>åœ¨ä»¥å‰ï¼Œæ£€æµ‹ä¸€ä¸ªå…ƒç´ çš„å¯è§æ€§æˆ–ä¸¤ä¸ªå…ƒç´ ç›¸å¯¹äºå½¼æ­¤çš„ç›¸å¯¹å¯è§æ€§ä¸€ç›´æ˜¯ä¸€é¡¹è‰°å·¨çš„ä»»åŠ¡ï¼Œå…¶è§£å†³æ–¹æ¡ˆä¸å¯é ä¸”æ˜“äºå¯¼è‡´æµè§ˆå™¨å’Œç”¨æˆ·è®¿é—®çš„ç½‘é¡µå˜æ…¢ã€‚ éšç€ç½‘ç»œçš„æˆç†Ÿï¼Œå¯¹æ­¤ç±»åŠŸèƒ½çš„éœ€æ±‚ä¹Ÿåœ¨å¢é•¿ã€‚ å‡ºäºå¤šç§åŸå› éœ€è¦å…ƒç´ çš„å¯è§æ€§ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼š</p><ul><li><p>æ»šåŠ¨é¡µé¢æ—¶å»¶è¿ŸåŠ è½½å›¾åƒæˆ–å…¶ä»–å†…å®¹ã€‚</p></li><li><p>å®ç°â€œæ— é™æ»šåŠ¨â€çš„ç½‘é¡µï¼Œåœ¨æ‚¨æ»šåŠ¨æ—¶ä¼šåŠ è½½å’Œå‘ˆç°è¶Šæ¥è¶Šå¤šçš„å†…å®¹ï¼Œä»è€Œä½¿ç”¨æˆ·ä¸å¿…ç¿»é˜…é¡µé¢ã€‚</p></li><li><p>ç»Ÿè®¡å¹¿å‘Šå¯è§åº¦ï¼Œä»¥è®¡ç®—å¹¿å‘Šæ”¶å…¥ã€‚</p></li><li><p>æ ¹æ®ç”¨æˆ·æ˜¯å¦ä¼šçœ‹åˆ°ç»“æœæ¥å†³å®šæ˜¯å¦æ‰§è¡Œä»»åŠ¡æˆ–åŠ¨ç”»å¤„ç†ã€‚</p></li></ul><p>è¿‡å»å®ç°äº¤å‰æ£€æµ‹é€šå¸¸æ¶‰åŠåˆ°äº‹ä»¶å¤„ç†ç¨‹åºï¼Œå¹¶ä¸”å¾ªç¯è°ƒç”¨ <code>Element.getBoundingClientRectï¼ˆï¼‰</code>ä¹‹ç±»çš„æ–¹æ³•æ¥ä¸ºæ¯ä¸ªå—å½±å“çš„å…ƒç´ å»ºç«‹æ‰€éœ€çš„ä¿¡æ¯ã€‚ ç”±äºæ‰€æœ‰è¿™äº›ä»£ç éƒ½åœ¨ä¸»çº¿ç¨‹ä¸Šè¿è¡Œï¼Œå› æ­¤å³ä½¿åªæœ‰ä¸€ä¸ªï¼Œä¹Ÿå¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚ å½“ç½‘ç«™åŠ è½½äº†è¿™äº›æµ‹è¯•æ—¶ï¼Œäº‹æƒ…å¯èƒ½ä¼šå˜å¾—å¾ˆéš¾çœ‹ã€‚</p><p>è€ƒè™‘ä½¿ç”¨æ— é™æ»šåŠ¨çš„ç½‘é¡µã€‚å®ƒä½¿ç”¨ä¾›åº”å•†æä¾›çš„åº“æ¥ç®¡ç†åœ¨æ•´ä¸ªé¡µé¢ä¸­å®šæœŸæ”¾ç½®çš„å¹¿å‘Šï¼Œè¿™äº›å¹¿å‘Šå…·æœ‰åŠ¨ç”»å›¾å½¢ï¼Œä½¿ç”¨è‡ªå®šä¹‰åº“ç»˜åˆ¶é€šçŸ¥æ¡†ç­‰ç­‰ã€‚æ¯ä¸ªå…ƒç´ éƒ½æœ‰å…¶è‡ªå·±çš„ç›¸äº¤æ£€æµ‹ç¨‹åºï¼Œå®ƒä»¬å‡åœ¨ä¸»çº¿ç¨‹ä¸Šè¿è¡Œã€‚è¯¥ç½‘ç«™çš„ä½œè€…ç”šè‡³å¯èƒ½æ²¡æœ‰æ„è¯†åˆ°è¿™ç§æƒ…å†µçš„å‘ç”Ÿï¼Œå› ä¸ºä»–ä»¬å¯èƒ½å¯¹æ‰€ä½¿ç”¨çš„ä¸¤ä¸ªåº“çš„å†…éƒ¨è¿ä½œäº†è§£å¾—å¾ˆå°‘ã€‚å½“ç”¨æˆ·æ»šåŠ¨é¡µé¢æ—¶ï¼Œè¿™äº›ç›¸äº¤æ£€æµ‹ç¨‹åºåœ¨æ»šåŠ¨å¤„ç†ä»£ç æœŸé—´ä¸æ–­è§¦å‘ï¼Œä»è€Œå¯¼è‡´ç”¨æˆ·å¯¹æµè§ˆå™¨ï¼Œç½‘ç«™åŠå…¶è®¡ç®—æœºæ„Ÿåˆ°å´©æºƒã€‚</p><p><strong>Intersection Observer API</strong> ä½¿ä»£ç å¯ä»¥æ³¨å†Œä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œè¯¥å›è°ƒå‡½æ•°å°†åœ¨ä»–ä»¬å¸Œæœ›ç›‘è§†çš„å…ƒç´ è¿›å…¥æˆ–é€€å‡ºå¦ä¸€ä¸ªå…ƒç´ ï¼ˆæˆ–è§†å£ï¼‰æ—¶ï¼Œæˆ–è€…å½“ä¸¤ä¸ªç›¸äº¤çš„é‡æ”¹å˜è¯·æ±‚çš„é‡æ—¶æ‰§è¡Œã€‚è¿™æ ·ï¼Œç«™ç‚¹ä¸å†éœ€è¦åœ¨<strong>ä¸»çº¿ç¨‹</strong>ä¸Šæ‰§è¡Œä»»ä½•æ“ä½œæ¥ç›‘è§†è¿™ç§å…ƒç´ äº¤é›†ï¼Œå¹¶ä¸”æµè§ˆå™¨å¯ä»¥è‡ªç”±åœ°ä¼˜åŒ–äº¤é›†çš„ç®¡ç†ã€‚</p><p>Intersection Observer APIä¸èƒ½å‘Šè¯‰æ‚¨çš„ä¸€ä»¶äº‹ï¼šé‡å çš„ç¡®åˆ‡åƒç´ æ•°æˆ–ç¡®åˆ‡åœ°è¯´æ˜¯é‡å åƒç´ ã€‚ä½†æ˜¯ï¼Œå®ƒæ¶µç›–äº†æ›´å¸¸è§çš„ç”¨ä¾‹ï¼šâ€œå¦‚æœå®ƒä»¬ç›¸äº¤Nï¼…å·¦å³ï¼Œæˆ‘éœ€è¦åšç‚¹ä»€ä¹ˆã€‚â€</p><h2 id="intersection-observer-æ¦‚å¿µå’Œä½¿ç”¨"><a class="markdownIt-Anchor" href="#intersection-observer-æ¦‚å¿µå’Œä½¿ç”¨"></a> Intersection observer æ¦‚å¿µå’Œä½¿ç”¨</h2><p>Intersection Observer APIå…è®¸æ‚¨é…ç½®ä¸€ä¸ª callbackï¼Œåªè¦ä¸€ä¸ªå…ƒç´ ï¼ˆç§°ä¸ºç›®æ ‡ï¼‰ä¸è®¾å¤‡è§†å£æˆ–æŒ‡å®šå…ƒç´ ç›¸äº¤ï¼Œå°±ä¼šè°ƒç”¨è¯¥ callbackã€‚ å°±æ­¤APIè€Œè¨€ï¼Œè¿™ç§°ä¸ºæ ¹å…ƒç´ æˆ–æ ¹ã€‚ é€šå¸¸ï¼Œæ‚¨å°†éœ€è¦æ³¨æ„ä¸å…ƒç´ æœ€æ¥è¿‘çš„å¯æ»šåŠ¨ç¥–å…ˆç›¸å…³çš„ç›¸äº¤å˜åŒ–ï¼Œæˆ–è€…ï¼Œå¦‚æœå…ƒç´ ä¸æ˜¯å¯æ»šåŠ¨å…ƒç´ çš„åä»£ï¼Œåˆ™è¦è§‚å¯Ÿè§†å£ã€‚ è¦æ³¨æ„ç›¸å¯¹äºæ ¹å…ƒç´ çš„äº¤ç‚¹ï¼Œè¯·æŒ‡å®šnullã€‚</p><p>æ— è®ºæ‚¨æ˜¯ä½¿ç”¨è§†å£è¿˜æ˜¯å…¶ä»–å…ƒç´ ä½œä¸ºæ ¹ï¼ŒAPIéƒ½ä»¥ç›¸åŒçš„æ–¹å¼å·¥ä½œï¼Œåªè¦ç›®æ ‡å…ƒç´ çš„å¯è§æ€§å‘ç”Ÿå˜åŒ–ï¼Œä»¥ä¾¿ä¸æ ¹äº¤å‰è¶…è¿‡æ‰€éœ€çš„äº¤é›†é‡ï¼Œå°±æ‰§è¡Œæ‚¨æä¾›çš„å›è°ƒå‡½æ•°ã€‚</p><p>ç›®æ ‡å…ƒç´ ä¸å…¶æ ¹ä¹‹é—´çš„ç›¸äº¤åº¦ä¸ºç›¸äº¤æ¯”ã€‚ è¿™è¡¨ç¤ºç›®æ ‡å…ƒç´ çš„ç™¾åˆ†æ¯”ï¼Œè¯¥ç™¾åˆ†æ¯”å¯è§ä¸º0.0åˆ°1.0ä¹‹é—´çš„å€¼ã€‚</p><h3 id="åˆ›å»ºä¸€ä¸ª-intersection-observer"><a class="markdownIt-Anchor" href="#åˆ›å»ºä¸€ä¸ª-intersection-observer"></a> åˆ›å»ºä¸€ä¸ª intersection observer</h3><p>é€šè¿‡è°ƒç”¨äº¤é›†è§‚å¯Ÿå™¨çš„æ„é€ å‡½æ•°å¹¶å‘å…¶ä¼ é€’ä¸€ä¸ªå›è°ƒå‡½æ•°æ¥åˆ›å»ºäº¤é›†è§‚å¯Ÿè€…ï¼Œåªè¦åœ¨ä¸€ä¸ªæ–¹å‘æˆ–å¦ä¸€ä¸ªæ–¹å‘ä¸Šè¶…è¿‡é˜ˆå€¼ï¼Œè¯¥å›è°ƒå‡½æ•°ä¾¿ä¼šè¿è¡Œï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">let options = &#123;</span><br><span class="line">  root: document.querySelector(&apos;#scrollArea&apos;),</span><br><span class="line">  rootMargin: &apos;0px&apos;,</span><br><span class="line">  threshold: 1.0</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let observer = new IntersectionObserver(callback, options);</span><br></pre></td></tr></table></figure><p>é˜ˆå€¼1.0è¡¨ç¤ºåœ¨rooté€‰é¡¹æŒ‡å®šçš„å…ƒç´ ä¸­å¯è§ç›®æ ‡çš„100ï¼…æ—¶ï¼Œå°†è°ƒç”¨å›è°ƒã€‚</p><h4 id="intersection-observer-options-å‚æ•°"><a class="markdownIt-Anchor" href="#intersection-observer-options-å‚æ•°"></a> Intersection observer options å‚æ•°</h4><p>ä¼ é€’ç»™ <code>IntersectionObserverï¼ˆï¼‰</code>æ„é€ å‡½æ•°çš„ <code>options</code> å¯¹è±¡ä½¿æ‚¨å¯ä»¥æ§åˆ¶åœ¨å“ªäº›æƒ…å†µä¸‹è°ƒç”¨è§‚å¯Ÿè€…çš„å›è°ƒã€‚ å®ƒå…·æœ‰ä»¥ä¸‹å­—æ®µï¼š</p><ul><li><p><strong>root</strong></p><p>ç”¨ä½œæ£€æŸ¥ç›®æ ‡å¯è§æ€§çš„è§†å£çš„å…ƒç´ ã€‚ å¿…é¡»æ˜¯ç›®æ ‡çš„ç¥–å…ˆã€‚ å¦‚æœæœªæŒ‡å®šæˆ–ä¸ºnullï¼Œåˆ™é»˜è®¤ä¸ºæµè§ˆå™¨è§†å£ã€‚</p></li><li><p><strong>rootMargin</strong></p><p>å›´ç»•æ ¹çš„è¾¹è·ã€‚å¯ä»¥å…·æœ‰ç±»ä¼¼äºCSS <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/margin" target="_blank" rel="noopener"><code>margin</code></a>å±æ€§çš„å€¼ï¼Œä¾‹å¦‚ <code>&quot;10px 20px 30px 40px&quot;</code>ï¼ˆï¼ˆä¸Šï¼Œå³ï¼Œä¸‹ï¼Œå·¦ï¼‰ã€‚è¿™äº›å€¼å¯ä»¥æ˜¯ç™¾åˆ†æ¯”ã€‚è¿™ç»„å€¼ç”¨äºåœ¨è®¡ç®—ç›¸äº¤ä¹‹å‰å¢å¤§æˆ–ç¼©å°æ ¹å…ƒç´ è¾¹ç•Œæ¡†çš„æ¯ä¸€ä¾§ã€‚é»˜è®¤ä¸ºå…¨é›¶ã€‚</p></li><li><p><strong>threshold</strong></p><p>ä¸€ä¸ªæ•°å­—æˆ–ä¸€ä¸ªæ•°å­—æ•°ç»„ï¼ŒæŒ‡ç¤ºè§‚å¯Ÿè€…çš„å›è°ƒåº”åœ¨ç›®æ ‡å¯è§æ€§çš„ç™¾åˆ†æ¯”ä¸Šæ‰§è¡Œã€‚å¦‚æœåªæƒ³æ£€æµ‹å¯è§æ€§ä½•æ—¶è¶…è¿‡50ï¼…æ ‡è®°ï¼Œåˆ™å¯ä»¥ä½¿ç”¨0.5å€¼ã€‚å¦‚æœå¸Œæœ›æ¯æ¬¡å¯è§æ€§å†è¶…è¿‡25ï¼…æ—¶éƒ½è¿è¡Œå›è°ƒï¼Œåˆ™å¯ä»¥æŒ‡å®šæ•°ç»„[0ï¼Œ0.25ï¼Œ0.5ï¼Œ0.75ï¼Œ1]ã€‚é»˜è®¤å€¼ä¸º0ï¼ˆæ„å‘³ç€å³ä½¿å¯è§ä¸€ä¸ªåƒç´ ï¼Œå›è°ƒä¹Ÿå°†è¿è¡Œï¼‰ã€‚å€¼ä¸º1.0æ„å‘³ç€ç›´åˆ°æ¯ä¸ªåƒç´ éƒ½å¯è§ï¼Œæ‰è®¤ä¸ºé˜ˆå€¼å·²é€šè¿‡ã€‚</p></li></ul><h4 id="å®šä½è¦è§‚å¯Ÿçš„å…ƒç´ "><a class="markdownIt-Anchor" href="#å®šä½è¦è§‚å¯Ÿçš„å…ƒç´ "></a> å®šä½è¦è§‚å¯Ÿçš„å…ƒç´ </h4><p>åˆ›å»ºè§‚å¯Ÿè€…åï¼Œéœ€è¦ç»™å®ƒä¸€ä¸ªç›®æ ‡å…ƒç´ ä»¥è¿›è¡Œè§‚å¯Ÿï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let target = document.querySelector(&apos;#listItem&apos;);</span><br><span class="line">observer.observe(target);</span><br></pre></td></tr></table></figure><p>æ¯å½“ç›®æ ‡è¾¾åˆ°ä¸ºæ‰€æŒ‡å®šçš„é˜ˆå€¼æ—¶<code>IntersectionObserver</code>ï¼Œå°±ä¼šè°ƒç”¨å›è°ƒã€‚å›è°ƒæ¥æ”¶<a href="https://developer.mozilla.org/en-US/docs/Web/API/IntersectionObserverEntry" target="_blank" rel="noopener"><code>IntersectionObserverEntry</code></a>å¯¹è±¡åˆ—è¡¨å’Œè§‚å¯Ÿè€…ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">let callback = (entries, observer) =&gt; &#123; </span><br><span class="line">  entries.forEach(entry =&gt; &#123;</span><br><span class="line">    // Each entry describes an intersection change for one observed</span><br><span class="line">    // target element:</span><br><span class="line">    //   entry.boundingClientRect</span><br><span class="line">    //   entry.intersectionRatio</span><br><span class="line">    //   entry.intersectionRect</span><br><span class="line">    //   entry.isIntersecting</span><br><span class="line">    //   entry.rootBounds</span><br><span class="line">    //   entry.target</span><br><span class="line">    //   entry.time</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>è¯·æ³¨æ„ï¼Œæ‚¨çš„å›è°ƒæ˜¯åœ¨ä¸»çº¿ç¨‹ä¸Šæ‰§è¡Œçš„ã€‚å®ƒåº”å°½å¿«è¿è¡Œï¼›å¦‚æœéœ€è¦å®Œæˆä»»ä½•è€—æ—¶çš„æ“ä½œï¼Œè¯·ä½¿ç”¨<a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/requestIdleCallback" target="_blank" rel="noopener"><code>Window.requestIdleCallback()</code></a>ã€‚</p><p>å¦å¤–ï¼Œè¯·æ³¨æ„ï¼Œå¦‚æœæŒ‡å®šäº†è¯¥<code>root</code>é€‰é¡¹ï¼Œåˆ™ç›®æ ‡å¿…é¡»æ˜¯æ ¹å…ƒç´ çš„åä»£ã€‚</p><h3 id="å¦‚ä½•è®¡ç®—äº¤é›†"><a class="markdownIt-Anchor" href="#å¦‚ä½•è®¡ç®—äº¤é›†"></a> å¦‚ä½•è®¡ç®—äº¤é›†</h3><p>Intersection Observer APIè€ƒè™‘çš„æ‰€æœ‰åŒºåŸŸéƒ½æ˜¯çŸ©å½¢ã€‚å½¢çŠ¶ä¸è§„åˆ™çš„å…ƒç´ è¢«è®¤ä¸ºå æ®äº†åŒ…å›´å…ƒç´ æ‰€æœ‰éƒ¨åˆ†çš„æœ€å°çŸ©å½¢ã€‚ç±»ä¼¼åœ°ï¼Œå¦‚æœå…ƒç´ çš„å¯è§éƒ¨åˆ†ä¸æ˜¯çŸ©å½¢ï¼Œåˆ™è¯¥å…ƒç´ çš„ç›¸äº¤çŸ©å½¢è¢«è§£é‡Šä¸ºåŒ…å«è¯¥å…ƒç´ æ‰€æœ‰å¯è§éƒ¨åˆ†çš„æœ€å°çŸ©å½¢ã€‚</p><p>äº†è§£ä¸€ç‚¹æœ‰å…³æä¾›çš„å„ç§å±æ€§å¦‚ä½•<a href="https://developer.mozilla.org/en-US/docs/Web/API/IntersectionObserverEntry" target="_blank" rel="noopener"><code>IntersectionObserverEntry</code></a>æè¿°ç›¸äº¤çš„æ–¹æ³•å¾ˆæœ‰ç”¨ã€‚</p><h4 id="äº¤ç‚¹æ ¹å’Œæ ¹è¾¹è·"><a class="markdownIt-Anchor" href="#äº¤ç‚¹æ ¹å’Œæ ¹è¾¹è·"></a> äº¤ç‚¹æ ¹å’Œæ ¹è¾¹è·</h4><p>åœ¨è·Ÿè¸ªå…ƒç´ ä¸å®¹å™¨çš„äº¤é›†ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“è¯¥å®¹å™¨æ˜¯ä»€ä¹ˆã€‚è¯¥å®¹å™¨æ˜¯<strong>äº¤é›†æ ¹</strong>æˆ–<strong>æ ¹å…ƒç´ </strong>ã€‚è¿™å¯ä»¥æ˜¯æ–‡æ¡£ä¸­çš„ç‰¹å®šå…ƒç´ ï¼ˆæ˜¯è¦è§‚å¯Ÿçš„å…ƒç´ çš„ç¥–å…ˆï¼‰ï¼Œä¹Ÿ<code>null</code>å¯ä»¥æ˜¯æ–‡æ¡£çš„è§†å£ä½œä¸ºå®¹å™¨ã€‚</p><p><strong>æ ¹çš„ç›¸äº¤çŸ©å½¢</strong>æ˜¯ç”¨äºæ‰€è¦æ£€æŸ¥çš„ç›®æ ‡æˆ–ç›®æ ‡çš„çŸ©å½¢ã€‚è¯¥çŸ©å½¢çš„ç¡®å®šå¦‚ä¸‹ï¼š</p><ul><li>å¦‚æœç›¸äº¤æ ¹æ˜¯éšå¼æ ¹ï¼ˆå³é¡¶çº§<a href="https://developer.mozilla.org/en-US/docs/Web/API/Document" target="_blank" rel="noopener"><code>Document</code></a>ï¼‰ï¼Œåˆ™æ ¹ç›¸äº¤çŸ©å½¢æ˜¯è§†å£çš„çŸ©å½¢ã€‚</li><li>å¦‚æœç›¸äº¤æ ¹å…·æœ‰æº¢å‡ºå‰ªè¾‘ï¼Œåˆ™æ ¹ç›¸äº¤çŸ©å½¢æ˜¯æ ¹å…ƒç´ çš„å†…å®¹åŒºåŸŸã€‚</li><li>å¦åˆ™ï¼Œæ ¹ç›¸äº¤çŸ©å½¢æ˜¯ç›¸äº¤æ ¹çš„è¾¹ç•Œå®¢æˆ·ç«¯çŸ©å½¢ï¼ˆé€šè¿‡è°ƒç”¨<a href="https://developer.mozilla.org/en-US/docs/Web/API/Element/getBoundingClientRect" target="_blank" rel="noopener"><code>getBoundingClientRect()</code></a>å®ƒè¿”å›ï¼‰ã€‚</li></ul><p>åˆ›å»ºæ—¶ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®<strong>æ ¹è¾¹ç¼˜</strong>æ¥è¿›ä¸€æ­¥è°ƒæ•´æ ¹ç›¸äº¤çŸ©å½¢ã€‚å®šä¹‰åç§»é‡ä¸­çš„å€¼æ·»åŠ åˆ°ç›¸äº¤æ ¹çš„è¾¹ç•Œæ¡†çš„æ¯ä¸€ä¾§ï¼Œä»¥åˆ›å»ºæœ€ç»ˆçš„ç›¸äº¤æ ¹è¾¹ç•Œï¼ˆåœ¨æ‰§è¡Œå›è°ƒæ—¶å…¬å¼€ï¼‰ã€‚<code>rootMargin</code><a href="https://developer.mozilla.org/en-US/docs/Web/API/IntersectionObserver" target="_blank" rel="noopener"><code>IntersectionObserver</code></a><code>rootMargin</code><a href="https://developer.mozilla.org/en-US/docs/Web/API/IntersectionObserverEntry/rootBounds" target="_blank" rel="noopener"><code>IntersectionObserverEntry.rootBounds</code></a></p><h4 id="thresholds-é—¨æ§›"><a class="markdownIt-Anchor" href="#thresholds-é—¨æ§›"></a> Thresholds é—¨æ§›</h4><p>Intersection Observer APIä½¿ç”¨<strong>é˜ˆå€¼</strong>ï¼Œè€Œä¸æ˜¯æŠ¥å‘Šå¯è§çš„ç›®æ ‡å…ƒç´ å¤šå°‘å¾®å°å˜åŒ–ã€‚åˆ›å»ºè§‚å¯Ÿè€…æ—¶ï¼Œå¯ä»¥æä¾›ä¸€ä¸ªæˆ–å¤šä¸ªæ•°å­—å€¼ï¼Œè¿™äº›æ•°å­—å€¼è¡¨ç¤ºå¯è§çš„ç›®æ ‡å…ƒç´ çš„ç™¾åˆ†æ¯”ã€‚ç„¶åï¼ŒAPIä»…æŠ¥å‘Šè¶…è¿‡è¿™äº›é˜ˆå€¼çš„å¯è§æ€§æ›´æ”¹ã€‚</p><p>ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨å¸Œæœ›æ¯æ¬¡ç›®æ ‡çš„å¯è§æ€§é€šè¿‡æ¯ä¸ª25ï¼…æ ‡è®°å‘åæˆ–å‘å‰ç§»åŠ¨æ—¶éƒ½å¾—åˆ°é€šçŸ¥ï¼Œåˆ™åœ¨åˆ›å»ºè§‚å¯Ÿè€…æ—¶ï¼Œå¯ä»¥å°†æ•°ç»„[0ï¼Œ0.25ï¼Œ0.5ï¼Œ0.75ï¼Œ1]æŒ‡å®šä¸ºé˜ˆå€¼åˆ—è¡¨ã€‚æ‚¨å¯ä»¥é€šè¿‡åœ¨å¯è§æ€§æ›´æ”¹æ—¶æ£€æŸ¥ä¼ é€’ç»™å›è°ƒå‡½æ•°çš„<a href="https://developer.mozilla.org/en-US/docs/Web/API/IntersectionObserverEntry/isIntersecting" target="_blank" rel="noopener"><code>isIntersecting</code></a>å±æ€§å€¼ï¼Œæ¥ç¡®å®šå¯è§æ€§çš„å˜åŒ–æ–¹å‘ï¼ˆå³ï¼Œå…ƒç´ å˜å¾—æ›´å¯è§è¿˜æ˜¯ä¸å¯è§ï¼‰<a href="https://developer.mozilla.org/en-US/docs/Web/API/IntersectionObserverEntry" target="_blank" rel="noopener"><code>IntersectionObserverEntry</code></a>ã€‚å¦‚æœ<code>isIntersecting</code>ä¸º<code>true</code>ï¼Œåˆ™ç›®æ ‡å…ƒç´ å·²å˜å¾—è‡³å°‘ä¸å·²é€šè¿‡çš„é˜ˆå€¼ä¸€æ ·å¯è§ã€‚å¦‚æœä¸º<code>false</code>ï¼Œåˆ™ç›®æ ‡ä¸å†åƒç»™å®šé˜ˆå€¼é‚£æ ·å¯è§ã€‚</p><p>è¦äº†è§£é˜ˆå€¼çš„å·¥ä½œåŸç†ï¼Œè¯·å°è¯•æ»šåŠ¨ä¸‹é¢çš„æ¡†ã€‚å…¶ä¸­çš„æ¯ä¸ªå½©è‰²æ¡†éƒ½ä¼šæ˜¾ç¤ºå…¶åœ¨å››ä¸ªè§’ä¸Šéƒ½å¯è§çš„ç™¾åˆ†æ¯”ï¼Œå› æ­¤æ‚¨å¯ä»¥åœ¨æ»šåŠ¨å®¹å™¨æ—¶çœ‹åˆ°è¿™äº›æ¯”ä¾‹éšæ—¶é—´çš„å˜åŒ–ã€‚æ¯ä¸ªæ¡†éƒ½æœ‰ä¸åŒçš„é˜ˆå€¼é›†ï¼š</p><ul><li>ç¬¬ä¸€ä¸ªæ¡†æœ‰ä¸€ä¸ªé’ˆå¯¹æ¯ä¸ªå¯è§åº¦ç™¾åˆ†æ¯”çš„é˜ˆå€¼ï¼›ä¹Ÿå°±æ˜¯è¯´ï¼Œ<a href="https://developer.mozilla.org/en-US/docs/Web/API/IntersectionObserver/thresholds" target="_blank" rel="noopener"><code>IntersectionObserver.thresholds</code></a>æ•°ç»„æ˜¯<code>[0.00, 0.01, 0.02, ..., 0.99, 1.00]</code>ã€‚</li><li>ç¬¬äºŒä¸ªæ¡†åªæœ‰ä¸€ä¸ªé˜ˆå€¼ï¼Œä¸º50ï¼…ã€‚</li><li>ç¬¬ä¸‰ä¸ªæ¡†çš„é˜ˆå€¼æ˜¯å¯è§æ€§çš„æ¯10ï¼…ï¼ˆ0ï¼…ï¼Œ10ï¼…ï¼Œ20ï¼…ç­‰ï¼‰ã€‚</li><li>æœ€åä¸€ä¸ªæ¡†çš„é˜ˆå€¼å„ä¸º25ï¼…ã€‚</li></ul><h4 id="è£å‰ªå’Œäº¤ç‚¹çŸ©å½¢"><a class="markdownIt-Anchor" href="#è£å‰ªå’Œäº¤ç‚¹çŸ©å½¢"></a> è£å‰ªå’Œäº¤ç‚¹çŸ©å½¢</h4><p>æµè§ˆå™¨æŒ‰ä»¥ä¸‹æ–¹å¼è®¡ç®—æœ€ç»ˆçš„ç›¸äº¤çŸ©å½¢ï¼šè¿™ä¸€åˆ‡éƒ½ä¸ºæ‚¨å®Œæˆï¼Œä½†æ˜¯äº†è§£è¿™äº›æ­¥éª¤æœ‰åŠ©äºæ›´å¥½åœ°å‡†ç¡®æŠŠæ¡ä½•æ—¶å‘ç”Ÿäº¤å‰ç‚¹ã€‚</p><ol><li>é€šè¿‡è°ƒç”¨<a href="https://developer.mozilla.org/en-US/docs/Web/API/Element/getBoundingClientRect" target="_blank" rel="noopener"><code>getBoundingClientRect()</code></a>ç›®æ ‡ï¼Œå¯ä»¥è·å¾—ç›®æ ‡å…ƒç´ çš„è¾¹ç•ŒçŸ©å½¢ï¼ˆå³ï¼Œå®Œå…¨åŒ…å›´ç»„æˆè¯¥å…ƒç´ çš„æ¯ä¸ªç»„ä»¶çš„è¾¹ç•Œæ¡†çš„æœ€å°çŸ©å½¢ï¼‰ã€‚è¿™æ˜¯æœ€å¤§çš„ç›¸äº¤çŸ©å½¢ã€‚å…¶ä½™æ­¥éª¤å°†åˆ é™¤æ‰€æœ‰ä¸ç›¸äº¤çš„éƒ¨åˆ†ã€‚</li><li>ä»ç›®æ ‡çš„ç›´æ¥çˆ¶å—å¼€å§‹å¹¶å‘å¤–ç§»åŠ¨ï¼Œæ¯ä¸ªåŒ…å«å—çš„å‰ªè¾‘ï¼ˆå¦‚æœæœ‰ï¼‰éƒ½åº”ç”¨äºç›¸äº¤çŸ©å½¢ã€‚æ ¹æ®ä¸¤ä¸ªå—çš„äº¤é›†å’Œè¯¥<a href="https://developer.mozilla.org/en-US/docs/Web/CSS/overflow" target="_blank" rel="noopener"><code>overflow</code></a>å±æ€§æŒ‡å®šçš„å‰ªåˆ‡æ¨¡å¼ï¼ˆå¦‚æœæœ‰ï¼‰æ¥ç¡®å®šå—çš„å‰ªåˆ‡ã€‚è®¾ç½®<code>overflow</code>ä¸ºå…¶ä»–ä»»ä½•å€¼<code>visible</code>éƒ½ä¼šå¯¼è‡´å‘ç”Ÿè£å‰ªã€‚</li><li>å¦‚æœå…¶ä¸­ä¸€ä¸ªåŒ…å«å…ƒç´ æ˜¯åµŒå¥—æµè§ˆä¸Šä¸‹æ–‡çš„æ ¹ï¼ˆä¾‹å¦‚åŒ…å«åœ¨ä¸­çš„æ–‡æ¡£ï¼‰[<code>](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/iframe)ï¼Œåˆ™äº¤é›†çŸ©å½¢ä¼šè¢«è£å‰ªåˆ°åŒ…å«ä¸Šä¸‹æ–‡çš„è§†å£ï¼Œå¹¶ä¸”å‘ä¸Šé€’å½’é€šè¿‡å®¹å™¨ç»§ç»­è¿›è¡Œåˆ°å®¹å™¨çš„åŒ…å«å—ã€‚</code>åˆ°è¾¾çš„æœ€é«˜å±‚ï¼Œå°†ç›¸äº¤çŸ©å½¢å‰ªåˆ‡åˆ°æ¡†æ¶çš„è§†å£ï¼Œç„¶åæ¡†æ¶çš„çˆ¶å…ƒç´ æ˜¯å‘ç›¸äº¤æ ¹é€’å½’çš„ä¸‹ä¸€ä¸ªå—ã€‚</li><li>å½“å‘ä¸Šé€’å½’åˆ°è¾¾ç›¸äº¤æ ¹æ—¶ï¼Œç”Ÿæˆçš„çŸ©å½¢å°†æ˜ å°„åˆ°ç›¸äº¤æ ¹çš„åæ ‡ç©ºé—´ã€‚</li><li>ç„¶åï¼Œé€šè¿‡ä¸<a href="https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API#root-intersection-rectangle" target="_blank" rel="noopener">æ ¹ç›¸äº¤çŸ©å½¢</a>ç›¸äº¤æ¥æ›´æ–°ç”Ÿæˆçš„<a href="https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API#root-intersection-rectangle" target="_blank" rel="noopener">çŸ©å½¢</a>ã€‚</li><li>æœ€åï¼Œå°†æ­¤çŸ©å½¢æ˜ å°„åˆ°ç›®æ ‡çš„åæ ‡ç©ºé—´<a href="https://developer.mozilla.org/en-US/docs/Web/API/Document" target="_blank" rel="noopener"><code>document</code></a>ã€‚</li></ol><h3 id="äº¤å‰å˜æ›´callbacks"><a class="markdownIt-Anchor" href="#äº¤å‰å˜æ›´callbacks"></a> äº¤å‰å˜æ›´callbacks</h3><p>å½“åœ¨æ ¹å…ƒç´ ä¸­å¯è§çš„ç›®æ ‡å…ƒç´ çš„æ•°é‡è¶…è¿‡å¯è§æ€§é˜ˆå€¼ä¹‹ä¸€æ—¶ï¼Œå°†<a href="https://developer.mozilla.org/en-US/docs/Web/API/IntersectionObserver" target="_blank" rel="noopener"><code>IntersectionObserver</code></a>æ‰§è¡Œå¯¹è±¡çš„å›è°ƒã€‚å›è°ƒæ¥æ”¶æ‰€æœ‰<code>IntersectionObserverEntry</code>å¯¹è±¡çš„æ•°ç»„ä½œä¸ºè¾“å…¥ï¼Œæ¯ä¸ªè¶…è¿‡é˜ˆå€¼çš„å¯¹è±¡ä¸€ä¸ªï¼Œä»¥åŠå¯¹<code>IntersectionObserver</code>å¯¹è±¡æœ¬èº«çš„å¼•ç”¨ã€‚</p><p>é˜ˆå€¼åˆ—è¡¨ä¸­çš„æ¯ä¸ªæ¡ç›®éƒ½æ˜¯ä¸€ä¸ª<a href="https://developer.mozilla.org/en-US/docs/Web/API/IntersectionObserverEntry" target="_blank" rel="noopener"><code>IntersectionObserverEntry</code></a>å¯¹è±¡ï¼Œå®ƒæè¿°ä¸€ä¸ªè¢«è¶…è¿‡çš„é˜ˆå€¼ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯ä¸ªæ¡ç›®éƒ½æè¿°äº†ç»™å®šå…ƒç´ ä¸­æœ‰å¤šå°‘ä¸æ ¹å…ƒç´ ç›¸äº¤ï¼Œè¯¥å…ƒç´ æ˜¯å¦è¢«è®¤ä¸ºç›¸äº¤ä»¥åŠè¿‡æ¸¡å‘ç”Ÿçš„æ–¹å‘ã€‚</p><p>ä¸‹é¢çš„ä»£ç æ®µæ˜¾ç¤ºäº†ä¸€ä¸ªå›è°ƒï¼Œè¯¥å›è°ƒä¿ç•™äº†å…ƒç´ ä»ä¸ç›¸äº¤æ ¹åˆ°ç›¸äº¤è‡³å°‘75ï¼…è¿‡æ¸¡çš„æ¬¡æ•°çš„è®¡æ•°ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">intersectionCallback(entries) =&gt; &#123;</span><br><span class="line">  entries.forEach(entry =&gt; &#123;</span><br><span class="line">    if (entry.isIntersecting) &#123;</span><br><span class="line">      let elem = entry.target;</span><br><span class="line"></span><br><span class="line">      if (entry.intersectionRatio &gt;= 0.75) &#123;</span><br><span class="line">        intersectionCounter++;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ¥å£"><a class="markdownIt-Anchor" href="#æ¥å£"></a> æ¥å£</h2><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/IntersectionObserver" target="_blank" rel="noopener"><code>IntersectionObserver</code></a></p><p>Intersection Observer APIçš„ä¸»è¦æ¥å£ã€‚æä¾›ç”¨äºåˆ›å»ºå’Œç®¡ç†è§‚å¯Ÿè€…çš„æ–¹æ³•ï¼Œè¯¥è§‚å¯Ÿè€…å¯ä»¥ç›‘è§†ç›¸åŒäº¤é›†é…ç½®çš„ä»»æ„æ•°é‡çš„ç›®æ ‡å…ƒç´ ã€‚æ¯ä¸ªè§‚å¯Ÿè€…å¯ä»¥å¼‚æ­¥è§‚å¯Ÿä¸€ä¸ªæˆ–å¤šä¸ªç›®æ ‡å…ƒç´ å’Œå…±ç”¨ç¥–å…ˆå…ƒç´ ä¹‹é—´æˆ–ä¸å®ƒä»¬é¡¶å±‚çš„äº¤ç‚¹å˜åŒ–<a href="https://developer.mozilla.org/en-US/docs/Web/API/Document" target="_blank" rel="noopener"><code>Document</code></a>çš„<a href="https://developer.mozilla.org/en-US/docs/Glossary/viewport" target="_blank" rel="noopener">è§†å£</a>ã€‚ç¥–å…ˆæˆ–è§†å£ç§°ä¸º<strong>æ ¹</strong>ã€‚</p><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/IntersectionObserverEntry" target="_blank" rel="noopener"><code>IntersectionObserverEntry</code></a></p><p>æè¿°åœ¨ç‰¹å®šè¿‡æ¸¡æ—¶åˆ»ç›®æ ‡å…ƒç´ åŠå…¶æ ¹å®¹å™¨ä¹‹é—´çš„äº¤é›†ã€‚åªèƒ½ä»¥ä¸¤ç§æ–¹å¼è·å¾—æ­¤ç±»å‹çš„å¯¹è±¡ï¼šä½œä¸º<code>IntersectionObserver</code>å›è°ƒçš„è¾“å…¥ï¼Œæˆ–é€šè¿‡è°ƒç”¨<a href="https://developer.mozilla.org/en-US/docs/Web/API/IntersectionObserver/takeRecords" target="_blank" rel="noopener"><code>IntersectionObserver.takeRecords()</code></a>ã€‚</p><h2 id="ä¸€ä¸ªç®€å•çš„ä¾‹å­"><a class="markdownIt-Anchor" href="#ä¸€ä¸ªç®€å•çš„ä¾‹å­"></a> ä¸€ä¸ªç®€å•çš„ä¾‹å­</h2><p>è¿™ä¸ªç®€å•çš„ç¤ºä¾‹ä½¿ç›®æ ‡å…ƒç´ åœ¨å˜å¾—æˆ–å¤šæˆ–å°‘å¯è§æ—¶æ›´æ”¹å…¶é¢œè‰²å’Œé€æ˜åº¦ã€‚åœ¨<a href="https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API/Timing_element_visibility" target="_blank" rel="noopener">ä½¿ç”¨Intersection Observer APIçš„â€œè®¡æ—¶å…ƒç´ å¯è§æ€§â€ä¸­</a>ï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªæ›´å¹¿æ³›çš„ç¤ºä¾‹ï¼Œè¯¥ç¤ºä¾‹æ˜¾ç¤ºå¦‚ä½•è®¡æ—¶ç”¨æˆ·å¯ä»¥çœ‹åˆ°ä¸€ç»„å…ƒç´ ï¼ˆä¾‹å¦‚å¹¿å‘Šï¼‰å¤šé•¿æ—¶é—´ï¼Œä»¥åŠå¦‚ä½•é€šè¿‡è®°å½•ç»Ÿè®¡ä¿¡æ¯æˆ–æ›´æ–°å…ƒç´ æ¥å¯¹è¯¥ä¿¡æ¯åšå‡ºååº”â€¦</p><h3 id="html"><a class="markdownIt-Anchor" href="#html"></a> HTML</h3><p>æ­¤ç¤ºä¾‹çš„HTMLéå¸¸ç®€çŸ­ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªä¸»è¦å…ƒç´ ï¼Œå³æˆ‘ä»¬å°†è¦å®šä½çš„æ¡†ï¼ˆå¸¦æœ‰creative ID <code>&quot;box&quot;</code>ï¼‰å’Œè¯¥æ¡†ä¸­çš„ä¸€äº›å†…å®¹ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=&quot;box&quot;&gt;</span><br><span class="line">  &lt;div class=&quot;vertical&quot;&gt;</span><br><span class="line">    Welcome to &lt;strong&gt;The Box!&lt;/strong&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><h4 id="css"><a class="markdownIt-Anchor" href="#css"></a> CSS</h4><p>å°±æœ¬ç¤ºä¾‹è€Œè¨€ï¼ŒCSSå¹¶ä¸æ˜¯ååˆ†é‡è¦ã€‚å®ƒå¯¹å…ƒç´ è¿›è¡Œäº†å¸ƒå±€ï¼Œå¹¶ç¡®å®š<a href="https://developer.mozilla.org/en-US/docs/Web/CSS/background-color" target="_blank" rel="noopener"><code>background-color</code></a>and <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/border" target="_blank" rel="noopener"><code>border</code></a>å±æ€§å¯ä»¥å‚ä¸<a href="https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Transitions" target="_blank" rel="noopener">CSSè¿‡æ¸¡</a>ï¼Œå½“å…ƒç´ æˆ–å¤šæˆ–å°‘è¢«é®ç›–æ—¶ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å®ƒæ¥å½±å“å…ƒç´ çš„æ›´æ”¹ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#box &#123;</span><br><span class="line">  background-color: rgba(40, 40, 190, 255);</span><br><span class="line">  border: 4px solid rgb(20, 20, 120);</span><br><span class="line">  transition: background-color 1s, border 1s;</span><br><span class="line">  width: 350px;</span><br><span class="line">  height: 350px;</span><br><span class="line">  display: flex;</span><br><span class="line">  align-items: center;</span><br><span class="line">  justify-content: center;</span><br><span class="line">  padding: 20px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.vertical &#123;</span><br><span class="line">  color: white;</span><br><span class="line">  font: 32px &quot;Arial&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.extra &#123;</span><br><span class="line">  width: 350px;</span><br><span class="line">  height: 350px;</span><br><span class="line">  margin-top: 10px;</span><br><span class="line">  border: 4px solid rgb(20, 20, 120);</span><br><span class="line">  text-align: center;</span><br><span class="line">  padding: 20px;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="javascript"><a class="markdownIt-Anchor" href="#javascript"></a> JavaScript</h4><p>æœ€åï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ä½¿ç”¨Intersection Observer APIè¿›è¡Œäº‹æƒ…çš„JavaScriptä»£ç ã€‚</p><h4 id="é…ç½®"><a class="markdownIt-Anchor" href="#é…ç½®"></a> é…ç½®</h4><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å‡†å¤‡ä¸€äº›å˜é‡å¹¶å®‰è£…è§‚å¯Ÿå™¨ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">const numSteps = 20.0;</span><br><span class="line"></span><br><span class="line">let boxElement;</span><br><span class="line">let prevRatio = 0.0;</span><br><span class="line">let increasingColor = &quot;rgba(40, 40, 190, ratio)&quot;;</span><br><span class="line">let decreasingColor = &quot;rgba(190, 40, 40, ratio)&quot;;</span><br><span class="line"></span><br><span class="line">// Set things up</span><br><span class="line">window.addEventListener(&quot;load&quot;, (event) =&gt; &#123;</span><br><span class="line">  boxElement = document.querySelector(&quot;#box&quot;);</span><br><span class="line"></span><br><span class="line">  createObserver();</span><br><span class="line">&#125;, false);</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬åœ¨æ­¤å¤„è®¾ç½®çš„å¸¸é‡å’Œå˜é‡æ˜¯ï¼š</p><ul><li><p><code>numSteps</code></p><p>ä¸€ä¸ªå¸¸æ•°ï¼ŒæŒ‡ç¤ºæˆ‘ä»¬å¸Œæœ›åœ¨0.0å’Œ1.0çš„å¯è§æ€§æ¯”ç‡ä¹‹é—´å…·æœ‰å¤šå°‘ä¸ªé˜ˆå€¼ã€‚</p></li><li><p><code>prevRatio</code></p><p>æ­¤å˜é‡å°†ç”¨äºè®°å½•ä¸Šæ¬¡è¶…è¿‡é˜ˆå€¼æ—¶å¯è§æ€§æ¯”ç‡ã€‚è¿™å°†è®©æˆ‘ä»¬å¼„æ¸…æ¥šç›®æ ‡å…ƒç´ æ˜¯å¦å˜å¾—è¶Šæ¥è¶Šæ˜æ˜¾ã€‚</p></li><li><p><code>increasingColor</code></p><p>å®šä¹‰å¯è§æ€§æ¯”ç‡å¢åŠ æ—¶å°†åº”ç”¨äºç›®æ ‡å…ƒç´ çš„é¢œè‰²çš„å­—ç¬¦ä¸²ã€‚è¯¥å­—ç¬¦ä¸²ä¸­çš„â€œæ¯”ç‡â€ä¸€è¯å°†æ›¿æ¢ä¸ºç›®æ ‡çš„å½“å‰å¯è§æ€§æ¯”ç‡ï¼Œå› æ­¤è¯¥å…ƒç´ ä¸ä»…ä¼šæ”¹å˜é¢œè‰²ï¼Œè€Œä¸”ä¼šå˜å¾—è¶Šæ¥è¶Šä¸é€æ˜ï¼Œå› ä¸ºå®ƒå˜å¾—è¶Šæ¥è¶Šæ¨¡ç³Šã€‚</p></li><li><p><code>decreasingColor</code></p><p>åŒæ ·ï¼Œè¿™æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå®šä¹‰äº†å¯è§ç‡é™ä½æ—¶å°†åº”ç”¨çš„é¢œè‰²ã€‚</p></li></ul><p>æˆ‘ä»¬å‘¼å<a href="https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener" target="_blank" rel="noopener"><code>Window.addEventListener()</code></a>å¼€å§‹æ”¶å¬<code>load</code>äº‹ä»¶ã€‚ä¸€æ—¦é¡µé¢åŠ è½½å®Œæˆåï¼Œæˆ‘ä»¬å¾—åˆ°çš„å…ƒç´ çš„å¼•ç”¨ä¸ID <code>&quot;box&quot;</code>ä½¿ç”¨<a href="https://developer.mozilla.org/en-US/docs/Web/API/Document/querySelector" target="_blank" rel="noopener"><code>querySelector()</code></a>ï¼Œç„¶åè°ƒç”¨<code>createObserver()</code>æˆ‘ä»¬å°†åœ¨ç¨ååˆ›å»ºæ¥å¤„ç†å»ºç­‘æ–¹æ³•å’Œå®‰è£…çš„äº¤å‰ç‚¹è§‚æµ‹ã€‚</p><h4 id="åˆ›å»ºç›¸äº¤è§‚å¯Ÿå™¨"><a class="markdownIt-Anchor" href="#åˆ›å»ºç›¸äº¤è§‚å¯Ÿå™¨"></a> åˆ›å»ºç›¸äº¤è§‚å¯Ÿå™¨</h4><p><code>createObserver()</code>ä¸€æ—¦é¡µé¢åŠ è½½å®Œæˆï¼Œä¾¿ä¼šè°ƒç”¨è¯¥æ–¹æ³•ä»¥å¤„ç†å®é™…åˆ›å»ºæ–°å¯¹è±¡<a href="https://developer.mozilla.org/en-US/docs/Web/API/IntersectionObserver" target="_blank" rel="noopener"><code>IntersectionObserver</code></a>å¹¶å¼€å§‹è§‚å¯Ÿç›®æ ‡å…ƒç´ çš„è¿‡ç¨‹ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function createObserver() &#123;</span><br><span class="line">  let observer;</span><br><span class="line"></span><br><span class="line">  let options = &#123;</span><br><span class="line">    root: null,</span><br><span class="line">    rootMargin: &quot;0px&quot;,</span><br><span class="line">    threshold: buildThresholdList()</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  observer = new IntersectionObserver(handleIntersect, options);</span><br><span class="line">  observer.observe(boxElement);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆä»è®¾ç½®ä¸€ä¸ª<code>options</code>åŒ…å«è§‚å¯Ÿè€…è®¾ç½®çš„å¯¹è±¡å¼€å§‹ã€‚æˆ‘ä»¬è¦ç•™æ„çš„ç›®æ ‡å…ƒç´ ç›¸å¯¹äºæ–‡æ¡£çš„è§†å£çš„å¯è§æ€§çš„å˜åŒ–ï¼Œæ‰€ä»¥<code>root</code>æ˜¯<code>null</code>ã€‚æˆ‘ä»¬ä¸éœ€è¦è¾¹è·ï¼Œå› æ­¤è¾¹è·åç§»é‡<code>rootMargin</code>æŒ‡å®šä¸ºâ€œ 0pxâ€ã€‚è¿™ä½¿è§‚å¯Ÿè€…å¯ä»¥è§‚å¯Ÿç›®æ ‡å…ƒç´ çš„è¾¹ç•Œä¸è§†å£è¾¹ç•Œä¹‹é—´çš„äº¤é›†å¤„çš„å˜åŒ–ï¼Œè€Œæ— éœ€å¢åŠ ï¼ˆæˆ–å‡å»ï¼‰ä»»ä½•ç©ºé—´ã€‚</p><p>å¯è§åº¦é˜ˆå€¼åˆ—è¡¨<code>threshold</code>ç”±å‡½æ•°æ„é€ <code>buildThresholdList()</code>ã€‚åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œä»¥ç¼–ç¨‹æ–¹å¼æ„å»ºé˜ˆå€¼åˆ—è¡¨ï¼Œå› ä¸ºå­˜åœ¨è®¸å¤šé˜ˆå€¼åˆ—è¡¨ï¼Œå¹¶ä¸”è¯¥æ•°é‡æ—¨åœ¨è°ƒæ•´ã€‚</p><p>ä¸€æ—¦<code>options</code>å‡†å¤‡å¥½äº†ï¼Œæˆ‘ä»¬åˆ›å»ºäº†æ–°çš„è§‚å¯Ÿå‘˜ï¼Œè°ƒç”¨<a href="https://developer.mozilla.org/en-US/docs/Web/API/IntersectionObserver/IntersectionObserver" target="_blank" rel="noopener"><code>IntersectionObserver()</code></a>æ„é€ å‡½æ•°ï¼ŒæŒ‡å®šä¸€ä¸ªå‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œè·¯å£ç©¿è¶Šæˆ‘ä»¬çš„å…¶ä¸­ä¸€ä¸ªé˜ˆå€¼ï¼Œ<code>handleIntersect()</code>å’Œæˆ‘ä»¬ä¸€ç»„é€‰é¡¹ã€‚ç„¶å<a href="https://developer.mozilla.org/en-US/docs/Web/API/IntersectionObserver/observe" target="_blank" rel="noopener"><code>observe()</code></a>ï¼Œæˆ‘ä»¬è°ƒç”¨è¿”å›çš„è§‚å¯Ÿè€…ï¼Œå°†æ‰€éœ€çš„ç›®æ ‡å…ƒç´ ä¼ é€’ç»™å®ƒã€‚</p><p>å¦‚æœæˆ‘ä»¬æ„¿æ„çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©é€šè¿‡ç›‘è§†<code>observer.observe()</code>æ¯ä¸ªå…ƒç´ æ¥ç›‘è§†å¤šä¸ªå…ƒç´ æ˜¯å¦ç›¸å¯¹äºè§†å£ç›¸äº¤ã€‚</p><h4 id="å»ºç«‹é˜ˆå€¼æ¯”ç‡æ•°ç»„"><a class="markdownIt-Anchor" href="#å»ºç«‹é˜ˆå€¼æ¯”ç‡æ•°ç»„"></a> å»ºç«‹é˜ˆå€¼æ¯”ç‡æ•°ç»„</h4><p><code>buildThresholdList()</code>æ„å»ºé˜ˆå€¼åˆ—è¡¨çš„å‡½æ•°å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function buildThresholdList() &#123;</span><br><span class="line">  let thresholds = [];</span><br><span class="line">  let numSteps = 20;</span><br><span class="line"></span><br><span class="line">  for (let i=1.0; i&lt;=numSteps; i++) &#123;</span><br><span class="line">    let ratio = i/numSteps;</span><br><span class="line">    thresholds.push(ratio);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  thresholds.push(0);</span><br><span class="line">  return thresholds;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™å°†æ„å»ºé˜ˆå€¼æ•°ç»„-é€šè¿‡å°†å€¼ä»‹äº1å’Œä¹‹é—´çš„æ¯ä¸ªæ•´æ•°æ¨<code>i/numSteps</code>å…¥<code>thresholds</code>æ•°ç»„ï¼Œæ¯ä¸ªé˜ˆå€¼ä¹‹é—´çš„æ¯”ç‡ä¸º0.0å’Œ1.0 <code>i</code>ä¹‹é—´<code>numSteps</code>ã€‚å®ƒè¿˜æ¨0ä»¥åŒ…æ‹¬è¯¥å€¼ã€‚ç»™å®šé»˜è®¤å€¼<code>numSteps</code>ï¼ˆ20ï¼‰ï¼Œç»“æœæ˜¯ä»¥ä¸‹é˜ˆå€¼åˆ—è¡¨ï¼š</p><table><thead><tr><th style="text-align:left">ï¼ƒ</th><th style="text-align:left">Ratio</th><th style="text-align:left">ï¼ƒ</th><th style="text-align:left">Ratio</th></tr></thead><tbody><tr><td style="text-align:left">1ä¸ª</td><td style="text-align:left">0.05</td><td style="text-align:left">11</td><td style="text-align:left">0.55</td></tr><tr><td style="text-align:left">2</td><td style="text-align:left">0.1</td><td style="text-align:left">12</td><td style="text-align:left">0.6</td></tr><tr><td style="text-align:left">3</td><td style="text-align:left">0.15</td><td style="text-align:left">13</td><td style="text-align:left">0.65</td></tr><tr><td style="text-align:left">4</td><td style="text-align:left">0.2</td><td style="text-align:left">14</td><td style="text-align:left">0.7</td></tr><tr><td style="text-align:left">5</td><td style="text-align:left">0.25</td><td style="text-align:left">15</td><td style="text-align:left">0.75</td></tr><tr><td style="text-align:left">6</td><td style="text-align:left">0.3</td><td style="text-align:left">16</td><td style="text-align:left">0.8</td></tr><tr><td style="text-align:left">7</td><td style="text-align:left">0.35</td><td style="text-align:left">17</td><td style="text-align:left">0.85</td></tr><tr><td style="text-align:left">8</td><td style="text-align:left">0.4</td><td style="text-align:left">18</td><td style="text-align:left">0.9</td></tr><tr><td style="text-align:left">9</td><td style="text-align:left">0.45</td><td style="text-align:left">19</td><td style="text-align:left">0.95</td></tr><tr><td style="text-align:left">10</td><td style="text-align:left">0.5</td><td style="text-align:left">20</td><td style="text-align:left">1.0</td></tr></tbody></table><p>å½“ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥å°†é˜ˆå€¼æ•°ç»„ç¡¬ç¼–ç åˆ°æˆ‘ä»¬çš„ä»£ç ä¸­ï¼Œè€Œè¿™é€šå¸¸æ˜¯æ‚¨æœ€ç»ˆè¦åšçš„ã€‚ä½†æ˜¯ï¼Œæ­¤ç¤ºä¾‹ä¸ºæ·»åŠ é…ç½®æ§ä»¶ä»¥è°ƒæ•´ç²’åº¦æä¾›äº†ç©ºé—´ã€‚</p><h4 id="å¤„ç†äº¤é›†å˜æ›´"><a class="markdownIt-Anchor" href="#å¤„ç†äº¤é›†å˜æ›´"></a> å¤„ç†äº¤é›†å˜æ›´</h4><p>å½“æµè§ˆå™¨æ£€æµ‹åˆ°ç›®æ ‡å…ƒç´ ï¼ˆåœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ä¸ºIDçš„å…ƒç´ <code>&quot;box&quot;</code>ï¼‰å·²ç»è¢«å…¬å¼€æˆ–æ¨¡ç³Šï¼Œä»¥è‡´å…¶å¯è§æ€§æ¯”ç‡è¶…è¿‡åˆ—è¡¨ä¸­çš„é˜ˆå€¼ä¹‹ä¸€æ—¶ï¼Œå®ƒå°†è°ƒç”¨å¤„ç†ç¨‹åºå‡½æ•°<code>handleIntersect()</code>ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">handleIntersect</span>(<span class="params">entries, observer</span>) </span>&#123;</span><br><span class="line">  entries.forEach(<span class="function">(<span class="params">entry</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (entry.intersectionRatio &gt; prevRatio) &#123;</span><br><span class="line">      entry.target.style.backgroundColor = increasingColor.replace(<span class="string">"ratio"</span>, entry.intersectionRatio);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      entry.target.style.backgroundColor = decreasingColor.replace(<span class="string">"ratio"</span>, entry.intersectionRatio);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    prevRatio = entry.intersectionRatio;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹äº<a href="https://developer.mozilla.org/en-US/docs/Web/API/IntersectionObserverEntry" target="_blank" rel="noopener"><code>IntersectionObserverEntry</code></a>åˆ—è¡¨ä¸­çš„æ¯ä¸ª<code>entries</code>æ¡ç›®ï¼Œæˆ‘ä»¬æŸ¥çœ‹æ¡ç›®<a href="https://developer.mozilla.org/en-US/docs/Web/API/IntersectionObserverEntry/intersectionRatio" target="_blank" rel="noopener"><code>intersectionRatio</code></a>æ˜¯å¦åœ¨ä¸Šå‡ï¼›å¦‚æœæ˜¯ï¼Œæˆ‘ä»¬å°†ç›®æ ‡çš„è®¾ç½®<a href="https://developer.mozilla.org/en-US/docs/Web/CSS/background-color" target="_blank" rel="noopener"><code>background-color</code></a>ä¸ºä¸­çš„å­—ç¬¦ä¸²<code>increasingColor</code>ï¼ˆè¯·è®°ä½ï¼Œå®ƒæ˜¯<code>&quot;rgba(40, 40, 190, ratio)&quot;</code>ï¼‰ï¼Œå°†å•è¯â€œ ratioâ€æ›¿æ¢ä¸ºæ¡ç›®çš„<code>intersectionRatio</code>ã€‚ç»“æœï¼šä¸ä»…é¢œè‰²æ”¹å˜äº†ï¼Œç›®æ ‡å…ƒç´ çš„é€æ˜åº¦ä¹Ÿæ”¹å˜äº†ï¼›å½“äº¤å‰æ¯”ä¾‹é™ä½æ—¶ï¼ŒèƒŒæ™¯è‰²çš„Alphaå€¼éšä¹‹é™ä½ï¼Œä»è€Œä½¿å…ƒç´ æ›´é€æ˜ã€‚</p><p>åŒæ ·ï¼Œå¦‚æœ<code>intersectionRatio</code>ä¸‹é™ï¼Œåˆ™ä½¿ç”¨å­—ç¬¦ä¸²ï¼Œ<code>decreasingColor</code>å¹¶<code>intersectionRatio</code>åœ¨è®¾ç½®ç›®æ ‡å…ƒç´ çš„ä¹‹å‰å°†å…¶ä¸­çš„â€œæ¯”ç‡â€ä¸€è¯æ›¿æ¢ä¸º<code>background-color</code>ã€‚</p><p>æœ€åï¼Œä¸ºäº†è·Ÿè¸ªäº¤å‰æ¯”ç‡æ˜¯ä¸Šå‡è¿˜æ˜¯ä¸‹é™ï¼Œæˆ‘ä»¬è®°ä½å˜é‡ä¸­çš„å½“å‰æ¯”ç‡<code>prevRatio</code>ã€‚</p><h2 id="æµè§ˆå™¨å…¼å®¹æ€§"><a class="markdownIt-Anchor" href="#æµè§ˆå™¨å…¼å®¹æ€§"></a> æµè§ˆå™¨å…¼å®¹æ€§</h2><p><a href="https://github.com/mdn/browser-compat-data" target="_blank" rel="noopener">Update compatibility data on GitHub</a></p><table><thead><tr><th style="text-align:left"></th><th style="text-align:center">Desktop</th><th style="text-align:center">Mobile</th><th style="text-align:center"></th><th style="text-align:center"></th><th style="text-align:center"></th><th style="text-align:center"></th><th style="text-align:center"></th><th style="text-align:center"></th><th style="text-align:center"></th><th style="text-align:center"></th><th style="text-align:center"></th><th></th></tr></thead><tbody><tr><td style="text-align:left"></td><td style="text-align:center">Chrome</td><td style="text-align:center">Edge</td><td style="text-align:center">Firefox</td><td style="text-align:center">Internet Explorer</td><td style="text-align:center">Opera</td><td style="text-align:center">Safari</td><td style="text-align:center">Android webview</td><td style="text-align:center">Chrome for Android</td><td style="text-align:center">Firefox for Android</td><td style="text-align:center">Opera for Android</td><td style="text-align:center">Safari on iOS</td><td>Samsung Internet</td></tr><tr><td style="text-align:left"><a href="https://developer.mozilla.org/en-US/docs/Web/API/IntersectionObserver" target="_blank" rel="noopener"><code>IntersectionObserver</code></a>Experimental</td><td style="text-align:center">Full support51</td><td style="text-align:center">Full support15</td><td style="text-align:center">Full support55Open</td><td style="text-align:center">No supportNo</td><td style="text-align:center">Full supportYes</td><td style="text-align:center">Full support12.1</td><td style="text-align:center">Full support51</td><td style="text-align:center">Full support51</td><td style="text-align:center">?</td><td style="text-align:center">?</td><td style="text-align:center">Full support12.2</td><td>Full support5.0</td></tr><tr><td style="text-align:left"><a href="https://developer.mozilla.org/en-US/docs/Web/API/IntersectionObserver/IntersectionObserver" target="_blank" rel="noopener"><code>IntersectionObserver()</code> constructor</a>Experimental</td><td style="text-align:center">Full support51</td><td style="text-align:center">Full support15</td><td style="text-align:center">Full support55Open</td><td style="text-align:center">No supportNo</td><td style="text-align:center">?</td><td style="text-align:center">Full support12.1</td><td style="text-align:center">Full support51</td><td style="text-align:center">Full support51</td><td style="text-align:center">?</td><td style="text-align:center">?</td><td style="text-align:center">Full support12.2</td><td>Full support5.0</td></tr><tr><td style="text-align:left"><a href="https://developer.mozilla.org/en-US/docs/Web/API/IntersectionObserver/disconnect" target="_blank" rel="noopener"><code>disconnect</code></a>Experimental</td><td style="text-align:center">Full support51</td><td style="text-align:center">Full support15NotesOpen</td><td style="text-align:center">Full support55Open</td><td style="text-align:center">No supportNo</td><td style="text-align:center">Full supportYes</td><td style="text-align:center">?</td><td style="text-align:center">Full support51</td><td style="text-align:center">Full support51</td><td style="text-align:center">?</td><td style="text-align:center">?</td><td style="text-align:center">?</td><td>Full support5.0</td></tr><tr><td style="text-align:left"><a href="https://developer.mozilla.org/en-US/docs/Web/API/IntersectionObserver/observe" target="_blank" rel="noopener"><code>observe</code></a>Experimental</td><td style="text-align:center">Full support51</td><td style="text-align:center">Full support15</td><td style="text-align:center">Full support55Open</td><td style="text-align:center">No supportNo</td><td style="text-align:center">Full supportYes</td><td style="text-align:center">Full support12.1</td><td style="text-align:center">Full support51</td><td style="text-align:center">Full support51</td><td style="text-align:center">?</td><td style="text-align:center">?</td><td style="text-align:center">Full support12.2</td><td>Full support5.0</td></tr><tr><td style="text-align:left"><a href="https://developer.mozilla.org/en-US/docs/Web/API/IntersectionObserver/root" target="_blank" rel="noopener"><code>root</code></a>Experimental</td><td style="text-align:center">Full support51</td><td style="text-align:center">Full support15</td><td style="text-align:center">Full support55Open</td><td style="text-align:center">No supportNo</td><td style="text-align:center">Full supportYes</td><td style="text-align:center">Full support12.1</td><td style="text-align:center">Full support51</td><td style="text-align:center">Full support51</td><td style="text-align:center">?</td><td style="text-align:center">?</td><td style="text-align:center">Full support12.2</td><td>Full support5.0</td></tr><tr><td style="text-align:left"><a href="https://developer.mozilla.org/en-US/docs/Web/API/IntersectionObserver/rootMargin" target="_blank" rel="noopener"><code>rootMargin</code></a>Experimental</td><td style="text-align:center">Full support51</td><td style="text-align:center">Full support15</td><td style="text-align:center">Full support55Open</td><td style="text-align:center">No supportNo</td><td style="text-align:center">Full supportYes</td><td style="text-align:center">Full support12.1NotesOpen</td><td style="text-align:center">Full support51</td><td style="text-align:center">Full support51</td><td style="text-align:center">?</td><td style="text-align:center">?</td><td style="text-align:center">Full support12.2NotesOpen</td><td>Full support5.0</td></tr><tr><td style="text-align:left"><a href="https://developer.mozilla.org/en-US/docs/Web/API/IntersectionObserver/takeRecords" target="_blank" rel="noopener"><code>takeRecords</code></a>Experimental</td><td style="text-align:center">Full support51</td><td style="text-align:center">Full support15NotesOpen</td><td style="text-align:center">Full support55Open</td><td style="text-align:center">No supportNo</td><td style="text-align:center">Full supportYes</td><td style="text-align:center">?</td><td style="text-align:center">Full support51</td><td style="text-align:center">Full support51</td><td style="text-align:center">?</td><td style="text-align:center">?</td><td style="text-align:center">?</td><td>Full support5.0</td></tr><tr><td style="text-align:left"><a href="https://developer.mozilla.org/en-US/docs/Web/API/IntersectionObserver/thresholds" target="_blank" rel="noopener"><code>thresholds</code></a>Experimental</td><td style="text-align:center">Full support51</td><td style="text-align:center">Full support15</td><td style="text-align:center">Full support55Open</td><td style="text-align:center">No supportNo</td><td style="text-align:center">Full supportYes</td><td style="text-align:center">Full support12.1</td><td style="text-align:center">Full support51</td><td style="text-align:center">Full support51</td><td style="text-align:center">?</td><td style="text-align:center">?</td><td style="text-align:center">Full support12.2</td><td>Full support5.0</td></tr><tr><td style="text-align:left"><a href="https://developer.mozilla.org/en-US/docs/Web/API/IntersectionObserver/unobserve" target="_blank" rel="noopener"><code>unobserve</code></a>Experimental</td><td style="text-align:center">Full support51</td><td style="text-align:center">Full support15NotesOpen</td><td style="text-align:center">Full support55Open</td><td style="text-align:center">No supportNo</td><td style="text-align:center">Full supportYes</td><td style="text-align:center">Full support12.1</td><td style="text-align:center">Full support51</td><td style="text-align:center">Full support51</td><td style="text-align:center">?</td><td style="text-align:center">?</td><td style="text-align:center">Full support12.2</td><td>Full support5.0</td></tr></tbody></table>]]></content>
    
    <summary type="html">
    
      æ‘˜è‡ªMDNï¼Œç¿»è¯‘ä¸€ä¸‹å§ï¼Œå¯¹æ£€æµ‹å…ƒç´ å¯è§æ•ˆé—®é¢˜æŒºæœ‰ç”¨çš„å“ˆå“ˆ
    
    </summary>
    
      <category term="JavaScript" scheme="https://wzes.github.io/categories/JavaScript/"/>
    
    
      <category term="JavaScript" scheme="https://wzes.github.io/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>iScroll æºç å­¦ä¹ </title>
    <link href="https://wzes.github.io/2019/10/23/JavaScript/iScroll/"/>
    <id>https://wzes.github.io/2019/10/23/JavaScript/iScroll/</id>
    <published>2019-10-23T10:30:16.000Z</published>
    <updated>2019-10-24T06:15:03.500Z</updated>
    
    <content type="html"><![CDATA[<h3 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h3><p>å¼ºå¤§çš„ iScroll å•Šï¼ŒåŠŸèƒ½çš„ç¡®å¤šï¼Œä½†æˆ‘åªæƒ³çœ‹çœ‹ä½ çš„ flinger æ»‘åŠ¨å¤„ç†çš„ç²¾é«“ï¼æ„Ÿè§‰ iscroll çš„æ»‘åŠ¨å¤„ç†çš„è¿˜å¯ä»¥å§ï¼Œè™½ç„¶æ¯”ä¸ä¸Šç³»ç»Ÿçš„ scrollï¼Œä½†ä¹Ÿä¸è‡³äºå¾ˆéš¾å—ï¼Œå­¦ä¼šäº†è¿™æ‹›ï¼Œå¯ä»¥å‡ºå»å¹å¹ç‰›ï¼ˆæ‹›æ‘‡æ’éª—ï¼‰äº†ã€‚</p><h3 id="é¡»çŸ¥"><a class="markdownIt-Anchor" href="#é¡»çŸ¥"></a> é¡»çŸ¥</h3><p>é€šå¸¸å¦‚æœæˆ‘ä»¬ç»™å®¹å™¨è®¾ç½®ä¸€ä¸ªé«˜åº¦ï¼Œå¦‚æœå­èŠ‚ç‚¹çš„é«˜åº¦è¶…å‡ºäº†çˆ¶å®¹å™¨çš„é«˜åº¦ï¼Œé‚£ä¹ˆå†…å®¹å°±å¯ä»¥è¿›è¡Œæ»šåŠ¨ï¼ŒåŸå› åœ¨äº <code>overflow</code> å±æ€§é»˜è®¤ä¸º <code>auto</code>ï¼Œå½“ç„¶æœ€å¥½å°†çˆ¶å®¹å™¨è®¾ç½®ä¸º <code>overflow: scroll</code>ï¼Œå­å†…å®¹å°±å¯ä»¥è¿›è¡Œæ»šåŠ¨ã€‚è¿˜å¯ä»¥å•ç‹¬è®¾ç½® X æˆ– Y è½´çš„æ»šåŠ¨ï¼Œ<code>overflow-x:scroll</code> æˆ– <code>overflow-y:scroll</code>ï¼Œå¦‚æœä¸æƒ³è®©å†…å®¹æ»šåŠ¨ï¼Œåˆ™è®¾ç½® <code>overflow: hidden</code></p><h3 id="æ˜¯ä»€ä¹ˆ"><a class="markdownIt-Anchor" href="#æ˜¯ä»€ä¹ˆ"></a> æ˜¯ä»€ä¹ˆ</h3><p>iScroll æ˜¯ä¸€ç§é«˜æ€§èƒ½ï¼Œå ç”¨ç©ºé—´å°ï¼Œæ— ä¾èµ–çš„å¤šå¹³å° javascript æ»šåŠ¨å™¨ã€‚</p><blockquote><p>å®ƒé€‚ç”¨äºå°å¼æœºï¼Œç§»åŠ¨ç”µè§†å’Œæ™ºèƒ½ç”µè§†ã€‚å®ƒå·²é’ˆå¯¹æ€§èƒ½å’Œå°ºå¯¸è¿›è¡Œäº†ä¼˜åŒ–ï¼Œä»¥åœ¨ç°ä»£å’Œæ—§è®¾å¤‡ä¸Šæä¾›æœ€å¹³æ»‘çš„ç»“æœã€‚</p><p>iScrollä¸ä»…å¯ä»¥æ»šåŠ¨ã€‚å®ƒå¯ä»¥å¤„ç†éœ€è¦é€šè¿‡ç”¨æˆ·äº¤äº’ç§»åŠ¨çš„ä»»ä½•å…ƒç´ ã€‚å®ƒä¸ºæ‚¨çš„é¡¹ç›®æ·»åŠ äº†æ»šåŠ¨ï¼Œç¼©æ”¾ï¼Œå¹³ç§»ï¼Œæ— é™æ»šåŠ¨ï¼Œè§†å·®æ»šåŠ¨ï¼Œè½®æ’­ï¼Œå¹¶ä¸”ä»…ä»¥4kbçš„é€Ÿåº¦åšåˆ°äº†è¿™ä¸€ç‚¹ã€‚ç»™å®ƒæ‰«å¸šï¼Œå®ƒä¹Ÿä¼šæ‰“æ‰«ä½ çš„åŠå…¬å®¤ã€‚</p><p>å³ä½¿åœ¨æœ¬æœºæ»šåŠ¨è¶³ä»¥èƒœä»»çš„å¹³å°ä¸Šï¼ŒiScrollä¹Ÿä¼šæ·»åŠ åŸæœ¬æ— æ³•å®ç°çš„åŠŸèƒ½ã€‚ç‰¹åˆ«ï¼š</p><p>å³ä½¿åœ¨åŠ¨é‡æœŸé—´ï¼Œä¹Ÿå¯ä»¥å¯¹æ»šåŠ¨ä½ç½®è¿›è¡Œç²¾ç»†æ§åˆ¶ã€‚æ‚¨å§‹ç»ˆå¯ä»¥è·å–å¹¶è®¾ç½®æ»šåŠ¨æ¡çš„xï¼Œyåæ ‡ã€‚<br>å¯ä»¥ä½¿ç”¨ç”¨æˆ·å®šä¹‰çš„ç¼“åŠ¨åŠŸèƒ½ï¼ˆå¼¹è·³ï¼Œå¼¹æ€§ï¼Œåé€€â€¦ï¼‰è‡ªå®šä¹‰åŠ¨ç”»ã€‚<br>æ‚¨å¯ä»¥è½»æ¾åœ°æŒ‚é’©åˆ°å¤§é‡è‡ªå®šä¹‰äº‹ä»¶ï¼ˆonBeforeScrollStartï¼ŒonScrollStartï¼ŒonScrollï¼ŒonScrollEndï¼Œflickç­‰ï¼‰ã€‚<br>å¼€ç®±å³ç”¨çš„å¤šå¹³å°æ”¯æŒã€‚ä»è¾ƒæ—§çš„Androidè®¾å¤‡åˆ°æœ€æ–°çš„iPhoneï¼Œä»Chromeåˆ°Internet Explorerã€‚</p></blockquote><h3 id="get-started"><a class="markdownIt-Anchor" href="#get-started"></a> Get started</h3><p>å‡è®¾æˆ‘ä»¬çš„å…ƒç´ é•¿è¿™ä¸ªæ ·å­</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=&quot;wrapper&quot;&gt;</span><br><span class="line">    &lt;ul&gt;</span><br><span class="line">        &lt;li&gt;...&lt;/li&gt;</span><br><span class="line">        &lt;li&gt;...&lt;/li&gt;</span><br><span class="line">        ...</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><p>é‚£æˆ‘ä»¬åªéœ€è¦åœ¨è„šæœ¬ä¸­ä½¿ç”¨ <code>new IScroll</code> å³å¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">myScroll = new IScroll(&apos;#wrapper&apos;);</span><br></pre></td></tr></table></figure><p>å½“ç„¶ï¼Œä»–è¿˜æœ‰å¾ˆå¤šå±æ€§ï¼ˆåªå¯æ„ä¼šï¼‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">this.options = &#123;</span><br><span class="line">disablePointer : !utils.hasPointer,</span><br><span class="line">disableTouch : utils.hasPointer || !utils.hasTouch,</span><br><span class="line">disableMouse : utils.hasPointer || utils.hasTouch,</span><br><span class="line">startX: 0, // å¼€å§‹æ»šåŠ¨çš„å€¼</span><br><span class="line">startY: 0,</span><br><span class="line">scrollY: true,</span><br><span class="line">directionLockThreshold: 5,</span><br><span class="line">momentum: true,  // å¯¹å…¶ Native çš„ flinger(æ‰‹æŒ‡æ”¾å¼€åè¿˜ä¼šç»§ç»­æ»šåŠ¨ä¸€æ®µè·ç¦»)</span><br><span class="line">bounce: true,   // æ»šåŠ¨å›å¼¹</span><br><span class="line">bounceTime: 600,</span><br><span class="line">bounceEasing: &apos;&apos;,</span><br><span class="line">preventDefault: true,</span><br><span class="line">preventDefaultException: &#123; tagName: /^(INPUT|TEXTAREA|BUTTON|SELECT)$/ &#125;,</span><br><span class="line">HWCompositing: true,</span><br><span class="line">useTransition: true,</span><br><span class="line">useTransform: true,</span><br><span class="line">bindToWrapper: typeof window.onmousedown === &quot;undefined&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åŸç†æ¦‚æ‹¬"><a class="markdownIt-Anchor" href="#åŸç†æ¦‚æ‹¬"></a> åŸç†æ¦‚æ‹¬</h3><p>iScroll å½“ç„¶æ²¡æœ‰ä½¿ç”¨ç³»ç»Ÿçš„ scrollï¼ŒåŸå› æœ‰å¾ˆå¤šç‚¹ï¼Œä¸Šé¢ä¹Ÿæåˆ°è¿‡ã€‚</p><p>iScroll ä½¿ç”¨äº† <code>transform: translate(px, px)</code>æ¥å®ç°æ»šåŠ¨ï¼Œå®Œå…¨æ˜¯é€šè¿‡è‡ªå·±è®¡ç®—æ¥å®ç°çš„ï¼Œå½“ç„¶ï¼Œå¦‚æœç³»ç»Ÿæ”¯æŒ <code>transation</code>ï¼Œé‚£ä¹ˆ iScroll çš„æ¾æ‰‹åæ»šåŠ¨å°†å€ŸåŠ© <code>transitionTimingFunction</code>ï¼Œå¦åˆ™å°±è‡ªå®šä¹‰åŠ¨ç”»ï¼Œå®Œæˆå¹³æ»‘æ»šåŠ¨ã€‚</p><h3 id="æºç è§£æ"><a class="markdownIt-Anchor" href="#æºç è§£æ"></a> æºç è§£æ</h3><h4 id="å…¥å£"><a class="markdownIt-Anchor" href="#å…¥å£"></a> å…¥å£</h4><p>IScroll æ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œè°ƒç”¨äº†ä»¥åä¼šåˆ›å»ºå±æ€§ï¼Œè¿›è¡Œåˆå§‹åŒ–ï¼Œå…¶ä¸­ <code>this.x</code> å’Œ <code>this.y</code> åˆ†åˆ«è®°å½•äº†x è½´ ä¸ y è½´çš„æ»šåŠ¨è·ç¦»ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">function IScroll (el, options) &#123;</span><br><span class="line">this.wrapper = typeof el == &apos;string&apos; ? document.querySelector(el) : el;</span><br><span class="line">this.scroller = this.wrapper.children[0];</span><br><span class="line">this.scrollerStyle = this.scroller.style;// cache style for better performance</span><br><span class="line"></span><br><span class="line">// æ­¤å¤„çœç•¥äº† this.options çš„èµ‹å€¼</span><br><span class="line"></span><br><span class="line">// Some defaults</span><br><span class="line">this.x = 0;  </span><br><span class="line">this.y = 0;</span><br><span class="line">this.directionX = 0;</span><br><span class="line">this.directionY = 0;</span><br><span class="line">this._events = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">this._init();</span><br><span class="line">this.refresh();</span><br><span class="line"></span><br><span class="line">this.scrollTo(this.options.startX, this.options.startY);</span><br><span class="line">this.enable();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åˆå§‹åŒ–äº‹ä»¶"><a class="markdownIt-Anchor" href="#åˆå§‹åŒ–äº‹ä»¶"></a> åˆå§‹åŒ–äº‹ä»¶</h4><p>åœ¨ <code>this._init();</code> ä¸­åˆå§‹åŒ–äº†äº‹ä»¶ç›‘å¬ï¼Œåœ¨æ‰‹æœºç«¯ä¸»è¦æ˜¯  <code>touch</code> å¼€å¤´çš„äº‹ä»¶ï¼ŒPC ç«¯ä¸»è¦æ˜¯ <code>mouse</code> äº‹ä»¶ï¼Œ<code>pointer</code> æ˜¯æŒ‡é’ˆäº‹ä»¶ï¼Œæ­¤å¤–ï¼Œè¿˜ä¼šç›‘å¬ <code>transitionend</code> äº‹ä»¶ï¼Œç”¨äºæ»šåŠ¨ç»“æŸäº‹ä»¶çš„ç›‘å¬ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">_initEvents: function (remove) &#123;</span><br><span class="line">var eventType = remove ? utils.removeEvent : utils.addEvent,</span><br><span class="line">target = this.options.bindToWrapper ? this.wrapper : window;</span><br><span class="line"></span><br><span class="line">eventType(window, &apos;orientationchange&apos;, this);</span><br><span class="line">eventType(window, &apos;resize&apos;, this);</span><br><span class="line"></span><br><span class="line">if ( this.options.click ) &#123;</span><br><span class="line">eventType(this.wrapper, &apos;click&apos;, this, true);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if ( !this.options.disableMouse ) &#123;</span><br><span class="line">eventType(this.wrapper, &apos;mousedown&apos;, this);</span><br><span class="line">eventType(target, &apos;mousemove&apos;, this);</span><br><span class="line">eventType(target, &apos;mousecancel&apos;, this);</span><br><span class="line">eventType(target, &apos;mouseup&apos;, this);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if ( utils.hasPointer &amp;&amp; !this.options.disablePointer ) &#123;</span><br><span class="line">eventType(this.wrapper, utils.prefixPointerEvent(&apos;pointerdown&apos;), this);</span><br><span class="line">eventType(target, utils.prefixPointerEvent(&apos;pointermove&apos;), this);</span><br><span class="line">eventType(target, utils.prefixPointerEvent(&apos;pointercancel&apos;), this);</span><br><span class="line">eventType(target, utils.prefixPointerEvent(&apos;pointerup&apos;), this);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if ( utils.hasTouch &amp;&amp; !this.options.disableTouch ) &#123;</span><br><span class="line">eventType(this.wrapper, &apos;touchstart&apos;, this);</span><br><span class="line">eventType(target, &apos;touchmove&apos;, this);</span><br><span class="line">eventType(target, &apos;touchcancel&apos;, this);</span><br><span class="line">eventType(target, &apos;touchend&apos;, this);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">eventType(this.scroller, &apos;transitionend&apos;, this);</span><br><span class="line">eventType(this.scroller, &apos;webkitTransitionEnd&apos;, this);</span><br><span class="line">eventType(this.scroller, &apos;oTransitionEnd&apos;, this);</span><br><span class="line">eventType(this.scroller, &apos;MSTransitionEnd&apos;, this);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><h4 id="åˆå§‹åŒ–å˜é‡"><a class="markdownIt-Anchor" href="#åˆå§‹åŒ–å˜é‡"></a> åˆå§‹åŒ–å˜é‡</h4><p>è®¡ç®—å®¹å™¨é«˜åº¦ã€å®½åº¦ï¼Œæ»šåŠ¨å†…å®¹é«˜åº¦ã€å®½åº¦ï¼Œæœ€å¤§æ»šåŠ¨è·ç¦»ï¼ˆXè½´ï¼ŒYè½´ï¼‰ç­‰ç­‰ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">refresh: function () &#123;</span><br><span class="line">utils.getRect(this.wrapper);// Force reflow</span><br><span class="line"></span><br><span class="line">this.wrapperWidth= this.wrapper.clientWidth;</span><br><span class="line">this.wrapperHeight= this.wrapper.clientHeight;</span><br><span class="line"></span><br><span class="line">var rect = utils.getRect(this.scroller);</span><br><span class="line">/* REPLACE START: refresh */</span><br><span class="line"></span><br><span class="line">this.scrollerWidth= rect.width;</span><br><span class="line">this.scrollerHeight= rect.height;</span><br><span class="line"></span><br><span class="line">this.maxScrollX= this.wrapperWidth - this.scrollerWidth;</span><br><span class="line">this.maxScrollY= this.wrapperHeight - this.scrollerHeight;</span><br><span class="line"></span><br><span class="line">/* REPLACE END: refresh */</span><br><span class="line"></span><br><span class="line">this.hasHorizontalScroll= this.options.scrollX &amp;&amp; this.maxScrollX &lt; 0;</span><br><span class="line">this.hasVerticalScroll= this.options.scrollY &amp;&amp; this.maxScrollY &lt; 0;</span><br><span class="line"></span><br><span class="line">if ( !this.hasHorizontalScroll ) &#123;</span><br><span class="line">this.maxScrollX = 0;</span><br><span class="line">this.scrollerWidth = this.wrapperWidth;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if ( !this.hasVerticalScroll ) &#123;</span><br><span class="line">this.maxScrollY = 0;</span><br><span class="line">this.scrollerHeight = this.wrapperHeight;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">this.endTime = 0;</span><br><span class="line">this.directionX = 0;</span><br><span class="line">this.directionY = 0;</span><br><span class="line"></span><br><span class="line">if(utils.hasPointer &amp;&amp; !this.options.disablePointer) &#123;</span><br><span class="line">// The wrapper should have `touchAction` property for using pointerEvent.</span><br><span class="line">this.wrapper.style[utils.style.touchAction] = utils.getTouchAction(this.options.eventPassthrough, true);</span><br><span class="line"></span><br><span class="line">// case. not support &apos;pinch-zoom&apos;</span><br><span class="line">// https://github.com/cubiq/iscroll/issues/1118#issuecomment-270057583</span><br><span class="line">if (!this.wrapper.style[utils.style.touchAction]) &#123;</span><br><span class="line">this.wrapper.style[utils.style.touchAction] = utils.getTouchAction(this.options.eventPassthrough, false);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">this.wrapperOffset = utils.offset(this.wrapper);</span><br><span class="line"></span><br><span class="line">this._execEvent(&apos;refresh&apos;);</span><br><span class="line"></span><br><span class="line">this.resetPosition();</span><br><span class="line"></span><br><span class="line">// INSERT POINT: _refresh</span><br><span class="line"></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><h4 id="æ»šåŠ¨å‡½æ•°"><a class="markdownIt-Anchor" href="#æ»šåŠ¨å‡½æ•°"></a> æ»šåŠ¨å‡½æ•°</h4><p>ç»™å®šä¸€ä¸ª xï¼Œyï¼Œæ»šåŠ¨æ—¶é—´ timeï¼Œæ»šåŠ¨æ•ˆæœ easingï¼›</p><p>å¦‚æœ time ä¸º 0ï¼Œåˆ™ä¸ºç¬æ—¶æ»šåŠ¨ï¼Œä½¿ç”¨ <code>_translate</code> æ”¹å˜ä½ç½®ï¼Œå¦‚æœç¯å¢ƒæ”¯æŒ <code>transition</code> , é‚£ä¹ˆå°†ä½¿ç”¨ transition å±æ€§å®ç°åŠ¨ç”»ã€‚</p><p>å¦‚æœæµè§ˆå™¨ä¸æ”¯æŒ transitionï¼Œtime åˆä¸ä¸º 0ï¼Œé‚£ä¹ˆåˆ™è‡ªå®šä¹‰åŠ¨ç”»å®ç°æ»šåŠ¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">scrollTo: function (x, y, time, easing) &#123;</span><br><span class="line">easing = easing || utils.ease.circular;</span><br><span class="line"></span><br><span class="line">this.isInTransition = this.options.useTransition &amp;&amp; time &gt; 0;</span><br><span class="line">var transitionType = this.options.useTransition &amp;&amp; easing.style;</span><br><span class="line">if ( !time || transitionType ) &#123;</span><br><span class="line">if(transitionType) &#123;</span><br><span class="line">this._transitionTimingFunction(easing.style);</span><br><span class="line">this._transitionTime(time);</span><br><span class="line">&#125;</span><br><span class="line">this._translate(x, y);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">this._animate(x, y, time, easing.fn);</span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><h4 id="ç§»åŠ¨å®ç°"><a class="markdownIt-Anchor" href="#ç§»åŠ¨å®ç°"></a> ç§»åŠ¨å®ç°</h4><p>å¦‚æœå…ƒç´ æ”¯æŒ transform ç»™å…ƒç´ èµ‹å€¼ transform å±æ€§å³å¯ï¼Œå¦åˆ™ä½¿ç”¨ left å±æ€§ã€‚ç„¶åå°† <code>x</code> , <code>y</code> è®¾ç½®ä¸ºç›®æ ‡ä½ç½®ï¼Œæ—¢ç›®å‰æ»šåŠ¨ä½ç½®ï¼Œé€šå¸¸éƒ½æ˜¯ä¸º<strong>è´Ÿå€¼</strong>ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">_translate: function (x, y) &#123;</span><br><span class="line">if ( this.options.useTransform ) &#123;</span><br><span class="line"></span><br><span class="line">/* REPLACE START: _translate */</span><br><span class="line"></span><br><span class="line">this.scrollerStyle[utils.style.transform] = &apos;translate(&apos; + x + &apos;px,&apos; + y + &apos;px)&apos; + this.translateZ;</span><br><span class="line"></span><br><span class="line">/* REPLACE END: _translate */</span><br><span class="line"></span><br><span class="line">&#125; else &#123;</span><br><span class="line">x = Math.round(x);</span><br><span class="line">y = Math.round(y);</span><br><span class="line">this.scrollerStyle.left = x + &apos;px&apos;;</span><br><span class="line">this.scrollerStyle.top = y + &apos;px&apos;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">this.x = x;</span><br><span class="line">this.y = y;</span><br><span class="line"></span><br><span class="line">// INSERT POINT: _translate</span><br><span class="line"></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><h4 id="è§¦æ‘¸äº‹ä»¶å¤„ç†-core"><a class="markdownIt-Anchor" href="#è§¦æ‘¸äº‹ä»¶å¤„ç†-core"></a> è§¦æ‘¸äº‹ä»¶å¤„ç† Core</h4><p>ä¾¿äºåˆ†æï¼Œæˆ‘åªè€ƒè™‘yæ–¹å‘çš„æ»‘åŠ¨ï¼Œxæ–¹å‘åŒç†ï¼ˆä¼šåˆ é™¤æ‰ x æ–¹å‘çš„ä»£ç ï¼‰</p><h5 id="startmovestartmousedown"><a class="markdownIt-Anchor" href="#startmovestartmousedown"></a> startï¼ˆmovestartï¼Œmousedownâ€¦ï¼‰</h5><p>å…¶ä¸­æ¯”è¾ƒé‡è¦çš„æ˜¯ startYï¼ŒstartTimeï¼Œè®°å½•ä¸‹ç›®å‰æ»šåŠ¨ä½ç½®ï¼Œæ»šåŠ¨æ—¶åˆ» pointY åˆ™æ˜¯ç‚¹å‡»ä½ç½®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">_start: function (e) &#123;</span><br><span class="line"> var point = e.touches ? e.touches[0] : e,</span><br><span class="line">  pos;</span><br><span class="line"></span><br><span class="line"> this.initiated = utils.eventType[e.type];</span><br><span class="line"> this.moved  = false;</span><br><span class="line"> this.distY  = 0;</span><br><span class="line"> this.directionY = 0;</span><br><span class="line"> this.directionLocked = 0;</span><br><span class="line"></span><br><span class="line"> this.startTime = utils.getTime();</span><br><span class="line"></span><br><span class="line"> if ( this.options.useTransition &amp;&amp; this.isInTransition ) &#123;</span><br><span class="line">  this._transitionTime();</span><br><span class="line">  this.isInTransition = false;</span><br><span class="line">  pos = this.getComputedPosition();</span><br><span class="line">  this._translate(Math.round(pos.x), Math.round(pos.y));</span><br><span class="line">  this._execEvent(&apos;scrollEnd&apos;);</span><br><span class="line"> &#125; else if ( !this.options.useTransition &amp;&amp; this.isAnimating ) &#123;</span><br><span class="line">  this.isAnimating = false;</span><br><span class="line">  this._execEvent(&apos;scrollEnd&apos;);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> this.startY    = this.y;</span><br><span class="line"> this.absStartY = this.y;</span><br><span class="line"> this.pointY    = point.pageY;</span><br><span class="line"></span><br><span class="line"> this._execEvent(&apos;beforeScrollStart&apos;);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><h5 id="move"><a class="markdownIt-Anchor" href="#move"></a> move</h5><p>é€šå¸¸ï¼Œæ‰‹æŒ‡ä¸æ¾å¼€ï¼Œå±å¹•æ»šåŠ¨æ˜¯è·Ÿéšæ‰‹æŒ‡ç§»åŠ¨çš„ï¼Œæ‰‹æŒ‡æ€ä¹ˆç§»åŠ¨ï¼Œå±å¹•å°±æ€ä¹ˆç§»åŠ¨ã€‚</p><p>é¦–å…ˆä¼šåˆ¤æ–­è¯¥æ¬¡æ»‘åŠ¨æ˜¯å¦æœ‰æ•ˆï¼Œç„¶åé”å®šæ»‘åŠ¨æ–¹å‘ï¼Œæœ€åè®¡ç®— newYï¼Œéœ€è¦æ»‘åŠ¨çš„ä½ç½® <code>newY = this.y + deltaY</code> æ˜¯é€šè¿‡ delta æ¥è®¡ç®—çš„ã€‚ç„¶åä½¿ç”¨ translate å‡½æ•°ç§»åŠ¨è¿›è¡Œç¬æ—¶ç§»åŠ¨ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">_move: function (e) &#123;</span><br><span class="line">var point= e.touches ? e.touches[0] : e,</span><br><span class="line">deltaY= point.pageY - this.pointY,</span><br><span class="line">timestamp= utils.getTime(),</span><br><span class="line">newY,</span><br><span class="line">absDistY;</span><br><span class="line"></span><br><span class="line">this.pointY= point.pageY;</span><br><span class="line">this.distY+= deltaY;</span><br><span class="line">absDistY= Math.abs(this.distY);</span><br><span class="line"></span><br><span class="line">// We need to move at least 10 pixels for the scrolling to initiate</span><br><span class="line">if ( timestamp - this.endTime &gt; 300 &amp;&amp; (absDistX &lt; 10 &amp;&amp; absDistY &lt; 10) ) &#123;</span><br><span class="line">return;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// If you are scrolling in one direction lock the other</span><br><span class="line">if ( !this.directionLocked &amp;&amp; !this.options.freeScroll ) &#123;</span><br><span class="line">if ( absDistX &gt; absDistY + this.options.directionLockThreshold ) &#123;</span><br><span class="line">this.directionLocked = &apos;h&apos;;// lock horizontally</span><br><span class="line">&#125; else if ( absDistY &gt;= absDistX + this.options.directionLockThreshold ) &#123;</span><br><span class="line">this.directionLocked = &apos;v&apos;;// lock vertically</span><br><span class="line">&#125; else &#123;</span><br><span class="line">this.directionLocked = &apos;n&apos;;// no lock</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if ( this.directionLocked == &apos;h&apos; ) &#123;</span><br><span class="line">if ( this.options.eventPassthrough == &apos;vertical&apos; ) &#123;</span><br><span class="line">e.preventDefault();</span><br><span class="line">&#125; else if ( this.options.eventPassthrough == &apos;horizontal&apos; ) &#123;</span><br><span class="line">this.initiated = false;</span><br><span class="line">return;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">deltaY = 0;</span><br><span class="line">&#125; else if ( this.directionLocked == &apos;v&apos; ) &#123;</span><br><span class="line">if ( this.options.eventPassthrough == &apos;horizontal&apos; ) &#123;</span><br><span class="line">e.preventDefault();</span><br><span class="line">&#125; else if ( this.options.eventPassthrough == &apos;vertical&apos; ) &#123;</span><br><span class="line">this.initiated = false;</span><br><span class="line">return;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">deltaX = 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">deltaY = this.hasVerticalScroll ? deltaY : 0;</span><br><span class="line">newY = this.y + deltaY;</span><br><span class="line"></span><br><span class="line">// Slow down if outside of the boundaries</span><br><span class="line">if ( newY &gt; 0 || newY &lt; this.maxScrollY ) &#123;</span><br><span class="line">newY = this.options.bounce ? this.y + deltaY / 3 : newY &gt; 0 ? 0 : this.maxScrollY;</span><br><span class="line">&#125;</span><br><span class="line">this.directionY = deltaY &gt; 0 ? -1 : deltaY &lt; 0 ? 1 : 0;</span><br><span class="line">if ( !this.moved ) &#123;</span><br><span class="line">this._execEvent(&apos;scrollStart&apos;);</span><br><span class="line">&#125;</span><br><span class="line">this.moved = true;</span><br><span class="line">this._translate(newX, newY);</span><br><span class="line"></span><br><span class="line">/* REPLACE START: _move */</span><br><span class="line"></span><br><span class="line">if ( timestamp - this.startTime &gt; 300 ) &#123;</span><br><span class="line">this.startTime = timestamp;</span><br><span class="line">this.startX = this.x;</span><br><span class="line">this.startY = this.y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* REPLACE END: _move */</span><br><span class="line"></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„æ˜¯ï¼Œå¦‚æœè¿™æ¬¡ move çš„æ—¶åˆ»ä¸ä¸Šä¸€æ¬¡ï¼ˆstartï¼‰çš„æ—¶é—´è¶…è¿‡ 300 msï¼Œä¼šè¿›è¡Œé‡ç½®ï¼ˆå¤ªå¦™äº†ï¼ï¼ï¼‰è¿™ä¸æ¥ä¸‹æ¥çš„ end æœ‰ç€éå¸¸é‡è¦çš„æ„ä¹‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if ( timestamp - this.startTime &gt; 300 ) &#123;</span><br><span class="line">this.startTime = timestamp;</span><br><span class="line">this.startY = this.y;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="end"><a class="markdownIt-Anchor" href="#end"></a> end</h5><p>åœ¨ end ä¸­å°†è¿›è¡ŒåŠ¨é‡æ»šåŠ¨ï¼ˆæ¾å¼€åè¿˜èƒ½è¿›è¡Œæ»šåŠ¨ï¼‰</p><p>åŠ¨é‡æ»šåŠ¨æœ€é‡è¦çš„æ˜¯è®¡ç®—ä¸¤ä¸ªå€¼ï¼Œæ¾å¼€åæ»šåŠ¨çš„ <code>æ—¶é—´</code> å’Œ <code>è·ç¦»</code>ï¼Œä¹Ÿæ˜¯ iscroll æœ€æ ¸å¿ƒçš„éƒ¨åˆ†ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">_end: function (e) &#123;</span><br><span class="line">var point = e.changedTouches ? e.changedTouches[0] : e,</span><br><span class="line">momentumY,</span><br><span class="line">duration = utils.getTime() - this.startTime,</span><br><span class="line">newY = Math.round(this.y),</span><br><span class="line">distanceY = Math.abs(newY - this.startY),</span><br><span class="line">time = 0,</span><br><span class="line">easing = &apos;&apos;;</span><br><span class="line"></span><br><span class="line">this.isInTransition = 0;</span><br><span class="line">this.initiated = 0;</span><br><span class="line">this.endTime = utils.getTime();</span><br><span class="line"></span><br><span class="line">// reset if we are outside of the boundaries</span><br><span class="line">if ( this.resetPosition(this.options.bounceTime) ) &#123;</span><br><span class="line">return;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">this.scrollTo(newX, newY);// ensures that the last position is rounded</span><br><span class="line"></span><br><span class="line">// we scrolled less than 10 pixels</span><br><span class="line">if ( !this.moved ) &#123;</span><br><span class="line">if ( this.options.tap ) &#123;</span><br><span class="line">utils.tap(e, this.options.tap);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if ( this.options.click ) &#123;</span><br><span class="line">utils.click(e);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">this._execEvent(&apos;scrollCancel&apos;);</span><br><span class="line">return;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if ( this._events.flick &amp;&amp; duration &lt; 200 &amp;&amp; distanceX &lt; 100 &amp;&amp; distanceY &lt; 100 ) &#123;</span><br><span class="line">this._execEvent(&apos;flick&apos;);</span><br><span class="line">return;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// start momentum animation if needed</span><br><span class="line">if ( this.options.momentum &amp;&amp; duration &lt; 300 ) &#123;</span><br><span class="line">momentumY = this.hasVerticalScroll ? utils.momentum(this.y, this.startY, duration, this.maxScrollY, this.options.bounce ? this.wrapperHeight : 0, this.options.deceleration) : &#123; destination: newY, duration: 0 &#125;;</span><br><span class="line">newY = momentumY.destination;</span><br><span class="line">time = Math.max(momentumX.duration, momentumY.duration);</span><br><span class="line">this.isInTransition = 1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// INSERT POINT: _end</span><br><span class="line"></span><br><span class="line">if ( newX != this.x || newY != this.y ) &#123;</span><br><span class="line">// change easing function when scroller goes out of the boundaries</span><br><span class="line">if ( newX &gt; 0 || newX &lt; this.maxScrollX || newY &gt; 0 || newY &lt; this.maxScrollY ) &#123;</span><br><span class="line">easing = utils.ease.quadratic;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">this.scrollTo(newX, newY, time, easing);</span><br><span class="line">return;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">this._execEvent(&apos;scrollEnd&apos;);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>è®¡ç®—ä½¿ç”¨äº† util.momentum</p><p>è¾“å…¥ï¼Œç°åœ¨çš„æ»šåŠ¨ä½ç½® yï¼Œä¸Šä¸€æ¬¡å¼€å§‹çš„ startYï¼ˆè¯¥ä½ç½®ä¼šåœ¨ move ä¸­é‡ç½®ï¼‰ï¼Œtimeï¼ˆè·ç¦»ä¸Šä¸€æ¬¡ start çš„æ—¶é—´ï¼‰ï¼ŒlowerMargin æœ€å¤§çš„æ»šåŠ¨è·ç¦»ï¼ŒwrapperSize å®¹å™¨çš„å°ºå¯¸ï¼Œdeceleration æ’å€¼å™¨</p><p>è¯ä¸å¤šè¯´ï¼Œè‡ªå·±æ¬£èµå§ã€‚è¿”å›æ»šåŠ¨æ—¶é—´å’Œç›®æ ‡æ»šåŠ¨ä½ç½®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">momentum = function (current, start, time, lowerMargin, wrapperSize, deceleration) &#123;</span><br><span class="line">var distance = current - start,</span><br><span class="line">speed = Math.abs(distance) / time,</span><br><span class="line">destination,</span><br><span class="line">duration;</span><br><span class="line"></span><br><span class="line">deceleration = deceleration === undefined ? 0.0006 : deceleration;</span><br><span class="line"></span><br><span class="line">destination = current + ( speed * speed ) / ( 2 * deceleration ) * ( distance &lt; 0 ? -1 : 1 );</span><br><span class="line">duration = speed / deceleration;</span><br><span class="line"></span><br><span class="line">if ( destination &lt; lowerMargin ) &#123;</span><br><span class="line">destination = wrapperSize ? lowerMargin - ( wrapperSize / 2.5 * ( speed / 8 ) ) : lowerMargin;</span><br><span class="line">distance = Math.abs(destination - current);</span><br><span class="line">duration = distance / speed;</span><br><span class="line">&#125; else if ( destination &gt; 0 ) &#123;</span><br><span class="line">destination = wrapperSize ? wrapperSize / 2.5 * ( speed / 8 ) : 0;</span><br><span class="line">distance = Math.abs(current) + destination;</span><br><span class="line">duration = distance / speed;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">return &#123;</span><br><span class="line">destination: Math.round(destination),</span><br><span class="line">duration: duration</span><br><span class="line">&#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ç„¶åå°±æ˜¯ä½¿ç”¨ scrollTo å‡½æ•°è¿›è¡ŒåŠ¨é‡æ»šåŠ¨äº†ã€‚<code>this.isInTransition</code> æ ‡å¿—æ­£åœ¨è¿›è¡ŒåŠ¨é‡æ»šåŠ¨ï¼Œå¦‚æœæœŸé—´å­˜åœ¨ touchdown äº‹ä»¶ï¼Œåˆ™ä¼šç«‹åˆ»åœæ­¢æ»šåŠ¨ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">if ( this.options.useTransition &amp;&amp; this.isInTransition ) &#123;</span><br><span class="line">this._transitionTime();</span><br><span class="line">this.isInTransition = false;</span><br><span class="line">pos = this.getComputedPosition();</span><br><span class="line">this._translate(Math.round(pos.x), Math.round(pos.y));</span><br><span class="line">this._execEvent(&apos;scrollEnd&apos;);</span><br><span class="line">&#125; else if ( !this.options.useTransition &amp;&amp; this.isAnimating ) &#123;</span><br><span class="line">this.isAnimating = false;</span><br><span class="line">this._execEvent(&apos;scrollEnd&apos;);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‡³æ­¤ï¼Œæ ¸å¿ƒåŠŸèƒ½å·®ä¸å¤šäº†</p><p>ä½† iscroll è¿˜æœ‰å…¶ä»–å¾ˆå¤šåŠŸèƒ½ï¼Œæ¯”å¦‚</p><ul><li>è½®æ’­å›¾</li><li>æ”¾å¤§ç¼©å°</li><li>â€¦</li></ul><h3 id="æœ€å"><a class="markdownIt-Anchor" href="#æœ€å"></a> æœ€å</h3><p>å…¶å®å§ï¼ŒiScroll ä¹Ÿä¹Ÿå°±é‚£ä¹ˆå›äº‹ã€‚</p>]]></content>
    
    <summary type="html">
    
      å¼ºå¤§çš„ iScroll å•Šï¼ŒåŠŸèƒ½çš„ç¡®å¤šï¼Œä½†æˆ‘åªæƒ³çœ‹çœ‹ä½ çš„ flinger æ»‘åŠ¨å¤„ç†çš„ç²¾é«“ï¼æ„Ÿè§‰ iscroll çš„æ»‘åŠ¨å¤„ç†çš„è¿˜å¯ä»¥å§ï¼Œè™½ç„¶æ¯”ä¸ä¸Šç³»ç»Ÿçš„ scrollï¼Œä½†ä¹Ÿä¸è‡³äºå¾ˆéš¾å—ï¼Œå­¦ä¼šäº†è¿™æ‹›ï¼Œå¯ä»¥å‡ºå»å¹å¹ç‰›ï¼ˆæ‹›æ‘‡æ’éª—ï¼‰äº†
    
    </summary>
    
      <category term="JavaScript" scheme="https://wzes.github.io/categories/JavaScript/"/>
    
    
      <category term="JavaScript" scheme="https://wzes.github.io/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>Gulp å…¥é—¨æŒ‡å—</title>
    <link href="https://wzes.github.io/2019/10/20/JavaScript/Gulp/"/>
    <id>https://wzes.github.io/2019/10/20/JavaScript/Gulp/</id>
    <published>2019-10-20T07:30:16.000Z</published>
    <updated>2019-10-20T09:58:06.150Z</updated>
    
    <content type="html"><![CDATA[<h3 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h3><p>æ˜å¤©å°±è¦æ™‹å‡ç­”è¾©äº†ï¼Œä»Šå¤©å†™ç¯‡å…¥é—¨ Wiki å‹å‹æƒŠå§ï¼Œæ­£å¥½æœ€è¿‘æƒ³å­¦æ„å»ºå·¥å…·ä¹‹ç±»çš„ä¸œè¥¿ï¼ŒGulp å¥½åƒå°±å¾ˆåˆé€‚</p><h3 id="glup-æ˜¯ä»€ä¹ˆ"><a class="markdownIt-Anchor" href="#glup-æ˜¯ä»€ä¹ˆ"></a> Glup æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p><code>Gulp</code> æœ‰ç‹¼åè™å’½çš„æ„æ€ã€‚</p><p>å®˜æ–¹ã€<a href="https://gulpjs.com/docs%E3%80%91%E8%A7%A3%E9%87%8A" target="_blank" rel="noopener">https://gulpjs.com/docsã€‘è§£é‡Š</a></p><blockquote><p>gulp æ˜¯ä¸€ä¸ªå·¥å…·åŒ…ï¼Œç”¨äºåœ¨å¼€å‘å·¥ä½œæµç¨‹ä¸­è‡ªåŠ¨åŒ–ç¹çæˆ–è€—æ—¶çš„ä»»åŠ¡ï¼Œå› æ­¤æ‚¨å¯ä»¥é¿å…æ··ä¹±å¹¶æ„å»ºä¸€äº›ä¸œè¥¿ã€‚</p></blockquote><p>ç›´ç™½æ¥è¯´ï¼Œå°±æ˜¯ä¸€ä¸ªæ„å»ºå·¥å…·ã€‚å¸¸ç”¨æ¥åˆ¶ä½œå¼€å‘è„šæ‰‹æ¶ï¼Œç”Ÿäº§æ¨¡ç‰ˆï½</p><h3 id="get-started"><a class="markdownIt-Anchor" href="#get-started"></a> Get Started</h3><h4 id="node-ç¯å¢ƒ"><a class="markdownIt-Anchor" href="#node-ç¯å¢ƒ"></a> Node ç¯å¢ƒ</h4><p>é¦–å…ˆï¼Œæ£€æŸ¥ nodeã€npm å’Œ npx æ˜¯å¦æ­£ç¡®å®‰è£…</p><h4 id="å…¨å±€å®‰è£…"><a class="markdownIt-Anchor" href="#å…¨å±€å®‰è£…"></a> å…¨å±€å®‰è£…</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install gulp-cli -g</span><br></pre></td></tr></table></figure><h4 id="åˆ›å»ºé¡¹ç›®ç›®å½•å¹¶è¿›å…¥"><a class="markdownIt-Anchor" href="#åˆ›å»ºé¡¹ç›®ç›®å½•å¹¶è¿›å…¥"></a> åˆ›å»ºé¡¹ç›®ç›®å½•å¹¶è¿›å…¥</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir gulp-project &amp; cd gulp-project</span><br></pre></td></tr></table></figure><h4 id="åœ¨é¡¹ç›®ç›®å½•ä¸‹åˆ›å»º-packagejson-æ–‡ä»¶"><a class="markdownIt-Anchor" href="#åœ¨é¡¹ç›®ç›®å½•ä¸‹åˆ›å»º-packagejson-æ–‡ä»¶"></a> åœ¨é¡¹ç›®ç›®å½•ä¸‹åˆ›å»º package.json æ–‡ä»¶</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm init</span><br></pre></td></tr></table></figure><h4 id="å®‰è£…-gulpä½œä¸ºå¼€å‘æ—¶ä¾èµ–é¡¹"><a class="markdownIt-Anchor" href="#å®‰è£…-gulpä½œä¸ºå¼€å‘æ—¶ä¾èµ–é¡¹"></a> å®‰è£… gulpï¼Œä½œä¸ºå¼€å‘æ—¶ä¾èµ–é¡¹</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev gulp</span><br></pre></td></tr></table></figure><h4 id="åˆ›å»º-gulpfile-æ–‡ä»¶"><a class="markdownIt-Anchor" href="#åˆ›å»º-gulpfile-æ–‡ä»¶"></a> åˆ›å»º gulpfile æ–‡ä»¶</h4><p>åˆ©ç”¨ä»»ä½•æ–‡æœ¬ç¼–è¾‘å™¨åœ¨é¡¹ç›®å¤§çš„æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º gulpfile.js çš„æ–‡ä»¶ï¼Œå¹¶åœ¨æ–‡ä»¶ä¸­è¾“å…¥ä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">function defaultTask(cb) &#123;</span><br><span class="line">  // place code for your default task here</span><br><span class="line">  cb();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">exports.default = defaultTask</span><br></pre></td></tr></table></figure><h4 id="æµ‹è¯•"><a class="markdownIt-Anchor" href="#æµ‹è¯•"></a> æµ‹è¯•</h4><p>åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰§è¡Œ gulp å‘½ä»¤ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gulp</span><br></pre></td></tr></table></figure><h4 id="è¾“å‡º"><a class="markdownIt-Anchor" href="#è¾“å‡º"></a> è¾“å‡º</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[17:16:32] Using gulpfile ~/WebProjects/gulp-project/gulpfile.js</span><br><span class="line">[17:16:32] Starting &apos;default&apos;...</span><br><span class="line">[17:16:32] Finished &apos;default&apos; after 1.37 ms</span><br></pre></td></tr></table></figure><h3 id="é«˜çº§ç”¨æ³•"><a class="markdownIt-Anchor" href="#é«˜çº§ç”¨æ³•"></a> é«˜çº§ç”¨æ³•</h3><h4 id="æ–‡ä»¶ç›‘æ§å’Œå¤„ç†"><a class="markdownIt-Anchor" href="#æ–‡ä»¶ç›‘æ§å’Œå¤„ç†"></a> æ–‡ä»¶ç›‘æ§å’Œå¤„ç†</h4><p>ä½¿ç”¨ watchï¼Œç›‘å¬æ–‡ä»¶å˜åŒ–ï¼Œå°† src ç›®å½•çš„ js æ–‡ä»¶å¤åˆ¶åˆ° output ç›®å½•ä¸‹ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">const &#123; src, dest, watch &#125; = require(&apos;gulp&apos;);</span><br><span class="line">const gulp = require(&apos;gulp&apos;)</span><br><span class="line"></span><br><span class="line">function streamTask() &#123;</span><br><span class="line">  return src(&apos;src/**/*.js&apos;)</span><br><span class="line">    .pipe(dest(&apos;output&apos;));</span><br><span class="line">&#125;</span><br><span class="line">// åˆ›å»ºä¸€ä¸ªä»»åŠ¡</span><br><span class="line">gulp.task(&apos;watch&apos;, function () &#123;</span><br><span class="line">  watch(&apos;src/*.js&apos;, streamTask);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>ä¼¼ä¹éå¸¸æ–¹ä¾¿ï¼Œå°è£…äº† <code>chokidar</code></p><h3 id="å†™åœ¨æœ€å"><a class="markdownIt-Anchor" href="#å†™åœ¨æœ€å"></a> å†™åœ¨æœ€å</h3><p>å¯ä»¥é›†æˆ rollupï¼Œwebpack ç­‰ node apiï¼Œåšä¸€ä¸ª hotreload</p><h3 id="å‚è€ƒ"><a class="markdownIt-Anchor" href="#å‚è€ƒ"></a> å‚è€ƒ</h3><ul><li><a href="https://www.gulpjs.com.cn/docs/getting-started/quick-start/" target="_blank" rel="noopener">https://www.gulpjs.com.cn/docs/getting-started/quick-start/</a></li></ul>]]></content>
    
    <summary type="html">
    
      æ˜å¤©å°±è¦æ™‹å‡ç­”è¾©äº†ï¼Œä»Šå¤©å†™ç¯‡å…¥é—¨ Wiki å‹å‹æƒŠå§ï¼Œæ­£å¥½æœ€è¿‘æƒ³å­¦æ„å»ºå·¥å…·ä¹‹ç±»çš„ä¸œè¥¿ï¼ŒGulp å¥½åƒå°±å¾ˆåˆé€‚
    
    </summary>
    
      <category term="JavaScript" scheme="https://wzes.github.io/categories/JavaScript/"/>
    
    
      <category term="JavaScript" scheme="https://wzes.github.io/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>JavaScript Event preventDefaultå’ŒstopPropagation</title>
    <link href="https://wzes.github.io/2019/09/30/JavaScript/JavaScript%20Event/"/>
    <id>https://wzes.github.io/2019/09/30/JavaScript/JavaScript Event/</id>
    <published>2019-09-30T07:30:16.000Z</published>
    <updated>2019-09-30T07:52:23.506Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h2><p>å¯¹äºJSçš„äº‹ä»¶ä¼ é€’è¿˜æ˜¯æ¯”è¾ƒé™Œç”Ÿï¼Œæ‰€ä»¥æ‰“ç®—å¥½å¥½ç†ä¸€ç†preventDefaultå’ŒstopPropagationçš„ç”¨æ³•ï¼Œå½»åº•å‘Šåˆ«æ¨¡ç³Šï¼Œæå‡è‡ªå·±çš„å‰ç«¯æ®µä½ï¼</p><h2 id="æ —å­"><a class="markdownIt-Anchor" href="#æ —å­"></a> æ —å­</h2><p>åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼Œå•å‡»Webæµè§ˆå™¨ä¸­çš„è¶…é“¾æ¥å°†è§¦å‘äº‹ä»¶çš„æµç¨‹ï¼ˆæ‰§è¡Œäº‹ä»¶ç›‘å¬å™¨ï¼‰å’Œäº‹ä»¶ç›®æ ‡çš„é»˜è®¤æ“ä½œï¼ˆæ‰“å¼€æ–°é€‰é¡¹å¡ï¼‰ã€‚</p><p>HTMLï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=&quot;a&quot;&gt;</span><br><span class="line">  &lt;a id=&quot;b&quot; href=&quot;http://www.google.com/&quot; target=&quot;_blank&quot;&gt;Google&lt;/a&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><p>JavaScript:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">var el = document.getElementById(&quot;c&quot;);</span><br><span class="line">function capturingOnClick1(ev) &#123;</span><br><span class="line">    el.innerHTML += &quot;DIV event capture&lt;br&gt;&quot;;</span><br><span class="line">&#125;</span><br><span class="line">function capturingOnClick2(ev) &#123;</span><br><span class="line">    el.innerHTML += &quot;A event capture&lt;br&gt;&quot;;</span><br><span class="line">&#125;</span><br><span class="line">function bubblingOnClick1(ev) &#123;</span><br><span class="line">    el.innerHTML += &quot;DIV event bubbling&lt;br&gt;&quot;;</span><br><span class="line">&#125;</span><br><span class="line">function bubblingOnClick2(ev) &#123;</span><br><span class="line">    el.innerHTML += &quot;A event bubbling&lt;br&gt;&quot;;</span><br><span class="line">&#125;</span><br><span class="line">// The 3rd parameter useCapture makes the event listener capturing (false by default)</span><br><span class="line">document.getElementById(&quot;a&quot;).addEventListener(&quot;click&quot;, capturingOnClick1, true);</span><br><span class="line">document.getElementById(&quot;b&quot;).addEventListener(&quot;click&quot;, capturingOnClick2, true);</span><br><span class="line">document.getElementById(&quot;a&quot;).addEventListener(&quot;click&quot;, bubblingOnClick1, false);</span><br><span class="line">document.getElementById(&quot;b&quot;).addEventListener(&quot;click&quot;, bubblingOnClick2, false);</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight plain"><figcaption><span>event captureA event captureA event bubblingDIV event bubbling</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">DIV event capture</span><br><span class="line">A event capture</span><br><span class="line">A event bubbling</span><br><span class="line">DIV event bubbling</span><br></pre></td></tr></table></figure><h5 id="å‘capturingonclick1å‡½æ•°æ·»åŠ stoppropagation"><a class="markdownIt-Anchor" href="#å‘capturingonclick1å‡½æ•°æ·»åŠ stoppropagation"></a> å‘<code>capturingOnClick1</code>å‡½æ•°æ·»åŠ <code>stopPropagation()</code></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">function capturingOnClick1(ev) &#123;</span><br><span class="line">    el.innerHTML += &quot;DIV event capture&lt;br&gt;&quot;;</span><br><span class="line">    ev.stopPropagation();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æœåªè¾“å‡º</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DIV event capture</span><br></pre></td></tr></table></figure><p>äº‹ä»¶ä¾¦å¬å™¨é˜»æ­¢äº†äº‹ä»¶çš„è¿›ä¸€æ­¥å‘ä¸‹å’Œå‘ä¸Šä¼ æ’­ã€‚ä½†æ˜¯ï¼Œè¿™å¹¶æ²¡æœ‰é˜»æ­¢é»˜è®¤æ“ä½œï¼ˆæ‰“å¼€æ–°æ ‡ç­¾é¡µï¼‰ã€‚</p><h5 id="å‘capturingonclick2å‡½æ•°æ·»åŠ stoppropagation"><a class="markdownIt-Anchor" href="#å‘capturingonclick2å‡½æ•°æ·»åŠ stoppropagation"></a> å‘<code>capturingOnClick2</code>å‡½æ•°æ·»åŠ <code>stopPropagation()</code></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">function capturingOnClick2(ev) &#123;</span><br><span class="line">    el.innerHTML += &quot;A event capture&lt;br&gt;&quot;;</span><br><span class="line">    ev.stopPropagation();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ–è€…</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">function bubblingOnClick2(ev) &#123;</span><br><span class="line">    el.innerHTML += &quot;A event bubbling&lt;br&gt;&quot;;</span><br><span class="line">    ev.stopPropagation();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">DIV event capture</span><br><span class="line">A event capture</span><br><span class="line">A event bubbling</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯å› ä¸ºä¸¤ä¸ªäº‹ä»¶ä¾¦å¬å™¨éƒ½æ³¨å†Œåœ¨åŒä¸€äº‹ä»¶ç›®æ ‡ä¸Šã€‚äº‹ä»¶ä¾¦å¬å™¨é˜»æ­¢äº†äº‹ä»¶çš„è¿›ä¸€æ­¥å‘ä¸Šä¼ æ’­ã€‚ä½†æ˜¯ï¼Œå®ƒä»¬å¹¶æ²¡æœ‰é˜»æ­¢é»˜è®¤æ“ä½œï¼ˆæ‰“å¼€æ–°æ ‡ç­¾é¡µï¼‰ã€‚</p><h5 id="å°†preventdefaultæ·»åŠ åˆ°ä»»ä½•å‡½æ•°ä¸­"><a class="markdownIt-Anchor" href="#å°†preventdefaultæ·»åŠ åˆ°ä»»ä½•å‡½æ•°ä¸­"></a> å°†<code>preventDefault()</code>æ·»åŠ åˆ°ä»»ä½•å‡½æ•°ä¸­</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">function capturingOnClick1(ev) &#123;</span><br><span class="line">    el.innerHTML += &quot;DIV event capture&lt;br&gt;&quot;;</span><br><span class="line">    ev.preventDefault();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æœç…§å¸¸è¾“å‡º</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">DIV event capture</span><br><span class="line">A event capture</span><br><span class="line">A event bubbling</span><br><span class="line">DIV event bubbling</span><br></pre></td></tr></table></figure><p><strong>ä½†å®ƒé˜»æ­¢æ‰“å¼€æ–°æ ‡ç­¾é¡µ</strong></p><h2 id="åŸç†è§£æ"><a class="markdownIt-Anchor" href="#åŸç†è§£æ"></a> åŸç†è§£æ</h2><h3 id="äº‹ä»¶é¡ºåº"><a class="markdownIt-Anchor" href="#äº‹ä»¶é¡ºåº"></a> äº‹ä»¶é¡ºåº</h3><p>åŸºæœ¬é—®é¢˜å¾ˆç®€å•ï¼Œå‡è®¾å…ƒç´ å†…éƒ¨æœ‰ä¸€ä¸ªå…ƒç´ ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-----------------------------------</span><br><span class="line">| element1                        |</span><br><span class="line">|   -------------------------     |</span><br><span class="line">|   |element2               |     |</span><br><span class="line">|   -------------------------     |</span><br><span class="line">|                                 |</span><br><span class="line">-----------------------------------</span><br></pre></td></tr></table></figure><p>ä¸¤è€…éƒ½æœ‰ä¸€ä¸ªonClickäº‹ä»¶å¤„ç†ç¨‹åºã€‚å¦‚æœç”¨æˆ·å•å‡»element2ï¼Œä»–å°†åœ¨element1å’Œelement2ä¸­éƒ½å¼•èµ·clickäº‹ä»¶ã€‚ä½†æ˜¯å“ªä¸ªäº‹ä»¶é¦–å…ˆè§¦å‘ï¼Ÿåº”è¯¥å…ˆæ‰§è¡Œå“ªä¸ªäº‹ä»¶å¤„ç†ç¨‹åºï¼Ÿæ¢å¥è¯è¯´ï¼Œäº‹ä»¶é¡ºåºæ˜¯ä»€ä¹ˆï¼Ÿ</p><h3 id="ä¸¤ç§äº‹ä»¶æ¨¡å‹"><a class="markdownIt-Anchor" href="#ä¸¤ç§äº‹ä»¶æ¨¡å‹"></a> ä¸¤ç§äº‹ä»¶æ¨¡å‹</h3><p>åœ¨è¿‡å»ï¼ŒNetscapeå’ŒMicrosoftå¾—å‡ºäº†ä¸åŒçš„ç»“è®ºã€‚</p><ul><li><p>Netscapeè¯´ï¼Œelement1ä¸Šçš„äº‹ä»¶é¦–å…ˆå‘ç”Ÿã€‚è¿™ç§°ä¸ºäº‹ä»¶æ•è·***(capturing)***ã€‚</p></li><li><p>MicrosoftåšæŒè®¤ä¸ºelement2ä¸Šçš„äº‹ä»¶ä¼˜å…ˆã€‚è¿™ç§°ä¸ºäº‹ä»¶å†’æ³¡**(<em>bubbling</em>)**ã€‚</p></li></ul><p>è¿™ä¸¤ä¸ªäº‹ä»¶é¡ºåºå®Œå…¨ç›¸åã€‚ Explorerä»…æ”¯æŒäº‹ä»¶å†’æ³¡ã€‚ Mozillaï¼ŒOpera 7å’ŒKonqueroréƒ½æ”¯æŒã€‚æ—§ç‰ˆOperaå’ŒiCabéƒ½ä¸æ”¯æŒã€‚</p><h4 id="äº‹ä»¶æ•è·capturing"><a class="markdownIt-Anchor" href="#äº‹ä»¶æ•è·capturing"></a> äº‹ä»¶æ•è·ï¼ˆcapturingï¼‰</h4><p>ä½¿ç”¨äº‹ä»¶æ•è·æ—¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">               | |</span><br><span class="line">---------------| |-----------------</span><br><span class="line">| element1     | |                |</span><br><span class="line">|   -----------| |-----------     |</span><br><span class="line">|   |element2  \ /          |     |</span><br><span class="line">|   -------------------------     |</span><br><span class="line">|        Event CAPTURING          |</span><br><span class="line">-----------------------------------</span><br></pre></td></tr></table></figure><p>element1çš„äº‹ä»¶å¤„ç†ç¨‹åºé¦–å…ˆè§¦å‘ï¼Œelement2çš„äº‹ä»¶å¤„ç†ç¨‹åºæœ€åè§¦å‘ã€‚</p><h4 id="äº‹ä»¶å†’æ³¡bubbling"><a class="markdownIt-Anchor" href="#äº‹ä»¶å†’æ³¡bubbling"></a> äº‹ä»¶å†’æ³¡ï¼ˆbubblingï¼‰</h4><p>ä½¿ç”¨äº‹ä»¶å†’æ³¡æ—¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">               / \</span><br><span class="line">---------------| |-----------------</span><br><span class="line">| element1     | |                |</span><br><span class="line">|   -----------| |-----------     |</span><br><span class="line">|   |element2  | |          |     |</span><br><span class="line">|   -------------------------     |</span><br><span class="line">|        Event BUBBLING           |</span><br><span class="line">-----------------------------------</span><br></pre></td></tr></table></figure><p>element2çš„äº‹ä»¶å¤„ç†ç¨‹åºé¦–å…ˆè§¦å‘ï¼Œelement1çš„äº‹ä»¶å¤„ç†ç¨‹åºæœ€åè§¦å‘ã€‚</p><h3 id="w3c-äº‹ä»¶æ¨¡å‹"><a class="markdownIt-Anchor" href="#w3c-äº‹ä»¶æ¨¡å‹"></a> W3C äº‹ä»¶æ¨¡å‹</h3><p>W3Céå¸¸æ˜æ™ºåœ°å†³å®šåœ¨è¿™åœºæ–—äº‰ä¸­å¤„äºä¸­é—´ä½ç½®ã€‚ W3Cäº‹ä»¶æ¨¡å‹ä¸­å‘ç”Ÿçš„ä»»ä½•äº‹ä»¶éƒ½é¦–å…ˆè¢«æ•è·ï¼Œç›´åˆ°åˆ°è¾¾ç›®æ ‡å…ƒç´ ï¼Œç„¶åå†æ¬¡å†’æ³¡ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">                 | |  / \</span><br><span class="line">-----------------| |--| |-----------------</span><br><span class="line">| element1       | |  | |                |</span><br><span class="line">|   -------------| |--| |-----------     |</span><br><span class="line">|   |element2    \ /  | |          |     |</span><br><span class="line">|   --------------------------------     |</span><br><span class="line">|        W3C event model                 |</span><br><span class="line">------------------------------------------`</span><br></pre></td></tr></table></figure><p>Webå¼€å‘äººå‘˜å¯ä»¥é€‰æ‹©æ˜¯åœ¨æ•è·é˜¶æ®µè¿˜æ˜¯å†’æ³¡é˜¶æ®µä¸­æ³¨å†Œäº‹ä»¶å¤„ç†ç¨‹åºã€‚è¿™æ˜¯é€šè¿‡â€œé«˜çº§æ¨¡å‹â€é¡µé¢ä¸Šè¯´æ˜çš„<code>addEventListener()</code>æ–¹æ³•å®Œæˆçš„ã€‚å¦‚æœæœ€åä¸€ä¸ªå‚æ•°ä¸ºtrueï¼Œåˆ™ä¸ºæ•è·é˜¶æ®µè®¾ç½®äº‹ä»¶å¤„ç†ç¨‹åºï¼Œå¦‚æœä¸ºfalseï¼Œåˆ™ä¸ºå†’æ³¡é˜¶æ®µè®¾ç½®äº‹ä»¶å¤„ç†ç¨‹åºã€‚</p><p><strong>å‡è®¾</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">element1.addEventListener(&apos;click&apos;,doSomething2,true)</span><br><span class="line">element2.addEventListener(&apos;click&apos;,doSomething,false)</span><br></pre></td></tr></table></figure><p>å¦‚æœç”¨æˆ·å•å‡»element2ï¼Œåˆ™ä¼šå‘ç”Ÿä»¥ä¸‹æƒ…å†µï¼š</p><ul><li>å•å‡»äº‹ä»¶åœ¨æ•è·é˜¶æ®µå¼€å§‹ã€‚è¯¥äº‹ä»¶æŸ¥æ‰¾element2çš„ä»»ä½•ç¥–å…ˆå…ƒç´ æ˜¯å¦å…·æœ‰ç”¨äºæ•è·é˜¶æ®µçš„onclickäº‹ä»¶å¤„ç†ç¨‹åºã€‚</li><li>è¯¥äº‹ä»¶åœ¨element1ä¸Šæ‰¾åˆ°ä¸€ä¸ªã€‚<code>doSomething2()</code>è¢«æ‰§è¡Œã€‚</li><li>äº‹ä»¶å‘ä¸‹ä¼ æ’­åˆ°ç›®æ ‡æœ¬èº«ï¼Œæ‰¾ä¸åˆ°ç”¨äºæ•è·é˜¶æ®µçš„äº‹ä»¶å¤„ç†ç¨‹åºã€‚è¯¥äº‹ä»¶è¿›å…¥å…¶å†’æ³¡é˜¶æ®µå¹¶æ‰§è¡Œ<code>doSomething()</code>ï¼Œè¯¥äº‹ä»¶å·²åœ¨å†’æ³¡é˜¶æ®µæ³¨å†Œåˆ°element2ã€‚</li><li>äº‹ä»¶å†æ¬¡å‘ä¸Šä¼ æ’­ï¼Œå¹¶æ£€æŸ¥ç›®æ ‡çš„ä»»ä½•ç¥–å…ˆå…ƒç´ æ˜¯å¦å…·æœ‰ç”¨äºå†’æ³¡é˜¶æ®µçš„äº‹ä»¶å¤„ç†ç¨‹åºã€‚äº‹å®å¹¶éå¦‚æ­¤ï¼Œå› æ­¤ä»€ä¹ˆä¹Ÿæ²¡æœ‰å‘ç”Ÿã€‚</li></ul><p><strong>ç›¸å</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">element1.addEventListener(&apos;click&apos;,doSomething2,false)</span><br><span class="line">element2.addEventListener(&apos;click&apos;,doSomething,false)</span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œå¦‚æœç”¨æˆ·å•å‡»element2ï¼Œåˆ™ä¼šå‘ç”Ÿä»¥ä¸‹æƒ…å†µï¼š</p><ul><li>å•å‡»äº‹ä»¶åœ¨æ•è·é˜¶æ®µå¼€å§‹ã€‚è¯¥äº‹ä»¶å°†æŸ¥æ‰¾element2çš„ä»»ä½•ç¥–å…ˆå…ƒç´ æ˜¯å¦å…·æœ‰ç”¨äºæ•è·é˜¶æ®µçš„onclickäº‹ä»¶å¤„ç†ç¨‹åºï¼Œè€Œæ‰¾ä¸åˆ°ä»»ä½•äº‹ä»¶å¤„ç†ç¨‹åºã€‚</li><li>äº‹ä»¶å‘ä¸‹ä¼ æ’­åˆ°ç›®æ ‡æœ¬èº«ã€‚è¯¥äº‹ä»¶è¿›å…¥å…¶å†’æ³¡é˜¶æ®µå¹¶æ‰§è¡Œ<code>doSomething()</code>ï¼Œè¯¥äº‹ä»¶å·²åœ¨å†’æ³¡é˜¶æ®µæ³¨å†Œåˆ°element2ã€‚</li><li>äº‹ä»¶å†æ¬¡å‘ä¸Šä¼ æ’­ï¼Œå¹¶æ£€æŸ¥ç›®æ ‡çš„ä»»ä½•ç¥–å…ˆå…ƒç´ æ˜¯å¦å…·æœ‰ç”¨äºå†’æ³¡é˜¶æ®µçš„äº‹ä»¶å¤„ç†ç¨‹åºã€‚</li><li>è¯¥äº‹ä»¶åœ¨element1ä¸Šæ‰¾åˆ°ä¸€ä¸ªã€‚ç°åœ¨æ‰§è¡Œ<code>doSomething2()</code>ã€‚</li></ul><h3 id="ä¸ä¼ ç»Ÿæ¨¡å‹çš„å…¼å®¹æ€§"><a class="markdownIt-Anchor" href="#ä¸ä¼ ç»Ÿæ¨¡å‹çš„å…¼å®¹æ€§"></a> ä¸ä¼ ç»Ÿæ¨¡å‹çš„å…¼å®¹æ€§</h3><p>åœ¨æ”¯æŒW3C DOMçš„æµè§ˆå™¨ä¸­ï¼Œä¼ ç»Ÿçš„äº‹ä»¶æ³¨å†Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">element1.onclick = doSomething2;</span><br></pre></td></tr></table></figure><p>è¢«è§†ä¸ºå†’æ³¡é˜¶æ®µçš„æ³¨å†Œã€‚</p><h3 id="ä½¿ç”¨äº‹ä»¶å†’æ³¡"><a class="markdownIt-Anchor" href="#ä½¿ç”¨äº‹ä»¶å†’æ³¡"></a> ä½¿ç”¨äº‹ä»¶å†’æ³¡</h3><p>å¾ˆå°‘æœ‰Webå¼€å‘äººå‘˜è‡ªè§‰ä½¿ç”¨äº‹ä»¶æ•è·æˆ–å†’æ³¡ã€‚åœ¨å½“ä»Šçš„ç½‘é¡µä¸­ï¼Œæ ¹æœ¬æ²¡æœ‰å¿…è¦è®©å†’æ³¡äº‹ä»¶ç”±å¤šä¸ªä¸åŒçš„äº‹ä»¶å¤„ç†ç¨‹åºå¤„ç†ã€‚ç”¨æˆ·å¯èƒ½ä¼šå› å•å‡»é¼ æ ‡åå‘ç”Ÿçš„å‡ ä»¶äº‹è€Œæ„Ÿåˆ°å›°æƒ‘ï¼Œå¹¶ä¸”é€šå¸¸æ‚¨å¸Œæœ›å°†äº‹ä»¶å¤„ç†è„šæœ¬åˆ†å¼€ã€‚å½“ç”¨æˆ·å•å‡»æŸä¸ªå…ƒç´ æ—¶ï¼Œä¼šå‘ç”ŸæŸäº›äº‹æƒ…ï¼Œè€Œå½“ç”¨æˆ·å•å‡»å¦ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œä¼šå‘ç”Ÿå…¶ä»–äº‹æƒ…ã€‚</p><p>å½“ç„¶ï¼Œè¿™ç§æƒ…å†µå°†æ¥å¯èƒ½ä¼šæ”¹å˜ï¼Œå› æ­¤æœ€å¥½å¯ä»¥ä½¿ç”¨å‘å‰å…¼å®¹çš„æ¨¡å‹ã€‚ä½†æ˜¯ï¼Œä»Šå¤©äº‹ä»¶æ•è·å’Œå†’æ³¡çš„ä¸»è¦å®é™…ç”¨é€”æ˜¯é»˜è®¤åŠŸèƒ½çš„æ³¨å†Œã€‚</p><h4 id="æ€»æ˜¯ä¼šå‘ç”Ÿ"><a class="markdownIt-Anchor" href="#æ€»æ˜¯ä¼šå‘ç”Ÿ"></a> æ€»æ˜¯ä¼šå‘ç”Ÿ</h4><p>æ‚¨é¦–å…ˆéœ€è¦äº†è§£çš„æ˜¯ï¼Œäº‹ä»¶æ•è·æˆ–å†’æ³¡æ€»æ˜¯ä¼šå‘ç”Ÿã€‚å¦‚æœæ‚¨ä¸ºæ•´ä¸ªdocumentå®šä¹‰å¸¸è§„çš„onclickäº‹ä»¶å¤„ç†ç¨‹åº</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">document.onclick = doSomething;</span><br><span class="line">if (document.captureEvents) document.captureEvents(Event.CLICK);</span><br></pre></td></tr></table></figure><p>documentä¸­ä»»ä½•å…ƒç´ ä¸Šçš„ä»»ä½•clickäº‹ä»¶æœ€ç»ˆéƒ½ä¼šå†’æ³¡åˆ°documentä¸­ï¼Œä»è€Œè§¦å‘æ­¤å¸¸è§„äº‹ä»¶å¤„ç†ç¨‹åºã€‚ä»…å½“ä»¥å‰çš„äº‹ä»¶å¤„ç†è„šæœ¬æ˜ç¡®å‘½ä»¤äº‹ä»¶åœæ­¢å†’æ³¡æ—¶ï¼Œå®ƒæ‰ä¸ä¼šå†’æ³¡åˆ° documentã€‚</p><h4 id="ä½¿ç”¨"><a class="markdownIt-Anchor" href="#ä½¿ç”¨"></a> ä½¿ç”¨</h4><p>å› ä¸ºä»»ä½•äº‹ä»¶æœ€ç»ˆéƒ½å‡ºç°åœ¨ document ä¸Šï¼Œæ‰€ä»¥é»˜è®¤äº‹ä»¶å¤„ç†ç¨‹åºæˆä¸ºå¯èƒ½ã€‚å‡è®¾æ‚¨æœ‰æ­¤é¡µé¢ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">------------------------------------</span><br><span class="line">| document                         |</span><br><span class="line">|   ---------------  ------------  |</span><br><span class="line">|   | element1    |  | element2 |  |</span><br><span class="line">|   ---------------  ------------  |</span><br><span class="line">|                                  |</span><br><span class="line">------------------------------------</span><br><span class="line"></span><br><span class="line">element1.onclick = doSomething;</span><br><span class="line">element2.onclick = doSomething;</span><br><span class="line">document.onclick = defaultFunction;</span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œå¦‚æœç”¨æˆ·å•å‡»element1æˆ–2ï¼Œåˆ™å°†æ‰§è¡Œ<code>doSomething()</code>ã€‚å¦‚æœéœ€è¦ï¼Œå¯ä»¥åœ¨æ­¤å¤„åœæ­¢äº‹ä»¶ä¼ æ’­ã€‚å¦‚æœæ‚¨ä¸è¿™æ ·åšï¼Œåˆ™äº‹ä»¶ä¼šä¸Šå‡åˆ°<code>defaultFunction()</code>ã€‚å¦‚æœç”¨æˆ·å•å‡»å…¶ä»–ä»»ä½•åœ°æ–¹ï¼Œè¿˜å°†æ‰§è¡Œ<code>defaultFunction()</code>ã€‚æœ‰æ—¶è¿™å¯èƒ½å¾ˆæœ‰ç”¨ã€‚</p><p>åœ¨æ‹–æ”¾è„šæœ¬ä¸­ï¼Œå¿…é¡»è®¾ç½®<code>document</code>èŒƒå›´çš„äº‹ä»¶å¤„ç†ç¨‹åºã€‚é€šå¸¸ï¼Œä¸Šå±‚çš„<code>mousedown</code>äº‹ä»¶ä¼šé€‰æ‹©è¯¥å±‚å¹¶ä½¿ä¹‹å“åº”<code>mousemove</code>äº‹ä»¶ã€‚å°½ç®¡é€šå¸¸åœ¨å±‚ä¸Šæ³¨å†Œ<code>mousedown</code>ä»¥é¿å…æµè§ˆå™¨é”™è¯¯ï¼Œä½†æ˜¯å…¶ä»–ä¸¤ä¸ªäº‹ä»¶å¤„ç†ç¨‹åºéƒ½å¿…é¡»åœ¨<code>document</code>èŒƒå›´å†…ã€‚</p><p>è®°ä½æµè§ˆå™¨å­¦çš„ç¬¬ä¸€å®šå¾‹ï¼šä»»ä½•äº‹æƒ…éƒ½æœ‰å¯èƒ½å‘ç”Ÿï¼Œå¹¶ä¸”é€šå¸¸åœ¨æ‚¨æœ€æ²¡æœ‰å‡†å¤‡çš„æƒ…å†µä¸‹æ‰ä¼šå‘ç”Ÿã€‚å› æ­¤ï¼Œç”¨æˆ·å¯èƒ½ä¼šéå¸¸ç–¯ç‹‚åœ°ç§»åŠ¨é¼ æ ‡ï¼Œè€Œè„šæœ¬æ— æ³•è·Ÿä¸Šï¼Œä»¥è‡³äºé¼ æ ‡ä¸å†ä½äºå›¾å±‚ä¸Šã€‚</p><ul><li>å¦‚æœ<code>onmousemove</code>äº‹ä»¶å¤„ç†ç¨‹åºå·²æ³¨å†Œåˆ°å›¾å±‚ï¼Œåˆ™è¯¥å›¾å±‚ä¸å†å¯¹é¼ æ ‡ç§»åŠ¨åšå‡ºååº”ï¼Œä»è€Œå¼•èµ·æ··ä¹±ã€‚</li><li>å¦‚æœ<code>onmouseup</code>äº‹ä»¶å¤„ç†ç¨‹åºå·²åœ¨å›¾å±‚ä¸Šæ³¨å†Œï¼Œåˆ™ä¸ä¼šæ•è·æ­¤äº‹ä»¶ï¼Œå› æ­¤å³ä½¿ç”¨æˆ·è®¤ä¸ºä»–æ”¾ä¸‹äº†è¯¥å›¾å±‚ï¼Œè¯¥å›¾å±‚ä¹Ÿä¼šç»§ç»­å¯¹é¼ æ ‡ç§»åŠ¨åšå‡ºååº”ã€‚è¿™å¼•èµ·äº†æ›´å¤šçš„æ··ä¹±ã€‚</li></ul><p>å› æ­¤ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œäº‹ä»¶å†’æ³¡éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºåœ¨æ–‡æ¡£çº§åˆ«æ³¨å†Œäº‹ä»¶å¤„ç†ç¨‹åºå¯ç¡®ä¿å§‹ç»ˆæ‰§è¡Œå®ƒä»¬ã€‚</p><h4 id="ç¦ç”¨"><a class="markdownIt-Anchor" href="#ç¦ç”¨"></a> ç¦ç”¨</h4><p>ä½†æ˜¯é€šå¸¸æ‚¨æƒ³å…³é—­æ‰€æœ‰æ•è·å’Œå†’æ³¡åŠŸèƒ½ï¼Œä»¥é˜²æ­¢åŠŸèƒ½ç›¸äº’å¹²æ‰°ã€‚æ­¤å¤–ï¼Œå¦‚æœæ‚¨çš„æ–‡æ¡£ç»“æ„éå¸¸å¤æ‚ï¼ˆå¾ˆå¤šåµŒå¥—è¡¨ç­‰ï¼‰ï¼Œåˆ™å¯ä»¥é€šè¿‡å…³é—­å†’æ³¡æ¥èŠ‚çœç³»ç»Ÿèµ„æºã€‚æµè§ˆå™¨å¿…é¡»éå†äº‹ä»¶ç›®æ ‡çš„æ¯ä¸ªç¥–å…ˆå…ƒç´ ï¼Œä»¥æŸ¥çœ‹å…¶æ˜¯å¦å…·æœ‰äº‹ä»¶å¤„ç†ç¨‹åºã€‚å³ä½¿æœªæ‰¾åˆ°ï¼Œæœç´¢ä»ç„¶éœ€è¦æ—¶é—´ã€‚</p><p>åœ¨Microsoftæ¨¡å‹ä¸­ï¼Œæ‚¨å¿…é¡»å°†äº‹ä»¶çš„cancelBubbleå±æ€§è®¾ç½®ä¸ºtrueã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">window.event.cancelBubble = true</span><br></pre></td></tr></table></figure><p>åœ¨W3Cæ¨¡å‹ä¸­ï¼Œæ‚¨å¿…é¡»è°ƒç”¨äº‹ä»¶çš„*stopPropagation()*æ–¹æ³•ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">e.stopPropagation()</span><br></pre></td></tr></table></figure><p>è¿™å°†åœæ­¢äº‹ä»¶åœ¨å†’æ³¡é˜¶æ®µçš„æ‰€æœ‰ä¼ æ’­ã€‚è¦è·å¾—å®Œæ•´çš„è·¨æµè§ˆå™¨ä½“éªŒï¼Œè¯·æ‰§è¡Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">function doSomething(e)</span><br><span class="line">&#123;</span><br><span class="line">if (!e) var e = window.event;</span><br><span class="line">e.cancelBubble = true;</span><br><span class="line">if (e.stopPropagation) e.stopPropagation();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸æ”¯æŒè¯¥åŠŸèƒ½çš„æµè§ˆå™¨ä¸­è®¾ç½®cancelBubbleå±æ€§ä¸ä¼šæœ‰ä»»ä½•é—®é¢˜ã€‚æµè§ˆå™¨è€¸è€¸è‚©å¹¶åˆ›å»ºå±æ€§ã€‚å½“ç„¶ï¼Œå®ƒå®é™…ä¸Šå¹¶ä¸èƒ½æ¶ˆé™¤å†’æ³¡ï¼Œä½†æ˜¯ä½œä¸šæœ¬èº«æ˜¯å®‰å…¨çš„ã€‚</p><h4 id="å½“å‰ç›®æ ‡"><a class="markdownIt-Anchor" href="#å½“å‰ç›®æ ‡"></a> å½“å‰ç›®æ ‡</h4><p>å¦‚æˆ‘ä»¬å‰é¢æ‰€è§ï¼Œäº‹ä»¶å…·æœ‰ä¸€ä¸ªtargetæˆ–srcElementï¼Œå…¶ä¸­åŒ…å«å¯¹è¯¥äº‹ä»¶å‘ç”Ÿæ‰€åœ¨å…ƒç´ çš„å¼•ç”¨ã€‚åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œè¿™æ˜¯element2ï¼Œå› ä¸ºç”¨æˆ·å•å‡»äº†å®ƒã€‚</p><p>éå¸¸é‡è¦çš„ä¸€ç‚¹æ˜¯è¦ç†è§£ï¼Œåœ¨æ•è·å’Œå†’æ³¡é˜¶æ®µï¼ˆå¦‚æœæœ‰ï¼‰ï¼Œè¯¥ç›®æ ‡ä¸ä¼šæ”¹å˜ï¼šå®ƒå§‹ç»ˆæ˜¯å¯¹element2çš„å¼•ç”¨ã€‚</p><p>ä½†æ˜¯ï¼Œå‡è®¾æˆ‘ä»¬æ³¨å†Œäº†ä»¥ä¸‹äº‹ä»¶å¤„ç†ç¨‹åºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">element1.onclick = doSomething;</span><br><span class="line">element2.onclick = doSomething;</span><br></pre></td></tr></table></figure><p>å¦‚æœç”¨æˆ·å•å‡»element2ï¼Œåˆ™<code>doSomething()</code>å°†æ‰§è¡Œä¸¤æ¬¡ã€‚ä½†æ˜¯ï¼Œæ‚¨å¦‚ä½•çŸ¥é“å½“å‰æ­£åœ¨å¤„ç†è¯¥äº‹ä»¶çš„HTMLå…ƒç´ ï¼Ÿ target / srcElementä¸æä¾›ä»»ä½•çº¿ç´¢ï¼Œå®ƒä»¬å§‹ç»ˆå¼•ç”¨element2ï¼Œå› ä¸ºå®ƒæ˜¯äº‹ä»¶çš„åŸå§‹æ¥æºã€‚</p><p>ä¸ºäº†è§£å†³æ­¤é—®é¢˜ï¼ŒW3Cæ·»åŠ äº†currentTargetå±æ€§ã€‚å®ƒåŒ…å«å¯¹äº‹ä»¶å½“å‰æ­£åœ¨å¤„ç†çš„HTMLå…ƒç´ çš„å¼•ç”¨ï¼šæ­£æ˜¯æˆ‘ä»¬æ‰€éœ€è¦çš„ã€‚ä¸å¹¸çš„æ˜¯ï¼ŒMicrosoftæ¨¡å‹ä¸åŒ…å«ç±»ä¼¼çš„å±æ€§ã€‚</p><p>æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨thiså…³é”®å­—ã€‚åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œå®ƒå¼•ç”¨å¤„ç†äº‹ä»¶çš„HTMLå…ƒç´ ï¼Œå°±åƒcurrentTargetä¸€æ ·ã€‚</p><h4 id="microsoftæ¨¡å¼çš„é—®é¢˜"><a class="markdownIt-Anchor" href="#microsoftæ¨¡å¼çš„é—®é¢˜"></a> Microsoftæ¨¡å¼çš„é—®é¢˜</h4><p>ä½†æ˜¯ï¼Œå½“æ‚¨ä½¿ç”¨Microsoftäº‹ä»¶æ³¨å†Œæ¨¡å‹æ—¶ï¼Œæ­¤å…³é”®å­—å¹¶ä¸å¼•ç”¨HTMLå…ƒç´ ã€‚åŠ ä¸ŠMicrosoftæ¨¡å‹ä¸­ç¼ºå°‘ç±»ä¼¼äºcurrentTargetçš„å±æ€§ï¼Œè¿™æ„å‘³ç€å¦‚æœæ‚¨è¿™æ ·åš</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">element1.attachEvent(&apos;onclick&apos;,doSomething)</span><br><span class="line">element2.attachEvent(&apos;onclick&apos;,doSomething)</span><br></pre></td></tr></table></figure><p>æ‚¨ä¸çŸ¥é“å½“å‰å“ªä¸ªHTMLå…ƒç´ å¤„ç†è¯¥äº‹ä»¶ã€‚è¿™æ˜¯Microsoftäº‹ä»¶æ³¨å†Œæ¨¡å‹ä¸­æœ€ä¸¥é‡çš„é—®é¢˜ï¼Œå¯¹æˆ‘æ¥è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªä»ä¸ä½¿ç”¨å®ƒçš„ç†ç”±ï¼Œå³ä½¿åœ¨ä»…IE / Winçš„åº”ç”¨ç¨‹åºä¸­ä¹Ÿæ˜¯å¦‚æ­¤ã€‚</p><p>æˆ‘å¸Œæœ›å¾®è½¯èƒ½å°½å¿«æ·»åŠ ç±»ä¼¼äºcurrentTargetçš„å±æ€§ï¼Œç”šè‡³å¯ä»¥éµå¾ªè¯¥æ ‡å‡†ï¼Ÿ Webå¼€å‘äººå‘˜éœ€è¦æ­¤ä¿¡æ¯ã€‚</p><h3 id="å‚è€ƒ"><a class="markdownIt-Anchor" href="#å‚è€ƒ"></a> å‚è€ƒ</h3><p><a href="https://www.quirksmode.org/js/events_order.html" target="_blank" rel="noopener">Event Order</a></p>]]></content>
    
    <summary type="html">
    
      å¯¹äºJSçš„äº‹ä»¶ä¼ é€’è¿˜æ˜¯æ¯”è¾ƒé™Œç”Ÿï¼Œæ‰€ä»¥æ‰“ç®—å¥½å¥½ç†ä¸€ç†preventDefaultå’ŒstopPropagationçš„ç”¨æ³•ï¼Œå½»åº•å‘Šåˆ«æ¨¡ç³Šï¼Œæå‡è‡ªå·±çš„å‰ç«¯æ®µä½ï¼
    
    </summary>
    
      <category term="JavaScript" scheme="https://wzes.github.io/categories/JavaScript/"/>
    
    
      <category term="JavaScript" scheme="https://wzes.github.io/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>Browser Window æ‰«ç›²</title>
    <link href="https://wzes.github.io/2019/09/22/JavaScript/BrowserWindow/"/>
    <id>https://wzes.github.io/2019/09/22/JavaScript/BrowserWindow/</id>
    <published>2019-09-22T10:56:00.000Z</published>
    <updated>2019-09-21T14:18:05.202Z</updated>
    
    <content type="html"><![CDATA[<h3 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h3><p>ä½œä¸ºä¸€ä¸ª Node å¼€å‘å·¥ç¨‹å¸ˆï¼Œä¼¼ä¹å¯¹äº Window å¹¶ä¸éœ€è¦å…³å¿ƒï¼Œä½†ä½œä¸ºä¸€ä¸ªå‰ç«¯å·¥ç¨‹å¸ˆï¼ŒWindow æ˜¯ä¸ªå•¥å­ä¸œä¸œï¼Œè¿˜æ˜¯éœ€è¦èŠ±æ—¶é—´ç†ä¸€ç†çš„ã€‚æœ¬æœŸçœ‹ç‚¹ï¼Œæ·±å…¥äº†è§£ Window çš„ API ï½</p><h3 id="window"><a class="markdownIt-Anchor" href="#window"></a> Window</h3><p>æ‰€æœ‰çš„æµè§ˆå™¨éƒ½æœ‰ Window å¯¹è±¡ï¼Œæ¯ä¸ªçª—å£éƒ½ä¼šå…·æœ‰ä¸€ä¸ª Windowï¼Œé€šå¸¸åœ¨æµè§ˆå™¨å¼€å‘è€…æ¨¡å¼ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ window æ‹¿åˆ°è¿™ä¸ªå¯¹è±¡ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">window</span><br></pre></td></tr></table></figure><p>window å…·æœ‰å¾ˆå¤šå±æ€§å’Œæ–¹æ³•ï¼Œå¸¸è§çš„æœ‰</p><ul><li><p>navigator å¯¼èˆªå™¨</p></li><li><p>screen æ˜¾ç¤ºå™¨</p></li><li><p>history å†å²å¯¹è±¡</p></li><li><p>location ä½ç½®å¯¹è±¡</p></li><li><p>document æ–‡æ¡£å¯¹è±¡</p></li><li><p>æ–¹æ³•</p><ul><li><p>open</p></li><li><p>close</p></li><li><p>setTimeout</p></li><li><p>setInterval</p><p>â€¦</p></li></ul></li></ul><p>åœ¨æµè§ˆå™¨ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨è¿™äº›å¯¹è±¡å’Œæ–¹æ³•ï¼Œå®Œæ•´çš„ç”¨æ³•æ˜¯ <strong>window.xx</strong>ï¼Œä½†æˆ‘ä»¬å¯ä»¥çœç•¥ windowï¼Œç›´æ¥ä½¿ç”¨ xx å³å¯ï¼Œå¯¹äºæ–°æ‰‹æ¥è¯´å¯èƒ½è§‰å¾—å¾ˆå¥‡æ€ªã€‚</p><p>å¤ä¹ ä¸€ä¸‹æ–¹æ³•è°ƒç”¨ï¼Œ Javascript çš„æ–¹æ³•æ‰§è¡Œæœ€ç»ˆéƒ½ä¼šæ˜¯ä»¥  <strong>xx.call(this, argsâ€¦)</strong> çš„å½¢å¼ï¼Œè¿™é‡Œçš„ this å°±æ˜¯æ–¹æ³•çš„ä¸Šä¸‹æ–‡ï¼Œé€šå¸¸æ˜¯è°ƒç”¨çš„å¯¹è±¡</p><p>åœ¨æµè§ˆå™¨é‡Œï¼Œå¦‚æœæˆ‘ä»¬ç›´æ¥ä½¿ç”¨ä¸€ä¸ªå±æ€§æˆ–è€…æ–¹æ³•ï¼Œé‚£ä¹ˆæ‰§è¡Œè¿™ä¸ªæ–¹æ³•çš„ä¸Šä¸‹æ–‡é€šå¸¸éƒ½æ˜¯ window å¯¹è±¡ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™äº›å¯¹è±¡å’Œæ–¹æ³•ï¼Œå› ä¸ºä¸Šä¸‹æ–‡ç¯å¢ƒå°±æ˜¯ windowï¼Œæœ€åå–çš„éƒ½æ˜¯ window çš„å±æ€§å’Œæ–¹æ³•ã€‚</p><p>æ”¾ä¸€å¼ æ¯”è¾ƒå®Œæ•´çš„å›¾ï½</p><p><img src="/2019/09/22/JavaScript/BrowserWindow/window.gif" alt></p><h3 id="document"><a class="markdownIt-Anchor" href="#document"></a> document</h3><p>document æ˜¯æˆ‘ä»¬çš„æ–‡æ¡£å¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¼€å‘è€…æ¨¡å¼ç›´æ¥æ‰“å° documentï¼Œdocument æ‰“å°å‡ºæ¥ï¼ˆtoStringï¼‰å°±æ˜¯æˆ‘ä»¬çš„ htmlï¼Œå®é™…ä¸Š document å¯¹è±¡ä¹Ÿå…·æœ‰å¾ˆå¤šæ–¹æ³•å’Œå±æ€§ã€‚</p><p><img src="/2019/09/22/JavaScript/BrowserWindow/document.jpg" alt></p><h4 id="createelement"><a class="markdownIt-Anchor" href="#createelement"></a> createElement</h4><p>åˆ›å»ºå…ƒç´ </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">const div = document.createElement(&apos;div&apos;)</span><br><span class="line">div.appendChild()</span><br></pre></td></tr></table></figure><h4 id="getelementbyid"><a class="markdownIt-Anchor" href="#getelementbyid"></a> getElementById</h4><p>è·å–å…ƒç´ </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">const div = document.getElementById(&apos;id&apos;)</span><br><span class="line">div.appendChild()</span><br></pre></td></tr></table></figure><p>åˆ©ç”¨è¿™äº›æ–¹æ³•åˆ›å»ºå…ƒç´ ï¼Œç„¶åå°†å…ƒç´ æŒ‚è½½åˆ°å·²æœ‰çš„ dom (app)ä¸Šï¼ŒReactï¼ŒVue æ¡†æ¶æœ€æ ¸å¿ƒçš„åŸç†ä¸è¿‡å¦‚æ­¤</p><h4 id="cookie"><a class="markdownIt-Anchor" href="#cookie"></a> cookie</h4><p>cookie å¯¹è±¡æ˜¯ document çš„å±æ€§ï¼Œå½“è®¿é—®åŒæºçš„ç½‘ç«™æ˜¯ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬å§ cookie å¯¹è±¡ä¼ è¿‡å»ï¼Œcookie å¯¹è±¡é€šå¸¸åŒ…å«äº†ç”¨æˆ·ä¿¡æ¯ï¼ŒæœåŠ¡ç«¯å¯ä»¥é€šè¿‡ cookie åˆ¤æ–­ç”¨æˆ·çš„çŠ¶æ€ï¼Œcookie é»˜è®¤æ˜¯æŒä¹…åŒ–ä¿å­˜çš„</p><h4 id="location"><a class="markdownIt-Anchor" href="#location"></a> location</h4><p>location å¯¹è±¡å³ window çš„ location å¯¹è±¡</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">document.location == window.location</span><br><span class="line">// true</span><br></pre></td></tr></table></figure><h4 id="url"><a class="markdownIt-Anchor" href="#url"></a> URL</h4><p>è¿”å›å½“å‰çš„ url</p><h4 id="open"><a class="markdownIt-Anchor" href="#open"></a> open</h4><p>ä¸ window çš„ open ä¸åŒï¼Œ document çš„ open æ˜¯æ“ä½œ document å¯¹è±¡ï¼Œæ‰“å¼€ä¸€ä¸ª document çš„è¾“å…¥æµï¼Œopen å°†ä¼šæ¸…ç©ºå½“å‰çš„æ–‡æ¡£</p><h4 id="close"><a class="markdownIt-Anchor" href="#close"></a> close</h4><p>å…³é—­æ–‡æ¡£æµ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">document.open(); </span><br><span class="line">document.write(&quot;&lt;p&gt;Hello world!&lt;/p&gt;&quot;);</span><br><span class="line">document.write(&quot;&lt;p&gt;I am a fish&lt;/p&gt;&quot;);</span><br><span class="line">document.write(&quot;&lt;p&gt;The number is 42&lt;/p&gt;&quot;); </span><br><span class="line">document.close();</span><br></pre></td></tr></table></figure><p><img src="/2019/09/22/JavaScript/BrowserWindow/open_close.jpg" alt></p><h3 id="æ€»ç»“"><a class="markdownIt-Anchor" href="#æ€»ç»“"></a> æ€»ç»“</h3><p>window å¯¹è±¡åšå¤§ç²¾æ·±ï½</p>]]></content>
    
    <summary type="html">
    
      ä½œä¸ºä¸€ä¸ª Node å¼€å‘å·¥ç¨‹å¸ˆï¼Œä¼¼ä¹å¯¹äº Window å¹¶ä¸éœ€è¦å…³å¿ƒï¼Œä½†ä½œä¸ºä¸€ä¸ªå‰ç«¯å·¥ç¨‹å¸ˆï¼ŒWindow æ˜¯ä¸ªå•¥å­ä¸œä¸œï¼Œè¿˜æ˜¯éœ€è¦èŠ±æ—¶é—´ç†ä¸€ç†çš„ã€‚æœ¬æœŸçœ‹ç‚¹ï¼Œæ·±å…¥äº†è§£ Window çš„ API ï½ï½
    
    </summary>
    
      <category term="JavaScript" scheme="https://wzes.github.io/categories/JavaScript/"/>
    
    
      <category term="JavaScript" scheme="https://wzes.github.io/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>koa-bodyparser æºç è§£æ</title>
    <link href="https://wzes.github.io/2019/09/08/JavaScript/koa-bodyparser/"/>
    <id>https://wzes.github.io/2019/09/08/JavaScript/koa-bodyparser/</id>
    <published>2019-09-08T10:56:00.000Z</published>
    <updated>2019-09-08T15:31:51.951Z</updated>
    
    <content type="html"><![CDATA[<h3 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h3><p>å‰é¢æˆ‘ä»¬å·²ç»æŠŠã€è£¸é…ã€‘ Koa å­¦ä¹ äº†ä¸€ä¸‹ï¼Œå­¦å®Œäº†ä»¥åå¥½åƒå¹¶æ²¡æœ‰ä»€ä¹ˆå¥½ç”¨çš„ä¸œè¥¿ï¼Œç„¶è€Œè¿™ç©æ„å°±åƒä¸€ä¸ªå·¨å¤§çš„å¹³å°ï¼Œå®¹æ˜“é›†æˆå„ç§å°æ’ä»¶ï¼Œæ¥è¾¾åˆ°å„ç§å„æ ·çš„åŠŸèƒ½ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å­¦ä¹ ä¸€ä¸ª koa-bodyparser è¿™æ­ŒçŸ­å°ç²¾æ‚çš„åº“ï¼</p><h3 id="helloworld"><a class="markdownIt-Anchor" href="#helloworld"></a> HelloWorld</h3><p>å½“æˆ‘çš„ hello world å¦‚æ­¤ç®€å•çš„æ—¶å€™ï¼Œæˆ‘æƒ³å‘ä¸€ä¸ª POST è¯·æ±‚ï¼Œé‚£ä¹ˆæˆ‘æ€ä¹ˆæ‹¿åˆ° POST è¯·æ±‚çš„å‚æ•°å‘¢ï¼Œæˆ‘ä»¬ ctx.request.body æ˜¯ç©ºçš„ï¼ŒKoa åŸå£°çš„æ¡†æ¶å¹¶æ²¡æœ‰å¸®æˆ‘ä»¬è§£æ POST çš„è¯·æ±‚æ•°æ®ã€‚æ‰€ä»¥æˆ‘ä»¬å°±éœ€è¦åŠ å…¥ koa-bodyparser ä¸­é—´ä»¶ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡  ctx.request.body æ‹¿åˆ°æ•°æ®äº†ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">const Koa = require(&apos;koa&apos;);</span><br><span class="line">const app = new Koa();</span><br><span class="line">app.use(async ctx =&gt; &#123;</span><br><span class="line">    // ctx.body = ctx.query.param;</span><br><span class="line">    console.log( ctx.request.body)</span><br><span class="line">&#125;);</span><br><span class="line">app.listen(3000);</span><br></pre></td></tr></table></figure><p>é¦–å…ˆå®‰è£…è¿™ä¸ªåº“ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install koa-bodyparser --save</span><br></pre></td></tr></table></figure><p>ç„¶åå†ä»£ç ä¸­åŠ å…¥è¿™ä¸ªä¸­é—´ä»¶ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">const Koa = require(&apos;koa&apos;);</span><br><span class="line">const bodyParser = require(&apos;koa-bodyparser&apos;)</span><br><span class="line"></span><br><span class="line">const app = new Koa();</span><br><span class="line"></span><br><span class="line">app.use(bodyParser());</span><br><span class="line"></span><br><span class="line">app.use(async ctx =&gt; &#123;</span><br><span class="line">    ctx.body = ctx.request.body.param;</span><br><span class="line">    console.log(ctx.request.body)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(3000);</span><br></pre></td></tr></table></figure><p>è¿™æ—¶å€™ ctx.request.body ä¾¿æ˜¯ä¸€ä¸ªè§£æå¥½çš„å¯¹è±¡äº†ï¼Œç›´æ¥å–å¯¹è±¡çš„å±æ€§å°±å¯ä»¥äº†</p><h5 id="é¢˜å¤–è¯"><a class="markdownIt-Anchor" href="#é¢˜å¤–è¯"></a> é¢˜å¤–è¯</h5><p>åŸå£°çš„ NodeJS é€šè¿‡ createServer ä¹Ÿæ˜¯æ²¡æœ‰åŠæ³•ç›´æ¥å–åˆ° post çš„å‚æ•°çš„ï¼Œè¿˜æ˜¯éœ€è¦åšä¸€äº›è¯»å–æ•°æ®çš„æ“ä½œæ‰å¯ä»¥</p><h3 id="æºç è§£æ"><a class="markdownIt-Anchor" href="#æºç è§£æ"></a> æºç è§£æ</h3><h4 id="bodyparser"><a class="markdownIt-Anchor" href="#bodyparser"></a> bodyParser</h4><p>ä½œä¸ºä¸€ä¸ªä¸­é—´ä»¶ï¼Œéœ€è¦è¿”å›ä¸€ä¸ª async å‡½æ•°ï¼Œåœ¨è¿™ä¸ªå‡½æ•°çš„æœ€åè°ƒç”¨ next()ï¼Œå…³é”®éƒ¨åˆ†æ˜¯ parseBody å‡½æ•°ï¼Œå°† request è¿›è¡Œè§£æï¼Œå¹¶å°†ç»“æœè¿”å›èµ‹å€¼ç»™ ctx.request.body</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">return async function bodyParser(ctx, next) &#123;</span><br><span class="line">    if (ctx.request.body !== undefined) return await next();</span><br><span class="line">    if (ctx.disableBodyParser) return await next();</span><br><span class="line">    try &#123;</span><br><span class="line">      const res = await parseBody(ctx);</span><br><span class="line">      ctx.request.body = &apos;parsed&apos; in res ? res.parsed : &#123;&#125;;</span><br><span class="line">      if (ctx.request.rawBody === undefined) ctx.request.rawBody = res.raw;</span><br><span class="line">    &#125; catch (err) &#123;</span><br><span class="line">      if (onerror) &#123;</span><br><span class="line">        onerror(err, ctx);</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        throw err;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    await next();</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure><h5 id="parsebody"><a class="markdownIt-Anchor" href="#parsebody"></a> parseBody</h5><p><a href="http://ctx.request.is" target="_blank" rel="noopener">ctx.request.is</a> å¯ä»¥æ£€æŸ¥ request ã€Content-Typeã€‘ è¯·æ±‚çš„ç±»å‹æ˜¯å¦æ˜¯å½“ä¸­çš„ä¸€ä¸ªï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä»¥ form å±…å¤šï¼Œå³ <strong>application/x-www-form-urlencoded</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">async function parseBody(ctx) &#123;</span><br><span class="line">    if (enableJson &amp;&amp; ((detectJSON &amp;&amp; detectJSON(ctx)) || ctx.request.is(jsonTypes))) &#123;</span><br><span class="line">      return await parse.json(ctx, jsonOpts);</span><br><span class="line">    &#125;</span><br><span class="line">    if (enableForm &amp;&amp; ctx.request.is(formTypes)) &#123;</span><br><span class="line">      return await parse.form(ctx, formOpts);</span><br><span class="line">    &#125;</span><br><span class="line">    if (enableText &amp;&amp; ctx.request.is(textTypes)) &#123;</span><br><span class="line">      return await parse.text(ctx, textOpts) || &apos;&apos;;</span><br><span class="line">    &#125;</span><br><span class="line">    return &#123;&#125;;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h5 id="parseform"><a class="markdownIt-Anchor" href="#parseform"></a> parse.form</h5><p>ä¸»è¦æ˜¯ raw(inflate(req), opts) æ–¹æ³•ï¼Œå°†è¯·æ±‚çš„å‚æ•°è½¬åŒ–ä¸ºä¸€ä¸ª string</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">module.exports = async function(req, opts) &#123;</span><br><span class="line">  req = req.req || req;</span><br><span class="line">  opts = utils.clone(opts);</span><br><span class="line">  const queryString = opts.queryString || &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  // keep compatibility with qs@4</span><br><span class="line">  if (queryString.allowDots === undefined) queryString.allowDots = true;</span><br><span class="line"></span><br><span class="line">  // defaults</span><br><span class="line">  const len = req.headers[&apos;content-length&apos;];</span><br><span class="line">  const encoding = req.headers[&apos;content-encoding&apos;] || &apos;identity&apos;;</span><br><span class="line">  if (len &amp;&amp; encoding === &apos;identity&apos;) opts.length = ~~len;</span><br><span class="line">  opts.encoding = opts.encoding || &apos;utf8&apos;;</span><br><span class="line">  opts.limit = opts.limit || &apos;56kb&apos;;</span><br><span class="line">  opts.qs = opts.qs || qs;</span><br><span class="line"></span><br><span class="line">  const str = await raw(inflate(req), opts);</span><br><span class="line">  try &#123;</span><br><span class="line">    const parsed = opts.qs.parse(str, queryString);</span><br><span class="line">    return opts.returnRawBody ? &#123; parsed, raw: str &#125; : parsed;</span><br><span class="line">  &#125; catch (err) &#123;</span><br><span class="line">    err.status = 400;</span><br><span class="line">    err.body = str;</span><br><span class="line">    throw err;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h5 id="raw"><a class="markdownIt-Anchor" href="#raw"></a> raw</h5><p>è¯»å– body æ•°æ®ï¼Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">function getRawBody (stream, options, callback) &#123;</span><br><span class="line"></span><br><span class="line">  return new Promise(function executor (resolve, reject) &#123;</span><br><span class="line">    readStream(stream, encoding, length, limit, function onRead (err, buf) &#123;</span><br><span class="line">      if (err) return reject(err)</span><br><span class="line">      resolve(buf)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€‰å–äº† onData å‡½æ•°ï¼Œå¯ä»¥æ¥å—æµæ•°æ®ï¼Œä»¥å­—ç¬¦ä¸²å½¢å¼ï¼Œç»“æŸåç›´æ¥è¿”å› å­—ç¬¦ä¸²å³å¯ï¼Œæ•°æ®ä¸º bufferï¼Œä½¿ç”¨ buffer.toString() å°±å¯ä»¥è½¬åŒ–ä¸ºå­—ç¬¦ä¸²ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">function readStream (stream, encoding, length, limit, callback) &#123;</span><br><span class="line">  // attach listeners</span><br><span class="line">  stream.on(&apos;aborted&apos;, onAborted)</span><br><span class="line">  stream.on(&apos;close&apos;, cleanup)</span><br><span class="line">  stream.on(&apos;data&apos;, onData)</span><br><span class="line">  stream.on(&apos;end&apos;, onEnd)</span><br><span class="line">  stream.on(&apos;error&apos;, onEnd)</span><br><span class="line">  </span><br><span class="line">  function onData (chunk) &#123;</span><br><span class="line">    if (complete) return</span><br><span class="line"></span><br><span class="line">    received += chunk.length</span><br><span class="line"></span><br><span class="line">    if (limit !== null &amp;&amp; received &gt; limit) &#123;</span><br><span class="line">      done(createError(413, &apos;request entity too large&apos;, &#123;</span><br><span class="line">        limit: limit,</span><br><span class="line">        received: received,</span><br><span class="line">        type: &apos;entity.too.large&apos;</span><br><span class="line">      &#125;))</span><br><span class="line">    &#125; else if (decoder) &#123;</span><br><span class="line">      buffer += decoder.write(chunk)</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      buffer.push(chunk)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function onEnd (err) &#123;</span><br><span class="line">    if (complete) return</span><br><span class="line">    if (err) return done(err)</span><br><span class="line"></span><br><span class="line">    if (length !== null &amp;&amp; received !== length) &#123;</span><br><span class="line">      done(createError(400, &apos;request size did not match content length&apos;, &#123;</span><br><span class="line">        expected: length,</span><br><span class="line">        length: length,</span><br><span class="line">        received: received,</span><br><span class="line">        type: &apos;request.size.invalid&apos;</span><br><span class="line">      &#125;))</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      var string = decoder</span><br><span class="line">        ? buffer + (decoder.end() || &apos;&apos;)</span><br><span class="line">        : Buffer.concat(buffer)</span><br><span class="line">      done(null, string)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ onEnd ä¸­è¿”å›å­—ç¬¦ä¸²</p><h3 id="å†™åœ¨æœ€å"><a class="markdownIt-Anchor" href="#å†™åœ¨æœ€å"></a> å†™åœ¨æœ€å</h3><p>koa-bodyparser ä¸ä»…åšäº† post çš„è½¬åŒ–ï¼Œè¿˜æœ‰ä¸€äº›å¯é€‰çš„å‚æ•°ï¼Œæ¯”å¦‚è¯´ä¼ è¾“ç±»å‹ï¼Œå¤§å°é™åˆ¶ï¼Œè¿™äº›éƒ½æ˜¯å¯ä»¥é€šè¿‡å‚æ•°è¿›è¡Œé…ç½®çš„ã€‚æºç åšå¤§ç²¾æ·±å•Šï¼</p>]]></content>
    
    <summary type="html">
    
      å‰é¢æˆ‘ä»¬å·²ç»æŠŠã€è£¸é…ã€‘ Koa å­¦ä¹ äº†ä¸€ä¸‹ï¼Œå­¦å®Œäº†ä»¥åå¥½åƒå¹¶æ²¡æœ‰ä»€ä¹ˆå¥½ç”¨çš„ä¸œè¥¿ï¼Œç„¶è€Œè¿™ç©æ„å°±åƒä¸€ä¸ªå·¨å¤§çš„å¹³å°ï¼Œå®¹æ˜“é›†æˆå„ç§å°æ’ä»¶ï¼Œæ¥è¾¾åˆ°å„ç§å„æ ·çš„åŠŸèƒ½ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å­¦ä¹ ä¸€ä¸ª koa-bodyparser è¿™æ­ŒçŸ­å°ç²¾æ‚çš„åº“ï¼
    
    </summary>
    
      <category term="JavaScript" scheme="https://wzes.github.io/categories/JavaScript/"/>
    
    
      <category term="JavaScript" scheme="https://wzes.github.io/tags/JavaScript/"/>
    
      <category term="Node" scheme="https://wzes.github.io/tags/Node/"/>
    
      <category term="Koa" scheme="https://wzes.github.io/tags/Koa/"/>
    
  </entry>
  
  <entry>
    <title>JavaScript Array çš„ 1 ä¸ªå±æ€§ï¼Œ35 ä¸ªæ–¹æ³•</title>
    <link href="https://wzes.github.io/2019/09/01/JavaScript/JavaScript%20Array/"/>
    <id>https://wzes.github.io/2019/09/01/JavaScript/JavaScript Array/</id>
    <published>2019-09-01T07:30:16.000Z</published>
    <updated>2019-09-07T04:15:12.383Z</updated>
    
    <content type="html"><![CDATA[<h3 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h3><p>è¿™å‘¨å‘¢ï¼Œå½»åº•å­¦ä¹ ä¸€ä¸‹ Array çš„æ‰€æœ‰æ–¹æ³•ã€‚å­¦ä¹ åœ°å€ MDNï¼Œé‡Œé¢è¿˜æœ‰å„ä¸ªå‡½æ•°å®ç°çš„æºç ï¼æ•°ç»„ä½œä¸º JavaScript çš„ä¸€ç§ç‰¹æ®Šçš„å¯¹è±¡ç±»å‹ï¼Œä¸ Numberï¼ŒBooleanï¼ŒNullï¼ŒStringï¼ŒUndefinedï¼ŒSymbol  ä¸ƒå¤§æ•°æ®ç±»å‹æœ‰æ‰€ä¸ä¸€æ ·ã€‚äº†è§£ Array çš„æ‰€æœ‰æ–¹æ³•ï¼Œèƒ½å¸®åŠ©æˆ‘ä»¬æœ€å¿«æ‰¾åˆ°é€‚åˆè‡ªå·±çš„å‡½æ•°ã€‚</p><h4 id="create-an-array"><a class="markdownIt-Anchor" href="#create-an-array"></a> Create an Array</h4><p>åˆ›å»ºä¸€ä¸ªæ•°ç»„å¾ˆç®€å•ï¼Œç›´æ¥èµ‹å€¼ï¼Œæˆ–è€…ä½¿ç”¨ <code>[]</code> åˆ›å»ºç©ºæ•°ç»„</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var fruits = [&apos;Apple&apos;, &apos;Banana&apos;];</span><br><span class="line">console.log(fruits.length); // 2</span><br></pre></td></tr></table></figure><h4 id><a class="markdownIt-Anchor" href="#"></a> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/length#" target="_blank" rel="noopener"><strong>Properties</strong></a></h4><h5 id="arraylength"><a class="markdownIt-Anchor" href="#arraylength"></a> Array.length</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var clothing = [&apos;shoes&apos;, &apos;shirts&apos;, &apos;socks&apos;, &apos;sweaters&apos;];</span><br><span class="line"></span><br><span class="line">console.log(clothing.length);</span><br><span class="line">// expected output: 4</span><br><span class="line"></span><br><span class="line">var array = new Array(2)</span><br></pre></td></tr></table></figure><h4 id="-2"><a class="markdownIt-Anchor" href="#-2"></a> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/prototype#" target="_blank" rel="noopener"><strong>Methods</strong></a></h4><p>é¦–å…ˆçœ‹ä¸€ä¸‹ Array çš„ä¸‰ä¸ªé™æ€æ–¹æ³•<br>#####1. Array.from()<br><strong>Array.from()</strong> æ–¹æ³•ä»ç±»ä¼¼æ•°ç»„æˆ–å¯è¿­ä»£çš„å¯¹è±¡åˆ›å»ºä¸€ä¸ªæ–°çš„ï¼Œæµ…æ‹·è´çš„ Array å®ä¾‹ï¼Œæˆ–è€…ä» {length: 3} å¯¹è±¡ä¸­åˆ›å»ºå›ºå®šé•¿åº¦çš„ undefined æ•°ç»„</p><blockquote><p>Array.from(arrayLike[, mapFn[, thisArg]])</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">console.log(Array.from(&apos;foo&apos;));</span><br><span class="line">// expected output: Array [&quot;f&quot;, &quot;o&quot;, &quot;o&quot;]</span><br><span class="line"></span><br><span class="line">console.log(Array.from([1, 2, 3], x =&gt; x + x));</span><br><span class="line">// expected output: Array [2, 4, 6]</span><br><span class="line"></span><br><span class="line">console.log(Array.from(&#123;length: 3&#125;));</span><br><span class="line">// expected output: Array [undefined, undefined, undefined]</span><br></pre></td></tr></table></figure><h5 id="2-arrayisarray"><a class="markdownIt-Anchor" href="#2-arrayisarray"></a> 2. Array.isArray()</h5><p><strong>Array.isArray()</strong> æ–¹æ³•ç¡®å®šä¼ é€’çš„å€¼æ˜¯å¦ä¸º Arrayï¼Œç”±äº typeof Array = â€˜objectâ€™ ï¼Œæ‰€ä»¥åˆ¤æ–­æ˜¯å¦æ˜¯ä¸€ä¸ªæ•°ç»„ä½¿ç”¨ isArray æ‰å¯ä»¥</p><blockquote><p>Array.isArray(value)</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Array.isArray([1, 2, 3]);  // true</span><br><span class="line">Array.isArray(&#123;foo: 123&#125;); // false</span><br><span class="line">Array.isArray(&apos;foobar&apos;);   // false</span><br><span class="line">Array.isArray(undefined);  // false</span><br></pre></td></tr></table></figure><h5 id="3-arrayof"><a class="markdownIt-Anchor" href="#3-arrayof"></a> 3. Array.of()</h5><p><strong>Array.of()</strong> æ–¹æ³•ä»å¯å˜æ•°é‡çš„å‚æ•°åˆ›å»ºä¸€ä¸ªæ–°çš„Arrayå®ä¾‹ï¼Œæ— è®ºå‚æ•°çš„æ•°é‡æˆ–ç±»å‹å¦‚ä½•<br>æ³¨æ„å®ƒä¸æ„é€ å‡½æ•°çš„ä¸åŒä¹‹å¤„</p><blockquote><p>Array.of(element0[, element1[, â€¦[, elementN]]])</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Array.of(7);       // [7] </span><br><span class="line">Array.of(1, 2, 3); // [1, 2, 3]</span><br><span class="line"></span><br><span class="line">Array(7);          // array of 7 empty slots</span><br><span class="line">Array(1, 2, 3);    // [1, 2, 3]</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥çœ‹ Array çš„å¯¹è±¡æ–¹æ³•</p><h5 id="4-arrayprototypeconcat"><a class="markdownIt-Anchor" href="#4-arrayprototypeconcat"></a> 4. Array.prototype.concat()</h5><p><strong>concat()</strong> æ–¹æ³•ç”¨äºåˆå¹¶ä¸¤ä¸ªæˆ–å¤šä¸ªæ•°ç»„ã€‚ æ­¤æ–¹æ³•ä¸ä¼šæ›´æ”¹ç°æœ‰æ•°ç»„ï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªæ–°æ•°ç»„</p><blockquote><p>var new_array = old_array.concat([value1[, value2[, â€¦[, valueN]]]])</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var array1 = [&apos;a&apos;, &apos;b&apos;, &apos;c&apos;];</span><br><span class="line">var array2 = [&apos;d&apos;, &apos;e&apos;, &apos;f&apos;];</span><br><span class="line"></span><br><span class="line">console.log(array1.concat(array2));</span><br><span class="line">// expected output: Array [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;, &quot;e&quot;, &quot;f&quot;]</span><br></pre></td></tr></table></figure><h5 id="5-arrayprototypecopywithin"><a class="markdownIt-Anchor" href="#5-arrayprototypecopywithin"></a> 5. Array.prototype.copyWithin()</h5><p><strong>copyWithin()</strong> æ–¹æ³•æµ…æå°†æ•°ç»„çš„ä¸€éƒ¨åˆ†å¤åˆ¶åˆ°åŒä¸€æ•°ç»„ä¸­çš„å¦ä¸€ä¸ªä½ç½®ï¼Œå¹¶è¿”å›å®ƒè€Œä¸ä¿®æ”¹å…¶é•¿åº¦</p><blockquote><p>arr.copyWithin(target[, start[, end]])</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">var array1 = [&apos;a&apos;, &apos;b&apos;, &apos;c&apos;, &apos;d&apos;, &apos;e&apos;];</span><br><span class="line"></span><br><span class="line">// copy to index 0 the element at index 3</span><br><span class="line">console.log(array1.copyWithin(0, 3, 4));</span><br><span class="line">// expected output: Array [&quot;d&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;, &quot;e&quot;]</span><br><span class="line"></span><br><span class="line">// copy to index 1 all elements from index 3 to the end</span><br><span class="line">console.log(array1.copyWithin(1, 3));</span><br><span class="line">// expected output: Array [&quot;d&quot;, &quot;d&quot;, &quot;e&quot;, &quot;d&quot;, &quot;e&quot;]</span><br></pre></td></tr></table></figure><h5 id="6-arrayprototypeentries"><a class="markdownIt-Anchor" href="#6-arrayprototypeentries"></a> 6. Array.prototype.entries()</h5><p><strong>entries()</strong> æ–¹æ³•è¿”å›ä¸€ä¸ªæ–°çš„Array Iteratorå¯¹è±¡ï¼Œè¯¥å¯¹è±¡åŒ…å«æ•°ç»„ä¸­æ¯ä¸ªç´¢å¼•çš„é”®/å€¼å¯¹ã€‚</p><blockquote><p>array.entries()</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">var array1 = [&apos;a&apos;, &apos;b&apos;, &apos;c&apos;];</span><br><span class="line"></span><br><span class="line">var iterator1 = array1.entries();</span><br><span class="line"></span><br><span class="line">console.log(iterator1.next().value);</span><br><span class="line">// expected output: Array [0, &quot;a&quot;]</span><br><span class="line"></span><br><span class="line">console.log(iterator1.next().value);</span><br><span class="line">// expected output: Array [1, &quot;b&quot;]</span><br><span class="line"></span><br><span class="line">// ä½¿ç”¨ for of éå†</span><br><span class="line">var a = [&apos;a&apos;, &apos;b&apos;, &apos;c&apos;];</span><br><span class="line">var iterator = a.entries();</span><br><span class="line"></span><br><span class="line">for (let e of iterator) &#123;</span><br><span class="line">  console.log(e);</span><br><span class="line">&#125;</span><br><span class="line">// [0, &apos;a&apos;]</span><br><span class="line">// [1, &apos;b&apos;]</span><br><span class="line">// [2, &apos;c&apos;]</span><br></pre></td></tr></table></figure><h5 id="7-arrayprototypeevery"><a class="markdownIt-Anchor" href="#7-arrayprototypeevery"></a> 7. Array.prototype.every()</h5><p><strong>every()</strong> æ–¹æ³•æµ‹è¯•æ•°ç»„ä¸­çš„æ‰€æœ‰å…ƒç´ æ˜¯å¦éƒ½é€šè¿‡äº†ç”±æä¾›çš„å‡½æ•°å®ç°çš„æµ‹è¯•ã€‚ å®ƒè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼</p><blockquote><p>arr.every(callback(element[, index[, array]])[, thisArg])</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function isBelowThreshold(currentValue) &#123;</span><br><span class="line">  return currentValue &lt; 40;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var array1 = [1, 30, 39, 29, 10, 13];</span><br><span class="line"></span><br><span class="line">console.log(array1.every(isBelowThreshold));</span><br><span class="line">// expected output: true</span><br></pre></td></tr></table></figure><h5 id="8-arrayprototypefill"><a class="markdownIt-Anchor" href="#8-arrayprototypefill"></a> 8. Array.prototype.fill()</h5><p><strong>fill()</strong> æ–¹æ³•ä½¿ç”¨é™æ€å€¼ä»å¼€å§‹ç´¢å¼•ï¼ˆé»˜è®¤ä¸ºé›¶ï¼‰åˆ°ç»“æŸç´¢å¼•ï¼ˆé»˜è®¤æ•°ç»„é•¿åº¦ï¼‰å¡«å……ï¼ˆä¿®æ”¹ï¼‰æ•°ç»„çš„æ‰€æœ‰å…ƒç´ ã€‚ å®ƒè¿”å›ä¿®æ”¹åçš„æ•°ç»„ï¼ŒåŸæ•°ç»„ä¼šæ”¹å˜ï½</p><blockquote><p>arr.fill(value[, start[, end]])</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> var array1 = [1, 2, 3, 4];</span><br><span class="line"></span><br><span class="line">// fill with 0 from position 2 until position 4</span><br><span class="line">console.log(array1.fill(0, 2, 4));</span><br><span class="line">// expected output: [1, 2, 0, 0]</span><br><span class="line"></span><br><span class="line">// fill with 5 from position 1</span><br><span class="line">console.log(array1.fill(5, 1));</span><br><span class="line">// expected output: [1, 5, 5, 5]</span><br><span class="line"></span><br><span class="line">console.log(array1.fill(6));</span><br><span class="line">// expected output: [6, 6, 6, 6]</span><br></pre></td></tr></table></figure><h5 id="9-arrayprototypefilter"><a class="markdownIt-Anchor" href="#9-arrayprototypefilter"></a> 9.  Array.prototype.filter()</h5><p><strong>filter()</strong> æ–¹æ³•åˆ›å»ºä¸€ä¸ªæ–°æ•°ç»„ï¼Œå…¶ä¸­åŒ…å«æ‰€æœ‰ä¼ é€’ç”±æä¾›çš„å‡½æ•°å®ç°çš„æµ‹è¯•çš„å…ƒç´ </p><blockquote><p>var newArray = arr.filter(callback(element[, index[, array]])[, thisArg])</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var words = [&apos;spray&apos;, &apos;limit&apos;, &apos;elite&apos;, &apos;exuberant&apos;, &apos;destruction&apos;, &apos;present&apos;];</span><br><span class="line"></span><br><span class="line">const result = words.filter(word =&gt; word.length &gt; 6);</span><br><span class="line"></span><br><span class="line">console.log(result);</span><br><span class="line">// expected output: Array [&quot;exuberant&quot;, &quot;destruction&quot;, &quot;present&quot;]</span><br></pre></td></tr></table></figure><h5 id="10-arrayprototypefind"><a class="markdownIt-Anchor" href="#10-arrayprototypefind"></a> 10. Array.prototype.find()</h5><p><strong>find()</strong> æ–¹æ³•è¿”å›æ•°ç»„ä¸­ç¬¬ä¸€ä¸ªæ»¡è¶³æä¾›çš„æµ‹è¯•å‡½æ•°çš„å…ƒç´ çš„å€¼ã€‚ å¦åˆ™è¿”å›undefined</p><blockquote><p>arr.find(callback(element[, index[, array]])[, thisArg])</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var array1 = [5, 12, 8, 130, 44];</span><br><span class="line"></span><br><span class="line">var found = array1.find(function(element) &#123;</span><br><span class="line">  return element &gt; 10;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">console.log(found);</span><br><span class="line">// expected output: 12</span><br></pre></td></tr></table></figure><h5 id="11-arrayprototypefindindex"><a class="markdownIt-Anchor" href="#11-arrayprototypefindindex"></a> 11. Array.prototype.findIndex()</h5><p><strong>findIndex()</strong> æ–¹æ³•è¿”å›æ•°ç»„ä¸­ç¬¬ä¸€ä¸ªæ»¡è¶³æä¾›çš„æµ‹è¯•å‡½æ•°çš„å…ƒç´ çš„ç´¢å¼•ã€‚ å¦åˆ™ï¼Œå®ƒè¿”å›-1ï¼Œè¡¨ç¤ºæ²¡æœ‰å…ƒç´ é€šè¿‡æµ‹è¯•</p><blockquote><p>arr.findIndex(callback(element[, index[, array]])[, thisArg])</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var array1 = [5, 12, 8, 130, 44];</span><br><span class="line"></span><br><span class="line">function isLargeNumber(element) &#123;</span><br><span class="line">  return element &gt; 13;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">console.log(array1.findIndex(isLargeNumber));</span><br></pre></td></tr></table></figure><h5 id="12-arrayprototypeflat"><a class="markdownIt-Anchor" href="#12-arrayprototypeflat"></a> 12. Array.prototype.flat()</h5><p><strong>flat()</strong> æ–¹æ³•åˆ›å»ºä¸€ä¸ªæ–°æ•°ç»„ï¼Œæ‰€æœ‰å­æ•°ç»„å…ƒç´ ä»¥é€’å½’æ–¹å¼è¿æ¥åˆ°æŒ‡å®šçš„æ·±åº¦ã€‚</p><blockquote><p>var newArray = arr.flat([depth]);</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">var arr1 = [1, 2, [3, 4]];</span><br><span class="line">arr1.flat(); </span><br><span class="line">// [1, 2, 3, 4]</span><br><span class="line"></span><br><span class="line">var arr2 = [1, 2, [3, 4, [5, 6]]];</span><br><span class="line">arr2.flat();</span><br><span class="line">// [1, 2, 3, 4, [5, 6]]</span><br><span class="line"></span><br><span class="line">var arr3 = [1, 2, [3, 4, [5, 6]]];</span><br><span class="line">arr3.flat(2);</span><br><span class="line">// [1, 2, 3, 4, 5, 6]</span><br><span class="line"></span><br><span class="line">var arr4 = [1, 2, [3, 4, [5, 6, [7, 8, [9, 10]]]]];</span><br><span class="line">arr4.flat(Infinity);</span><br><span class="line">// [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]</span><br></pre></td></tr></table></figure><h5 id="13-arrayprototypeflatmap"><a class="markdownIt-Anchor" href="#13-arrayprototypeflatmap"></a> 13. Array.prototype.flatMap()</h5><p><strong>flatMap()</strong> æ–¹æ³•é¦–å…ˆä½¿ç”¨æ˜ å°„å‡½æ•°æ˜ å°„æ¯ä¸ªå…ƒç´ ï¼Œç„¶åå°†ç»“æœå±•å¹³ä¸ºæ–°æ•°ç»„ã€‚ å®ƒä¸mapï¼ˆï¼‰åè·Ÿæ·±åº¦ä¸º1çš„flatï¼ˆï¼‰ç›¸åŒï¼Œä½†flatMapï¼ˆï¼‰é€šå¸¸éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºå°†ä¸¤è€…åˆå¹¶åˆ°ä¸€ä¸ªæ–¹æ³•ä¸­æ•ˆç‡ç¨é«˜</p><blockquote><p>var new_array = arr.flatMap(function callback(currentValue[, index[, array]]) {<br>// return element for new_array<br>}[, thisArg])</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">let arr1 = [&quot;it&apos;s Sunny in&quot;, &quot;&quot;, &quot;California&quot;];</span><br><span class="line"></span><br><span class="line">arr1.map(x =&gt; x.split(&quot; &quot;));</span><br><span class="line">// [[&quot;it&apos;s&quot;,&quot;Sunny&quot;,&quot;in&quot;],[&quot;&quot;],[&quot;California&quot;]]</span><br><span class="line"></span><br><span class="line">arr1.flatMap(x =&gt; x.split(&quot; &quot;));</span><br><span class="line">// [&quot;it&apos;s&quot;,&quot;Sunny&quot;,&quot;in&quot;, &quot;&quot;, &quot;California&quot;]</span><br></pre></td></tr></table></figure><h5 id="14-arrayprototypeforeach"><a class="markdownIt-Anchor" href="#14-arrayprototypeforeach"></a> 14. Array.prototype.forEach()</h5><p><strong>forEach()</strong> æ–¹æ³•ä¸ºæ¯ä¸ªæ•°ç»„å…ƒç´ æ‰§è¡Œä¸€æ¬¡æä¾›çš„å‡½æ•°</p><blockquote><p>arr.forEach(callback(currentValue [, index [, array]])[, thisArg]);</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">var array1 = [&apos;a&apos;, &apos;b&apos;, &apos;c&apos;];</span><br><span class="line"></span><br><span class="line">array1.forEach(function(element) &#123;</span><br><span class="line">  console.log(element);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// expected output: &quot;a&quot;</span><br><span class="line">// expected output: &quot;b&quot;</span><br><span class="line">// expected output: &quot;c&quot;</span><br></pre></td></tr></table></figure><h5 id="15-arrayprototypeincludes"><a class="markdownIt-Anchor" href="#15-arrayprototypeincludes"></a> 15. Array.prototype.includes()</h5><p><strong>includes()</strong> æ–¹æ³•ç¡®å®šæ•°ç»„æ˜¯å¦åœ¨å…¶æ¡ç›®ä¸­åŒ…å«æŸä¸ªå€¼ï¼Œå¹¶åœ¨é€‚å½“æ—¶è¿”å›trueæˆ–false</p><blockquote><p>arr.includes(valueToFind[, fromIndex])</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">var array1 = [1, 2, 3];</span><br><span class="line"></span><br><span class="line">console.log(array1.includes(2));</span><br><span class="line">// expected output: true</span><br><span class="line"></span><br><span class="line">var pets = [&apos;cat&apos;, &apos;dog&apos;, &apos;bat&apos;];</span><br><span class="line"></span><br><span class="line">console.log(pets.includes(&apos;cat&apos;));</span><br><span class="line">// expected output: true</span><br><span class="line"></span><br><span class="line">console.log(pets.includes(&apos;at&apos;));</span><br><span class="line">// expected output: false</span><br></pre></td></tr></table></figure><h5 id="16-arrayprototypeindexof"><a class="markdownIt-Anchor" href="#16-arrayprototypeindexof"></a> 16. Array.prototype.indexOf()</h5><p><strong>indexOf()</strong> æ–¹æ³•è¿”å›å¯åœ¨æ•°ç»„ä¸­æ‰¾åˆ°ç»™å®šå…ƒç´ çš„ç¬¬ä¸€ä¸ªç´¢å¼•ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™è¿”å›-1</p><blockquote><p>arr.indexOf(searchElement[, fromIndex])</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">var beasts = [&apos;ant&apos;, &apos;bison&apos;, &apos;camel&apos;, &apos;duck&apos;, &apos;bison&apos;];</span><br><span class="line"></span><br><span class="line">console.log(beasts.indexOf(&apos;bison&apos;));</span><br><span class="line">// expected output: 1</span><br><span class="line"></span><br><span class="line">// start from index 2</span><br><span class="line">console.log(beasts.indexOf(&apos;bison&apos;, 2));</span><br><span class="line">// expected output: 4</span><br><span class="line"></span><br><span class="line">console.log(beasts.indexOf(&apos;giraffe&apos;));</span><br><span class="line">// expected output: -1</span><br></pre></td></tr></table></figure><h5 id="17-arrayprototypejoin"><a class="markdownIt-Anchor" href="#17-arrayprototypejoin"></a> 17. Array.prototype.join()</h5><p><strong>join()</strong> æ–¹æ³•é€šè¿‡è¿æ¥æ•°ç»„ï¼ˆæˆ–ç±»æ•°ç»„å¯¹è±¡ï¼‰ä¸­çš„æ‰€æœ‰å…ƒç´ ï¼ˆç”¨é€—å·æˆ–æŒ‡å®šçš„åˆ†éš”ç¬¦å­—ç¬¦ä¸²åˆ†éš”ï¼‰æ¥åˆ›å»ºå¹¶è¿”å›ä¸€ä¸ªæ–°å­—ç¬¦ä¸²ã€‚ å¦‚æœæ•°ç»„åªæœ‰ä¸€ä¸ªé¡¹ç›®ï¼Œé‚£ä¹ˆå°†è¿”å›è¯¥é¡¹ç›®è€Œä¸ä½¿ç”¨åˆ†éš”ç¬¦</p><blockquote><p>arr.join([separator])</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ar elements = [&apos;Fire&apos;, &apos;Air&apos;, &apos;Water&apos;];</span><br><span class="line"></span><br><span class="line">console.log(elements.join());</span><br><span class="line">// expected output: &quot;Fire,Air,Water&quot;</span><br><span class="line"></span><br><span class="line">console.log(elements.join(&apos;&apos;));</span><br><span class="line">// expected output: &quot;FireAirWater&quot;</span><br><span class="line"></span><br><span class="line">console.log(elements.join(&apos;-&apos;));</span><br><span class="line">// expected output: &quot;Fire-Air-Water&quot;</span><br></pre></td></tr></table></figure><h5 id="18-arrayprototypekeys"><a class="markdownIt-Anchor" href="#18-arrayprototypekeys"></a> 18. Array.prototype.keys()</h5><p><strong>keys()</strong> æ–¹æ³•è¿”å›ä¸€ä¸ªæ–°çš„Array Iteratorå¯¹è±¡ï¼Œè¯¥å¯¹è±¡åŒ…å«æ•°ç»„ä¸­æ¯ä¸ªç´¢å¼•çš„é”®</p><blockquote></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var array1 = [&apos;a&apos;, &apos;b&apos;, &apos;c&apos;];</span><br><span class="line">var iterator = array1.keys(); </span><br><span class="line">  </span><br><span class="line">for (let key of iterator) &#123;</span><br><span class="line">  console.log(key); // expected output: 0 1 2</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="19-arrayprototypelastindexof"><a class="markdownIt-Anchor" href="#19-arrayprototypelastindexof"></a> 19. Array.prototype.lastIndexOf()</h5><p><strong>lastIndexOf()</strong> æ–¹æ³•è¿”å›å¯åœ¨æ•°ç»„ä¸­æ‰¾åˆ°ç»™å®šå…ƒç´ çš„æœ€åä¸€ä¸ªç´¢å¼•ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™è¿”å›-1ã€‚ ä»fromIndexå¼€å§‹å‘åæœç´¢æ•°ç»„</p><blockquote><p>arr.lastIndexOf(searchElement[, fromIndex])</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var animals = [&apos;Dodo&apos;, &apos;Tiger&apos;, &apos;Penguin&apos;, &apos;Dodo&apos;];</span><br><span class="line"></span><br><span class="line">console.log(animals.lastIndexOf(&apos;Dodo&apos;));</span><br><span class="line">// expected output: 3</span><br><span class="line"></span><br><span class="line">console.log(animals.lastIndexOf(&apos;Penguin&apos;, 1));</span><br><span class="line">// expected output: -1</span><br></pre></td></tr></table></figure><h5 id="20-arrayprototypemap"><a class="markdownIt-Anchor" href="#20-arrayprototypemap"></a> 20. Array.prototype.map()</h5><p><strong>map()</strong> æ–¹æ³•åˆ›å»ºä¸€ä¸ªæ–°æ•°ç»„ï¼Œå…¶ç»“æœæ˜¯åœ¨è°ƒç”¨æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ä¸Šè°ƒç”¨æä¾›çš„å‡½æ•°</p><blockquote><p>var new_array = arr.map(function callback(currentValue[, index[, array]]) {<br>// Return element for new_array<br>}[, thisArg])</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var array1 = [1, 4, 9, 16];</span><br><span class="line"></span><br><span class="line">// pass a function to map</span><br><span class="line">const map1 = array1.map(x =&gt; x * 2);</span><br><span class="line"></span><br><span class="line">console.log(map1);</span><br><span class="line">// expected output: Array [2, 8, 18, 32]</span><br></pre></td></tr></table></figure><h5 id="21-arrayprototypepop"><a class="markdownIt-Anchor" href="#21-arrayprototypepop"></a> 21. Array.prototype.pop()</h5><p><strong>pop()</strong> æ–¹æ³•ä»æ•°ç»„ä¸­åˆ é™¤æœ€åä¸€ä¸ªå…ƒç´ å¹¶è¿”å›è¯¥å…ƒç´ ã€‚ æ­¤æ–¹æ³•æ›´æ”¹æ•°ç»„çš„é•¿åº¦ã€‚</p><blockquote><p>arr.pop()</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">var plants = [&apos;broccoli&apos;, &apos;cauliflower&apos;, &apos;cabbage&apos;, &apos;kale&apos;, &apos;tomato&apos;];</span><br><span class="line"></span><br><span class="line">console.log(plants.pop());</span><br><span class="line">// expected output: &quot;tomato&quot;</span><br><span class="line"></span><br><span class="line">console.log(plants);</span><br><span class="line">// expected output: Array [&quot;broccoli&quot;, &quot;cauliflower&quot;, &quot;cabbage&quot;, &quot;kale&quot;]</span><br><span class="line"></span><br><span class="line">plants.pop();</span><br><span class="line"></span><br><span class="line">console.log(plants);</span><br><span class="line">// expected output: Array [&quot;broccoli&quot;, &quot;cauliflower&quot;, &quot;cabbage&quot;]</span><br></pre></td></tr></table></figure><h5 id="22-arrayprototypepush"><a class="markdownIt-Anchor" href="#22-arrayprototypepush"></a> 22. Array.prototype.push()</h5><p><strong>push()</strong> æ–¹æ³•å°†ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ æ·»åŠ åˆ°æ•°ç»„çš„æœ«å°¾ï¼Œå¹¶è¿”å›æ•°ç»„çš„æ–°é•¿åº¦</p><blockquote><p>arr.push(element1[, â€¦[, elementN]])</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">var animals = [&apos;pigs&apos;, &apos;goats&apos;, &apos;sheep&apos;];</span><br><span class="line"></span><br><span class="line">console.log(animals.push(&apos;cows&apos;));</span><br><span class="line">// expected output: 4</span><br><span class="line"></span><br><span class="line">console.log(animals);</span><br><span class="line">// expected output: Array [&quot;pigs&quot;, &quot;goats&quot;, &quot;sheep&quot;, &quot;cows&quot;]</span><br><span class="line"></span><br><span class="line">animals.push(&apos;chickens&apos;);</span><br><span class="line"></span><br><span class="line">console.log(animals);</span><br><span class="line">// expected output: Array [&quot;pigs&quot;, &quot;goats&quot;, &quot;sheep&quot;, &quot;cows&quot;, &quot;chickens&quot;]</span><br></pre></td></tr></table></figure><h5 id="23-arrayprototypereduce"><a class="markdownIt-Anchor" href="#23-arrayprototypereduce"></a> 23. Array.prototype.reduce()</h5><p><strong>reduce()</strong> æ–¹æ³•åœ¨æ•°ç»„çš„æ¯ä¸ªå…ƒç´ ä¸Šæ‰§è¡Œreducerå‡½æ•°ï¼ˆæ‚¨æä¾›ï¼‰ï¼Œä»è€Œäº§ç”Ÿå•ä¸ªè¾“å‡ºå€¼</p><blockquote><p>arr.reduce(callback(accumulator, currentValue[, index[, array]])[, initialValue])</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">const array1 = [1, 2, 3, 4];</span><br><span class="line">const reducer = (accumulator, currentValue) =&gt; accumulator + currentValue;</span><br><span class="line"></span><br><span class="line">// 1 + 2 + 3 + 4</span><br><span class="line">console.log(array1.reduce(reducer));</span><br><span class="line">// expected output: 10</span><br><span class="line"></span><br><span class="line">// 5 + 1 + 2 + 3 + 4</span><br><span class="line">console.log(array1.reduce(reducer, 5));</span><br><span class="line">// expected output: 15</span><br></pre></td></tr></table></figure><h5 id="24-arrayprototypereduceright"><a class="markdownIt-Anchor" href="#24-arrayprototypereduceright"></a> 24. Array.prototype.reduceRight()</h5><p><strong>reduceRight()</strong> æ–¹æ³•å¯¹ç´¯åŠ å™¨å’Œæ•°ç»„çš„æ¯ä¸ªå€¼ï¼ˆä»å³åˆ°å·¦ï¼‰åº”ç”¨å‡½æ•°ä»¥å°†å…¶å‡å°‘ä¸ºå•ä¸ªå€¼</p><blockquote><p>arr.reduceRight(callback(accumulator, currentValue[, index[, array]])[, initialValue])</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">const array1 = [[0, 1], [2, 3], [4, 5]].reduceRight(</span><br><span class="line">  (accumulator, currentValue) =&gt; accumulator.concat(currentValue)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">console.log(array1);</span><br><span class="line">// expected output: Array [4, 5, 2, 3, 0, 1]</span><br></pre></td></tr></table></figure><h5 id="25-arrayprototypereverse"><a class="markdownIt-Anchor" href="#25-arrayprototypereverse"></a> 25. Array.prototype.reverse()</h5><p><strong>reverse()</strong> æ–¹æ³•å°†æ•°ç»„åè½¬åˆ°ä½ã€‚ ç¬¬ä¸€ä¸ªæ•°ç»„å…ƒç´ æˆä¸ºæœ€åä¸€ä¸ªï¼Œæœ€åä¸€ä¸ªæ•°ç»„å…ƒç´ æˆä¸ºç¬¬ä¸€ä¸ª</p><blockquote><p>a.reverse()</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">var array1 = [&apos;one&apos;, &apos;two&apos;, &apos;three&apos;];</span><br><span class="line">console.log(&apos;array1: &apos;, array1);</span><br><span class="line">// expected output: Array [&apos;one&apos;, &apos;two&apos;, &apos;three&apos;]</span><br><span class="line"></span><br><span class="line">var reversed = array1.reverse(); </span><br><span class="line">console.log(&apos;reversed: &apos;, reversed);</span><br><span class="line">// expected output: Array [&apos;three&apos;, &apos;two&apos;, &apos;one&apos;]</span><br><span class="line"></span><br><span class="line">/* Careful: reverse is destructive. It also changes</span><br><span class="line">the original array */ </span><br><span class="line">console.log(&apos;array1: &apos;, array1);</span><br><span class="line">// expected output: Array [&apos;three&apos;, &apos;two&apos;, &apos;one&apos;]</span><br></pre></td></tr></table></figure><h5 id="26-arrayprototypeshift"><a class="markdownIt-Anchor" href="#26-arrayprototypeshift"></a> 26. Array.prototype.shift()</h5><p><strong>shift()</strong> æ–¹æ³•ä»æ•°ç»„ä¸­åˆ é™¤ç¬¬ä¸€ä¸ªå…ƒç´ å¹¶è¿”å›å·²åˆ é™¤çš„å…ƒç´ ã€‚ æ­¤æ–¹æ³•æ›´æ”¹æ•°ç»„çš„é•¿åº¦</p><blockquote><p>arr.shift()</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">var array1 = [1, 2, 3];</span><br><span class="line"></span><br><span class="line">var firstElement = array1.shift();</span><br><span class="line"></span><br><span class="line">console.log(array1);</span><br><span class="line">// expected output: Array [2, 3]</span><br><span class="line"></span><br><span class="line">console.log(firstElement);</span><br><span class="line">// expected output: 1</span><br></pre></td></tr></table></figure><h5 id="27-arrayprototypeslice"><a class="markdownIt-Anchor" href="#27-arrayprototypeslice"></a> 27. Array.prototype.slice()</h5><p><strong>slice()</strong> æ–¹æ³•å°†æ•°ç»„çš„ä¸€éƒ¨åˆ†çš„æµ…è¡¨å‰¯æœ¬è¿”å›åˆ°ä»å¤´åˆ°å°¾é€‰æ‹©çš„æ–°æ•°ç»„å¯¹è±¡ï¼ˆä¸åŒ…æ‹¬ç»“å°¾ï¼‰ï¼Œå…¶ä¸­beginå’Œendè¡¨ç¤ºè¯¥æ•°ç»„ä¸­é¡¹çš„ç´¢å¼•ã€‚ åŸå§‹æ•°ç»„ä¸ä¼šè¢«ä¿®æ”¹</p><blockquote><p>arr.slice([begin[, end]])</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">var animals = [&apos;ant&apos;, &apos;bison&apos;, &apos;camel&apos;, &apos;duck&apos;, &apos;elephant&apos;];</span><br><span class="line"></span><br><span class="line">console.log(animals.slice(2));</span><br><span class="line">// expected output: Array [&quot;camel&quot;, &quot;duck&quot;, &quot;elephant&quot;]</span><br><span class="line"></span><br><span class="line">console.log(animals.slice(2, 4));</span><br><span class="line">// expected output: Array [&quot;camel&quot;, &quot;duck&quot;]</span><br><span class="line"></span><br><span class="line">console.log(animals.slice(1, 5));</span><br><span class="line">// expected output: Array [&quot;bison&quot;, &quot;camel&quot;, &quot;duck&quot;, &quot;elephant&quot;]</span><br></pre></td></tr></table></figure><h5 id="28-arrayprototypesome"><a class="markdownIt-Anchor" href="#28-arrayprototypesome"></a> 28. # Array.prototype.some()</h5><p><strong>some()</strong> æ–¹æ³•æµ‹è¯•æ•°ç»„ä¸­æ˜¯å¦è‡³å°‘æœ‰ä¸€ä¸ªå…ƒç´ é€šè¿‡äº†ç”±æä¾›çš„å‡½æ•°å®ç°çš„æµ‹è¯•ã€‚ å®ƒè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼</p><blockquote><p>arr.some(callback(element[, index[, array]])[, thisArg])</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">var array = [1, 2, 3, 4, 5];</span><br><span class="line"></span><br><span class="line">var even = function(element) &#123;</span><br><span class="line">  // checks whether an element is even</span><br><span class="line">  return element % 2 === 0;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">console.log(array.some(even));</span><br><span class="line">// expected output: true</span><br></pre></td></tr></table></figure><h5 id="29-arrayprototypesort"><a class="markdownIt-Anchor" href="#29-arrayprototypesort"></a> 29. Array.prototype.sort()</h5><p><strong>sort()</strong> æ–¹æ³•å¯¹æ•°ç»„ä¸­çš„å…ƒç´ è¿›è¡Œæ’åºå¹¶è¿”å›å·²æ’åºçš„æ•°ç»„ã€‚ é»˜è®¤æ’åºé¡ºåºæ˜¯åœ¨å°†å…ƒç´ è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œç„¶åæ¯”è¾ƒå®ƒä»¬çš„UTF-16ä»£ç å•å…ƒå€¼åºåˆ—æ—¶æ„å»ºçš„ã€‚</p><p>ç”±äºå–å†³äºå®ç°ï¼Œå› æ­¤æ— æ³•ä¿è¯æ’åºçš„æ—¶é—´å’Œç©ºé—´å¤æ‚æ€§ã€‚</p><blockquote><p>arr.sort([compareFunction])</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">var months = [&apos;March&apos;, &apos;Jan&apos;, &apos;Feb&apos;, &apos;Dec&apos;];</span><br><span class="line">months.sort();</span><br><span class="line">console.log(months);</span><br><span class="line">// expected output: Array [&quot;Dec&quot;, &quot;Feb&quot;, &quot;Jan&quot;, &quot;March&quot;]</span><br><span class="line"></span><br><span class="line">var array1 = [1, 30, 4, 21, 100000];</span><br><span class="line">array1.sort();</span><br><span class="line">console.log(array1);</span><br><span class="line">// expected output: ArrayÂ [1, 100000, 21, 30, 4]</span><br></pre></td></tr></table></figure><h5 id="30-arrayprototypesplice"><a class="markdownIt-Anchor" href="#30-arrayprototypesplice"></a> 30. Array.prototype.splice()</h5><p><strong>splice()</strong> æ–¹æ³•é€šè¿‡åˆ é™¤æˆ–æ›¿æ¢ç°æœ‰å…ƒç´ å’Œ/æˆ–åœ¨é€‚å½“ä½ç½®æ·»åŠ æ–°å…ƒç´ æ¥æ›´æ”¹æ•°ç»„çš„å†…å®¹</p><blockquote><p>var arrDeletedItems = array.splice(start[, deleteCount[, item1[, item2[, â€¦]]]])</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">var months = [&apos;Jan&apos;, &apos;March&apos;, &apos;April&apos;, &apos;June&apos;];</span><br><span class="line">months.splice(1, 0, &apos;Feb&apos;);</span><br><span class="line">// inserts at index 1</span><br><span class="line">console.log(months);</span><br><span class="line">// expected output: Array [&apos;Jan&apos;, &apos;Feb&apos;, &apos;March&apos;, &apos;April&apos;, &apos;June&apos;]</span><br><span class="line"></span><br><span class="line">months.splice(4, 1, &apos;May&apos;);</span><br><span class="line">// replaces 1 element at index 4</span><br><span class="line">console.log(months);</span><br><span class="line">// expected output: Array [&apos;Jan&apos;, &apos;Feb&apos;, &apos;March&apos;, &apos;April&apos;, &apos;May&apos;]</span><br></pre></td></tr></table></figure><h5 id="31-arrayprototypeunshift"><a class="markdownIt-Anchor" href="#31-arrayprototypeunshift"></a> 31. Array.prototype.unshift()</h5><p><strong>unshift()</strong> æ–¹æ³•å°†ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ æ·»åŠ åˆ°æ•°ç»„çš„å¼€å¤´å¹¶è¿”å›æ•°ç»„çš„æ–°é•¿åº¦</p><blockquote><p>arr.unshift(element1[, â€¦[, elementN]])</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var array1 = [1, 2, 3];</span><br><span class="line"></span><br><span class="line">console.log(array1.unshift(4, 5));</span><br><span class="line">// expected output: 5</span><br><span class="line"></span><br><span class="line">console.log(array1);</span><br><span class="line">// expected output: Array [4, 5, 1, 2, 3]</span><br></pre></td></tr></table></figure><h5 id="32-arrayprototypevalues"><a class="markdownIt-Anchor" href="#32-arrayprototypevalues"></a> 32. Array.prototype.values()</h5><p><strong>values()</strong> æ–¹æ³•è¿”å›ä¸€ä¸ªæ–°çš„Array Iteratorå¯¹è±¡ï¼Œè¯¥å¯¹è±¡åŒ…å«æ•°ç»„ä¸­æ¯ä¸ªç´¢å¼•çš„å€¼</p><blockquote><p>arr.values()</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">const array1 = [&apos;a&apos;, &apos;b&apos;, &apos;c&apos;];</span><br><span class="line">const iterator = array1.values();</span><br><span class="line"></span><br><span class="line">for (const value of iterator) &#123;</span><br><span class="line">  console.log(value); // expected output: &quot;a&quot; &quot;b&quot; &quot;c&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="33-arrayprototypetolocalestring"><a class="markdownIt-Anchor" href="#33-arrayprototypetolocalestring"></a> 33. Array.prototype.toLocaleString()</h5><p><strong>toLocaleString()</strong> æ–¹æ³•è¿”å›è¡¨ç¤ºæ•°ç»„å…ƒç´ çš„å­—ç¬¦ä¸²ã€‚ ä½¿ç”¨toLocaleStringæ–¹æ³•å°†å…ƒç´ è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œå¹¶ä¸”è¿™äº›å­—ç¬¦ä¸²ç”±ç‰¹å®šäºè¯­è¨€ç¯å¢ƒçš„å­—ç¬¦ä¸²ï¼ˆä¾‹å¦‚é€—å·â€œï¼Œâ€ï¼‰åˆ†éš”</p><blockquote><p>arr.toLocaleString([locales[, options]]);</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var array1 = [1, &apos;a&apos;, new Date(&apos;21 Dec 1997 14:12:00 UTC&apos;)];</span><br><span class="line">var localeString = array1.toLocaleString(&apos;en&apos;, &#123;timeZone: &quot;UTC&quot;&#125;);</span><br><span class="line"></span><br><span class="line">console.log(localeString);</span><br><span class="line">// expected output: &quot;1,a,12/21/1997, 2:12:00 PM&quot;,</span><br><span class="line">// This assumes &quot;en&quot; locale and UTC timezone - your results may vary</span><br></pre></td></tr></table></figure><h5 id="34-arrayprototypetostring"><a class="markdownIt-Anchor" href="#34-arrayprototypetostring"></a> 34. Array.prototype.toString()</h5><p><strong>toString()</strong> æ–¹æ³•è¿”å›è¡¨ç¤ºæŒ‡å®šæ•°ç»„åŠå…¶å…ƒç´ çš„å­—ç¬¦ä¸²</p><blockquote><p>arr.toString()</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var array1 = [1, 2, &apos;a&apos;, &apos;1a&apos;];</span><br><span class="line"></span><br><span class="line">console.log(array1.toString());</span><br><span class="line">// expected output: &quot;1,2,a,1a&quot;</span><br></pre></td></tr></table></figure><h5 id="35-arrayprototypeiterator"><a class="markdownIt-Anchor" href="#35-arrayprototypeiterator"></a> 35. Array.prototype<a href>@@iterator</a></h5><p><strong>@@iterator</strong> å±æ€§çš„åˆå§‹å€¼ä¸valuesï¼ˆï¼‰å±æ€§çš„åˆå§‹å€¼æ˜¯ç›¸åŒçš„å‡½æ•°å¯¹è±¡ã€‚</p><blockquote><p>arr<a href>Symbol.iterator</a></p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var arr = [&apos;a&apos;, &apos;b&apos;, &apos;c&apos;, &apos;d&apos;, &apos;e&apos;];</span><br><span class="line">var eArr = arr[Symbol.iterator]();</span><br><span class="line">// your browser must support for..of loop</span><br><span class="line">// and let-scoped variables in for loops</span><br><span class="line">// const and var could also be used</span><br><span class="line">for (let letter of eArr) &#123;</span><br><span class="line">  console.log(letter);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      è¿™å‘¨å‘¢ï¼Œå½»åº•å­¦ä¹ ä¸€ä¸‹ Array çš„æ‰€æœ‰æ–¹æ³•ã€‚å­¦ä¹ åœ°å€ MDNï¼Œé‡Œé¢è¿˜æœ‰å„ä¸ªå‡½æ•°å®ç°çš„æºç ï¼æ•°ç»„ä½œä¸º JavaScript çš„ä¸€ç§ç‰¹æ®Šçš„å¯¹è±¡ç±»å‹ï¼Œä¸ Numberï¼ŒBooleanï¼ŒNullï¼ŒStringï¼ŒUndefinedï¼ŒSymbol  ä¸ƒå¤§æ•°æ®ç±»å‹æœ‰æ‰€ä¸ä¸€æ ·ã€‚äº†è§£ Array çš„æ‰€æœ‰æ–¹æ³•ï¼Œèƒ½å¸®åŠ©æˆ‘ä»¬æœ€å¿«æ‰¾åˆ°é€‚åˆè‡ªå·±çš„å‡½æ•°
    
    </summary>
    
      <category term="JavaScript" scheme="https://wzes.github.io/categories/JavaScript/"/>
    
    
      <category term="JavaScript" scheme="https://wzes.github.io/tags/JavaScript/"/>
    
      <category term="Array" scheme="https://wzes.github.io/tags/Array/"/>
    
  </entry>
  
  <entry>
    <title>React Redux v0.2.1 æºç å­¦ä¹ </title>
    <link href="https://wzes.github.io/2019/08/25/JavaScript/Redux%20V0.2.1/"/>
    <id>https://wzes.github.io/2019/08/25/JavaScript/Redux V0.2.1/</id>
    <published>2019-08-25T11:30:16.000Z</published>
    <updated>2019-09-02T12:16:07.731Z</updated>
    
    <content type="html"><![CDATA[<h3 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h3><p>è¿™å‘¨çªç„¶æƒ³å­¦ä¹ ä¸€ä¸‹çŠ¶æ€ç®¡ç†çš„å†™æ³•ã€‚çœ‹çœ‹ä¸šç•Œæ˜¯æ€ä¹ˆå®ç°çš„ï¼Œä¹‹å‰ä½¿ç”¨è¿‡ reduxï¼Œé‚£å°±å…ˆä» redux ä¸‹æ‰‹å§ï¼Œä½†æ˜¯ï¼Œä¸€ä¸Šæ¥å°±çœ‹æœ€æ–°ç‰ˆæœ¬çš„ä»£ç ï¼Œä¸å¤ªé€‚åˆæ–°æ‰‹å­¦ä¹ ï¼Œä¸€æ–¹é¢æœ€æ–°ç‰ˆæœ¬å·²ç»å‘å±•nå¤šå¹´äº†ï¼ŒåŠŸèƒ½å·²ç»éå¸¸å®Œå–„ï¼ˆä»£ç å¤šéš¾æ‡‚ï¼‰ï¼Œå¦ä¸€æ–¹é¢ç›´æ¥çœ‹æœ€æ–°çš„ä¸äº†è§£è¿™ä¸ªå·¥å…·æ˜¯æ€ä¹ˆè®¾è®¡å‡ºæ¥çš„ã€‚äºæ˜¯å°±æ‰“ç®—å­¦ä¹ æœ€æ—©çš„å‘å¸ƒç‰ˆæœ¬ v0.2.1</p><p>å…ˆæ¥è¯´ä¸‹æˆ‘è®¤è¯†çš„ä¸€èˆ¬çš„çŠ¶æ€ç®¡ç†çš„åŸºæœ¬è·¯å­ï¼š</p><blockquote><p>å…¨å±€åªå­˜åœ¨ <strong>å”¯ä¸€state</strong>ï¼Œè€Œå‰ç«¯ä¸ç›´æ¥æ”¹å˜ stateï¼Œè€Œæ˜¯é€šè¿‡ <strong>action</strong> å»æ”¹å˜ state</p></blockquote><h3 id="helloworld"><a class="markdownIt-Anchor" href="#helloworld"></a> HelloWorld</h3><p>ä¸€ä¸ªè®¡æ•°å™¨çš„æ —å­ï¼Œç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">counter</span><br><span class="line">â”œâ”€â”€ App.js</span><br><span class="line">â”œâ”€â”€ Counter.js</span><br><span class="line">â”œâ”€â”€ actions</span><br><span class="line">â”‚   â”œâ”€â”€ CounterActions.js</span><br><span class="line">â”‚   â””â”€â”€ index.js</span><br><span class="line">â”œâ”€â”€ constants</span><br><span class="line">â”‚   â””â”€â”€ ActionTypes.js</span><br><span class="line">â”œâ”€â”€ dispatcher.js</span><br><span class="line">â””â”€â”€ stores</span><br><span class="line">    â”œâ”€â”€ CounterStore.js</span><br><span class="line">    â””â”€â”€ index.js</span><br></pre></td></tr></table></figure><h4 id="actions"><a class="markdownIt-Anchor" href="#actions"></a> actions</h4><p>å‡½æ•°ï¼Œè¿”å›ä¸€ä¸ªå¸¦ type çš„å¯¹è±¡ï¼Œæˆ–è€…è¿”å›ä¸€ä¸ªå‡½æ•°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">import &#123;</span><br><span class="line">  INCREMENT_COUNTER,</span><br><span class="line">  DECREMENT_COUNTER</span><br><span class="line">&#125; from &apos;../constants/ActionTypes&apos;;</span><br><span class="line"></span><br><span class="line">export function increment() &#123;</span><br><span class="line">  return &#123;</span><br><span class="line">    type: INCREMENT_COUNTER</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export function incrementAsync() &#123;</span><br><span class="line">  return dispatch =&gt; &#123;</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">      dispatch(increment());</span><br><span class="line">    &#125;, 1000);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export function decrement() &#123;</span><br><span class="line">  return &#123;</span><br><span class="line">    type: DECREMENT_COUNTER</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="store"><a class="markdownIt-Anchor" href="#store"></a> store</h4><p>è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œå‚æ•° state å’Œ actionï¼Œå½“ state ä¸ºç©ºæ—¶è¿”å›åˆå§‹å€¼ï¼Œè¡¨ç¤ºåˆå§‹åŒ–ã€‚æ ¹æ® action çš„ type å€¼ï¼Œè¿›è¡Œç›¸åº”çš„åšæ³•ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„ stateã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">import &#123;</span><br><span class="line">  INCREMENT_COUNTER,</span><br><span class="line">  DECREMENT_COUNTER</span><br><span class="line">&#125; from &apos;../constants/ActionTypes&apos;;</span><br><span class="line"></span><br><span class="line">const initialState = &#123; counter: 0 &#125;;</span><br><span class="line"></span><br><span class="line">function incremenent(&#123; counter &#125;) &#123;</span><br><span class="line">  return &#123; counter: counter + 1 &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function decremenent(&#123; counter &#125;) &#123;</span><br><span class="line">  return &#123; counter: counter - 1 &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default function CounterStore(state, action) &#123;</span><br><span class="line">  if (!state) &#123;</span><br><span class="line">    return initialState;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  switch (action.type) &#123;</span><br><span class="line">  case INCREMENT_COUNTER:</span><br><span class="line">    return incremenent(state, action);</span><br><span class="line">  case DECREMENT_COUNTER:</span><br><span class="line">    return decremenent(state, action);</span><br><span class="line">  default:</span><br><span class="line">    return state;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¥å£ App.js ä½ ä¼šå‘ç° @provides(dispatcher) è¿™ä¸ªå¥‡æ€ªçš„ä¸œè¥¿ï¼Œåœ¨ React é‡Œé¢è¿˜ç»å¸¸å‡ºç°ï¼Œè£…é¥°å™¨ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; Component &#125; from &apos;react&apos;;</span><br><span class="line">import Counter from &apos;./Counter&apos;;</span><br><span class="line">import &#123; provides &#125; from &apos;redux&apos;;</span><br><span class="line">import dispatcher from &apos;./dispatcher&apos;;</span><br><span class="line"></span><br><span class="line">@provides(dispatcher)</span><br><span class="line">export default class App extends Component &#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;Counter /&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Couter.jsï¼ŒåŒæ ·ï¼Œä¹Ÿå‡ºç° performsï¼ˆæ–¹æ³•ï¼‰ï¼Œobservesï¼ˆè§‚å¯Ÿè€…ï¼‰ç­‰å…³é”®å­—ã€‚ä½¿ç”¨ state ç›´æ¥ä½¿ç”¨ this.props è§£æ„èµ‹å€¼å³å¯ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">import React from &apos;react&apos;;</span><br><span class="line">import &#123; performs, observes &#125; from &apos;redux&apos;;</span><br><span class="line"></span><br><span class="line">@performs(&apos;increment&apos;, &apos;decrement&apos;)</span><br><span class="line">@observes(&apos;CounterStore&apos;)</span><br><span class="line">export default class Counter &#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    const &#123; increment, decrement &#125; = this.props;</span><br><span class="line">    return (</span><br><span class="line">      &lt;p&gt;</span><br><span class="line">        Clicked: &#123;this.props.counter&#125; times</span><br><span class="line">        &#123;&apos; &apos;&#125;</span><br><span class="line">        &lt;button onClick=&#123;() =&gt; increment()&#125;&gt;+&lt;/button&gt;</span><br><span class="line">        &#123;&apos; &apos;&#125;</span><br><span class="line">        &lt;button onClick=&#123;() =&gt; decrement()&#125;&gt;-&lt;/button&gt;</span><br><span class="line">      &lt;/p&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™äº›å…³é”®å­—æ˜¯æ—©èµ· Redux çŠ¶æ€ç®¡ç†çš„å…³é”®ï¼Œç°åœ¨çš„ç‰ˆæœ¬åº”è¯¥å·²ç»ä¸ä½¿ç”¨è¿™ç§æ–¹å¼äº†ã€‚</p><h3 id="è§£æ"><a class="markdownIt-Anchor" href="#è§£æ"></a> è§£æ</h3><h4 id="dispatcher"><a class="markdownIt-Anchor" href="#dispatcher"></a> dispatcher</h4><p>é€šè¿‡ provides å°† dispatcher æ³¨å…¥åˆ° App ä¸­ï¼Œå…¶ä¸­ï¼Œdispatcher æ˜¯é€šè¿‡ createDispatcher åˆ›å»ºï¼Œå¹¶è°ƒç”¨äº† dispatcher.receive(stores, actions) è¿›è¡Œç»‘å®šã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import * as stores from &apos;./stores/index&apos;;</span><br><span class="line">import * as actions from &apos;./actions/index&apos;;</span><br><span class="line">import &#123; createDispatcher &#125; from &apos;redux&apos;;</span><br><span class="line"></span><br><span class="line">const dispatcher =</span><br><span class="line">  module.hot &amp;&amp; module.hot.data &amp;&amp; module.hot.data.dispatcher ||</span><br><span class="line">  createDispatcher();</span><br><span class="line"></span><br><span class="line">dispatcher.receive(stores, actions);</span><br><span class="line"></span><br><span class="line">module.hot.dispose(data =&gt; &#123;</span><br><span class="line">  data.dispatcher = dispatcher;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">export default dispatcher;</span><br></pre></td></tr></table></figure><p>receive æ–¹æ³•ï¼ŒactionCreator å°† action è¿›è¡Œå°è£…ï¼Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">// Provide a way to receive new stores and actions</span><br><span class="line">  function receive(nextStores, nextActionCreators) &#123;</span><br><span class="line">    stores = nextStores;</span><br><span class="line">    actionCreators = mapValues(nextActionCreators, wrapActionCreator);</span><br><span class="line"></span><br><span class="line">    // Merge the observers</span><br><span class="line">    observers = mapValues(stores,</span><br><span class="line">      (store, key) =&gt; observers[key] || []</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    // Dispatch to initialize stores</span><br><span class="line">    if (currentTransaction) &#123;</span><br><span class="line">      updateState(committedState);</span><br><span class="line">      currentTransaction.forEach(dispatch);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      dispatch(BOOTSTRAP_STORE);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>action è¿›è¡Œè½¬åŒ–è¿”å›ä¸€ä¸ª dispatchAction å‡½æ•°ï¼Œå¦‚æœ action ä¸ºå‡½æ•°ï¼Œåˆ™å…ˆæ‰§è¡Œå‡½æ•°ï¼ŒæŠŠ dispatchInTransaction ä½œä¸ºå‚æ•°ä¼ å…¥ï¼Œè¿™æ ·å¯ä»¥åœ¨ action å†…éƒ¨ä½¿ç”¨è¯¥å‡½æ•°äº†ï¼Œå¦åˆ™ä½¿ç”¨ dispatchInTransaction å‡½æ•°è°ƒç”¨ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// Bind action creator to the dispatcher</span><br><span class="line"> function wrapActionCreator(actionCreator) &#123;</span><br><span class="line">   return function dispatchAction(...args) &#123;</span><br><span class="line">     const action = actionCreator(...args);</span><br><span class="line">     if (typeof action === &apos;function&apos;) &#123;</span><br><span class="line">       // Async action creator</span><br><span class="line">       action(dispatchInTransaction);</span><br><span class="line">     &#125; else &#123;</span><br><span class="line">       // Sync action creator</span><br><span class="line">       dispatchInTransaction(action);</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>dispatchInTransaction ï¼Œæ‰§è¡Œ dispatch ï¼Œè®¡ç®— nextStateï¼Œæ‰§è¡Œ updateState æ›´æ–°ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">  // Dispatch in the context of current transaction</span><br><span class="line">  function dispatchInTransaction(action) &#123;</span><br><span class="line">    if (currentTransaction) &#123;</span><br><span class="line">      currentTransaction.push(action);</span><br><span class="line">    &#125;</span><br><span class="line">    dispatch(action);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">// Reassign the current state on each dispatch</span><br><span class="line">  function dispatch(action) &#123;</span><br><span class="line">    if (typeof action.type !== &apos;string&apos;) &#123;</span><br><span class="line">      throw new Error(&apos;Action type must be a string.&apos;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    const nextState = computeNextState(currentState, action);</span><br><span class="line">    updateState(nextState);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>è·å– storeï¼Œä¹Ÿå°±æ˜¯ CounterStoreï¼ŒæŠŠå‚æ•°ä¼ å…¥ï¼Œè·å–æ–°çš„ state</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// To compute the next state, combine the next states of every store</span><br><span class="line">function computeNextState(state, action) &#123;</span><br><span class="line">  return mapValues(stores,</span><br><span class="line">    (store, key) =&gt; store(state[key], action)</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>updateState å®ç°ï¼Œè®¡ç®—å˜åŒ–çš„ changedKeysï¼Œæ‰§è¡Œ  emitChange è¿›è¡Œæ›´æ–°ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// Update state and emit change if needed</span><br><span class="line">function updateState(nextState) &#123;</span><br><span class="line">  // Swap the state</span><br><span class="line">  const previousState = currentState;</span><br><span class="line">  currentState = nextState;</span><br><span class="line"></span><br><span class="line">  // Notify the observers</span><br><span class="line">  const changedKeys = Object.keys(currentState).filter(key =&gt;</span><br><span class="line">    currentState[key] !== previousState[key]</span><br><span class="line">  );</span><br><span class="line">  emitChange(changedKeys);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>emitChangeï¼Œè·å–éœ€è¦é€šçŸ¥çš„ observersï¼Œè°ƒç”¨é€šçŸ¥å‡½æ•°ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">// Notify observers about the changed stores</span><br><span class="line">  function emitChange(changedKeys) &#123;</span><br><span class="line">    if (!changedKeys.length) &#123;</span><br><span class="line">      return;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // Gather the affected observers</span><br><span class="line">    const notifyObservers = [];</span><br><span class="line">    changedKeys.forEach(key =&gt; &#123;</span><br><span class="line">      observers[key].forEach(o =&gt; &#123;</span><br><span class="line">        if (notifyObservers.indexOf(o) === -1) &#123;</span><br><span class="line">          notifyObservers.push(o);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    // Emit change</span><br><span class="line">    notifyObservers.forEach(o =&gt; o());</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå¯èƒ½æœ‰ç‚¹ç–‘é—®ï¼Œobersevers æ˜¯ä»€ä¹ˆï¼Œä»å“ªæ¥ï¼Ÿå¾€ä¸‹çœ‹ï½</p><h4 id="observesjs"><a class="markdownIt-Anchor" href="#observesjs"></a> observes.js</h4><p>å°† ç»„ä»¶è¿›è¡Œè£…é¥°ï¼Œæ„é€ å‡½æ•°ä¸­æœ‰ä¸€ä¸ª</p><blockquote><p>this.unobserve = this.context.observeStores(storeKeys, this.handleChange);<br>context å°±æ˜¯ dispatcherï¼Œ</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; Component, PropTypes &#125; from &apos;react&apos;;</span><br><span class="line">import pick from &apos;lodash/object/pick&apos;;</span><br><span class="line">import identity from &apos;lodash/utility/identity&apos;;</span><br><span class="line"></span><br><span class="line">const contextTypes = &#123;</span><br><span class="line">  observeStores: PropTypes.func.isRequired</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">export default function connect(...storeKeys) &#123;</span><br><span class="line">  let mapState = identity;</span><br><span class="line"></span><br><span class="line">  // Last argument may be a custom mapState function</span><br><span class="line">  const lastIndex = storeKeys.length - 1;</span><br><span class="line">  if (typeof storeKeys[lastIndex] === &apos;function&apos;) &#123;</span><br><span class="line">    [mapState] = storeKeys.splice(lastIndex, 1);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return function (DecoratedComponent) &#123;</span><br><span class="line">    const wrappedDisplayName =</span><br><span class="line">      DecoratedComponent.displayName ||</span><br><span class="line">      DecoratedComponent.name ||</span><br><span class="line">      &apos;Component&apos;;</span><br><span class="line"></span><br><span class="line">    return class extends Component &#123;</span><br><span class="line">      static displayName = `ReduxObserves($&#123;wrappedDisplayName&#125;)`;</span><br><span class="line">      static contextTypes = contextTypes;</span><br><span class="line"></span><br><span class="line">      constructor(props, context) &#123;</span><br><span class="line">        super(props, context);</span><br><span class="line">        this.handleChange = this.handleChange.bind(this);</span><br><span class="line">        this.unobserve = this.context.observeStores(storeKeys, this.handleChange);</span><br><span class="line">      &#125;</span><br><span class="line">      ....</span><br><span class="line"></span><br><span class="line">      componentWillUnmount() &#123;</span><br><span class="line">        this.unobserve();</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      render() &#123;</span><br><span class="line">        return (</span><br><span class="line">          &lt;DecoratedComponent &#123;...this.props&#125;</span><br><span class="line">                              &#123;...this.state&#125; /&gt;</span><br><span class="line">        );</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>dispatcher observeStores æ–¹æ³•ï¼Œå°†éœ€è¦ç›‘å¬çš„ç»„ä»¶ä¼ å…¥ï¼Œä»¥åŠ onChange å‡½æ•°ï¼Œä½œä¸ºå›è°ƒä½¿ç”¨ã€‚æœ€åè¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œç§»é™¤ç›‘å¬ï¼Œè¿™ä¸ªä¹Ÿå¤ªå¦™äº†å§ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">// Provide subscription and unsubscription</span><br><span class="line">  function observeStores(observedKeys, onChange) &#123;</span><br><span class="line">    // Emit the state update</span><br><span class="line">    function handleChange() &#123;</span><br><span class="line">      onChange(currentState);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // Synchronously emit the initial value</span><br><span class="line">    handleChange();</span><br><span class="line"></span><br><span class="line">    // Register the observer for each relevant key</span><br><span class="line">    observedKeys.forEach(key =&gt;</span><br><span class="line">      observers[key].push(handleChange)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    // Let it unregister when the time comes</span><br><span class="line">    return () =&gt; &#123;</span><br><span class="line">      observedKeys.forEach(key =&gt; &#123;</span><br><span class="line">        const index = observers[key].indexOf(handleChange);</span><br><span class="line">        observers[key].splice(index, 1);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>å½“è®¡ç®—å¥½ nextState åï¼Œå°±ä¼šè°ƒç”¨ observe çš„ onChange æ–¹æ³•ï¼Œ onChange æ–¹æ³•ä¹Ÿå°±æ˜¯ è£…é¥°å™¨é‡Œé¢çš„æ–¹æ³•ã€‚æœ€åè°ƒç”¨è‡ªèº«çš„ updateStateï¼Œä½¿ç”¨ setState è¿›è¡Œç»„ä»¶æ›´æ–°ã€‚è€Œè¿™äº› state ä½œä¸º props ä¼ å…¥äº†æˆ‘ä»¬è‡ªå·±çš„ç»„ä»¶ï¼Œä¹Ÿå°±å¯ä»¥é€šè¿‡ this.props  æ‹¿åˆ°ã€‚å®Œç¾ï½ï½ï½</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">handleChange(stateFromStores) &#123;</span><br><span class="line">  this.currentStateFromStores = pick(stateFromStores, storeKeys);</span><br><span class="line">  this.updateState(stateFromStores, this.props);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">componentWillReceiveProps(nextProps) &#123;</span><br><span class="line">  this.updateState(this.currentStateFromStores, nextProps);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">updateState(stateFromStores, props) &#123;</span><br><span class="line">  if (storeKeys.length === 1) &#123;</span><br><span class="line">    // Just give it the particular store state for convenience</span><br><span class="line">    stateFromStores = stateFromStores[storeKeys[0]];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  const state = mapState(stateFromStores, props);</span><br><span class="line">  if (this.state) &#123;</span><br><span class="line">    this.setState(state);</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    this.state = state;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="performs-ç»„ä»¶"><a class="markdownIt-Anchor" href="#performs-ç»„ä»¶"></a> performs ç»„ä»¶</h4><p>action ç»‘å®šåˆ°ç»„ä»¶ï¼Œå¯ä»¥é€šè¿‡ this.props ï¼Œé€šè¿‡ this.context.getActions() æ‹¿åˆ° actions</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; Component, PropTypes &#125; from &apos;react&apos;;</span><br><span class="line">import pick from &apos;lodash/object/pick&apos;;</span><br><span class="line">import identity from &apos;lodash/utility/identity&apos;;</span><br><span class="line"></span><br><span class="line">const contextTypes = &#123;</span><br><span class="line">  getActions: PropTypes.func.isRequired</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">export default function performs(...actionKeys) &#123;</span><br><span class="line">  let mapActions = identity;</span><br><span class="line"></span><br><span class="line">  // Last argument may be a custom mapState function</span><br><span class="line">  const lastIndex = actionKeys.length - 1;</span><br><span class="line">  if (typeof actionKeys[lastIndex] === &apos;function&apos;) &#123;</span><br><span class="line">    [mapActions] = actionKeys.splice(lastIndex, 1);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return function (DecoratedComponent) &#123;</span><br><span class="line">    const wrappedDisplayName =</span><br><span class="line">      DecoratedComponent.displayName ||</span><br><span class="line">      DecoratedComponent.name ||</span><br><span class="line">      &apos;Component&apos;;</span><br><span class="line"></span><br><span class="line">    return class extends Component &#123;</span><br><span class="line">      static displayName = `ReduxPerforms($&#123;wrappedDisplayName&#125;)`;</span><br><span class="line">      static contextTypes = contextTypes;</span><br><span class="line"></span><br><span class="line">      constructor(props, context) &#123;</span><br><span class="line">        super(props, context);</span><br><span class="line">        this.updateActions(props);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      componentWillReceiveProps(nextProps) &#123;</span><br><span class="line">        this.updateActions(nextProps);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      updateActions(props) &#123;</span><br><span class="line">        this.actions = mapActions(</span><br><span class="line">          pick(this.context.getActions(), actionKeys),</span><br><span class="line">          props</span><br><span class="line">        );</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      render() &#123;</span><br><span class="line">        return (</span><br><span class="line">          &lt;DecoratedComponent &#123;...this.props&#125;</span><br><span class="line">                              &#123;...this.actions&#125; /&gt;</span><br><span class="line">        );</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ°è¿™é‡Œå°±å·®ä¸å¤šäº†ï½<br>é¢å¤–æ”¶è·</p><h4 id="lodash"><a class="markdownIt-Anchor" href="#lodash"></a> Lodash</h4><ul><li><p>pick</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var object = &#123; &apos;user&apos;: &apos;fred&apos;, &apos;age&apos;: 40 &#125;;</span><br><span class="line">_.pick(object, &apos;user&apos;);</span><br><span class="line">// =&gt; &#123; &apos;user&apos;: &apos;fred&apos; &#125;</span><br><span class="line">_.pick(object, _.isString);</span><br><span class="line">// =&gt; &#123; &apos;user&apos;: &apos;fred&apos; &#125;</span><br></pre></td></tr></table></figure></li><li><p>identity</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">function identity(value) &#123;</span><br><span class="line">  return value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>mapValues</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">_.mapValues(&#123; &apos;a&apos;: 1, &apos;b&apos;: 2 &#125;, function(n) &#123;</span><br><span class="line"> return n * 3;</span><br><span class="line">&#125;);</span><br><span class="line">// =&gt; &#123; &apos;a&apos;: 3, &apos;b&apos;: 6 &#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="æœ€å"><a class="markdownIt-Anchor" href="#æœ€å"></a> æœ€å</h3><p>éº»é›€è™½å°ï¼Œå´èƒ½çœ‹é€ç²¾é«“ï½</p>]]></content>
    
    <summary type="html">
    
      è¿™å‘¨çªç„¶æƒ³å­¦ä¹ ä¸€ä¸‹çŠ¶æ€ç®¡ç†çš„å†™æ³•ã€‚çœ‹çœ‹ä¸šç•Œæ˜¯æ€ä¹ˆå®ç°çš„ï¼Œä¹‹å‰ä½¿ç”¨è¿‡ reduxï¼Œé‚£å°±å…ˆä» redux ä¸‹æ‰‹å§ï¼Œä½†æ˜¯ï¼Œä¸€ä¸Šæ¥å°±çœ‹æœ€æ–°ç‰ˆæœ¬çš„ä»£ç ï¼Œä¸å¤ªé€‚åˆæ–°æ‰‹å­¦ä¹ ï¼Œä¸€æ–¹é¢æœ€æ–°ç‰ˆæœ¬å·²ç»å‘å±•nå¤šå¹´äº†ï¼ŒåŠŸèƒ½å·²ç»éå¸¸å®Œå–„ï¼ˆä»£ç å¤šéš¾æ‡‚ï¼‰ï¼Œå¦ä¸€æ–¹é¢ç›´æ¥çœ‹æœ€æ–°çš„ä¸äº†è§£è¿™ä¸ªå·¥å…·æ˜¯æ€ä¹ˆè®¾è®¡å‡ºæ¥çš„
    
    </summary>
    
      <category term="JavaScript" scheme="https://wzes.github.io/categories/JavaScript/"/>
    
    
      <category term="JavaScript" scheme="https://wzes.github.io/tags/JavaScript/"/>
    
      <category term="React" scheme="https://wzes.github.io/tags/React/"/>
    
      <category term="Redux" scheme="https://wzes.github.io/tags/Redux/"/>
    
  </entry>
  
  <entry>
    <title>Node KoaJs æºç è§£æ</title>
    <link href="https://wzes.github.io/2019/08/18/JavaScript/KoaJs/"/>
    <id>https://wzes.github.io/2019/08/18/JavaScript/KoaJs/</id>
    <published>2019-08-18T10:56:00.000Z</published>
    <updated>2019-09-02T12:15:48.563Z</updated>
    
    <content type="html"><![CDATA[<h3 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h3><p>åˆæ˜¯ä¸€å‘¨è¿‡å»äº†ï¼Œå¸¸è§„å­¦ä¹ ä¸èƒ½æ–­ï¼ä½†æ˜¯é€‰æ‹©ä»€ä¹ˆä¸»é¢˜å‘¢ï¼Ÿä¸€æ—¶é—´ä¸çŸ¥é“é€‰ä»€ä¹ˆå¥½ï¼Œäºæ˜¯åˆæƒ³èµ·ç®€å•çš„ <strong>koajs</strong> éå¸¸æ„‰å¿«çš„å°±é€‰æ‹©ä»–äº† <a href="https://koajs.com/" target="_blank" rel="noopener">https://koajs.com/</a>ï¼Œäº†è§£ä¸€ä¸‹ï¼Ÿ</p><p>ä»–æ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿å‘¢ï¼Ÿ</p><blockquote><p>Koa æ˜¯ä¸€ä¸ªæ–°çš„ web æ¡†æ¶ï¼Œç”± Express å¹•åçš„åŸç­äººé©¬æ‰“é€ ï¼Œ è‡´åŠ›äºæˆä¸º web åº”ç”¨å’Œ API å¼€å‘é¢†åŸŸä¸­çš„ä¸€ä¸ªæ›´å°ã€æ›´å¯Œæœ‰è¡¨ç°åŠ›ã€æ›´å¥å£®çš„åŸºçŸ³ã€‚ é€šè¿‡åˆ©ç”¨ async å‡½æ•°ï¼ŒKoa å¸®ä½ ä¸¢å¼ƒå›è°ƒå‡½æ•°ï¼Œå¹¶æœ‰åŠ›åœ°å¢å¼ºé”™è¯¯å¤„ç†ã€‚ Koa å¹¶æ²¡æœ‰æ†ç»‘ä»»ä½•ä¸­é—´ä»¶ï¼Œ è€Œæ˜¯æä¾›äº†ä¸€å¥—ä¼˜é›…çš„æ–¹æ³•ï¼Œå¸®åŠ©æ‚¨å¿«é€Ÿè€Œæ„‰å¿«åœ°ç¼–å†™æœåŠ¡ç«¯åº”ç”¨ç¨‹åºã€‚</p></blockquote><h3 id="hello-world"><a class="markdownIt-Anchor" href="#hello-world"></a> hello world</h3><p>é¦–å…ˆæ–°å»ºä¸€ä¸ª node é¡¹ç›®ï¼Œå…¶å®å¾ˆç®€å•ï¼Œåªéœ€è¦ä¸€ä¸ª package.json æ–‡ä»¶ï¼Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;koa-hello&quot;,</span><br><span class="line">  &quot;version&quot;: &quot;1.0.0&quot;,</span><br><span class="line">  &quot;description&quot;: &quot;&quot;,</span><br><span class="line">  &quot;main&quot;: &quot;index.js&quot;,</span><br><span class="line">  &quot;scripts&quot;: &#123;</span><br><span class="line">    &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;,</span><br><span class="line">    &quot;start&quot;: &quot;node src/index.js&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;keywords&quot;: [],</span><br><span class="line">  &quot;author&quot;: &quot;&quot;,</span><br><span class="line">  &quot;license&quot;: &quot;ISC&quot;,</span><br><span class="line">  &quot;dependencies&quot;: &#123;</span><br><span class="line">    &quot;koa&quot;: &quot;^2.7.0&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åæ‰§è¡Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i koa</span><br></pre></td></tr></table></figure><p>ä»£ç  index.js æ–‡ä»¶ï¼Œæ–°å»ºä¸€ä¸ª koa å®ä¾‹ï¼Œä½¿ç”¨ app.use å†™ä¸€ä¸ª async æ–¹æ³•ï¼Œè®¾ç½® ctx.body çš„å€¼å°±å¯ä»¥äº†ã€‚æœ€åä½¿ç”¨ app.listen å¯åŠ¨ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">const Koa = require(&apos;koa&apos;);</span><br><span class="line">const app = new Koa();</span><br><span class="line"></span><br><span class="line">app.use(async ctx =&gt; &#123;</span><br><span class="line">    ctx.body = &apos;Hello World&apos;;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(3000);</span><br></pre></td></tr></table></figure><p>è¿™æ ·çš„è¯ï¼Œä¸€ä¸ª web æœåŠ¡å™¨å°±æ­å»ºå¥½äº†ï¼Œè®¿é—® <a href="http://localhost:3000/" target="_blank" rel="noopener">http://localhost:3000/</a> å°±ä¼šå¾—åˆ° hello world è¿”å›ç»“æœäº†ã€‚ä½ å¯ä»¥å°è¯•æ›´æ”¹å­—æ®µä»è€Œå¾—åˆ°ä¸åŒçš„è¿”å›ç»“æœã€‚</p><h3 id="æºç è§£æ"><a class="markdownIt-Anchor" href="#æºç è§£æ"></a> æºç è§£æ</h3><p>koa çš„æºç åªæœ‰å››ä¸ªæ–‡ä»¶ï¼Œä¸åŒ…å«å…¶ä»–å¼•ç”¨çš„è¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> .</span><br><span class="line">â”œâ”€â”€ History.md</span><br><span class="line">â”œâ”€â”€ LICENSE</span><br><span class="line">â”œâ”€â”€ Readme.md</span><br><span class="line">â”œâ”€â”€ lib</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ application.js</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ context.js</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ request.js</span><br><span class="line">â”‚Â Â  â””â”€â”€ response.js</span><br><span class="line">â””â”€â”€ package.json</span><br></pre></td></tr></table></figure><p>ä¸»å…¥å£å¯ä»¥åœ¨ package.json çš„ main ä¸­å¾—åˆ°ï¼Œæ˜¯ application.jsï¼Œæš‚æ—¶å…ˆçŸ¥é“ middleware æ˜¯ä¸­é—´æ¥ï¼Œé€šå¸¸ä¸€ä¸ªè¯·æ±‚è¿‡æ¥å°±ä¼šä¾æ¬¡æ‰§è¡Œä¸­é—´ä»¶çš„æ–¹æ³•ã€‚</p><h4 id="æ„é€ å‡½æ•°"><a class="markdownIt-Anchor" href="#æ„é€ å‡½æ•°"></a> æ„é€ å‡½æ•°</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">module.exports = class Application extends Emitter &#123;</span><br><span class="line">  /**</span><br><span class="line">   * Initialize a new `Application`.</span><br><span class="line">   *</span><br><span class="line">   * @api public</span><br><span class="line">   */</span><br><span class="line"></span><br><span class="line">  constructor() &#123;</span><br><span class="line">    super();</span><br><span class="line"></span><br><span class="line">    this.proxy = false;</span><br><span class="line">    this.middleware = [];</span><br><span class="line">    this.subdomainOffset = 2;</span><br><span class="line">    this.env = process.env.NODE_ENV || &apos;development&apos;;</span><br><span class="line">    this.context = Object.create(context);</span><br><span class="line">    this.request = Object.create(request);</span><br><span class="line">    this.response = Object.create(response);</span><br><span class="line">    if (util.inspect.custom) &#123;</span><br><span class="line">      this[util.inspect.custom] = this.inspect;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>app.use å…¶å®å°±æ˜¯æ·»åŠ ä¸€ä¸ªä¸­é—´ä»¶ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨ async çš„å‡½æ•°ï¼Œgenerator è¢«æŠ›å¼ƒäº†ï¼</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">use(fn) &#123;</span><br><span class="line">  if (typeof fn !== &apos;function&apos;) throw new TypeError(&apos;middleware must be a function!&apos;);</span><br><span class="line">  if (isGeneratorFunction(fn)) &#123;</span><br><span class="line">    deprecate(&apos;Support for generators will be removed in v3. &apos; +</span><br><span class="line">              &apos;See the documentation for examples of how to convert old middleware &apos; +</span><br><span class="line">              &apos;https://github.com/koajs/koa/blob/master/docs/migration.md&apos;);</span><br><span class="line">    fn = convert(fn);</span><br><span class="line">  &#125;</span><br><span class="line">  debug(&apos;use %s&apos;, fn._name || fn.name || &apos;-&apos;);</span><br><span class="line">  this.middleware.push(fn);</span><br><span class="line">  return this;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>app.listen åˆ›å»ºä¸€ä¸ªæœåŠ¡å™¨ï¼Œç›‘å¬ 3000 ç«¯å£ï¼Œhttp.createServer æ˜¯ node çš„æœåŠ¡å™¨ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">listen(...args) &#123;</span><br><span class="line">  debug(&apos;listen&apos;);</span><br><span class="line">  const server = http.createServer(this.callback());</span><br><span class="line">  return server.listen(...args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>callback æ˜¯æä¾›ä¸€ä¸ªå‡½æ•°ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½ä¼šèµ°åˆ°è¿™ä¸ªå‡½æ•°é‡Œé¢è¿›è¡Œå¤„ç†ã€‚æ¯æ¬¡è¯·æ±‚è¿‡æ¥éƒ½ä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½ä¼šåˆ›å»ºä¸€ä¸ª ctx çš„å¯¹è±¡ã€‚<br>compose çš„ä½œç”¨å°±æ˜¯å°†æ‰€æœ‰çš„ä¸­é—´ä»¶æ•´åˆæˆä¸€ä¸ªå‡½æ•°ï¼Œä½¿ç”¨ next å‡½æ•°ç»§ç»­è°ƒç”¨ä¸‹ä¸€ä¸ªå‡½æ•°ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">callback() &#123;</span><br><span class="line">  const fn = compose(this.middleware);</span><br><span class="line"></span><br><span class="line">  if (!this.listenerCount(&apos;error&apos;)) this.on(&apos;error&apos;, this.onerror);</span><br><span class="line"></span><br><span class="line">  const handleRequest = (req, res) =&gt; &#123;</span><br><span class="line">    const ctx = this.createContext(req, res);</span><br><span class="line">    return this.handleRequest(ctx, fn);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  return handleRequest;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆå§‹åŒ– ctx å¯¹è±¡ï¼Œè¿™é‡Œ this.request å°†ä¼šæŠŠåŸç”Ÿçš„ request å‚æ•°è¿›è¡Œè§£æï¼Œæ–¹ä¾¿æˆ‘ä»¬è¿›è¡Œç›¸å…³å‚æ•°è·å–ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Initialize a new context.</span><br><span class="line"> *</span><br><span class="line"> * @api private</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">createContext(req, res) &#123;</span><br><span class="line">  const context = Object.create(this.context);</span><br><span class="line">  const request = context.request = Object.create(this.request);</span><br><span class="line">  const response = context.response = Object.create(this.response);</span><br><span class="line">  context.app = request.app = response.app = this;</span><br><span class="line">  context.req = request.req = response.req = req;</span><br><span class="line">  context.res = request.res = response.res = res;</span><br><span class="line">  request.ctx = response.ctx = context;</span><br><span class="line">  request.response = response;</span><br><span class="line">  response.request = request;</span><br><span class="line">  context.originalUrl = request.originalUrl = req.url;</span><br><span class="line">  context.state = &#123;&#125;;</span><br><span class="line">  return context;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¯”å¦‚æˆ‘ä»¬ä¹‹åå°±å¯ä»¥ä½¿ç”¨<br>** ctx.query.key ** æ¥è·å– <a href="http://localhost:3000?key=value%EF%BC%8C%E4%B8%BA%E4%BB%80%E4%B9%88%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8" target="_blank" rel="noopener">http://localhost:3000?key=valueï¼Œä¸ºä»€ä¹ˆå¯ä»¥ä½¿ç”¨</a> ctx.query åˆå¯ä»¥è·å–å‚æ•°å‘¢ï¼Œè¿™ä¸ªè¦é  Object.create çš„æœ¬äº‹äº†ï¼Œå®ƒç›¸å½“äºåˆ›é€ äº†ä¸€ä¸ªå¯¹è±¡ï¼Œç»§æ‰¿äº†åŸæ¥çš„å¯¹è±¡ï¼Œè€Œ this.request æœ‰ query çš„å‚æ•°ï¼Œè€Œæœ€ä¸ºé‡è¦çš„æ˜¯ this.context = Object.create(context); context å§”æ‰˜ï¼ˆä½¿ç”¨äº† Delegatorï¼‰äº†è¿™äº› request çš„ç›¸å…³å±æ€§å’Œæ–¹æ³•ã€‚ã€ç¬¬ä¸€æ¬¡ä½“ä¼šåˆ° js å§”æ‰˜ï¼Œä»¥å‰çŸ¥è¯†å¬è¯´ä¸çŸ¥é“æ˜¯å•¥ã€‘</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Request delegation.</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">delegate(proto, &apos;request&apos;)</span><br><span class="line">  .access(&apos;method&apos;)</span><br><span class="line">  .access(&apos;query&apos;)</span><br><span class="line">  .access(&apos;path&apos;)</span><br><span class="line">  .access(&apos;url&apos;)</span><br><span class="line">  ....... // çœç•¥</span><br></pre></td></tr></table></figure><p>handleRequest è¯·æ±‚å¤„ç†ï¼ŒfnMiddleware å°±æ˜¯æ‰€æœ‰çš„ä¸­é—´ä»¶ï¼Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">handleRequest(ctx, fnMiddleware) &#123;</span><br><span class="line">  const res = ctx.res;</span><br><span class="line">  res.statusCode = 404;</span><br><span class="line">  const onerror = err =&gt; ctx.onerror(err);</span><br><span class="line">  const handleResponse = () =&gt; respond(ctx);</span><br><span class="line">  onFinished(res, onerror);</span><br><span class="line">  return fnMiddleware(ctx).then(handleResponse).catch(onerror);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è°ƒç”¨å®Œä¸­é—´ä»¶ä»¥åï¼Œå°±æ‰§è¡Œ handleResponse å°†æ•°æ®è¿”å›ï¼Œè¿”å›æ•°æ®ä¹Ÿå°±æ˜¯å°† ctx.body æ‹¿å‡ºæ¥ï¼Œä½¿ç”¨ response.end è¿”å›æ•°æ®ï¼Œè¿”å›æ—¶ï¼Œä¼šå¯¹æ•°æ®è¿›è¡Œå¤„ç†ï¼Œåœ¨æœ€åé¢å¯ä»¥ä½“ä¼šåˆ°ï½</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Response helper.</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">function respond(ctx) &#123;</span><br><span class="line">  // allow bypassing koa</span><br><span class="line">  if (false === ctx.respond) return;</span><br><span class="line"></span><br><span class="line">  if (!ctx.writable) return;</span><br><span class="line"></span><br><span class="line">  const res = ctx.res;</span><br><span class="line">  let body = ctx.body;</span><br><span class="line">  const code = ctx.status;</span><br><span class="line"></span><br><span class="line">  // ignore body</span><br><span class="line">  if (statuses.empty[code]) &#123;</span><br><span class="line">    // strip headers</span><br><span class="line">    ctx.body = null;</span><br><span class="line">    return res.end();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  if (&apos;HEAD&apos; == ctx.method) &#123;</span><br><span class="line">    if (!res.headersSent &amp;&amp; isJSON(body)) &#123;</span><br><span class="line">      ctx.length = Buffer.byteLength(JSON.stringify(body));</span><br><span class="line">    &#125;</span><br><span class="line">    return res.end();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // status body</span><br><span class="line">  if (null == body) &#123;</span><br><span class="line">    if (ctx.req.httpVersionMajor &gt;= 2) &#123;</span><br><span class="line">      body = String(code);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      body = ctx.message || String(code);</span><br><span class="line">    &#125;</span><br><span class="line">    if (!res.headersSent) &#123;</span><br><span class="line">      ctx.type = &apos;text&apos;;</span><br><span class="line">      ctx.length = Buffer.byteLength(body);</span><br><span class="line">    &#125;</span><br><span class="line">    return res.end(body);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // responses</span><br><span class="line">  if (Buffer.isBuffer(body)) return res.end(body);</span><br><span class="line">  if (&apos;string&apos; == typeof body) return res.end(body);</span><br><span class="line">  if (body instanceof Stream) return body.pipe(res);</span><br><span class="line"></span><br><span class="line">  // body: json</span><br><span class="line">  body = JSON.stringify(body);</span><br><span class="line">  if (!res.headersSent) &#123;</span><br><span class="line">    ctx.length = Buffer.byteLength(body);</span><br><span class="line">  &#125;</span><br><span class="line">  res.end(body);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ°è¿™é‡Œï¼ŒåŸºæœ¬çš„è¯·æ±‚å·²ç»æ¸…æ¥šäº†ï½ï½</p><h4 id="end"><a class="markdownIt-Anchor" href="#end"></a> End</h4><p>å†æ¥çœ‹ä¸€çœ¼æœ€ç®€å•çš„ http server ä»£ç ï¼Œå¯¹æ¯”ä¸€ä¸‹ï¼Œæ¯” koa ä»£ç çš„ hello world ç›¸æ¯”å¹¶æ²¡æœ‰å¤šå¤æ‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var http = require(&apos;http&apos;);</span><br><span class="line">http.createServer(function (req, res) &#123;</span><br><span class="line">  res.writeHead(200, &#123;&apos;Content-Type&apos;: &apos;text/plain&apos;&#125;);</span><br><span class="line">  res.write(&apos;Hello World!&apos;);</span><br><span class="line">  res.end();</span><br><span class="line">&#125;).listen(8080);</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ï¼Œè·å–å‚æ•°ï¼Œä½¿ç”¨è·¯ç”±ç­‰ç­‰æ’ä»¶ï¼Œkoa ç”Ÿæ€åšäº†å¾ˆå¤šï¼Œéå¸¸æ–¹ä¾¿ï¼Œå¿«æ¥ä½“éªŒå§ï¼</p>]]></content>
    
    <summary type="html">
    
      åˆæ˜¯ä¸€å‘¨è¿‡å»äº†ï¼Œå¸¸è§„å­¦ä¹ ä¸èƒ½æ–­ï¼ä½†æ˜¯é€‰æ‹©ä»€ä¹ˆä¸»é¢˜å‘¢ï¼Ÿä¸€æ—¶é—´ä¸çŸ¥é“é€‰ä»€ä¹ˆå¥½ï¼Œäºæ˜¯åˆæƒ³èµ·ç®€å•çš„ koajs éå¸¸æ„‰å¿«çš„å°±é€‰æ‹©ä»–äº†ï¼Œäº†è§£ä¸€ä¸‹ï¼Ÿ
    
    </summary>
    
      <category term="JavaScript" scheme="https://wzes.github.io/categories/JavaScript/"/>
    
    
      <category term="JavaScript" scheme="https://wzes.github.io/tags/JavaScript/"/>
    
      <category term="Node" scheme="https://wzes.github.io/tags/Node/"/>
    
      <category term="Koa" scheme="https://wzes.github.io/tags/Koa/"/>
    
  </entry>
  
  <entry>
    <title>Android ä¸€ä¸ªæ»‘åŠ¨ç»„ä»¶çš„åŸç†æµ…æ</title>
    <link href="https://wzes.github.io/2019/08/11/Android/%E4%B8%80%E4%B8%AA%E6%BB%91%E5%8A%A8%E7%BB%84%E4%BB%B6%E7%9A%84%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90/"/>
    <id>https://wzes.github.io/2019/08/11/Android/ä¸€ä¸ªæ»‘åŠ¨ç»„ä»¶çš„åŸç†æµ…æ/</id>
    <published>2019-08-11T06:47:16.000Z</published>
    <updated>2019-09-02T12:19:37.016Z</updated>
    
    <content type="html"><![CDATA[<h3 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h3><p>ä¸€ä¸ªå¥½çš„æ»‘åŠ¨ä¸æ­¢èƒ½å¤Ÿå“åº”æ‰‹æŒ‡çš„ç§»åŠ¨ï¼Œè€Œä¸”è¿˜èƒ½å“åº” Flingï¼ˆæŠ›ï¼‰ äº‹ä»¶ï¼Œå“åº”æ‰‹æŒ‡çš„ç§»åŠ¨æ¯”è¾ƒç®€å•ï¼Œæ‰‹æŒ‡ç§»åŠ¨å¤šå°‘è·ç¦»ï¼Œå¸ƒå±€å°±ç§»åŠ¨å¤šå°‘è·ç¦»ï¼›å½“å¿«é€Ÿæ»‘åŠ¨æ—¶ï¼Œæ‰‹æŒ‡ç¦»å¼€åï¼Œä¸èƒ½é©¬ä¸Šåœæ­¢æ»‘åŠ¨ï¼Œè€Œæ˜¯åº”è¯¥è®¡ç®—æ‰‹æŒ‡çš„ç§»åŠ¨é€Ÿåº¦ï¼Œäº§ç”Ÿä¸€ä¸ªã€æŠ›ã€‘ï¼ˆFling ï¼‰çš„åŠ¨ä½œï¼Œè®©å†…å®¹ç»§ç»­æ»šåŠ¨ä¸€æ®µè·ç¦»ã€‚è¿™æ‰æ˜¯å¥½çš„æ»‘åŠ¨ç»„ä»¶ã€‚é‚£ä¹ˆå…¶ä¸­å…·ä½“çš„è®¾è®¡ç©¶ç«Ÿæ˜¯å¦‚ä½•å‘¢ï¼Œä»Šå¤©å°±æ¥åˆ†æä¸€æ³¢ï¼Œå€Ÿé‰´ Android OverScroller çš„å®ç°ã€‚</p><h3 id="demo"><a class="markdownIt-Anchor" href="#demo"></a> Demo</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">if (mOverScroller.computeScrollOffset()) &#123;</span><br><span class="line">      // è·å– scrollY</span><br><span class="line">     int y = mOverScroller.getCurrY();</span><br><span class="line">     // æ­¤å¤„çœç•¥ä¸€å †æ§åˆ¶æ»šåŠ¨çš„ä»£ç </span><br><span class="line">     .....</span><br><span class="line">     // æ›´æ–°</span><br><span class="line">    postInvalidate();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è§£æ"><a class="markdownIt-Anchor" href="#è§£æ"></a> è§£æ</h3><p>æ€»ä½“é€»è¾‘å…ˆæ¢³ç†ä¸‹ï¼Œé¦–å…ˆå†…å®¹è·Ÿéšæ‰‹æŒ‡ç§»åŠ¨è€Œã€ç§»åŠ¨ã€‘ï¼Œæ‰‹æŒ‡ç¦»å¼€æ—¶äº§ç”Ÿä¸€ä¸ª ã€é€Ÿåº¦ã€‘ï¼Œæ ¹æ®è¿™ä¸ªé€Ÿåº¦è®¡ç®—ä¸€ä¸ªï¼Œæ­¤æ¬¡æ»‘åŠ¨çš„ã€æ€»æ—¶é—´ã€‘å’Œã€æ€»è·ç¦»ã€‘ï¼Œä¹‹åå¯ä»¥è®¡ç®—æ¯ä¸€ä¸ªã€æ—¶åˆ»ã€‘å¯¹åº”çš„ã€ä½ç½®ã€‘ã€‚é‚£å…¶ä¸­æ—¶åˆ»ä¸è·ç¦»çš„å¯¹åº”å…³ç³»æ˜¯å¦‚ä½•å‘¢ï¼Ÿçœ‹äº†ä¸€ä¸‹ Android çš„æºç ï¼Œè®¡ç®—å…³ç³»ä¹‹å¤æ‚ï¼Œæƒ¨ç»äººå¯°ï¼Œæ¬²ç ”åˆæ­¢ï¼ä½†è¿™ä¸é‡è¦ï¼Œé‡è¦çš„æ˜¯æŒæ¡å…¨å±€ã€‚<br>ä¸€èµ·æ¥æ¬£èµä¸€ä¸‹ä»£ç å§</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line">         * Update the current position and velocity for current time. Returns</span><br><span class="line">         * true if update has been done and false if animation duration has been</span><br><span class="line">         * reached.</span><br><span class="line">         */</span><br><span class="line">        boolean update() &#123;</span><br><span class="line">            final long time = AnimationUtils.currentAnimationTimeMillis();</span><br><span class="line">            final long currentTime = time - mStartTime;</span><br><span class="line"></span><br><span class="line">            if (currentTime == 0) &#123;</span><br><span class="line">                // Skip work but report that we&apos;re still going if we have a nonzero duration.</span><br><span class="line">                return mDuration &gt; 0;</span><br><span class="line">            &#125;</span><br><span class="line">            if (currentTime &gt; mDuration) &#123;</span><br><span class="line">                return false;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            double distance = 0.0;</span><br><span class="line">            switch (mState) &#123;</span><br><span class="line">                case SPLINE: &#123;</span><br><span class="line">                    final float t = (float) currentTime / mSplineDuration;</span><br><span class="line">                    final int index = (int) (NB_SAMPLES * t);</span><br><span class="line">                    float distanceCoef = 1.f;</span><br><span class="line">                    float velocityCoef = 0.f;</span><br><span class="line">                    if (index &lt; NB_SAMPLES) &#123;</span><br><span class="line">                        final float t_inf = (float) index / NB_SAMPLES;</span><br><span class="line">                        final float t_sup = (float) (index + 1) / NB_SAMPLES;</span><br><span class="line">                        final float d_inf = SPLINE_POSITION[index];</span><br><span class="line">                        final float d_sup = SPLINE_POSITION[index + 1];</span><br><span class="line">                        velocityCoef = (d_sup - d_inf) / (t_sup - t_inf);</span><br><span class="line">                        distanceCoef = d_inf + (t - t_inf) * velocityCoef;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    distance = distanceCoef * mSplineDistance;</span><br><span class="line">                    mCurrVelocity = velocityCoef * mSplineDistance / mSplineDuration * 1000.0f;</span><br><span class="line">                    break;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                case BALLISTIC: &#123;</span><br><span class="line">                    final float t = currentTime / 1000.0f;</span><br><span class="line">                    mCurrVelocity = mVelocity + mDeceleration * t;</span><br><span class="line">                    distance = mVelocity * t + mDeceleration * t * t / 2.0f;</span><br><span class="line">                    break;</span><br><span class="line">                &#125;</span><br><span class="line">                .....</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            mCurrentPosition = mStart + (int) Math.round(distance);</span><br><span class="line"></span><br><span class="line">            return true;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>mCurrentPosition å°±æ˜¯æŸä¸ªæ—¶åˆ»å¯¹åº”çš„ä½ç½®ï¼Œæœ‰è¶£çš„æ˜¯ BALLISTIC æ¨¡å¼ï¼Œè¿˜è®°å¾—é«˜ä¸­ç‰©ç†çš„é‡åŠ›åŠ é€Ÿåº¦æ—¶é—´ä¸è·ç¦»çš„å…¬å¼å—ï¼Ÿæ˜¯ä¸æ˜¯ä¼¼æ›¾ç›¸è¯†ï¼Ÿè¿™ç®—æ¯”è¾ƒç®€å•çš„å…¬å¼ï¼Œä½†æˆ‘ä»¬ä»Šå¤©ä½†ä¸»è§’æ˜¯ <strong>SPLINE</strong> æ¨¡å¼ï¼ŒScrollView ä½†æ»‘åŠ¨æ­£æ˜¯ä½¿ç”¨äº†è¿™ä¸ªæ¨¡å¼è¿›è¡Œæ»‘åŠ¨ï¼Œä½“éªŒéå¸¸å¥½ï¼ï¼ï¼ï¼å…¬å¼æœ‰ç‚¹å¤æ‚ï¼Œå°±ä¸æ´—æ´—ç ”ç©¶äº†ï¼Œå–œæ¬¢çš„åŒå­¦è‡ªè¡Œç ”ç©¶å§</p><h3 id="æ€»ç»“"><a class="markdownIt-Anchor" href="#æ€»ç»“"></a> æ€»ç»“</h3><p>ç®€å•ä¸€ä¸ªæ»šåŠ¨ï¼Œè•´è—çš„é“ç†ç”Ÿä¸å¯æµ‹ï¼Œä¸€ä¸å°å¿ƒå°±å‡ºç°äº†ç‰©ç†çŸ¥è¯†ç‚¹â€¦å­¦ä¹ è¿˜æ˜¯æŒºæœ‰ç”¨çš„å§</p>]]></content>
    
    <summary type="html">
    
      ä¸€ä¸ªå¥½çš„æ»‘åŠ¨ä¸æ­¢èƒ½å¤Ÿå“åº”æ‰‹æŒ‡çš„ç§»åŠ¨ï¼Œè€Œä¸”è¿˜èƒ½å“åº” Flingï¼ˆæŠ›ï¼‰ äº‹ä»¶ï¼Œå“åº”æ‰‹æŒ‡çš„ç§»åŠ¨æ¯”è¾ƒç®€å•ï¼Œæ‰‹æŒ‡ç§»åŠ¨å¤šå°‘è·ç¦»ï¼Œå¸ƒå±€å°±ç§»åŠ¨å¤šå°‘è·ç¦»ï¼›å½“å¿«é€Ÿæ»‘åŠ¨æ—¶ï¼Œæ‰‹æŒ‡ç¦»å¼€åï¼Œä¸èƒ½é©¬ä¸Šåœæ­¢æ»‘åŠ¨ï¼Œè€Œæ˜¯åº”è¯¥è®¡ç®—æ‰‹æŒ‡çš„ç§»åŠ¨é€Ÿåº¦ï¼Œäº§ç”Ÿä¸€ä¸ªã€æŠ›ã€‘ï¼ˆFling ï¼‰çš„åŠ¨ä½œï¼Œè®©å†…å®¹ç»§ç»­æ»šåŠ¨ä¸€æ®µè·ç¦»
    
    </summary>
    
      <category term="Android" scheme="https://wzes.github.io/categories/Android/"/>
    
    
      <category term="Android" scheme="https://wzes.github.io/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>JavaScript Babel-Loader è‡ªå®šä¹‰å…¥é—¨</title>
    <link href="https://wzes.github.io/2019/08/04/JavaScript/Babel%20Loader/"/>
    <id>https://wzes.github.io/2019/08/04/JavaScript/Babel Loader/</id>
    <published>2019-08-04T05:42:00.000Z</published>
    <updated>2019-09-02T12:14:06.673Z</updated>
    
    <content type="html"><![CDATA[<h3 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h3><p>çªç„¶è§‰å¾— babel-loader <a href="https://github.com/babel/babel-loader" target="_blank" rel="noopener">https://github.com/babel/babel-loader</a> å¾ˆå¥½ç©ï¼Œæ¯”è¾ƒè´´è¿‘ASTï¼Œç„¶è€Œç¼–è¯‘åŸç†ä¸€ç›´æ˜¯å™©æ¢¦ï¼Œæ²¡å­¦æ‡‚ï¼Œå¥½åœ¨è¿™ä¸œè¥¿ä¸éœ€è¦ä»€ä¹ˆç¼–è¯‘åŸç†çš„çŸ¥è¯†ã€‚ä½†è¿˜æ˜¯æ¶‰åŠåˆ°è¯­æ³•è§£æç­‰æ“ä½œï¼Œæ‰€ä»¥æ‹¿è¿‡æ¥å­¦ä¸€å­¦è¿˜æ˜¯æŒºå¥½çš„ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-babel"><a class="markdownIt-Anchor" href="#ä»€ä¹ˆæ˜¯-babel"></a> ä»€ä¹ˆæ˜¯ Babel</h3><p>Babel æ˜¯ä¸€ä¸ªå·¥å…·é“¾ï¼Œä¸»è¦ç”¨äºå°† ECMAScript 2015+ ä»£ç è½¬æ¢ä¸ºå½“å‰å’Œæ—§ç‰ˆæµè§ˆå™¨æˆ–ç¯å¢ƒä¸­çš„å‘åå…¼å®¹ç‰ˆæœ¬çš„ JavaScriptã€‚ ä»¥ä¸‹æ˜¯ Babel å¯ä»¥ä¸ºæ‚¨åšçš„ä¸»è¦äº‹æƒ…ï¼š</p><ul><li>è½¬æ¢è¯­æ³•</li><li>ç›®æ ‡ç¯å¢ƒä¸­ç¼ºå°‘PolyfillåŠŸèƒ½ï¼ˆé€šè¿‡@ babel / polyfillï¼‰æºä»£ç è½¬æ¢ï¼ˆcodemodsï¼‰</li><li>æ›´å¤š</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// Babel Input: ES2015 arrow function</span><br><span class="line">[1, 2, 3].map((n) =&gt; n + 1);</span><br><span class="line"></span><br><span class="line">// Babel Output: ES5 equivalent</span><br><span class="line">[1, 2, 3].map(function(n) &#123;</span><br><span class="line">  return n + 1;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ä»£ç è½¬åŒ–å°±æ¶‰åŠåˆ°äº†è¯­æ³•è§£æï¼Œè¿™ä¾¿æ˜¯æˆ‘ä»¬çš„é‡ç‚¹</p><h3 id="è‡ªå®šä¹‰"><a class="markdownIt-Anchor" href="#è‡ªå®šä¹‰"></a> è‡ªå®šä¹‰</h3><p>é¦–å…ˆæ–°å»ºä¸€ä¸ªé¡¹ç›® webpack é¡¹ç›® <a href="https://github.com/wzes/babel-demo" target="_blank" rel="noopener">babel-demo</a><br>ç›®å½•ç»“æ„å¦‚ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ README.md</span><br><span class="line">â”œâ”€â”€ babel-plugin-transform-class</span><br><span class="line">â”‚   â””â”€â”€ index.js</span><br><span class="line">â”œâ”€â”€ dist</span><br><span class="line">â”‚   â””â”€â”€ bundle.js</span><br><span class="line">â”œâ”€â”€ package-lock.json</span><br><span class="line">â”œâ”€â”€ package.json</span><br><span class="line">â”œâ”€â”€ src</span><br><span class="line">â”‚   â””â”€â”€ index.js</span><br><span class="line">â””â”€â”€ webpack.config.js</span><br></pre></td></tr></table></figure><p>æ–°å»º package.json å¹¶ä½¿ç”¨ npm install å®‰è£…æ‰€éœ€æ’ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -D babel-loader @babel/core @babel/preset-env webpack</span><br></pre></td></tr></table></figure><p><strong>package.json</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;scripts&quot;: &#123;</span><br><span class="line">    &quot;start&quot;: &quot;webpack&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;dependencies&quot;: &#123;&#125;,</span><br><span class="line">  &quot;devDependencies&quot;: &#123;</span><br><span class="line">    &quot;@babel/core&quot;: &quot;^7.5.5&quot;,</span><br><span class="line">    &quot;@babel/preset-env&quot;: &quot;^7.5.5&quot;,</span><br><span class="line">    &quot;babel-loader&quot;: &quot;^8.0.6&quot;,</span><br><span class="line">    &quot;webpack&quot;: &quot;^4.39.1&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ–°å»º webpack æ–‡ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">var path = require(&apos;path&apos;);</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">  entry: &apos;./src/index.js&apos;,</span><br><span class="line">  mode: &apos;development&apos;,</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.join(__dirname, &apos;dist&apos;),</span><br><span class="line">    filename: &apos;bundle.js&apos;</span><br><span class="line">  &#125;,</span><br><span class="line">  module: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: /\.js$/,</span><br><span class="line">        loader: &apos;babel-loader&apos;,</span><br><span class="line">        options: &#123;</span><br><span class="line">          plugins: [</span><br><span class="line">            &quot;transform-class&quot;</span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>module é‡Œé¢çš„ rule ä¾¿æ˜¯é…ç½®æˆ‘ä»¬è‡ªå®šä¹‰çš„ babel æ’ä»¶ï¼Œ<strong>transform-class</strong> æ˜¯æ’ä»¶åã€‚</p><h3 id="æ‰‹å†™æ’ä»¶"><a class="markdownIt-Anchor" href="#æ‰‹å†™æ’ä»¶"></a> æ‰‹å†™æ’ä»¶</h3><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„æ’ä»¶<br>babel-plugin-transform-class/index.js</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// A plugin is just a function</span><br><span class="line">module.exports = function (&#123; types: t &#125;) &#123;</span><br><span class="line">  return &#123;</span><br><span class="line">      visitor: &#123;</span><br><span class="line">          Identifier(path) &#123;</span><br><span class="line">            let name = path.node.name; // reverse the name: JavaScript -&gt; tpircSavaJ</span><br><span class="line">            path.node.name = name.split(&apos;&apos;).reverse().join(&apos;&apos;);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°† babel-plugin-transform-class æ–‡ä»¶å¤¹ç§»åŠ¨åˆ° node-modules ç›®å½•ä¸‹å³å¯ã€‚å½“è¿è¡Œ webpack çš„æ—¶å€™ï¼Œä¾¿ä¼šè¿è¡Œè¿™ä¸ªæ’ä»¶ï¼Œè¿™ä¸ªæ’ä»¶ä¼šæŠŠ node çš„ name åšåè½¬ã€‚</p><p>æˆ‘ä»¬çš„ demo</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">function babel() &#123;</span><br><span class="line">  let javascript = &apos;hello babel&apos;;</span><br><span class="line">  console.log(javascript);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰“åŒ…å</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eval(&quot;function lebab() &#123;\n  let tpircsavaj = &apos;hello babel&apos;;\n  elosnoc.gol(tpircsavaj);\n&#125;\n\n//# sourceURL=webpack:///./src/index.js?&quot;);</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹åˆ°å˜é‡åéƒ½åè½¬äº†ã€‚</p><p>æˆ‘ä»¬è¿˜å¯ä»¥å®ç°æ›´å¤šÂ·Â·Â·Â·Â·æ›´å¤šå±æ€§ï¼Œæ–¹æ³•åœ¨è¿™é‡Œ <a href="https://babeljs.io/docs/en/next/babel-types.html" target="_blank" rel="noopener">https://babeljs.io/docs/en/next/babel-types.html</a></p><h3 id="å‚è€ƒ"><a class="markdownIt-Anchor" href="#å‚è€ƒ"></a> å‚è€ƒ</h3><p>AST <a href="https://astexplorer.net/" target="_blank" rel="noopener">https://astexplorer.net/</a></p>]]></content>
    
    <summary type="html">
    
      çªç„¶è§‰å¾— babel-loader å¾ˆå¥½ç©ï¼Œæ¯”è¾ƒè´´è¿‘ASTï¼Œç„¶è€Œç¼–è¯‘åŸç†ä¸€ç›´æ˜¯å™©æ¢¦ï¼Œæ²¡å­¦æ‡‚ï¼Œå¥½åœ¨è¿™ä¸œè¥¿ä¸éœ€è¦ä»€ä¹ˆç¼–è¯‘åŸç†çš„çŸ¥è¯†ã€‚ä½†è¿˜æ˜¯æ¶‰åŠåˆ°è¯­æ³•è§£æç­‰æ“ä½œï¼Œæ‰€ä»¥æ‹¿è¿‡æ¥å­¦ä¸€å­¦è¿˜æ˜¯æŒºå¥½çš„
    
    </summary>
    
      <category term="JavaScript" scheme="https://wzes.github.io/categories/JavaScript/"/>
    
    
      <category term="JavaScript" scheme="https://wzes.github.io/tags/JavaScript/"/>
    
      <category term="Babel" scheme="https://wzes.github.io/tags/Babel/"/>
    
      <category term="Node" scheme="https://wzes.github.io/tags/Node/"/>
    
  </entry>
  
  <entry>
    <title>React Lazyload æºç è§£æ</title>
    <link href="https://wzes.github.io/2019/07/28/JavaScript/React%20Lazyload/"/>
    <id>https://wzes.github.io/2019/07/28/JavaScript/React Lazyload/</id>
    <published>2019-07-28T03:59:00.000Z</published>
    <updated>2019-09-02T12:17:04.380Z</updated>
    
    <content type="html"><![CDATA[<h3 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h3><p>æ—©åœ¨å¤šå¹´å‰ï¼Œlazyload å·²ç»å‡ºç°äº†ï¼Œæ‡’åŠ è½½åœ¨å‰ç«¯é‡Œè¾¹åŒæ ·å…·æœ‰ååˆ†é‡è¦çš„æ„ä¹‰ã€‚react-lazyload çš„ä½œç”¨æ˜¯å½“ç»„ä»¶æœªå‡ºç°åœ¨å±å¹•å†…æ—¶ï¼Œä¸å»æŒ‚è½½è¯¥ç»„ä»¶ï¼Œè€Œæ˜¯ä½¿ç”¨ placeholder å»æ¸²æŸ“ï¼Œè®©æ»šåŠ¨ä½¿å†…å®¹å‡ºç°åï¼Œç»„ä»¶ä¼šè¢«æŒ‚è½½ã€‚å°±æ˜¯è¿™ä¹ˆç®€å•ï¼ä¾‹å¦‚ï¼Œä¸€ä¸ªå¤æ‚çš„ç»„ä»¶ï¼ˆéé¦–å±å†…å®¹ï¼‰ï¼Œä½¿ç”¨äº†æ‡’åŠ è½½åï¼Œæ¸²æŸ“é¦–å±å°±ä¼šèŠ‚çœå¾ˆå¤šèµ„æºï¼Œä»è€Œå‡å°‘é¦–å±æ¸²æŸ“æ—¶é—´ã€‚</p><h3 id="demo"><a class="markdownIt-Anchor" href="#demo"></a> Demo</h3><p>æºç åœ°å€ <a href="https://github.com/twobin/react-lazyload" target="_blank" rel="noopener">react-lazyload</a><br>Demoåœ°å€ <a href="https://twobin.github.io/react-lazyload/examples/" target="_blank" rel="noopener">Demo</a></p><h4 id="helloworld"><a class="markdownIt-Anchor" href="#helloworld"></a> HelloWorld</h4><p>å°†éœ€è¦æ‡’åŠ è½½çš„ç»„ä»¶ä½¿ç”¨ LazyLoad åŒ…è£¹å³å¯ï¼Œæœ€å¥½ä½¿ç”¨ height è¿›è¡Œç«™ä½ï¼Œå¦åˆ™è¯¥ç»„ä»¶ä½ç½®å°†ä¼šä¸º 0</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;LazyLoad height=&#123;200&#125;&gt;</span><br><span class="line">    &lt;img src=&quot;tiger.jpg&quot; /&gt; /*</span><br><span class="line">                              Lazy loading images is supported out of box,</span><br><span class="line">                              no extra config needed, set `height` for better</span><br><span class="line">                              experience</span><br><span class="line">                             */</span><br><span class="line">  &lt;/LazyLoad&gt;</span><br></pre></td></tr></table></figure><h3 id="è§£æ"><a class="markdownIt-Anchor" href="#è§£æ"></a> è§£æ</h3><p>ä»æºç è§’åº¦åˆ†æï½</p><h4 id="ä¸€è§ˆæ ¸å¿ƒ"><a class="markdownIt-Anchor" href="#ä¸€è§ˆæ ¸å¿ƒ"></a> ä¸€è§ˆæ ¸å¿ƒ</h4><p>æœ¬å°èŠ‚æ‘˜å–äº†æœ€æ ¸å¿ƒçš„ä»£ç ï¼Œç›®çš„åœ¨äºå¯¹ LazyLoad ç»„ä»¶æœ‰ä¸ªæœ€æ ¸å¿ƒçš„è®¤è¯†ï¼Œå®ƒçš„æ ¸å¿ƒå°±æ˜¯ç›‘å¬æ»šåŠ¨äº‹ä»¶ï¼Œæ£€æŸ¥ç»„ä»¶æ˜¯å¦åœ¨å±å¹•å†…ï¼Œå¦‚æœåœ¨çš„è¯å°±æ˜¾ç¤ºï¼Œä¸åœ¨çš„è¯å°±ä¸æ˜¾ç¤ºï½</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">class LazyLoad extends Component &#123;</span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">   on(scrollport, &apos;scroll&apos;, finalLazyLoadHandler, passiveEvent);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    return this.visible ?</span><br><span class="line">           this.props.children :</span><br><span class="line">             this.props.placeholder ?</span><br><span class="line">                this.props.placeholder :</span><br><span class="line">                &lt;div style=&#123;&#123; height: this.props.height &#125;&#125; className=&quot;lazyload-placeholder&quot; ref=&#123;this.setRef&#125; /&gt;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>LazyLoad çš„å±æ€§ï¼Œé€è¿‡å±æ€§ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“å®ƒå¤§æ¦‚æœ‰äº›ä»€ä¹ˆåŠŸèƒ½ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">LazyLoad.propTypes = &#123;</span><br><span class="line">  once: PropTypes.bool,</span><br><span class="line">  height: PropTypes.oneOfType([PropTypes.number, PropTypes.string]),</span><br><span class="line">  offset: PropTypes.oneOfType([PropTypes.number, PropTypes.arrayOf(PropTypes.number)]),</span><br><span class="line">  overflow: PropTypes.bool, // ä¸æ˜¯ window æ»šåŠ¨ï¼Œè€Œä½¿ç”¨äº† overflow: scroll </span><br><span class="line">  resize: PropTypes.bool, // æ˜¯å¦ç›‘å¬ resize</span><br><span class="line">  scroll: PropTypes.bool, // æ˜¯å¦ç›‘å¬æ»šåŠ¨</span><br><span class="line">  children: PropTypes.node,</span><br><span class="line">  throttle: PropTypes.oneOfType([PropTypes.number, PropTypes.bool]),</span><br><span class="line">  debounce: PropTypes.oneOfType([PropTypes.number, PropTypes.bool]),</span><br><span class="line">  placeholder: PropTypes.node,</span><br><span class="line">  scrollContainer: PropTypes.oneOfType([PropTypes.string, PropTypes.object]),</span><br><span class="line">  unmountIfInvisible: PropTypes.bool,</span><br><span class="line">  preventLoading: PropTypes.bool</span><br><span class="line">&#125;;</span><br><span class="line">// é»˜è®¤å€¼</span><br><span class="line">LazyLoad.defaultProps = &#123;</span><br><span class="line">  once: false,</span><br><span class="line">  offset: 0,</span><br><span class="line">  overflow: false,</span><br><span class="line">  resize: false,</span><br><span class="line">  scroll: true,</span><br><span class="line">  unmountIfInvisible: false,</span><br><span class="line">  preventLoading: false,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å®Œæ•´çš„ componentDidMountï¼Œscrollport æ˜¯æ»šåŠ¨è¯•å›¾ï¼Œé»˜è®¤æ˜¯ windowï¼Œå¦‚æœ props ä¼ å…¥äº† scrollContainerï¼Œé‚£ä¹ˆæ»šåŠ¨è¯•å›¾å°†æ˜¯è‡ªå®šä¹‰çš„ã€‚needResetFinalLazyLoadHandler æ˜¯æ§åˆ¶æ˜¯å¦é‡ç½®æ»šåŠ¨ç›‘å¬ã€‚debounce å’Œ throttle åˆ†åˆ«æ˜¯ç”¨æ¥æ§åˆ¶æ»šåŠ¨äº‹ä»¶çš„ç›‘å¬è§¦å‘é¢‘ç‡ï¼Œé»˜è®¤éƒ½æ˜¯ undefineï¼ŒneedResetFinalLazyLoadHandler åˆå§‹å€¼ä¸º falseã€‚finalLazyLoadHandler åˆå§‹å€¼ä¹Ÿä¸º undefineï¼Œè€Œ overflow ä¹Ÿä¸º falseï¼Œscroll ä¸º trueï¼Œlisteners æ˜¯éœ€è¦æ‡’åŠ è½½çš„ç»„ä»¶é›†åˆï¼Œåˆå§‹å¤§å°è‚¯å®šä¸º0ï¼ŒcomponentDidMount æœ€åæ‰ä¼šè¿›è¡Œæ·»åŠ ï¼Œå› æ­¤æœ€ç»ˆä¼šèµ°åˆ° **on(scrollport, â€˜scrollâ€™, finalLazyLoadHandler, passiveEvent)ï¼Œäº‹ä»¶åªéœ€è¦ä¸€æ¬¡ç»‘å®šå³å¯ã€‚<br>**</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">componentDidMount() &#123;</span><br><span class="line">    // It&apos;s unlikely to change delay type on the fly, this is mainly</span><br><span class="line">    // designed for tests</span><br><span class="line">    let scrollport = window;</span><br><span class="line">    const &#123;</span><br><span class="line">      scrollContainer,</span><br><span class="line">    &#125; = this.props;</span><br><span class="line">    if (scrollContainer) &#123;</span><br><span class="line">      if (isString(scrollContainer)) &#123;</span><br><span class="line">        scrollport = scrollport.document.querySelector(scrollContainer);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    const needResetFinalLazyLoadHandler = (this.props.debounce !== undefined &amp;&amp; delayType === &apos;throttle&apos;)</span><br><span class="line">      || (delayType === &apos;debounce&apos; &amp;&amp; this.props.debounce === undefined);</span><br><span class="line"></span><br><span class="line">    if (needResetFinalLazyLoadHandler) &#123;</span><br><span class="line">      off(scrollport, &apos;scroll&apos;, finalLazyLoadHandler, passiveEvent);</span><br><span class="line">      off(window, &apos;resize&apos;, finalLazyLoadHandler, passiveEvent);</span><br><span class="line">      finalLazyLoadHandler = null;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (!finalLazyLoadHandler) &#123;</span><br><span class="line">      if (this.props.debounce !== undefined) &#123;</span><br><span class="line">        finalLazyLoadHandler = debounce(lazyLoadHandler, typeof this.props.debounce === &apos;number&apos; ?</span><br><span class="line">                                                         this.props.debounce :</span><br><span class="line">                                                         300);</span><br><span class="line">        delayType = &apos;debounce&apos;;</span><br><span class="line">      &#125; else if (this.props.throttle !== undefined) &#123;</span><br><span class="line">        finalLazyLoadHandler = throttle(lazyLoadHandler, typeof this.props.throttle === &apos;number&apos; ?</span><br><span class="line">                                                         this.props.throttle :</span><br><span class="line">                                                         300);</span><br><span class="line">        delayType = &apos;throttle&apos;;</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        finalLazyLoadHandler = lazyLoadHandler;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (this.props.overflow) &#123;</span><br><span class="line">      const parent = scrollParent(this.ref);</span><br><span class="line">      if (parent &amp;&amp; typeof parent.getAttribute === &apos;function&apos;) &#123;</span><br><span class="line">        const listenerCount = 1 + (+parent.getAttribute(LISTEN_FLAG));</span><br><span class="line">        if (listenerCount === 1) &#123;</span><br><span class="line">          parent.addEventListener(&apos;scroll&apos;, finalLazyLoadHandler, passiveEvent);</span><br><span class="line">        &#125;</span><br><span class="line">        parent.setAttribute(LISTEN_FLAG, listenerCount);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; else if (listeners.length === 0 || needResetFinalLazyLoadHandler) &#123;</span><br><span class="line">      const &#123; scroll, resize &#125; = this.props;</span><br><span class="line"></span><br><span class="line">      if (scroll) &#123;</span><br><span class="line">        on(scrollport, &apos;scroll&apos;, finalLazyLoadHandler, passiveEvent);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      if (resize) &#123;</span><br><span class="line">        on(window, &apos;resize&apos;, finalLazyLoadHandler, passiveEvent);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    listeners.push(this);</span><br><span class="line">    checkVisible(this);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>é€šå¸¸ finalLazyLoadHandler å°±æ˜¯ lazyLoadHandlerï¼Œä¸ä¼šå¯¹æ»šåŠ¨äº‹ä»¶è¿›è¡Œ debounce æˆ– throttleï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¸ºäº†æ€§èƒ½ï¼Œä¼šä½¿ç”¨ throttle è¿›è¡Œå¤„ç†ã€‚å‡½æ•°ä¼šå¯¹æ¯ä¸€ä¸ªæ‡’åŠ è½½ç»„ä»¶è¿›è¡Œ checkVisibleï¼Œä¹‹åä¼šç§»é™¤ once component</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">const lazyLoadHandler = () =&gt; &#123;</span><br><span class="line">  for (let i = 0; i &lt; listeners.length; ++i) &#123;</span><br><span class="line">    const listener = listeners[i];</span><br><span class="line">    checkVisible(listener);</span><br><span class="line">  &#125;</span><br><span class="line">  // Remove `once` component in listeners</span><br><span class="line">  purgePending();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>checkVisibleï¼Œæ£€æŸ¥ç»„ä»¶æ˜¯å¦å‡ºç°åœ¨ viewport ä¸­ï¼Œå¦‚æœå‡ºç°äº†å°±å§ visible è®¾ç½®ä¸º trueï¼Œå½“ç„¶å¦‚æœè®¾ç½®äº† unmountIfInvisible = trueï¼Œé‚£ä¹ˆä¸å¯è§æ—¶ç»„ä»¶å°†è¢«ç§»é™¤ï¼Œå¦‚æœä¹‹å‰å·²ç»æ¸²æŸ“äº†ï¼Œéœ€è¦é¿å…å†æ¬¡æ¸²æŸ“ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">const checkVisible = function checkVisible(component) &#123;</span><br><span class="line">  const node = component.ref;</span><br><span class="line">  if (!(node instanceof HTMLElement)) &#123;</span><br><span class="line">    return;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  const parent = scrollParent(node);</span><br><span class="line">  const isOverflow = component.props.overflow &amp;&amp;</span><br><span class="line">                     parent !== node.ownerDocument &amp;&amp;</span><br><span class="line">                     parent !== document &amp;&amp;</span><br><span class="line">                     parent !== document.documentElement;</span><br><span class="line">  const visible = isOverflow ?</span><br><span class="line">                  checkOverflowVisible(component, parent) :</span><br><span class="line">                  checkNormalVisible(component);</span><br><span class="line">  if (visible) &#123;</span><br><span class="line">    // Avoid extra render if previously is visible</span><br><span class="line">    if (!component.visible &amp;&amp; !component.preventLoading) &#123;</span><br><span class="line">      if (component.props.once) &#123;</span><br><span class="line">        pending.push(component);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      component.visible = true;</span><br><span class="line">      component.forceUpdate();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; else if (!(component.props.once &amp;&amp; component.visible)) &#123;</span><br><span class="line">    component.visible = false;</span><br><span class="line">    if (component.props.unmountIfInvisible) &#123;</span><br><span class="line">      component.forceUpdate();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>checkNormalVisible æ£€æŸ¥ç»„ä»¶æ˜¯å¦ visible çš„å‡½æ•°ï¼Œåˆ¤æ–­ç»„ä»¶çš„getgetBoundingClientRect çš„ top - offsetï¼ˆç›¸å¯¹äºå±å¹•é¡¶éƒ¨çš„è·ç¦»ï¼‰ ä¸ window çš„ height ä¹‹é—´çš„å…³ç³»</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">const checkNormalVisible = function checkNormalVisible(component) &#123;</span><br><span class="line">  const node = component.ref;</span><br><span class="line"></span><br><span class="line">  // If this element is hidden by css rules somehow, it&apos;s definitely invisible</span><br><span class="line">  if (!(node.offsetWidth || node.offsetHeight || node.getClientRects().length)) return false;</span><br><span class="line"></span><br><span class="line">  let top;</span><br><span class="line">  let elementHeight;</span><br><span class="line"></span><br><span class="line">  try &#123;</span><br><span class="line">    // è¿™ä¸ªè¯­æ³• node ä¹Ÿæ˜¯æ”¯æŒçš„</span><br><span class="line">    (&#123; top, height: elementHeight &#125; = node.getBoundingClientRect());</span><br><span class="line">  &#125; catch (e) &#123;</span><br><span class="line">    (&#123; top, height: elementHeight &#125; = defaultBoundingClientRect);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  const windowInnerHeight = window.innerHeight || document.documentElement.clientHeight;</span><br><span class="line"></span><br><span class="line">  const offsets = Array.isArray(component.props.offset) ?</span><br><span class="line">                component.props.offset :</span><br><span class="line">                [component.props.offset, component.props.offset]; // Be compatible with previous API</span><br><span class="line"></span><br><span class="line">  return (top - offsets[0] &lt;= windowInnerHeight) &amp;&amp;</span><br><span class="line">         (top + elementHeight + offsets[1] &gt;= 0);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(top - offsets[0] &lt;= windowInnerHeight) &amp;&amp;</span><br><span class="line">         (top + elementHeight + offsets[1] &gt;= 0);</span><br></pre></td></tr></table></figure><p>ä¸€å¼ å›¾è§£æï¼<br><img src="https://upload-images.jianshu.io/upload_images/7117641-a10f694d96109cc4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/640" alt="check visible example"><br>åˆ°è¿™é‡Œè§£æçš„å·®ä¸å¤šäº†</p><p>æ¬£èµä¸€ä¸‹ throttle</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">export default function throttle(fn, threshhold, scope) &#123;</span><br><span class="line">  threshhold || (threshhold = 250);</span><br><span class="line">  var last,</span><br><span class="line">      deferTimer;</span><br><span class="line">  return function () &#123;</span><br><span class="line">    var context = scope || this;</span><br><span class="line"></span><br><span class="line">    var now = +new Date,</span><br><span class="line">        args = arguments;</span><br><span class="line">    if (last &amp;&amp; now &lt; last + threshhold) &#123;</span><br><span class="line">      // hold on to it</span><br><span class="line">      clearTimeout(deferTimer);</span><br><span class="line">      deferTimer = setTimeout(function () &#123;</span><br><span class="line">        last = now;</span><br><span class="line">        fn.apply(context, args);</span><br><span class="line">      &#125;, threshhold);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      last = now;</span><br><span class="line">      fn.apply(context, args);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†æ¬£èµä¸€ä¸‹ debounce</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">export default function debounce(func, wait, immediate) &#123;</span><br><span class="line">  let timeout;</span><br><span class="line">  let args;</span><br><span class="line">  let context;</span><br><span class="line">  let timestamp;</span><br><span class="line">  let result;</span><br><span class="line"></span><br><span class="line">  const later = function later() &#123;</span><br><span class="line">    const last = +(new Date()) - timestamp;</span><br><span class="line"></span><br><span class="line">    if (last &lt; wait &amp;&amp; last &gt;= 0) &#123;</span><br><span class="line">      timeout = setTimeout(later, wait - last);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      timeout = null;</span><br><span class="line">      if (!immediate) &#123;</span><br><span class="line">        result = func.apply(context, args);</span><br><span class="line">        if (!timeout) &#123;</span><br><span class="line">          context = null;</span><br><span class="line">          args = null;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  return function debounced() &#123;</span><br><span class="line">    context = this;</span><br><span class="line">    args = arguments;</span><br><span class="line">    timestamp = +(new Date());</span><br><span class="line"></span><br><span class="line">    const callNow = immediate &amp;&amp; !timeout;</span><br><span class="line">    if (!timeout) &#123;</span><br><span class="line">      timeout = setTimeout(later, wait);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (callNow) &#123;</span><br><span class="line">      result = func.apply(context, args);</span><br><span class="line">      context = null;</span><br><span class="line">      args = null;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return result;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è·å– scrollParent</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">export default (node) =&gt; &#123;</span><br><span class="line">  if (!(node instanceof HTMLElement)) &#123;</span><br><span class="line">    return document.documentElement;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  const excludeStaticParent = node.style.position === &apos;absolute&apos;;</span><br><span class="line">  const overflowRegex = /(scroll|auto)/;</span><br><span class="line">  let parent = node;</span><br><span class="line"></span><br><span class="line">  while (parent) &#123;</span><br><span class="line">    if (!parent.parentNode) &#123;</span><br><span class="line">      return node.ownerDocument || document.documentElement;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    const style = window.getComputedStyle(parent);</span><br><span class="line">    const position = style.position;</span><br><span class="line">    const overflow = style.overflow;</span><br><span class="line">    const overflowX = style[&apos;overflow-x&apos;];</span><br><span class="line">    const overflowY = style[&apos;overflow-y&apos;];</span><br><span class="line"></span><br><span class="line">    if (position === &apos;static&apos; &amp;&amp; excludeStaticParent) &#123;</span><br><span class="line">      parent = parent.parentNode;</span><br><span class="line">      continue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (overflowRegex.test(overflow) &amp;&amp; overflowRegex.test(overflowX) &amp;&amp; overflowRegex.test(overflowY)) &#123;</span><br><span class="line">      return parent;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    parent = parent.parentNode;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return node.ownerDocument || node.documentElement || document.documentElement;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="æ€»ç»“æ€è€ƒ"><a class="markdownIt-Anchor" href="#æ€»ç»“æ€è€ƒ"></a> æ€»ç»“æ€è€ƒ</h3><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒLazyload å¹¶ä¸èƒ½å®ç°ç±»ä¼¼å®¢æˆ·ç«¯çš„å›¾ç‰‡æ‡’åŠ è½½ï¼ŒLazyload åŠ è½½å›¾ç‰‡ä¹Ÿä¼šå‡ºç°ç™½å±æ—¶é—´ï¼Œè§£å†³åŠæ³•æ˜¯ä½¿ç”¨ <a href="https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XUL/Attribute/image.onload" target="_blank" rel="noopener">image.onload</a>ï¼Œå½“å›¾ç‰‡èµ„æºè¯·æ±‚å…³é—­åï¼Œå†æ˜¾ç¤ºå›¾ç‰‡ï¼Œå°±å¯ä»¥åšåˆ°ç±»ä¼¼å®¢æˆ·ç«¯çš„æ•ˆæœã€‚</p>]]></content>
    
    <summary type="html">
    
      æ—©åœ¨å¤šå¹´å‰ï¼Œlazyload å·²ç»å‡ºç°äº†ï¼Œæ‡’åŠ è½½åœ¨å‰ç«¯é‡Œè¾¹åŒæ ·å…·æœ‰ååˆ†é‡è¦çš„æ„ä¹‰ã€‚react-lazyload çš„ä½œç”¨æ˜¯å½“ç»„ä»¶æœªå‡ºç°åœ¨å±å¹•å†…æ—¶ï¼Œä¸å»æŒ‚è½½è¯¥ç»„ä»¶ï¼Œè€Œæ˜¯ä½¿ç”¨ placeholder å»æ¸²æŸ“ï¼Œè®©æ»šåŠ¨ä½¿å†…å®¹å‡ºç°åï¼Œç»„ä»¶ä¼šè¢«æŒ‚è½½ã€‚å°±æ˜¯è¿™ä¹ˆç®€å•ï¼
    
    </summary>
    
      <category term="JavaScript" scheme="https://wzes.github.io/categories/JavaScript/"/>
    
    
      <category term="JavaScript" scheme="https://wzes.github.io/tags/JavaScript/"/>
    
      <category term="React" scheme="https://wzes.github.io/tags/React/"/>
    
      <category term="Lazyload" scheme="https://wzes.github.io/tags/Lazyload/"/>
    
  </entry>
  
  <entry>
    <title>JavaScript Swipe-js-ios æºç è§£æ</title>
    <link href="https://wzes.github.io/2019/07/20/JavaScript/Swipe-js-ios/"/>
    <id>https://wzes.github.io/2019/07/20/JavaScript/Swipe-js-ios/</id>
    <published>2019-07-20T06:38:00.000Z</published>
    <updated>2019-09-02T12:16:32.909Z</updated>
    
    <content type="html"><![CDATA[<h3 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h3><p>Swipeï¼Œå¸¸ç”¨æ¥åšè½®æ’­å›¾ï¼Œéœ€è¦ç¿»é¡µçš„åœºæ™¯ï¼Œæœ€ç»å…¸çš„å¼€æºåº“ <a href="https://github.com/voronianski/swipe-js-iso" target="_blank" rel="noopener">swipe-js-iso</a> ï¼Œä¸è¿‡æ›´æ¨èä½¿ç”¨ React ç»„ä»¶ <a href="https://github.com/voronianski/react-swipe" target="_blank" rel="noopener">react-swipe</a>ï¼Œå®ƒå°è£…äº† swipe-js-ios  ç»„ä»¶ï¼Œè€Œ swipe-js-ios ç»„ä»¶åˆ™å°è£…äº† <a href="https://github.com/thebird/Swipe" target="_blank" rel="noopener">Swipe</a></p><h3 id="helloword"><a class="markdownIt-Anchor" href="#helloword"></a> HelloWord</h3><p><img src="https://upload-images.jianshu.io/upload_images/7117641-de83b4953b2ad82f.gif?imageMogr2/auto-orient/strip%7CimageView2/2/w/620" alt="ReactSwipe"></p><p>å¦‚æœå•ç‹¬ä½¿ç”¨çš„åŒ–ï¼Œåˆ›å»ºä¸€ä¸ª swipeï¼Œdom å¿…é¡»æ˜¯ä¸‰å±‚ç»“æ„ï¼Œæœ€é‡Œé¢ä¸€å±‚æ˜¯æ”¾ slide çš„ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=&quot;slider&quot; class=&quot;swipe&quot;&gt;</span><br><span class="line">  &lt;div class=&quot;swipe-wrap&quot;&gt;</span><br><span class="line">    &lt;div&gt;&lt;/div&gt;</span><br><span class="line">    &lt;div&gt;&lt;/div&gt;</span><br><span class="line">    &lt;div&gt;&lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><p>CSS å­å…ƒç´  <strong>float: left;</strong> container çš„å®½åº¦ä¸ºè‡ªå®šä¹‰ï¼Œswipe-wrap çš„å®½åº¦ä¸ºå­é¡µé¢æ•° * container çš„ widthï¼Œæ¯ä¸€ä¸ª slide çš„å®½åº¦ä¸º container çš„ width</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">.swipe &#123;</span><br><span class="line">  overflow: hidden;</span><br><span class="line">  visibility: hidden;</span><br><span class="line">  position: relative;</span><br><span class="line">&#125;</span><br><span class="line">.swipe-wrap &#123;</span><br><span class="line">  overflow: hidden;</span><br><span class="line">  position: relative;</span><br><span class="line">&#125;</span><br><span class="line">.swipe-wrap &gt; div &#123;</span><br><span class="line">  float: left;</span><br><span class="line">  width: 100%;</span><br><span class="line">  position: relative;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>load ä»¥åï¼Œåˆ›å»º Swipe å³å¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const mySwipe = Swipe(document.getElementById(&apos;slider&apos;));</span><br></pre></td></tr></table></figure><h3 id="æºç è§£æ"><a class="markdownIt-Anchor" href="#æºç è§£æ"></a> æºç è§£æ</h3><p>swipe-js-ios ä½¿ç”¨ç«‹å³å‡½æ•°å¯¼å‡ºäº†ä¸€ä¸ª Swipe æ¨¡å—ï¼Œä½¿ç”¨ <strong>typeof module !== â€˜undefinedâ€™ &amp;&amp; module.exports</strong> å…¼å®¹ Node å’Œ æµè§ˆå™¨ç¯å¢ƒï¼Œå¦‚æœæ˜¯ Node ç¯å¢ƒï¼Œå°†ä¼šæœ‰ module.export é‚£ä¹ˆåˆ™ä½¿ç”¨ module.export å¯¼å‡ºï¼Œå¦åˆ™ä½¿ç”¨ root.Swipe å…¨å±€å˜é‡å¯¼å‡º</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">(function(root, factory) &#123;</span><br><span class="line">  if (typeof module !== &apos;undefined&apos; &amp;&amp; module.exports) &#123;</span><br><span class="line">    module.exports = factory();</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    root.Swipe = factory();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)(this, function() &#123;</span><br><span class="line">  &apos;use strict&apos;;</span><br><span class="line">  return function Swipe(container, options) &#123;</span><br><span class="line">        ....</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>æ£€æŸ¥æµè§ˆå™¨çš„ç¯å¢ƒï¼Œç®—æ˜¯ä¸€ç§è§„èŒƒå§ï¼Œé£åˆ«æ£€æŸ¥è§¦æ‘¸äº‹ä»¶å’Œ transition çš„æ”¯æŒ<br>âš ï¸åœ¨æµè§ˆå™¨ï¼Œæ‰‹æœºæ¨¡å¼ä¸‹ï¼Œè§¦æ‘¸äº‹ä»¶æ˜¯å­˜åœ¨çš„ï¼Œè€Œæ™®é€šæµè§ˆå™¨ä¸‹æ˜¯ä¸å­˜åœ¨çš„ï¼Œæ‰€ä»¥è¯¥ç»„ä»¶ä¸èƒ½åœ¨æ™®é€šæµè§ˆå™¨ä¸­ä½¿ç”¨ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">var browser = &#123;</span><br><span class="line">      addEventListener: !!window.addEventListener,</span><br><span class="line">      touch:</span><br><span class="line">        &apos;ontouchstart&apos; in window ||</span><br><span class="line">        (window.DocumentTouch &amp;&amp; document instanceof window.DocumentTouch),</span><br><span class="line">      transitions: (function(temp) &#123;</span><br><span class="line">        var props = [</span><br><span class="line">          &apos;transitionProperty&apos;,</span><br><span class="line">          &apos;WebkitTransition&apos;,</span><br><span class="line">          &apos;MozTransition&apos;,</span><br><span class="line">          &apos;OTransition&apos;,</span><br><span class="line">          &apos;msTransition&apos;</span><br><span class="line">        ];</span><br><span class="line">        for (var i in props)</span><br><span class="line">          if (temp.style[props[i]] !== undefined) return true;</span><br><span class="line">        return false;</span><br><span class="line">      &#125;)(document.createElement(&apos;swipe&apos;))</span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure><p>åˆ›å»ºæ—¶ä¼šè°ƒç”¨ setupï¼Œç»§è€Œæ·»åŠ äº‹ä»¶ï¼Œtouch è§¦æ‘¸äº‹ä»¶ã€transitionend ç§»åŠ¨äº‹ä»¶ï¼Œresize é‡æ–°å¸ƒå±€äº‹ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">// trigger setup</span><br><span class="line">setup();</span><br><span class="line"></span><br><span class="line">// start auto slideshow if applicable</span><br><span class="line">if (delay) begin();</span><br><span class="line"></span><br><span class="line">// add event listeners</span><br><span class="line">if (browser.addEventListener) &#123;</span><br><span class="line">  // set touchstart event on element</span><br><span class="line">  if (browser.touch) &#123;</span><br><span class="line">    element.addEventListener(&apos;touchstart&apos;, events, false);</span><br><span class="line">    element.addEventListener(&apos;touchforcechange&apos;, function() &#123;&#125;, false);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  if (browser.transitions) &#123;</span><br><span class="line">    element.addEventListener(&apos;webkitTransitionEnd&apos;, events, false);</span><br><span class="line">    element.addEventListener(&apos;msTransitionEnd&apos;, events, false);</span><br><span class="line">    element.addEventListener(&apos;oTransitionEnd&apos;, events, false);</span><br><span class="line">    element.addEventListener(&apos;otransitionend&apos;, events, false);</span><br><span class="line">    element.addEventListener(&apos;transitionend&apos;, events, false);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // set resize event on window</span><br><span class="line">  window.addEventListener(&apos;resize&apos;, events, false);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">  window.onresize = function() &#123;</span><br><span class="line">    setup();</span><br><span class="line">  &#125;; // to play nice with old IE</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>setup å‡½æ•°çš„å®ç°ï¼Œslides å°±æ˜¯å®¹å™¨é‡Œé¢çš„é¡µé¢ï¼Œcontinuous æ˜¯å¦è‡ªåŠ¨è½®æ’­ï¼ŒslidePos è®°å½•äº†æ¯ä¸€ä¸ªé¡µé¢çš„ä½ç½®ï¼Œwidth æ˜¯æ¯ä¸€ä¸ªé¡µé¢çš„å®½åº¦ï¼Œæ­¤å¤„éœ€è¦å‰ªæ‰widthOfSiblingSlidePreview çš„å¤§å°ï¼Œå¯ä»¥é¢„è§ˆå‰åé¡µã€‚element çš„å®½åº¦æ˜¯ **é¡µæ•° * width **</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">function setup() &#123;</span><br><span class="line">      // cache slides</span><br><span class="line">      slides = element.children;</span><br><span class="line">      length = slides.length;</span><br><span class="line"></span><br><span class="line">      // set continuous to false if only one slide</span><br><span class="line">      continuous = slides.length &lt; 2 ? false : options.continuous;</span><br><span class="line"></span><br><span class="line">      // create an array to store current positions of each slide</span><br><span class="line">      slidePos = new Array(slides.length);</span><br><span class="line"></span><br><span class="line">      // determine width of each slide</span><br><span class="line">      width =</span><br><span class="line">        Math.round(</span><br><span class="line">          container.getBoundingClientRect().width || container.offsetWidth</span><br><span class="line">        ) -</span><br><span class="line">        widthOfSiblingSlidePreview * 2;</span><br><span class="line"></span><br><span class="line">      element.style.width = slides.length * width + &apos;px&apos;;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>åˆå§‹åŒ–æ—¶ï¼Œéœ€è¦æ›´æ–°é¡µé¢çš„ä½ç½®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">var pos = slides.length;</span><br><span class="line">while (pos--) &#123;</span><br><span class="line">  var slide = slides[pos];</span><br><span class="line"></span><br><span class="line">  slide.style.width = width + &apos;px&apos;;</span><br><span class="line">  slide.setAttribute(&apos;data-index&apos;, pos);</span><br><span class="line"></span><br><span class="line">  if (browser.transitions) &#123;</span><br><span class="line">    slide.style.left = pos * -width + widthOfSiblingSlidePreview + &apos;px&apos;;</span><br><span class="line">    move(pos, index &gt; pos ? -width : index &lt; pos ? width : 0, 0);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæ”¯æŒè½®æ’­çš„åŒ–ï¼Œéœ€è¦æŠŠå·¦è¾¹å’Œå³è¾¹ä¹Ÿå¡«å……ï¼Œç„¶åæŠŠ container.style.visibility è®¾ç½®ä¸º visibleï¼Œå¦‚æœä¸æ”¯æŒ transition çš„è¯ï¼Œåªéœ€è¦è®¾ç½® element.style.left å³å¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// reposition elements before and after index</span><br><span class="line">    if (continuous &amp;&amp; browser.transitions) &#123;</span><br><span class="line">      move(circle(index - 1), -width, 0);</span><br><span class="line">      move(circle(index + 1), width, 0);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (!browser.transitions)</span><br><span class="line">      element.style.left = index * -width + widthOfSiblingSlidePreview + &apos;px&apos;;</span><br><span class="line"></span><br><span class="line">    container.style.visibility = &apos;visible&apos;;</span><br></pre></td></tr></table></figure><p>move çš„å®ç°ï¼Œtranslateï¼Œæ›´æ–° slidePos çš„ä½ç½®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">function move(index, dist, speed) &#123;</span><br><span class="line">  translate(index, dist, speed);</span><br><span class="line">  slidePos[index] = dist;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>translate ä¸‰ä¸ªå‚æ•°ï¼Œindexï¼šéœ€è¦ç§»åŠ¨çš„é¡µï¼Œdistï¼šç§»åŠ¨çš„ä½ç½®ï¼Œspeedï¼šç§»åŠ¨é€Ÿåº¦ï¼Œç§»åŠ¨åªéœ€è¦ç»™ é¡µé¢è®¾ç½® style çš„ transform å°±OKäº†ï¼Œä¹‹åå°±ä¼šä»¥åŠ¨ç”»ç§»åŠ¨è¿‡å»äº†</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">function translate(index, dist, speed) &#123;</span><br><span class="line">      var slide = slides[index];</span><br><span class="line">      var style = slide &amp;&amp; slide.style;</span><br><span class="line"></span><br><span class="line">      if (!style) return;</span><br><span class="line"></span><br><span class="line">      style.webkitTransitionDuration = style.MozTransitionDuration = style.msTransitionDuration = style.OTransitionDuration = style.transitionDuration =</span><br><span class="line">        speed + &apos;ms&apos;;</span><br><span class="line"></span><br><span class="line">      style.webkitTransform = &apos;translate(&apos; + dist + &apos;px,0)&apos; + &apos;translateZ(0)&apos;;</span><br><span class="line">      style.msTransform = style.MozTransform = style.OTransform =</span><br><span class="line">        &apos;translateX(&apos; + dist + &apos;px)&apos;;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>prev å¯¹å¤–æä¾›æ¥å£ï¼Œæ‰‹åŠ¨ç¿»é¡µä½¿ç”¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">function prev() &#123;</span><br><span class="line">   if (continuous) slide(index - 1);</span><br><span class="line">   else if (index) slide(index - 1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>slide ç§»åŠ¨å‡½æ•°ï¼ŒæŒ‡å®šç§»åŠ¨çš„é¡µ index å’Œé€Ÿåº¦</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">function slide(to, slideSpeed) &#123;</span><br><span class="line">      // do nothing if already on requested slide</span><br><span class="line">      if (index == to) return;</span><br><span class="line"></span><br><span class="line">      if (browser.transitions) &#123;</span><br><span class="line">        var direction = Math.abs(index - to) / (index - to); // 1: backward, -1: forward</span><br><span class="line"></span><br><span class="line">        // get the actual position of the slide</span><br><span class="line">        if (continuous) &#123;</span><br><span class="line">          var natural_direction = direction;</span><br><span class="line">          direction = -slidePos[circle(to)] / width;</span><br><span class="line"></span><br><span class="line">          // if going forward but to &lt; index, use to = slides.length + to</span><br><span class="line">          // if going backward but to &gt; index, use to = -slides.length + to</span><br><span class="line">          if (direction !== natural_direction)</span><br><span class="line">            to = -direction * slides.length + to;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        var diff = Math.abs(index - to) - 1;</span><br><span class="line"></span><br><span class="line">        // move all the slides between index and to in the right direction</span><br><span class="line">        while (diff--)</span><br><span class="line">          move(</span><br><span class="line">            circle((to &gt; index ? to : index) - diff - 1),</span><br><span class="line">            width * direction,</span><br><span class="line">            0</span><br><span class="line">          );</span><br><span class="line"></span><br><span class="line">        to = circle(to);</span><br><span class="line"></span><br><span class="line">        move(index, width * direction, slideSpeed || speed);</span><br><span class="line">        move(to, 0, slideSpeed || speed);</span><br><span class="line"></span><br><span class="line">        if (continuous) move(circle(to - direction), -(width * direction), 0); // we need to get the next in place</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        to = circle(to); </span><br><span class="line">        animate(index * -width, to * -width, slideSpeed || speed);</span><br><span class="line">        //no fallback for a circular continuous if the browser does not accept transitions</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      index = to;</span><br><span class="line">      offloadFn(options.callback &amp;&amp; options.callback(index, slides[index]));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæµè§ˆå™¨ä¸æ”¯æŒ transitionï¼Œé‚£ä¹ˆåˆ™ä½¿ç”¨ setInterval å®ç°æ¸è¿›ç§»åŠ¨ï¼Œ animation æ˜¯å¯¹æ•´ä¸ªé¡µé¢è¿›è¡Œç§»åŠ¨ï¼Œè€Œ move æ˜¯ç§»åŠ¨æ¯ä¸€ä¸ªå­é¡µé¢</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">function animate(from, to, speed) &#123;</span><br><span class="line">      // if not an animation, just reposition</span><br><span class="line">      if (!speed) &#123;</span><br><span class="line">        element.style.left = to + &apos;px&apos;;</span><br><span class="line">        return;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      var start = +new Date();</span><br><span class="line"></span><br><span class="line">      var timer = setInterval(function() &#123;</span><br><span class="line">        var timeElap = +new Date() - start;</span><br><span class="line"></span><br><span class="line">        if (timeElap &gt; speed) &#123;</span><br><span class="line">          element.style.left = to + &apos;px&apos;;</span><br><span class="line"></span><br><span class="line">          if (delay) begin();</span><br><span class="line"></span><br><span class="line">          options.transitionEnd &amp;&amp;</span><br><span class="line">            options.transitionEnd.call(event, index, slides[index]);</span><br><span class="line"></span><br><span class="line">          clearInterval(timer);</span><br><span class="line">          return;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        element.style.left =</span><br><span class="line">          (to - from) * (Math.floor((timeElap / speed) * 100) / 100) +</span><br><span class="line">          from +</span><br><span class="line">          &apos;px&apos;;</span><br><span class="line">      &#125;, 4);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ç ”ç©¶ä¸€ä¸‹è§¦æ‘¸äº‹ä»¶çš„å¤„ç†ï¼Œé¦–å…ˆæ˜¯ startï¼Œstart äº‹ä»¶ä¼šè®°å½•èµ·å§‹è§¦æ‘¸ä½ç½®ä»¥åŠæ—¶é—´ï¼Œå¹¶ä¸”æ·»åŠ  touchmove å’Œ touchend äº‹ä»¶ï¼Œå¦‚æœæ²¡æœ‰ start äº‹ä»¶ï¼Œè§¦æ‘¸äº‹ä»¶æ˜¯ä¸å­˜åœ¨çš„ï¼Œ end çš„æ—¶å€™ä¼šè¢«ç§»é™¤ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">start: function(event) &#123;</span><br><span class="line">        var touches = event.touches[0];</span><br><span class="line"></span><br><span class="line">        // measure start values</span><br><span class="line">        start = &#123;</span><br><span class="line">          // get initial touch coords</span><br><span class="line">          x: touches.pageX,</span><br><span class="line">          y: touches.pageY,</span><br><span class="line"></span><br><span class="line">          // store time to determine touch duration</span><br><span class="line">          time: +new Date()</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        // used for testing first move event</span><br><span class="line">        isScrolling = undefined;</span><br><span class="line"></span><br><span class="line">        // reset delta and end measurements</span><br><span class="line">        delta = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">        // attach touchmove and touchend listeners</span><br><span class="line">        element.addEventListener(&apos;touchmove&apos;, this, false);</span><br><span class="line">        element.addEventListener(&apos;touchend&apos;, this, false);</span><br><span class="line">      &#125;,</span><br></pre></td></tr></table></figure><p>move äº‹ä»¶ï¼Œdelta å°†æ‰‹æŒ‡ç§»åŠ¨è·ç¦»è®°ä¸‹ï¼Œæœ€åè§†åŒ translate ç§»åŠ¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">move: function(event) &#123;</span><br><span class="line">       // ensure swiping with one touch and not pinching</span><br><span class="line">       if (event.touches.length &gt; 1 || (event.scale &amp;&amp; event.scale !== 1))</span><br><span class="line">         return;</span><br><span class="line"></span><br><span class="line">       if (options.disableScroll) return;</span><br><span class="line"></span><br><span class="line">       var touches = event.touches[0];</span><br><span class="line"></span><br><span class="line">       // measure change in x and y</span><br><span class="line">       delta = &#123;</span><br><span class="line">         x: touches.pageX - start.x,</span><br><span class="line">         y: touches.pageY - start.y</span><br><span class="line">       &#125;;</span><br><span class="line"></span><br><span class="line">       // determine if scrolling test has run - one time test</span><br><span class="line">       if (typeof isScrolling == &apos;undefined&apos;) &#123;</span><br><span class="line">         isScrolling = !!(</span><br><span class="line">           isScrolling || Math.abs(delta.x) &lt; Math.abs(delta.y)</span><br><span class="line">         );</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       // if user is not trying to scroll vertically</span><br><span class="line">       if (!isScrolling) &#123;</span><br><span class="line">         // prevent native scrolling</span><br><span class="line">         event.preventDefault();</span><br><span class="line"></span><br><span class="line">         // stop slideshow</span><br><span class="line">         stop();</span><br><span class="line"></span><br><span class="line">         // increase resistance if first or last slide</span><br><span class="line">         if (continuous) &#123;</span><br><span class="line">           // we don&apos;t add resistance at the end</span><br><span class="line"></span><br><span class="line">           translate(</span><br><span class="line">             circle(index - 1),</span><br><span class="line">             delta.x + slidePos[circle(index - 1)],</span><br><span class="line">             0</span><br><span class="line">           );</span><br><span class="line">           translate(index, delta.x + slidePos[index], 0);</span><br><span class="line">           translate(</span><br><span class="line">             circle(index + 1),</span><br><span class="line">             delta.x + slidePos[circle(index + 1)],</span><br><span class="line">             0</span><br><span class="line">           );</span><br><span class="line">         &#125; else &#123;</span><br><span class="line">           delta.x =</span><br><span class="line">             delta.x /</span><br><span class="line">             ((!index &amp;&amp; delta.x &gt; 0) || // if first slide and sliding left</span><br><span class="line">             (index == slides.length - 1 &amp;&amp; // or if last slide and sliding right</span><br><span class="line">               delta.x &lt; 0) // and if sliding at all</span><br><span class="line">               ? Math.abs(delta.x) / width + 1 // determine resistance level</span><br><span class="line">               : 1); // no resistance if false</span><br><span class="line"></span><br><span class="line">           // translate 1:1</span><br><span class="line">           translate(index - 1, delta.x + slidePos[index - 1], 0);</span><br><span class="line">           translate(index, delta.x + slidePos[index], 0);</span><br><span class="line">           translate(index + 1, delta.x + slidePos[index + 1], 0);</span><br><span class="line">         &#125;</span><br><span class="line">         options.swiping &amp;&amp; options.swiping(-delta.x / width);</span><br><span class="line">       &#125;</span><br><span class="line">     &#125;,</span><br></pre></td></tr></table></figure><p>end äº‹ä»¶ï¼Œä¸»è¦åˆ¤æ–­æœ¬æ¬¡è§¦æ‘¸æ»‘åŠ¨æ˜¯å¦æœ‰æ•ˆï¼Œå¹¶æŒç»­æ¥ä¸‹æ¥çš„æ“ä½œï¼Œæœ€åå°†ä¼š remove æ‰ç›‘å¬äº‹ä»¶ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">end: function(event) &#123;</span><br><span class="line">        // measure duration</span><br><span class="line">        var duration = +new Date() - start.time;</span><br><span class="line"></span><br><span class="line">        // determine if slide attempt triggers next/prev slide</span><br><span class="line">        var isValidSlide =</span><br><span class="line">          (Number(duration) &lt; 250 &amp;&amp; // if slide duration is less than 250ms</span><br><span class="line">            Math.abs(delta.x) &gt; 20) || // and if slide amt is greater than 20px</span><br><span class="line">          Math.abs(delta.x) &gt; width / 2; // or if slide amt is greater than half the width</span><br><span class="line"></span><br><span class="line">        // determine if slide attempt is past start and end</span><br><span class="line">        var isPastBounds =</span><br><span class="line">          (!index &amp;&amp; delta.x &gt; 0) || // if first slide and slide amt is greater than 0</span><br><span class="line">          (index == slides.length - 1 &amp;&amp; delta.x &lt; 0); // or if last slide and slide amt is less than 0</span><br><span class="line"></span><br><span class="line">        if (continuous) isPastBounds = false;</span><br><span class="line"></span><br><span class="line">        // determine direction of swipe (true:right, false:left)</span><br><span class="line">        var direction = delta.x &lt; 0;</span><br><span class="line"></span><br><span class="line">        // if not scrolling vertically</span><br><span class="line">        if (!isScrolling) &#123;</span><br><span class="line">          if (isValidSlide &amp;&amp; !isPastBounds) &#123;</span><br><span class="line">            if (direction) &#123;</span><br><span class="line">              if (continuous) &#123;</span><br><span class="line">                // we need to get the next in this direction in place</span><br><span class="line"></span><br><span class="line">                move(circle(index - 1), -width, 0);</span><br><span class="line">                move(circle(index + 2), width, 0);</span><br><span class="line">              &#125; else &#123;</span><br><span class="line">                move(index - 1, -width, 0);</span><br><span class="line">              &#125;</span><br><span class="line"></span><br><span class="line">              move(index, slidePos[index] - width, speed);</span><br><span class="line">              move(</span><br><span class="line">                circle(index + 1),</span><br><span class="line">                slidePos[circle(index + 1)] - width,</span><br><span class="line">                speed</span><br><span class="line">              );</span><br><span class="line">              index = circle(index + 1);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">              if (continuous) &#123;</span><br><span class="line">                // we need to get the next in this direction in place</span><br><span class="line"></span><br><span class="line">                move(circle(index + 1), width, 0);</span><br><span class="line">                move(circle(index - 2), -width, 0);</span><br><span class="line">              &#125; else &#123;</span><br><span class="line">                move(index + 1, width, 0);</span><br><span class="line">              &#125;</span><br><span class="line"></span><br><span class="line">              move(index, slidePos[index] + width, speed);</span><br><span class="line">              move(</span><br><span class="line">                circle(index - 1),</span><br><span class="line">                slidePos[circle(index - 1)] + width,</span><br><span class="line">                speed</span><br><span class="line">              );</span><br><span class="line">              index = circle(index - 1);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            options.callback &amp;&amp; options.callback(index, slides[index]);</span><br><span class="line">          &#125; else &#123;</span><br><span class="line">            if (continuous) &#123;</span><br><span class="line">              move(circle(index - 1), -width, speed);</span><br><span class="line">              move(index, 0, speed);</span><br><span class="line">              move(circle(index + 1), width, speed);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">              move(index - 1, -width, speed);</span><br><span class="line">              move(index, 0, speed);</span><br><span class="line">              move(index + 1, width, speed);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // kill touchmove and touchend event listeners until touchstart called again</span><br><span class="line">        element.removeEventListener(&apos;touchmove&apos;, events, false);</span><br><span class="line">        element.removeEventListener(&apos;touchend&apos;, events, false);</span><br><span class="line">        element.removeEventListener(&apos;touchforcechange&apos;, function() &#123;&#125;, false);</span><br><span class="line">      &#125;,</span><br></pre></td></tr></table></figure><h4 id="æ€»ç»“"><a class="markdownIt-Anchor" href="#æ€»ç»“"></a> æ€»ç»“</h4><p>æ€»çš„æ¥è¯´ï¼Œswipe-js-ios å……åˆ†åˆ©ç”¨äº† transitionï¼Œæ¥å®ç°ç§»åŠ¨åŠ¨ç”»ï¼Œææ¸…æ¥šè§¦æ‘¸äº‹ä»¶å°±æ¯”è¾ƒå®¹æ˜“èƒ½å†™å‡ºæ¥å¯æ»‘åŠ¨çš„ swipe</p>]]></content>
    
    <summary type="html">
    
      Swipeï¼Œå¸¸ç”¨æ¥åšè½®æ’­å›¾ï¼Œéœ€è¦ç¿»é¡µçš„åœºæ™¯ï¼Œæœ€ç»å…¸çš„å¼€æºåº“ [swipe-js-iso]ï¼Œä¸è¿‡æ›´æ¨èä½¿ç”¨ React ç»„ä»¶ [react-swipe]ï¼Œå®ƒå°è£…äº† swipe-js-ios  ç»„ä»¶ï¼Œè€Œ swipe-js-ios ç»„ä»¶åˆ™å°è£…äº† [Swipe]
    
    </summary>
    
      <category term="JavaScript" scheme="https://wzes.github.io/categories/JavaScript/"/>
    
    
      <category term="JavaScript" scheme="https://wzes.github.io/tags/JavaScript/"/>
    
      <category term="HTML" scheme="https://wzes.github.io/tags/HTML/"/>
    
      <category term="DOM" scheme="https://wzes.github.io/tags/DOM/"/>
    
  </entry>
  
  <entry>
    <title>JavaScript Webpack æºç è§£æ</title>
    <link href="https://wzes.github.io/2019/07/13/JavaScript/Webpack/"/>
    <id>https://wzes.github.io/2019/07/13/JavaScript/Webpack/</id>
    <published>2019-07-13T11:59:16.000Z</published>
    <updated>2019-09-02T12:17:16.955Z</updated>
    
    <content type="html"><![CDATA[<h3 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h3><p>ç®—æ˜¯ä¸€ä¸ªh5å¼€å‘äº†ï¼Œè™½ç„¶æ²¡å†™è¿‡ä»€ä¹ˆå®Œæ•´çš„å‰ç«¯é¡µé¢ï¼Œä½†æ¥è§¦å‰ç«¯ä¹Ÿæœ‰æ®µæ—¶é—´äº†ï¼Œå¯¹äºä¸€ä¸ªåˆæ ¼çš„å‰ç«¯å¼€å‘è€…è€Œè¨€ï¼Œææ‡‚ webpack æ‰“åŒ…åŸç†è¿˜æ˜¯æ¯”è¾ƒé‡è¦çš„</p><h3 id="hello-world"><a class="markdownIt-Anchor" href="#hello-world"></a> hello world</h3><p>ä½¿ç”¨ commonjs è§„èŒƒï¼Œlib.js åªå¯¼å‡ºä¸€ä¸ªæ–¹æ³•</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// lib.js</span><br><span class="line">module.exports = function () &#123;</span><br><span class="line">    return &quot;hello webpack!&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>index.js ä½¿ç”¨ require å¼•å…¥ï¼Œä»£ç å¾ˆç®€å•ï¼Œè¾“å…¥æ–¹æ³•è¿”å›å€¼</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// index.js</span><br><span class="line">const func = require(&quot;./lib&quot;)</span><br><span class="line"></span><br><span class="line">const result = func()</span><br><span class="line">// print hello</span><br><span class="line">console.log(result)</span><br></pre></td></tr></table></figure><h5 id="ç›®å½•ç»“æ„"><a class="markdownIt-Anchor" href="#ç›®å½•ç»“æ„"></a> ç›®å½•ç»“æ„</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ dist</span><br><span class="line">â”‚Â Â  â””â”€â”€ main.js</span><br><span class="line">â”œâ”€â”€ package-lock.json</span><br><span class="line">â”œâ”€â”€ package.json</span><br><span class="line">â”œâ”€â”€ node_modules</span><br><span class="line">â”œâ”€â”€ src</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ index.js</span><br><span class="line">â”‚Â Â  â””â”€â”€ lib.js</span><br><span class="line">â””â”€â”€ webpack.config.js</span><br></pre></td></tr></table></figure><h5 id="webpackconfigjs"><a class="markdownIt-Anchor" href="#webpackconfigjs"></a> webpack.config.js</h5><p>ä¸ºäº†æ–¹ä¾¿çœ‹ç”Ÿæˆçš„æºç ï¼Œæˆ‘ä»¬å°† mode è®¾ç½®ä¸º developmentï¼Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">var path = require(&apos;path&apos;);</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">    context: path.resolve(__dirname, &apos;./&apos;),</span><br><span class="line">    mode: &apos;development&apos;,</span><br><span class="line">    entry: &apos;./src/index.js&apos;,</span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.resolve(__dirname, &apos;dist&apos;),</span><br><span class="line">        filename: &apos;main.js&apos;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h5 id="packagejson"><a class="markdownIt-Anchor" href="#packagejson"></a> package.json</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;webpack-demo&quot;,</span><br><span class="line">  &quot;version&quot;: &quot;1.0.0&quot;,</span><br><span class="line">  &quot;description&quot;: &quot;&quot;,</span><br><span class="line">  &quot;private&quot;: true,</span><br><span class="line">  &quot;scripts&quot;: &#123;</span><br><span class="line">    &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;,</span><br><span class="line">    &quot;build&quot;: &quot;webpack&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;keywords&quot;: [],</span><br><span class="line">  &quot;author&quot;: &quot;&quot;,</span><br><span class="line">  &quot;license&quot;: &quot;ISC&quot;,</span><br><span class="line">  &quot;devDependencies&quot;: &#123;</span><br><span class="line">    &quot;webpack&quot;: &quot;^4.35.2&quot;,</span><br><span class="line">    &quot;webpack-cli&quot;: &quot;^3.3.5&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;dependencies&quot;: &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="ç¼–è¯‘è¿è¡Œ"><a class="markdownIt-Anchor" href="#ç¼–è¯‘è¿è¡Œ"></a> ç¼–è¯‘è¿è¡Œ</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm run build</span><br><span class="line">node dist/main.js</span><br></pre></td></tr></table></figure><h5 id="è¾“å‡º"><a class="markdownIt-Anchor" href="#è¾“å‡º"></a> è¾“å‡º</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ node dist/main.js </span><br><span class="line">hello webpack!</span><br></pre></td></tr></table></figure><h4 id="èµ·æº"><a class="markdownIt-Anchor" href="#èµ·æº"></a> èµ·æº</h4><p>æµè§ˆå™¨ï¼Œnode å¹¶ä¸æ”¯æŒæ¨¡å—åŒ–ï¼Œæˆ‘ä»¬åœ¨é¡¹ç›®ä¸­ä½¿ç”¨çš„ requireã€export å°†ä¼šç»è¿‡ webpack åï¼Œè¿™äº› js å°±ä¼šè¢«æ‰“åŒ…æ•´åˆæˆä¸€ä¸ª js æ–‡ä»¶ï¼Œåªéœ€è¦è¿è¡Œ js æ–‡ä»¶ï¼Œæ•´ä¸ªæ¨¡å—å°†ä¼šè¿è¡Œèµ·æ¥äº†ã€‚</p><h4 id="mainjs-è§£æ"><a class="markdownIt-Anchor" href="#mainjs-è§£æ"></a> main.js è§£æ</h4><p>æ•´ä¸ªæ–‡ä»¶åªæœ‰ 111 è¡Œï¼Œè¿™æ˜¯æœªç»è¿‡å‹ç¼©çš„ç‰ˆæœ¬ï¼Œç”Ÿäº§ç¯å¢ƒä¸‹çš„è¾“å‡ºæ–‡ä»¶æ¯”è¿™è¿˜è¦ç²¾ç®€ï¼Œåªéœ€è¦åœ¨ webpack.config.js ä¸­å°† mode å€¼ç­‰äº production å³å¯æ”¹å˜æ‰“åŒ…ç¯å¢ƒ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line">/******/ (function(modules) &#123; // webpackBootstrap</span><br><span class="line">/******/ // The module cache</span><br><span class="line">/******/ var installedModules = &#123;&#125;;</span><br><span class="line">/******/</span><br><span class="line">/******/ // The require function</span><br><span class="line">/******/ function __webpack_require__(moduleId) &#123;</span><br><span class="line">/******/</span><br><span class="line">/******/ // Check if module is in cache</span><br><span class="line">/******/ if(installedModules[moduleId]) &#123;</span><br><span class="line">/******/ return installedModules[moduleId].exports;</span><br><span class="line">/******/ &#125;</span><br><span class="line">/******/ // Create a new module (and put it into the cache)</span><br><span class="line">/******/ var module = installedModules[moduleId] = &#123;</span><br><span class="line">/******/ i: moduleId,</span><br><span class="line">/******/ l: false,</span><br><span class="line">/******/ exports: &#123;&#125;</span><br><span class="line">/******/ &#125;;</span><br><span class="line">/******/</span><br><span class="line">/******/ // Execute the module function</span><br><span class="line">/******/ modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);</span><br><span class="line">/******/</span><br><span class="line">/******/ // Flag the module as loaded</span><br><span class="line">/******/ module.l = true;</span><br><span class="line">/******/</span><br><span class="line">/******/ // Return the exports of the module</span><br><span class="line">/******/ return module.exports;</span><br><span class="line">/******/ &#125;</span><br><span class="line">/******/</span><br><span class="line">/******/</span><br><span class="line">/******/ // expose the modules object (__webpack_modules__)</span><br><span class="line">/******/ __webpack_require__.m = modules;</span><br><span class="line">/******/</span><br><span class="line">/******/ // expose the module cache</span><br><span class="line">/******/ __webpack_require__.c = installedModules;</span><br><span class="line">/******/</span><br><span class="line">/******/ // define getter function for harmony exports</span><br><span class="line">/******/ __webpack_require__.d = function(exports, name, getter) &#123;</span><br><span class="line">/******/ if(!__webpack_require__.o(exports, name)) &#123;</span><br><span class="line">/******/ Object.defineProperty(exports, name, &#123; enumerable: true, get: getter &#125;);</span><br><span class="line">/******/ &#125;</span><br><span class="line">/******/ &#125;;</span><br><span class="line">/******/</span><br><span class="line">/******/ // define __esModule on exports</span><br><span class="line">/******/ __webpack_require__.r = function(exports) &#123;</span><br><span class="line">/******/ if(typeof Symbol !== &apos;undefined&apos; &amp;&amp; Symbol.toStringTag) &#123;</span><br><span class="line">/******/ Object.defineProperty(exports, Symbol.toStringTag, &#123; value: &apos;Module&apos; &#125;);</span><br><span class="line">/******/ &#125;</span><br><span class="line">/******/ Object.defineProperty(exports, &apos;__esModule&apos;, &#123; value: true &#125;);</span><br><span class="line">/******/ &#125;;</span><br><span class="line">/******/</span><br><span class="line">/******/ // create a fake namespace object</span><br><span class="line">/******/ // mode &amp; 1: value is a module id, require it</span><br><span class="line">/******/ // mode &amp; 2: merge all properties of value into the ns</span><br><span class="line">/******/ // mode &amp; 4: return value when already ns object</span><br><span class="line">/******/ // mode &amp; 8|1: behave like require</span><br><span class="line">/******/ __webpack_require__.t = function(value, mode) &#123;</span><br><span class="line">/******/ if(mode &amp; 1) value = __webpack_require__(value);</span><br><span class="line">/******/ if(mode &amp; 8) return value;</span><br><span class="line">/******/ if((mode &amp; 4) &amp;&amp; typeof value === &apos;object&apos; &amp;&amp; value &amp;&amp; value.__esModule) return value;</span><br><span class="line">/******/ var ns = Object.create(null);</span><br><span class="line">/******/ __webpack_require__.r(ns);</span><br><span class="line">/******/ Object.defineProperty(ns, &apos;default&apos;, &#123; enumerable: true, value: value &#125;);</span><br><span class="line">/******/ if(mode &amp; 2 &amp;&amp; typeof value != &apos;string&apos;) for(var key in value) __webpack_require__.d(ns, key, function(key) &#123; return value[key]; &#125;.bind(null, key));</span><br><span class="line">/******/ return ns;</span><br><span class="line">/******/ &#125;;</span><br><span class="line">/******/</span><br><span class="line">/******/ // getDefaultExport function for compatibility with non-harmony modules</span><br><span class="line">/******/ __webpack_require__.n = function(module) &#123;</span><br><span class="line">/******/ var getter = module &amp;&amp; module.__esModule ?</span><br><span class="line">/******/ function getDefault() &#123; return module[&apos;default&apos;]; &#125; :</span><br><span class="line">/******/ function getModuleExports() &#123; return module; &#125;;</span><br><span class="line">/******/ __webpack_require__.d(getter, &apos;a&apos;, getter);</span><br><span class="line">/******/ return getter;</span><br><span class="line">/******/ &#125;;</span><br><span class="line">/******/</span><br><span class="line">/******/ // Object.prototype.hasOwnProperty.call</span><br><span class="line">/******/ __webpack_require__.o = function(object, property) &#123; return Object.prototype.hasOwnProperty.call(object, property); &#125;;</span><br><span class="line">/******/</span><br><span class="line">/******/ // __webpack_public_path__</span><br><span class="line">/******/ __webpack_require__.p = &quot;&quot;;</span><br><span class="line">/******/</span><br><span class="line">/******/</span><br><span class="line">/******/ // Load entry module and return exports</span><br><span class="line">/******/ return __webpack_require__(__webpack_require__.s = &quot;./src/index.js&quot;);</span><br><span class="line">/******/ &#125;)</span><br><span class="line">/************************************************************************/</span><br><span class="line">/******/ (&#123;</span><br><span class="line"></span><br><span class="line">/***/ &quot;./src/index.js&quot;:</span><br><span class="line">/*!**********************!*\</span><br><span class="line">  !*** ./src/index.js ***!</span><br><span class="line">  \**********************/</span><br><span class="line">/*! no static exports found */</span><br><span class="line">/***/ (function(module, exports, __webpack_require__) &#123;</span><br><span class="line"></span><br><span class="line">eval(&quot;// index.js\nconst func = __webpack_require__(/*! ./lib */ \&quot;./src/lib.js\&quot;)\n\nconst result = func()\n// print hello\nconsole.log(result)\n\n//# sourceURL=webpack:///./src/index.js?&quot;);</span><br><span class="line"></span><br><span class="line">/***/ &#125;),</span><br><span class="line"></span><br><span class="line">/***/ &quot;./src/lib.js&quot;:</span><br><span class="line">/*!********************!*\</span><br><span class="line">  !*** ./src/lib.js ***!</span><br><span class="line">  \********************/</span><br><span class="line">/*! no static exports found */</span><br><span class="line">/***/ (function(module, exports) &#123;</span><br><span class="line"></span><br><span class="line">eval(&quot;module.exports = function () &#123;\n    return \&quot;hello webpack!\&quot;\n&#125;\n\n//# sourceURL=webpack:///./src/lib.js?&quot;);</span><br><span class="line"></span><br><span class="line">/***/ &#125;)</span><br><span class="line"></span><br><span class="line">/******/ &#125;);</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å…ˆå°†æ­¤æ–‡ä»¶çš„ä¸»è¦éƒ¨åˆ†æ‹¿å‡ºæ¥çœ‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">/******/</span><br><span class="line">(function (modules) &#123;</span><br><span class="line">    var installedModules = &#123;&#125;</span><br><span class="line"></span><br><span class="line">    function __webpack_require__ (moduleId) &#123;</span><br><span class="line">        if (installedModules[moduleId]) &#123;</span><br><span class="line">            return installedModules[moduleId].exports</span><br><span class="line">        &#125;</span><br><span class="line">        var module = installedModules[moduleId] = &#123;</span><br><span class="line">            i: moduleId,</span><br><span class="line">            l: false,</span><br><span class="line">            exports: &#123;&#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        modules[moduleId].call(module.exports, module, module.exports, __webpack_require__)</span><br><span class="line">        module.l = true</span><br><span class="line">        return module.exports</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return __webpack_require__(__webpack_require__.s = &apos;./src/index.js&apos;)</span><br><span class="line">&#125;)</span><br><span class="line">(&#123;</span><br><span class="line">    &apos;./src/index.js&apos;:</span><br><span class="line">        (function (module, exports, __webpack_require__) &#123;</span><br><span class="line">            eval(</span><br><span class="line">                &apos;// index.js\nconst func = __webpack_require__(/*! ./lib */ &quot;./src/lib.js&quot;)\n\nconst result = func()\n// print hello\nconsole.log(result)\n\n//# sourceURL=webpack:///./src/index.js?&apos;)</span><br><span class="line">        &#125;),</span><br><span class="line">    &apos;./src/lib.js&apos;:</span><br><span class="line">        (function (module, exports) &#123;</span><br><span class="line">            eval(</span><br><span class="line">                &apos;module.exports = function () &#123;\n    return &quot;hello webpack!&quot;\n&#125;\n\n//# sourceURL=webpack:///./src/lib.js?&apos;)</span><br><span class="line">        &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸€ä¸ªç«‹å³æ‰§è¡Œå‡½æ•°ï¼Œé¦–å…ˆç”³æ˜äº† installedModules å¯¹è±¡ï¼Œè¿™æ˜¯å·²å®‰è£…çš„æ¨¡å—é›†åˆï¼Œä¹‹åå®šä¹‰äº†ä¸€ä¸ªå‡½æ•° <strong>webpack_require</strong> ï¼Œæ­¤å‡½æ•°ç”¨æ¥è·å–æ¨¡å—çš„å¼•ç”¨ï¼Œæœ€å return äº†æ­¤å‡½æ•°ï¼Œå‚æ•°ä¸ºå…¥å£ï¼ŒmoduleId = â€˜./src/index.jsâ€™<br>modules å³ä¸º</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &apos;./src/index.js&apos;:</span><br><span class="line">        (function (module, exports, __webpack_require__) &#123;</span><br><span class="line">            eval(</span><br><span class="line">                &apos;// index.js\nconst func = __webpack_require__(/*! ./lib */ &quot;./src/lib.js&quot;)\n\nconst result = func()\n// print hello\nconsole.log(result)\n\n//# sourceURL=webpack:///./src/index.js?&apos;)</span><br><span class="line">        &#125;),</span><br><span class="line">    &apos;./src/lib.js&apos;:</span><br><span class="line">        (function (module, exports) &#123;</span><br><span class="line">            eval(</span><br><span class="line">                &apos;module.exports = function () &#123;\n    return &quot;hello webpack!&quot;\n&#125;\n\n//# sourceURL=webpack:///./src/lib.js?&apos;)</span><br><span class="line">        &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">modules[moduleId].call(module.exports, module, module.exports, __webpack_require__)</span><br></pre></td></tr></table></figure><p>module å³æ¨¡å—ï¼Œmodules[moduleId] å³ä¸º</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(function (module, exports, __webpack_require__) &#123;</span><br><span class="line">           eval(</span><br><span class="line">               &apos;// index.js\nconst func = __webpack_require__(/*! ./lib */ &quot;./src/lib.js&quot;)\n\nconst result = func()\n// print hello\nconsole.log(result)\n\n//# sourceURL=webpack:///./src/index.js?&apos;)</span><br><span class="line">       &#125;)</span><br></pre></td></tr></table></figure><p>module.exports ä¸º this ä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œè¯¥å‡½æ•°æ‰§è¡Œä¸­ï¼Œç¬¬ä¸€è¡Œå³è°ƒç”¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const func = __webpack_require__(&quot;./src/lib.js&quot;)</span><br></pre></td></tr></table></figure><p><strong>webpack_require</strong>(&quot;./src/lib.js&quot;) å³è°ƒç”¨äº†æ­¤å‡½æ•°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(function (module, exports) &#123;</span><br><span class="line">            eval(</span><br><span class="line">                &apos;module.exports = function () &#123;\n    return &quot;hello webpack!&quot;\n&#125;\n\n//# sourceURL=webpack:///./src/lib.js?&apos;)</span><br><span class="line">        &#125;)</span><br></pre></td></tr></table></figure><p>æœ€åè¿”å› module.exports å³ lib é‡Œé¢çš„å¯¼å‡ºå‡½æ•°ã€‚å†å¾€åæ‰§è¡Œä¾¿æ˜¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">const result = func()</span><br><span class="line">// print hello</span><br><span class="line">console.log(result)</span><br></pre></td></tr></table></figure><p>æ­¤åˆ»åŸºæœ¬å·²ç»å°†å…³ç³»ç†é¡ºäº†ï¼Œæ­¤åå¦‚æœåœ¨è°ƒç”¨æ¨¡å—ï¼Œåˆ™ä¸–ç•Œä» installedModules ä¸­ç›´æ¥è¿”å›ã€‚</p><h4 id="æ€»ç»“"><a class="markdownIt-Anchor" href="#æ€»ç»“"></a> æ€»ç»“</h4><p>æ­¤æ–‡åªæ˜¯åˆ†æäº†ç®€å•çš„æ¨¡å—å¼•ç”¨ï¼Œéœ€è¦ä»”ç»†åˆ†ææ‰èƒ½èä¼šè´¯é€šã€‚</p>]]></content>
    
    <summary type="html">
    
      ç®—æ˜¯ä¸€ä¸ªh5å¼€å‘äº†ï¼Œè™½ç„¶æ²¡å†™è¿‡ä»€ä¹ˆå®Œæ•´çš„å‰ç«¯é¡µé¢ï¼Œä½†æ¥è§¦å‰ç«¯ä¹Ÿæœ‰æ®µæ—¶é—´äº†ï¼Œå¯¹äºä¸€ä¸ªåˆæ ¼çš„å‰ç«¯å¼€å‘è€…è€Œè¨€ï¼Œææ‡‚ webpack æ‰“åŒ…åŸç†è¿˜æ˜¯æ¯”è¾ƒé‡è¦çš„
    
    </summary>
    
      <category term="JavaScript" scheme="https://wzes.github.io/categories/JavaScript/"/>
    
    
      <category term="JavaScript" scheme="https://wzes.github.io/tags/JavaScript/"/>
    
      <category term="Webpack" scheme="https://wzes.github.io/tags/Webpack/"/>
    
  </entry>
  
  <entry>
    <title>Android PageTransformer æºç è§£æ</title>
    <link href="https://wzes.github.io/2019/07/05/Android/PageTransformer/"/>
    <id>https://wzes.github.io/2019/07/05/Android/PageTransformer/</id>
    <published>2019-07-05T12:35:00.000Z</published>
    <updated>2019-09-02T12:19:17.763Z</updated>
    
    <content type="html"><![CDATA[<h3 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h3><p>ä½œä¸ºä¸€ä¸ªå¾ˆä¹…æ²¡å†™è¿‡ Android ä¸šåŠ¡çš„äººï¼Œå¿ƒé‡Œæœ‰ç‚¹æ…Œäº†ï¼Œäºæ˜¯æ‹¿èµ· Android Studioï¼Œè¿˜æ˜¯æ‰¾ç‚¹ä¸œè¥¿å­¦ä¹ ä¸€ä¸‹ï¼Œå¹¶ä¸”è®°å½•ä¸€ä¸‹ã€‚ä¸€ç›´è§‰å¾— ViewPager æ˜¯ä¸ªå¥½ä¸œè¥¿ï¼Œå¶ç„¶é—´çœ‹åˆ°ä¸€äº›å¾ˆå¥½çš„æ¡ˆä¾‹ï¼Œå¾ˆé…·ç‚«çš„ç¿»é¡µæ•ˆæœã€‚ç›´åˆ°äº†è§£äº†è¿™ä¸ªä¸œè¥¿çš„å®ç°åŸæ¥æ²¡æœ‰æƒ³è±¡ä¸­çš„é‚£ä¹ˆå¤æ‚ï¼Œä½†å¦‚æœæ²¡æœ‰æ·±åˆ»ç†è§£ï¼Œè¿˜æ˜¯å¾ˆéš¾å†™å‡ºé…·ç‚«çš„æ•ˆæœçš„ã€‚äºæ˜¯ï¼Œ ViewPager Transformer çš„å­¦ä¹ å°±æä¸Šäº†æ—¥ç¨‹ã€‚</p><h3 id="hello-world"><a class="markdownIt-Anchor" href="#hello-world"></a> Hello World</h3><p>é¦–å…ˆæˆ‘ä»¬æ¥å®ç°ä¸€ä¸ªåœºæ™¯ï¼Œå¾ˆç®€å•ï¼Œåªéœ€è¦ä¸€ä¸ª ViewPagerï¼Œç„¶åç»™ä»–è®¾ç½®å‡ é¡µç”¨æ¥å±•ç°æ•ˆæœå°±è¡Œäº†</p><h6 id="layout-æ–‡ä»¶"><a class="markdownIt-Anchor" href="#layout-æ–‡ä»¶"></a> Layout æ–‡ä»¶</h6><p>åªéœ€è¦æ”¾å…¥ä¸€ä¸ª ViewPager</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;androidx.constraintlayout.widget.ConstraintLayout</span><br><span class="line">        xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">        xmlns:tools=&quot;http://schemas.android.com/tools&quot;</span><br><span class="line">        xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;match_parent&quot;</span><br><span class="line">        tools:context=&quot;.MainActivity&quot;&gt;</span><br><span class="line">    &lt;androidx.viewpager.widget.ViewPager</span><br><span class="line">            android:layout_width=&quot;match_parent&quot;</span><br><span class="line">            android:layout_height=&quot;match_parent&quot;</span><br><span class="line">            android:id=&quot;@+id/view_pager&quot;&gt;</span><br><span class="line">    &lt;/androidx.viewpager.widget.ViewPager&gt;</span><br><span class="line"></span><br><span class="line">&lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;</span><br></pre></td></tr></table></figure><p>ä¹‹åï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª PageAdapterï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ FragmentPagerAdapterï¼ŒgetItem è¿”å›ä¸€ä¸ª Fragment å°±å¥½äº†</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">class PageAdapter(fm: FragmentManager) : FragmentPagerAdapter(fm) &#123;</span><br><span class="line"></span><br><span class="line">    override fun getItem(position: Int): Fragment &#123;</span><br><span class="line">        return PageFragment(&quot;Fragment $position&quot;, position)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    override fun getCount(): Int &#123;</span><br><span class="line">        return 4</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @SuppressLint(&quot;ValidFragment&quot;)</span><br><span class="line">    class PageFragment(private var content: String, private var position: Int) : Fragment() &#123;</span><br><span class="line"></span><br><span class="line">        private val colors = Arrays.asList(Color.GRAY, Color.RED, Color.BLUE, Color.YELLOW)!!</span><br><span class="line">        override fun onActivityCreated(savedInstanceState: Bundle?) &#123;</span><br><span class="line">            super.onActivityCreated(savedInstanceState)</span><br><span class="line">            text_view.text = content</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        override fun onCreateView(</span><br><span class="line">            inflater: LayoutInflater,</span><br><span class="line">            container: ViewGroup?,</span><br><span class="line">            savedInstanceState: Bundle?</span><br><span class="line">        ): View? &#123;</span><br><span class="line">            val view = inflater.inflate(R.layout.tab_item, container, false)</span><br><span class="line">            view.setBackgroundColor(colors[position % colors.size])</span><br><span class="line">            view.tag = &quot;$position&quot;</span><br><span class="line">            return view</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨æˆ‘ä»¬çš„ Activity ä¸­ï¼Œè®¾ç½® view_pagerï¼Œè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”±äºæˆ‘ä»¬ä½¿ç”¨äº† FragmentPagerAdapterï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨å±•ç¤ºæ˜¯å¦‚æœéœ€è¦å±•ç¤ºå¤šé¡µçš„è¯ï¼Œå¿…é¡»è®¾ç½®ä¸º <strong>offscreenPageLimit</strong> ä¸€ä¸ªæ¯”è¾ƒå¤§çš„å€¼ï¼Œä»¥ä¾¿ ViewPager èƒ½å¤Ÿæ¸²æŸ“è¶³å¤Ÿå¤šçš„é¡µé¢æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ã€‚<br>æœ€åä¸º ViewPager è®¾ç½®ä¸€ä¸ª PageTransformer</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">class MainActivity : AppCompatActivity() &#123;</span><br><span class="line"></span><br><span class="line">    override fun onCreate(savedInstanceState: Bundle?) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState)</span><br><span class="line">        setContentView(R.layout.activity_main)</span><br><span class="line"></span><br><span class="line">        view_pager.adapter = PageAdapter(supportFragmentManager)</span><br><span class="line"></span><br><span class="line">        view_pager.offscreenPageLimit = 4</span><br><span class="line"></span><br><span class="line">        view_pager.setPageTransformer(true, ViewPagerTransformer(TransformType.DEPTH))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸€ä¸ªæ¯”è¾ƒç®€å•çš„ PageTransformer çš„å®ç°å¦‚ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">class ViewPagerTransformer : ViewPager.PageTransformer  &#123;</span><br><span class="line">    override fun transformPage(page: View, position: Float) &#123;</span><br><span class="line">          page.rotationY = position * -30f</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ•ˆæœå¦‚ä¸‹ï¼Œç¿»é¡µæ—¶ä¼šæ ¹æ®ä½ç½®ä¿®æ”¹é¡µé¢çš„æ˜¾ç¤ºï¼Œé¡µé¢å°†ä¼šç»• Y è½´è¿›è¡Œæ—‹è½¬ä¸€å®šçš„è§’åº¦ï¼Œæ•ˆæœå¾ˆèµå§ï¼ï¼ï¼åªç”¨äº†ä¸€ç‚¹ä»£ç <br><img src="https://upload-images.jianshu.io/upload_images/7117641-ca06163fe13e1f15.gif?imageMogr2/auto-orient/strip" alt="é¡µé¢ç¿»è½¬"></p><h4 id="viewpagerpagetransformer"><a class="markdownIt-Anchor" href="#viewpagerpagetransformer"></a> ViewPager.PageTransformer</h4><h5 id="å®šä¹‰"><a class="markdownIt-Anchor" href="#å®šä¹‰"></a> å®šä¹‰</h5><p>PageTransfomer æ¥å£åªæœ‰ä¸€ä¸ªæ–¹æ³•ï¼Œè¯¥æ–¹æ³•æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯ pageï¼ŒæŒ‡çš„æ˜¯ ViewPage çš„ä¸€ä¸ªå†…å®¹é¡µ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public interface PageTransformer &#123;</span><br><span class="line">    /**</span><br><span class="line">     * Apply a property transformation to the given page.</span><br><span class="line">     *</span><br><span class="line">     * @param page Apply the transformation to this page</span><br><span class="line">     * @param position Position of page relative to the current front-and-center</span><br><span class="line">     *                 position of the pager. 0 is front and center. 1 is one full</span><br><span class="line">     *                 page position to the right, and -1 is one page position to the left.</span><br><span class="line">     */</span><br><span class="line">    void transformPage(@NonNull View page, float position);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>position</strong> æŒ‡çš„æ˜¯è¯¥å†…å®¹é¡µçš„ä½ç½®åç§»ï¼Œè¯¥åç§»æ˜¯ç›¸å¯¹çš„ï¼Œå…·ä½“è¡¨ç¤ºè¯·çœ‹ä¸€å¼ å›¾ï¼Œé¡µé¢é™æ­¢æ—¶ï¼Œä»¥å±å¹•å·¦è¾¹ç•Œä¸º 0ï¼Œå±å¹•å†…çš„é¡µé¢ position ä¸º0ï¼Œå·¦è¾¹ä¸º-1ï¼Œä¾æ¬¡é€’å‡ï¼Œå³ä¾§ä¸º1ï¼Œä¾æ¬¡é€’å¢ã€‚å½“å±å¹•æ»‘åŠ¨æ—¶ï¼Œpage2åªå‡ºç°ä¸€åŠï¼Œæ­¤æ—¶ï¼Œpage2 çš„ position ä¸º-0.5ï¼Œpage3 ä¸º0.5ï¼Œä¾æ¬¡ç±»æ¨å¯å¾—å‡ºå…¶ä»–page å›è°ƒçš„ position å€¼<br><img src="https://upload-images.jianshu.io/upload_images/7117641-a9868f1c4f6cd870.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Page Transformer"></p><h4 id="å®è·µ"><a class="markdownIt-Anchor" href="#å®è·µ"></a> å®è·µ</h4><p>1ã€æ·¡å…¥æ·¡å‡º æ•ˆæœ<br><img src="https://upload-images.jianshu.io/upload_images/7117641-d9f22c656de352bc.gif?imageMogr2/auto-orient/strip" alt="æ·¡å…¥æ·¡å‡º"></p><p>é¡µé¢éšç€ä½ç½®æ”¹å˜é€æ˜åº¦ï¼Œalpha = 0 æ˜¯é€æ˜ï¼Œalpha = 1 æ˜¯ä¸é€æ˜</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">if (position &lt;= -1.0f || position &gt;= 1.0f) &#123;</span><br><span class="line">    page.alpha = 0.0f</span><br><span class="line">&#125; else if (position == 0.0f) &#123;</span><br><span class="line">    page.alpha = 1.0f</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    page.alpha = 1.0f - Math.abs(position)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2ã€ç¼©æ”¾å˜å¤§æ•ˆæœ<br><img src="https://upload-images.jianshu.io/upload_images/7117641-af318d5c1ab4d301.gif?imageMogr2/auto-orient/strip" alt="ç¼©æ”¾å˜å¤§"></p><p>åŒæ—¶æ”¹å˜ä½ç§»ä¸é€æ˜åº¦</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">if (position &gt; 0 &amp;&amp; position &lt; 1) &#123;</span><br><span class="line">      page.alpha = 1 - position</span><br><span class="line">      page.scaleXY = 0.85f + (1 - 0.85f) * (1 - Math.abs(position))</span><br><span class="line">      page.translationX = page.width * -position</span><br><span class="line">&#125; else &#123;</span><br><span class="line">      page.alpha = 1f</span><br><span class="line">      page.scaleXY = 1f</span><br><span class="line">      page.translationX = 0f</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ›´å¤šæ•ˆæœ"><a class="markdownIt-Anchor" href="#æ›´å¤šæ•ˆæœ"></a> æ›´å¤šæ•ˆæœ</h4><p>ç­‰ä½ å»å‘ç°</p><h4 id="æºç è§£æ"><a class="markdownIt-Anchor" href="#æºç è§£æ"></a> æºç è§£æ</h4><p>å…¶å®è¿™ä¸ªåŸç†å¾ˆç®€å•ï¼Œåœ¨æ¯ä¸€æ¬¡æ»šåŠ¨çš„æ—¶å€™ï¼Œåœ¨ ViewPager å†…éƒ¨ï¼Œè®¡ç®—å‡º æ¯ä¸€ä¸ªview çš„ position ï¼Œå¹¶ä¸”è°ƒç”¨è¿™ä¸ªæ¥å£çš„æ–¹æ³•å°±å¯ä»¥å®ç°äº†<br>æºç å¦‚ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">protected void onPageScrolled(int position, float offset, int offsetPixels) &#123;</span><br><span class="line">     // çœç•¥.......</span><br><span class="line">     if (mPageTransformer != null) &#123;</span><br><span class="line">         final int scrollX = getScrollX();</span><br><span class="line">         final int childCount = getChildCount();</span><br><span class="line">         for (int i = 0; i &lt; childCount; i++) &#123;</span><br><span class="line">             final View child = getChildAt(i);</span><br><span class="line">             final LayoutParams lp = (LayoutParams) child.getLayoutParams();</span><br><span class="line"></span><br><span class="line">             if (lp.isDecor) continue;</span><br><span class="line">             final float transformPos = (float) (child.getLeft() - scrollX) / getClientWidth();</span><br><span class="line">             mPageTransformer.transformPage(child, transformPos);</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line">     // ....</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆåˆ¤æ–­ mPageTransformer æ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨çš„è¯å°±å¯ä»¥è°ƒç”¨äº†ï¼Œè·å– scrollXï¼Œæ ¹æ® childCount å¯¹æ¯ä¸€ä¸ª view æ‰§è¡Œ mPageTransformer.transformPage æ–¹æ³• transformPos æ˜¯ç”± (float) (child.getLeft() - scrollX) / getClientWidth() è®¡ç®—å¾—å‡ºã€‚æ­¤å¤„ä½¿ç”¨ getLeft - scrollX è®¡ç®—éªŒè¯äº†æˆ‘ä»¬å¯¹æƒ³æ³•ã€‚</p><p><a href="https://github.com/wzes/vptfdemo/tree/master" target="_blank" rel="noopener">demo</a></p><h4 id="æ€»ç»“"><a class="markdownIt-Anchor" href="#æ€»ç»“"></a> æ€»ç»“</h4><p>çœ‹ä¼¼å¤æ‚çš„åŠŸèƒ½ï¼Œå…¶å®æ²¡é‚£ä¹ˆå¤æ‚ï¼Œé™ä¸‹å¿ƒæ¥ç ”ç©¶ï¼ŒåŸæ¥è¿™ä¹ˆç®€å•</p>]]></content>
    
    <summary type="html">
    
      ä½œä¸ºä¸€ä¸ªå¾ˆä¹…æ²¡å†™è¿‡ Android ä¸šåŠ¡çš„äººï¼Œå¿ƒé‡Œæœ‰ç‚¹æ…Œäº†ï¼Œäºæ˜¯æ‹¿èµ· Android Studioï¼Œè¿˜æ˜¯æ‰¾ç‚¹ä¸œè¥¿å­¦ä¹ ä¸€ä¸‹ï¼Œå¹¶ä¸”è®°å½•ä¸€ä¸‹ã€‚ä¸€ç›´è§‰å¾— ViewPager æ˜¯ä¸ªå¥½ä¸œè¥¿ï¼Œå¶ç„¶é—´çœ‹åˆ°ä¸€äº›å¾ˆå¥½çš„æ¡ˆä¾‹ï¼Œå¾ˆé…·ç‚«çš„ç¿»é¡µæ•ˆæœã€‚ç›´åˆ°äº†è§£äº†è¿™ä¸ªä¸œè¥¿çš„å®ç°åŸæ¥æ²¡æœ‰æƒ³è±¡ä¸­çš„é‚£ä¹ˆå¤æ‚
    
    </summary>
    
      <category term="Android" scheme="https://wzes.github.io/categories/Android/"/>
    
    
      <category term="Android" scheme="https://wzes.github.io/tags/Android/"/>
    
      <category term="ViewPager" scheme="https://wzes.github.io/tags/ViewPager/"/>
    
  </entry>
  
  <entry>
    <title>Android TabLayout æºç è§£æ</title>
    <link href="https://wzes.github.io/2019/02/21/Android/TabLayout/"/>
    <id>https://wzes.github.io/2019/02/21/Android/TabLayout/</id>
    <published>2019-02-21T07:36:00.000Z</published>
    <updated>2019-09-02T12:19:29.232Z</updated>
    
    <content type="html"><![CDATA[<h3 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h3><p>å¾ˆä¹…å¾ˆä¹…æ²¡å†™è¿‡æºç è§£æäº†ï¼Œä¸æ˜¯è‡ªå·±æ²¡æœ‰çœ‹äº†ï¼Œåªæ˜¯æ²¡æœ‰è®°å½•äº†ï¼Œå´å‘ç°ä¸è®°å½•çš„è¯ï¼Œä¼¼æ‡‚éæ‡‚ï¼Œæ—¶é—´ä¹…äº†å°±å¿˜å¾—å·®ä¸å¤šäº†ï¼Œç”¨åˆ°äº†è¿˜æ˜¯å¾—å†å­¦ä¸€éï¼Œå¿ä½æç¬”ä¸€ç¯‡ TabLayout æºç å­¦ä¹ ã€‚</p><h3 id="hello-world"><a class="markdownIt-Anchor" href="#hello-world"></a> Hello World</h3><h5 id="ä¾èµ–"><a class="markdownIt-Anchor" href="#ä¾èµ–"></a> ä¾èµ–</h5><p>æ·»åŠ  support design åŒ…</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation &apos;com.android.support:design:27.1.1&apos;</span><br></pre></td></tr></table></figure><h5 id="xml"><a class="markdownIt-Anchor" href="#xml"></a> xml</h5><p>æ·»åŠ ä¸€ä¸ª TabLayout å°±å¯ä»¥äº†</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;android.support.constraint.ConstraintLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    xmlns:tools=&quot;http://schemas.android.com/tools&quot;</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;match_parent&quot;</span><br><span class="line">    tools:context=&quot;.TabLayoutActivity&quot;&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;android.support.design.widget.TabLayout</span><br><span class="line">        android:id=&quot;@+id/tab_layout&quot;</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;/&gt;</span><br><span class="line">&lt;/android.support.constraint.ConstraintLayout&gt;</span><br></pre></td></tr></table></figure><h5 id="mainactivityjava"><a class="markdownIt-Anchor" href="#mainactivityjava"></a> MainActivity.java</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">import android.support.design.widget.TabLayout;</span><br><span class="line">import android.support.v7.app.AppCompatActivity;</span><br><span class="line">import android.os.Bundle;</span><br><span class="line"></span><br><span class="line">public class TabLayoutActivity extends AppCompatActivity &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_tab_layout);</span><br><span class="line"></span><br><span class="line">        TabLayout mTabLayout = findViewById(R.id.tab_layout);</span><br><span class="line">        // æ·»åŠ  tab item</span><br><span class="line">        mTabLayout.addTab(mTabLayout.newTab().setText(&quot;TAB1&quot;));</span><br><span class="line">        mTabLayout.addTab(mTabLayout.newTab().setText(&quot;TAB2&quot;));</span><br><span class="line">        mTabLayout.addTab(mTabLayout.newTab().setText(&quot;TAB3&quot;));</span><br><span class="line">        mTabLayout.addTab(mTabLayout.newTab().setText(&quot;TAB4&quot;));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="æ•ˆæœ"><a class="markdownIt-Anchor" href="#æ•ˆæœ"></a> æ•ˆæœ</h5><p><img src="https://upload-images.jianshu.io/upload_images/7117641-d36e4e9cef4c41bd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Screenshot_1550732046.png"></p><h3 id="æºç å­¦ä¹ "><a class="markdownIt-Anchor" href="#æºç å­¦ä¹ "></a> æºç å­¦ä¹ </h3><p>å…¶å®ï¼Œå®ç°è¿™æ ·ä¸€ä¸ªå¸ƒå±€å¹¶ä¸éš¾ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹é‡Œé¢æ‰€æœ‰çš„å†…å®¹</p><h4 id="å‰ä¸–ä»Šç”Ÿ"><a class="markdownIt-Anchor" href="#å‰ä¸–ä»Šç”Ÿ"></a> å‰ä¸–ä»Šç”Ÿ</h4><p>ç»§æ‰¿è‡ª HorizontalScrollView å› ä¸ºä»–æ”¯æŒæ»šåŠ¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public class TabLayout extends HorizontalScrollView</span><br></pre></td></tr></table></figure><p>TabLayout æ”¯æŒä¸¤ç§æ¨¡å¼ï¼Œä¸€ç§æ˜¯å›ºå®šçš„ï¼Œä¸€ç§æ˜¯å¯æ»šåŠ¨çš„ï¼ˆtab å¤ªå¤šï¼Œä¸€å±æ˜¾ç¤ºä¸ä¸‹ï¼Œå¯ä½¿ç”¨è¿™ç§æ¨¡å¼ï¼Œå¦åˆ™é»˜è®¤ä¸ºå¹³åˆ†ï¼‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Scrollable tabs display a subset of tabs at any given moment, and can contain longer tab</span><br><span class="line"> * labels and a larger number of tabs. They are best used for browsing contexts in touch</span><br><span class="line"> * interfaces when users donâ€™t need to directly compare the tab labels.</span><br><span class="line"> *</span><br><span class="line"> * @see #setTabMode(int)</span><br><span class="line"> * @see #getTabMode()</span><br><span class="line"> */</span><br><span class="line">public static final int MODE_SCROLLABLE = 0;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Fixed tabs display all tabs concurrently and are best used with content that benefits from</span><br><span class="line"> * quick pivots between tabs. The maximum number of tabs is limited by the viewâ€™s width.</span><br><span class="line"> * Fixed tabs have equal width, based on the widest tab label.</span><br><span class="line"> *</span><br><span class="line"> * @see #setTabMode(int)</span><br><span class="line"> * @see #getTabMode()</span><br><span class="line"> */</span><br><span class="line">public static final int MODE_FIXED = 1;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @hide</span><br><span class="line"> */</span><br><span class="line">@RestrictTo(LIBRARY_GROUP)</span><br><span class="line">@IntDef(value = &#123;MODE_SCROLLABLE, MODE_FIXED&#125;)</span><br><span class="line">@Retention(RetentionPolicy.SOURCE)</span><br><span class="line">public @interface Mode &#123;&#125;</span><br></pre></td></tr></table></figure><p>Tab çš„ä½ç½®æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯å±…ä¸­ï¼Œä¸€ç§æ˜¯å¹³åˆ†</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Gravity used to fill the &#123;@link TabLayout&#125; as much as possible. This option only takes effect</span><br><span class="line"> * when used with &#123;@link #MODE_FIXED&#125;.</span><br><span class="line"> *</span><br><span class="line"> * @see #setTabGravity(int)</span><br><span class="line"> * @see #getTabGravity()</span><br><span class="line"> */</span><br><span class="line">public static final int GRAVITY_FILL = 0;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Gravity used to lay out the tabs in the center of the &#123;@link TabLayout&#125;.</span><br><span class="line"> *</span><br><span class="line"> * @see #setTabGravity(int)</span><br><span class="line"> * @see #getTabGravity()</span><br><span class="line"> */</span><br><span class="line">public static final int GRAVITY_CENTER = 1;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @hide</span><br><span class="line"> */</span><br><span class="line">@RestrictTo(LIBRARY_GROUP)</span><br><span class="line">@IntDef(flag = true, value = &#123;GRAVITY_FILL, GRAVITY_CENTER&#125;)</span><br><span class="line">@Retention(RetentionPolicy.SOURCE)</span><br><span class="line">public @interface TabGravity &#123;&#125;</span><br></pre></td></tr></table></figure><p><strong>å±…ä¸­æ¨¡å¼</strong><br><img src="https://upload-images.jianshu.io/upload_images/7117641-a4c409810ec18439.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å±å¹•å¿«ç…§ 2019-02-21 ä¸‹åˆ3.07.13.png"></p><h4 id="åˆ›å»º-tab"><a class="markdownIt-Anchor" href="#åˆ›å»º-tab"></a> åˆ›å»º Tab</h4><p>ä½¿ç”¨ä»£ç åˆ›å»º Tab</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public Tab newTab() &#123;</span><br><span class="line">    Tab tab = sTabPool.acquire();</span><br><span class="line">    if (tab == null) &#123;</span><br><span class="line">        tab = new Tab();</span><br><span class="line">    &#125;</span><br><span class="line">    tab.mParent = this;</span><br><span class="line">    tab.mView = createTabView(tab);</span><br><span class="line">    return tab;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Tab è¿˜ä½¿ç”¨äº† Poolï¼Œè¿˜æ˜¯æŒºç»†å¿ƒçš„</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">private static final Pools.Pool&lt;Tab&gt; sTabPool = new Pools.SynchronizedPool&lt;&gt;(16);</span><br></pre></td></tr></table></figure><h5 id="å¯æ»‘åŠ¨çš„æŒ‡ç¤ºæ¡å½¢å›¾"><a class="markdownIt-Anchor" href="#å¯æ»‘åŠ¨çš„æŒ‡ç¤ºæ¡å½¢å›¾"></a> å¯æ»‘åŠ¨çš„æŒ‡ç¤ºæ¡å½¢å›¾</h5><p>è‡ªå®šä¹‰ ViewGroup</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">private class SlidingTabStrip extends LinearLayout</span><br></pre></td></tr></table></figure><h5 id="onmeasure"><a class="markdownIt-Anchor" href="#onmeasure"></a> onMeasure</h5><p>å¦‚æœè®¾ç½®äº† MODE_FIXED å’Œ GRAVITY_CENTER åˆ™éœ€è¦é‡æ–°æµ‹é‡ï¼Œç›®çš„å°±æ˜¯è®©å±…ä¸­ï¼Œæ¯ä¸ª ITEM çš„å®½åº¦éƒ½æ˜¯ä¸€æ ·çš„ï¼Œè€Œä¸”ç­‰äºæœ€å¤§çš„ä¸€ä¸ªï¼Œå¦‚æœä¸€å±æ”¾å¾—ä¸‹åˆ™éœ€è¦é‡æ–°è®¾ç½®æ¯ä¸ª ITEM çš„å¤§å°ï¼Œå¹¶ä¸”é‡æ–°æµ‹é‡ã€‚å¦‚æœå‘ä¸ä¸‹ï¼Œé‚£ä¹ˆä¾§è®¾ç½®GRAVITY_FILL</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">        protected void onMeasure(final int widthMeasureSpec, final int heightMeasureSpec) &#123;</span><br><span class="line">            super.onMeasure(widthMeasureSpec, heightMeasureSpec);</span><br><span class="line"></span><br><span class="line">            if (MeasureSpec.getMode(widthMeasureSpec) != MeasureSpec.EXACTLY) &#123;</span><br><span class="line">                // HorizontalScrollView will first measure use with UNSPECIFIED, and then with</span><br><span class="line">                // EXACTLY. Ignore the first call since anything we do will be overwritten anyway</span><br><span class="line">                return;</span><br><span class="line">            &#125;</span><br><span class="line">            // é‡æ–°æµ‹é‡</span><br><span class="line">            if (mMode == MODE_FIXED &amp;&amp; mTabGravity == GRAVITY_CENTER) &#123;</span><br><span class="line">                final int count = getChildCount();</span><br><span class="line"></span><br><span class="line">                // First we&apos;ll find the widest tab</span><br><span class="line">                int largestTabWidth = 0;</span><br><span class="line">                for (int i = 0, z = count; i &lt; z; i++) &#123;</span><br><span class="line">                    View child = getChildAt(i);</span><br><span class="line">                    if (child.getVisibility() == VISIBLE) &#123;</span><br><span class="line">                        largestTabWidth = Math.max(largestTabWidth, child.getMeasuredWidth());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                if (largestTabWidth &lt;= 0) &#123;</span><br><span class="line">                    // If we don&apos;t have a largest child yet, skip until the next measure pass</span><br><span class="line">                    return;</span><br><span class="line">                &#125;</span><br><span class="line">                // é—´éš”</span><br><span class="line">                final int gutter = dpToPx(FIXED_WRAP_GUTTER_MIN);</span><br><span class="line">                boolean remeasure = false;</span><br><span class="line">                // ä¸€å±æ”¾å¾—ä¸‹</span><br><span class="line">                if (largestTabWidth * count &lt;= getMeasuredWidth() - gutter * 2) &#123;</span><br><span class="line">                    // If the tabs fit within our width minus gutters, we will set all tabs to have  </span><br><span class="line">                    // the same width</span><br><span class="line">                    for (int i = 0; i &lt; count; i++) &#123;</span><br><span class="line">                        final LinearLayout.LayoutParams lp =</span><br><span class="line">                                (LayoutParams) getChildAt(i).getLayoutParams();</span><br><span class="line">                        if (lp.width != largestTabWidth || lp.weight != 0) &#123;</span><br><span class="line">                            lp.width = largestTabWidth;</span><br><span class="line">                            lp.weight = 0;</span><br><span class="line">                            remeasure = true;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    // If the tabs will wrap to be larger than the width minus gutters, we need</span><br><span class="line">                    // to switch to GRAVITY_FILL</span><br><span class="line">                    mTabGravity = GRAVITY_FILL;</span><br><span class="line">                    updateTabViews(false);</span><br><span class="line">                    remeasure = true;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                if (remeasure) &#123;</span><br><span class="line">                    // Now re-measure after our changes</span><br><span class="line">                    super.onMeasure(widthMeasureSpec, heightMeasureSpec);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><h4 id="å¦‚ä½•å®ç°åŠ¨ç”»"><a class="markdownIt-Anchor" href="#å¦‚ä½•å®ç°åŠ¨ç”»"></a> å¦‚ä½•å®ç°åŠ¨ç”»ï¼Ÿ</h4><p>é€šè¿‡ç§»åŠ¨ IndicatorView</p><h5 id="onlayout"><a class="markdownIt-Anchor" href="#onlayout"></a> onLayout</h5><p>mIndicatorAnimator æ˜¯åŠ¨ç”»è¾…åŠ©ç±»ï¼Œåœ¨ onLayout ä¸­ï¼Œéç©ºè€Œä¸”æ­£åœ¨è¿è¡Œåˆ™çœ‹å–æ¶ˆï¼Œç„¶åè°ƒç”¨ animateIndicatorToPositionï¼ŒåŠ¨ç”»è°ƒç”¨ï¼Œå¦åˆ™ç›´æ¥è®¾ç½®ä½ç½®ï¼Œä¸æ”¯æŒåŠ¨ç”»</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">@Override                                                                               </span><br><span class="line">protected void onLayout(boolean changed, int l, int t, int r, int b) &#123;                  </span><br><span class="line">    super.onLayout(changed, l, t, r, b);                                                </span><br><span class="line">                                                                                        </span><br><span class="line">    if (mIndicatorAnimator != null &amp;&amp; mIndicatorAnimator.isRunning()) &#123;                 </span><br><span class="line">        // If we&apos;re currently running an animation, lets cancel it and start a          </span><br><span class="line">        // new animation with the remaining duration                                    </span><br><span class="line">        mIndicatorAnimator.cancel();                                                    </span><br><span class="line">        final long duration = mIndicatorAnimator.getDuration();                         </span><br><span class="line">        animateIndicatorToPosition(mSelectedPosition,                                   </span><br><span class="line">                Math.round((1f - mIndicatorAnimator.getAnimatedFraction()) * duration));</span><br><span class="line">    &#125; else &#123;                                                                            </span><br><span class="line">        // If we&apos;ve been layed out, update the indicator position                       </span><br><span class="line">        updateIndicatorPosition();                                                      </span><br><span class="line">    &#125;                                                                                   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>updateIndicatorPosition é¦–å…ˆè·å–é€‰ä¸­çš„ Viewï¼Œç„¶åçœ‹ mSelectionOffset æ˜¯å¦å¤§äºé›¶ï¼Œè¯´æ˜å‘ç”Ÿæ»šåŠ¨ï¼Œåˆ™éœ€è¦é‡æ–°è®¡ç®—æ–°ä½ç½®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">private void updateIndicatorPosition() &#123;                                       </span><br><span class="line">    final View selectedTitle = getChildAt(mSelectedPosition);                  </span><br><span class="line">    int left, right;                                                           </span><br><span class="line">                                                                               </span><br><span class="line">    if (selectedTitle != null &amp;&amp; selectedTitle.getWidth() &gt; 0) &#123;               </span><br><span class="line">        left = selectedTitle.getLeft();                                        </span><br><span class="line">        right = selectedTitle.getRight();                                      </span><br><span class="line">                                                                               </span><br><span class="line">        if (mSelectionOffset &gt; 0f &amp;&amp; mSelectedPosition &lt; getChildCount() - 1) &#123;</span><br><span class="line">            // Draw the selection partway between the tabs                     </span><br><span class="line">            View nextTitle = getChildAt(mSelectedPosition + 1);                </span><br><span class="line">            left = (int) (mSelectionOffset * nextTitle.getLeft() +             </span><br><span class="line">                    (1.0f - mSelectionOffset) * left);                         </span><br><span class="line">            right = (int) (mSelectionOffset * nextTitle.getRight() +           </span><br><span class="line">                    (1.0f - mSelectionOffset) * right);                        </span><br><span class="line">        &#125;                                                                      </span><br><span class="line">    &#125; else &#123;                                                                   </span><br><span class="line">        left = right = -1;                                                     </span><br><span class="line">    &#125;                                                                          </span><br><span class="line">                                                                               </span><br><span class="line">    setIndicatorPosition(left, right);                                         </span><br><span class="line">&#125; </span><br><span class="line">// mIndicatorLeft å’Œ mIndicatorRight æ§åˆ¶äº†çº¿çš„èµ·å§‹ä½ç½®</span><br><span class="line">void setIndicatorPosition(int left, int right) &#123;                </span><br><span class="line">    if (left != mIndicatorLeft || right != mIndicatorRight) &#123;   </span><br><span class="line">        // If the indicator&apos;s left/right has changed, invalidate</span><br><span class="line">        mIndicatorLeft = left;                                  </span><br><span class="line">        mIndicatorRight = right;                                </span><br><span class="line">        ViewCompat.postInvalidateOnAnimation(this);             </span><br><span class="line">    &#125;                                                           </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç§»åŠ¨åŠ¨ç”»ï¼Œç§»åŠ¨é—´éš”å¤§çš„è¯ï¼Œå¹¶ä¸ä¼šä»å½“å‰ä½ç½®ç›´æ¥ç§»åŠ¨ï¼Œè€Œæ˜¯è·³è·ƒä¸€æ®µè·ç¦»å†ç§»åŠ¨ï¼Œé€šè¿‡ startLeft å’Œ startRight æ§åˆ¶ï¼Œå¹¶ä¸”ä½¿ç”¨ ValueAnimator æ¥å®ç°åŠ¨ç”»<br>è¿™ä¸ªä¸é”™ï¼ŒåŒæ„äº† fraction 0-1 ï¼Œé€šè¿‡å‡½æ•°è®¡ç®—è¿›åº¦</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">setIndicatorPosition(                                           </span><br><span class="line">        AnimationUtils.lerp(startLeft, targetLeft, fraction),   </span><br><span class="line">        AnimationUtils.lerp(startRight, targetRight, fraction));</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">void animateIndicatorToPosition(final int position, int duration) &#123;              </span><br><span class="line">    if (mIndicatorAnimator != null &amp;&amp; mIndicatorAnimator.isRunning()) &#123;          </span><br><span class="line">        mIndicatorAnimator.cancel();                                             </span><br><span class="line">    &#125;                                                                            </span><br><span class="line">                                                                                 </span><br><span class="line">    final boolean isRtl = ViewCompat.getLayoutDirection(this)                    </span><br><span class="line">            == ViewCompat.LAYOUT_DIRECTION_RTL;                                  </span><br><span class="line">                                                                                 </span><br><span class="line">    final View targetView = getChildAt(position);                                </span><br><span class="line">    if (targetView == null) &#123;                                                    </span><br><span class="line">        // If we don&apos;t have a view, just update the position now and return      </span><br><span class="line">        updateIndicatorPosition();                                               </span><br><span class="line">        return;                                                                  </span><br><span class="line">    &#125;                                                                            </span><br><span class="line">                                                                                 </span><br><span class="line">    final int targetLeft = targetView.getLeft();                                 </span><br><span class="line">    final int targetRight = targetView.getRight();                               </span><br><span class="line">    final int startLeft;                                                         </span><br><span class="line">    final int startRight;                                                        </span><br><span class="line">                                                                                 </span><br><span class="line">    if (Math.abs(position - mSelectedPosition) &lt;= 1) &#123;                           </span><br><span class="line">        // If the views are adjacent, we&apos;ll animate from edge-to-edge            </span><br><span class="line">        startLeft = mIndicatorLeft;                                              </span><br><span class="line">        startRight = mIndicatorRight;                                            </span><br><span class="line">    &#125; else &#123;                                                                     </span><br><span class="line">        // Else, we&apos;ll just grow from the nearest edge                           </span><br><span class="line">        final int offset = dpToPx(MOTION_NON_ADJACENT_OFFSET);                   </span><br><span class="line">        if (position &lt; mSelectedPosition) &#123;                                      </span><br><span class="line">            // We&apos;re going end-to-start                                          </span><br><span class="line">            if (isRtl) &#123;                                                         </span><br><span class="line">                startLeft = startRight = targetLeft - offset;                    </span><br><span class="line">            &#125; else &#123;                                                             </span><br><span class="line">                startLeft = startRight = targetRight + offset;                   </span><br><span class="line">            &#125;                                                                    </span><br><span class="line">        &#125; else &#123;                                                                 </span><br><span class="line">            // We&apos;re going start-to-end                                          </span><br><span class="line">            if (isRtl) &#123;                                                         </span><br><span class="line">                startLeft = startRight = targetRight + offset;                   </span><br><span class="line">            &#125; else &#123;                                                             </span><br><span class="line">                startLeft = startRight = targetLeft - offset;                    </span><br><span class="line">            &#125;                                                                    </span><br><span class="line">        &#125;                                                                        </span><br><span class="line">    &#125;                                                                            </span><br><span class="line">    // å¼€å§‹ç§»åŠ¨ä½ç½®                                                                             </span><br><span class="line">    if (startLeft != targetLeft || startRight != targetRight) &#123;                  </span><br><span class="line">        ValueAnimator animator = mIndicatorAnimator = new ValueAnimator();       </span><br><span class="line">        animator.setInterpolator(AnimationUtils.FAST_OUT_SLOW_IN_INTERPOLATOR);  </span><br><span class="line">        animator.setDuration(duration);                                          </span><br><span class="line">        animator.setFloatValues(0, 1);                                           </span><br><span class="line">        animator.addUpdateListener(new ValueAnimator.AnimatorUpdateListener() &#123;  </span><br><span class="line">            @Override                                                            </span><br><span class="line">            public void onAnimationUpdate(ValueAnimator animator) &#123;              </span><br><span class="line">                final float fraction = animator.getAnimatedFraction();           </span><br><span class="line">                setIndicatorPosition(                                            </span><br><span class="line">                        AnimationUtils.lerp(startLeft, targetLeft, fraction),    </span><br><span class="line">                        AnimationUtils.lerp(startRight, targetRight, fraction)); </span><br><span class="line">            &#125;                                                                    </span><br><span class="line">        &#125;);                                                                      </span><br><span class="line">        animator.addListener(new AnimatorListenerAdapter() &#123;                     </span><br><span class="line">            @Override                                                            </span><br><span class="line">            public void onAnimationEnd(Animator animator) &#123;                      </span><br><span class="line">                mSelectedPosition = position;                                    </span><br><span class="line">                mSelectionOffset = 0f;                                           </span><br><span class="line">            &#125;                                                                    </span><br><span class="line">        &#125;);                                                                      </span><br><span class="line">        animator.start();                                                        </span><br><span class="line">    &#125;                                                                            </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>onDraw å¾ˆç®€å•</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@Override                                                                          </span><br><span class="line">public void draw(Canvas canvas) &#123;                                                  </span><br><span class="line">    super.draw(canvas);                                                            </span><br><span class="line">                                                                                   </span><br><span class="line">    // Thick colored underline below the current selection                         </span><br><span class="line">    if (mIndicatorLeft &gt;= 0 &amp;&amp; mIndicatorRight &gt; mIndicatorLeft) &#123;                 </span><br><span class="line">        canvas.drawRect(mIndicatorLeft, getHeight() - mSelectedIndicatorHeight,    </span><br><span class="line">                mIndicatorRight, getHeight(), mSelectedIndicatorPaint);            </span><br><span class="line">    &#125;                                                                              </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="tabview"><a class="markdownIt-Anchor" href="#tabview"></a> TabView</h4><p>æ¥ä¸‹æ¥å†çœ‹çœ‹ä¸Šé¢çš„å†…å®¹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">class TabView extends LinearLayout &#123;</span><br><span class="line">      private Tab mTab;                  </span><br><span class="line">      private TextView mTextView;        </span><br><span class="line">      private ImageView mIconView;       </span><br><span class="line">                                         </span><br><span class="line">      private View mCustomView;          </span><br><span class="line">      private TextView mCustomTextView;  </span><br><span class="line">      private ImageView mCustomIconView; </span><br><span class="line">                                         </span><br><span class="line">      private int mDefaultMaxLines = 2;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚ä½•å®ç°ç›‘å¬çš„ï¼Œå¯¹æ¯ä¸ª TabView è®¾ç½®ç‚¹å‡»äº‹ä»¶ï¼Œé‡å†™äº† performClickï¼Œå…¶ä¸­è°ƒç”¨ mTab.selectï¼ŒmTab æ‹¥æœ‰ TabLayout çš„å¼•ç”¨ï¼Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">@Override                                               </span><br><span class="line">public boolean performClick() &#123;                         </span><br><span class="line">    final boolean handled = super.performClick();       </span><br><span class="line">                                                        </span><br><span class="line">    if (mTab != null) &#123;                                 </span><br><span class="line">        if (!handled) &#123;                                 </span><br><span class="line">            playSoundEffect(SoundEffectConstants.CLICK);</span><br><span class="line">        &#125;                                               </span><br><span class="line">        mTab.select();                                  </span><br><span class="line">        return true;                                    </span><br><span class="line">    &#125; else &#123;                                            </span><br><span class="line">        return handled;                                 </span><br><span class="line">    &#125;                                                   </span><br><span class="line">&#125;                                                       </span><br><span class="line">/**                                                                             </span><br><span class="line"> * Select this tab. Only valid if the tab has been added to the action bar.     </span><br><span class="line"> */                                                                             </span><br><span class="line">public void select() &#123;                                                          </span><br><span class="line">    if (mParent == null) &#123;                                                      </span><br><span class="line">        throw new IllegalArgumentException(&quot;Tab not attached to a TabLayout&quot;);  </span><br><span class="line">    &#125;                                                                           </span><br><span class="line">    mParent.selectTab(this);                                                    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>tabLayout å›è°ƒäº‹ä»¶ï¼Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">void selectTab(Tab tab) &#123;                                                              </span><br><span class="line">    selectTab(tab, true);                                                              </span><br><span class="line">&#125;                                                                                      </span><br><span class="line">                                                                                       </span><br><span class="line">void selectTab(final Tab tab, boolean updateIndicator) &#123;                               </span><br><span class="line">    final Tab currentTab = mSelectedTab;                                               </span><br><span class="line">                                                                                       </span><br><span class="line">    if (currentTab == tab) &#123;                                                           </span><br><span class="line">        if (currentTab != null) &#123;                                                      </span><br><span class="line">            dispatchTabReselected(tab);                                                </span><br><span class="line">            animateToTab(tab.getPosition());                                           </span><br><span class="line">        &#125;                                                                              </span><br><span class="line">    &#125; else &#123;                                                                           </span><br><span class="line">        final int newPosition = tab != null ? tab.getPosition() : Tab.INVALID_POSITION;</span><br><span class="line">        if (updateIndicator) &#123;                                                         </span><br><span class="line">            if ((currentTab == null || currentTab.getPosition() == Tab.INVALID_POSITION</span><br><span class="line">                    &amp;&amp; newPosition != Tab.INVALID_POSITION) &#123;                          </span><br><span class="line">                // If we don&apos;t currently have a tab, just draw the indicator           </span><br><span class="line">                setScrollPosition(newPosition, 0f, true);                              </span><br><span class="line">            &#125; else &#123;                                                                   </span><br><span class="line">                animateToTab(newPosition);                                             </span><br><span class="line">            &#125;                                                                          </span><br><span class="line">            if (newPosition != Tab.INVALID_POSITION) &#123;                                 </span><br><span class="line">                setSelectedTabView(newPosition);                                       </span><br><span class="line">            &#125;                                                                          </span><br><span class="line">        &#125;                                                                              </span><br><span class="line">        if (currentTab != null) &#123;                                                      </span><br><span class="line">            dispatchTabUnselected(currentTab);                                         </span><br><span class="line">        &#125;                                                                              </span><br><span class="line">        mSelectedTab = tab;                                                            </span><br><span class="line">        if (tab != null) &#123;                                                             </span><br><span class="line">            dispatchTabSelected(tab);                                                  </span><br><span class="line">        &#125;                                                                              </span><br><span class="line">    &#125;                                                                                  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç§»åŠ¨ Tabï¼ŒåŠ¨ç”»</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">private void animateToTab(int newPosition) &#123;                                        </span><br><span class="line">    if (newPosition == Tab.INVALID_POSITION) &#123;                                      </span><br><span class="line">        return;                                                                     </span><br><span class="line">    &#125;                                                                               </span><br><span class="line">                                                                                    </span><br><span class="line">    if (getWindowToken() == null || !ViewCompat.isLaidOut(this)                     </span><br><span class="line">            || mTabStrip.childrenNeedLayout()) &#123;                                    </span><br><span class="line">        // If we don&apos;t have a window token, or we haven&apos;t been laid out yet just dra</span><br><span class="line">        // position now                                                             </span><br><span class="line">        setScrollPosition(newPosition, 0f, true);                                   </span><br><span class="line">        return;                                                                     </span><br><span class="line">    &#125;                                                                               </span><br><span class="line">                                                                                    </span><br><span class="line">    final int startScrollX = getScrollX();                                          </span><br><span class="line">    final int targetScrollX = calculateScrollXForTab(newPosition, 0);               </span><br><span class="line">                                                                                    </span><br><span class="line">    if (startScrollX != targetScrollX) &#123;                                            </span><br><span class="line">        ensureScrollAnimator();                                                     </span><br><span class="line">                                                                                    </span><br><span class="line">        mScrollAnimator.setIntValues(startScrollX, targetScrollX);                  </span><br><span class="line">        mScrollAnimator.start();                                                    </span><br><span class="line">    &#125;                                                                               </span><br><span class="line">                                                                                    </span><br><span class="line">    // Now animate the indicator                                                    </span><br><span class="line">    mTabStrip.animateIndicatorToPosition(newPosition, ANIMATION_DURATION);          </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®¡ç®—ç§»åŠ¨çš„è·ç¦»ï¼Œè®©é€‰ä¸­çš„ tab ä½äºä¸­é—´ä½ç½®ï¼Œç”±äº Android ScrollView é»˜è®¤ä¸ä¼šæ»šåŠ¨è¶…å‡ºè¾¹ç•Œï¼Œæ‰€ä»¥å¦‚æœåˆ°è¾¾è¾¹ç•Œä¹Ÿä¸ä¼šç»§ç»­æ»šåŠ¨äº†</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">private int calculateScrollXForTab(int position, float positionOffset) &#123;                                  </span><br><span class="line">    if (mMode == MODE_SCROLLABLE) &#123;                                                                       </span><br><span class="line">        final View selectedChild = mTabStrip.getChildAt(position);                                        </span><br><span class="line">        final View nextChild = position + 1 &lt; mTabStrip.getChildCount()                                   </span><br><span class="line">                ? mTabStrip.getChildAt(position + 1)                                                      </span><br><span class="line">                : null;                                                                                   </span><br><span class="line">        final int selectedWidth = selectedChild != null ? selectedChild.getWidth() : 0;                   </span><br><span class="line">        final int nextWidth = nextChild != null ? nextChild.getWidth() : 0;                               </span><br><span class="line">                                                                                                          </span><br><span class="line">        // base scroll amount: places center of tab in center of parent                                   </span><br><span class="line">        int scrollBase = selectedChild.getLeft() + (selectedWidth / 2) - (getWidth() / 2);                </span><br><span class="line">        // offset amount: fraction of the distance between centers of tabs                                </span><br><span class="line">        int scrollOffset = (int) ((selectedWidth + nextWidth) * 0.5f * positionOffset);                   </span><br><span class="line">                                                                                                          </span><br><span class="line">        return (ViewCompat.getLayoutDirection(this) == ViewCompat.LAYOUT_DIRECTION_LTR)                   </span><br><span class="line">                ? scrollBase + scrollOffset                                                               </span><br><span class="line">                : scrollBase - scrollOffset;                                                              </span><br><span class="line">    &#125;                                                                                                     </span><br><span class="line">    return 0;                                                                                             </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="viewpager"><a class="markdownIt-Anchor" href="#viewpager"></a> ViewPager</h4><p>å…¶å®å¾ˆç®€å•ï¼Œå°±æ˜¯ç»™ ViewPager æ·»åŠ ä¸€ä¸ª OnPageChangeListener å°±è¡Œäº†ï¼Œä»£ç ä¹Ÿå¾ˆç®€å•ï¼Œåœ¨ onPageScrolled ä¸­æ”¹å˜ æŒ‡ç¤ºæ¡ çš„ä½ç½®ï¼Œåœ¨ onPageSelected ä¸­æ”¹å˜ é€‰ä¸­çŠ¶æ€</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">public static class TabLayoutOnPageChangeListener implements ViewPager.OnPageChangeListener &#123;</span><br><span class="line">    private final WeakReference&lt;TabLayout&gt; mTabLayoutRef;</span><br><span class="line">    private int mPreviousScrollState;</span><br><span class="line">    private int mScrollState;</span><br><span class="line"></span><br><span class="line">    public TabLayoutOnPageChangeListener(TabLayout tabLayout) &#123;</span><br><span class="line">        mTabLayoutRef = new WeakReference&lt;&gt;(tabLayout);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onPageScrollStateChanged(final int state) &#123;</span><br><span class="line">        mPreviousScrollState = mScrollState;</span><br><span class="line">        mScrollState = state;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onPageScrolled(final int position, final float positionOffset,</span><br><span class="line">            final int positionOffsetPixels) &#123;</span><br><span class="line">        final TabLayout tabLayout = mTabLayoutRef.get();</span><br><span class="line">        if (tabLayout != null) &#123;</span><br><span class="line">            // Only update the text selection if we&apos;re not settling, or we are settling after</span><br><span class="line">            // being dragged</span><br><span class="line">            final boolean updateText = mScrollState != SCROLL_STATE_SETTLING ||</span><br><span class="line">                    mPreviousScrollState == SCROLL_STATE_DRAGGING;</span><br><span class="line">            // Update the indicator if we&apos;re not settling after being idle. This is caused</span><br><span class="line">            // from a setCurrentItem() call and will be handled by an animation from</span><br><span class="line">            // onPageSelected() instead.</span><br><span class="line">            final boolean updateIndicator = !(mScrollState == SCROLL_STATE_SETTLING</span><br><span class="line">                    &amp;&amp; mPreviousScrollState == SCROLL_STATE_IDLE);</span><br><span class="line">            tabLayout.setScrollPosition(position, positionOffset, updateText, updateIndicator);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onPageSelected(final int position) &#123;</span><br><span class="line">        final TabLayout tabLayout = mTabLayoutRef.get();</span><br><span class="line">        if (tabLayout != null &amp;&amp; tabLayout.getSelectedTabPosition() != position</span><br><span class="line">                &amp;&amp; position &lt; tabLayout.getTabCount()) &#123;</span><br><span class="line">            // Select the tab, only updating the indicator if we&apos;re not being dragged/settled</span><br><span class="line">            // (since onPageScrolled will handle that).</span><br><span class="line">            final boolean updateIndicator = mScrollState == SCROLL_STATE_IDLE</span><br><span class="line">                    || (mScrollState == SCROLL_STATE_SETTLING</span><br><span class="line">                    &amp;&amp; mPreviousScrollState == SCROLL_STATE_IDLE);</span><br><span class="line">            tabLayout.selectTab(tabLayout.getTabAt(position), updateIndicator);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    void reset() &#123;</span><br><span class="line">        mPreviousScrollState = mScrollState = SCROLL_STATE_IDLE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="å°ç»“"><a class="markdownIt-Anchor" href="#å°ç»“"></a> å°ç»“</h5><p>åŸºæœ¬ä¸Šçœ‹å®Œäº†ï¼Œä½†å¯¹äºä¸€äº›ç»†èŠ‚ï¼Œæ»šåŠ¨è¾¹ç•Œé—®é¢˜è¿˜æ²¡æœ‰æ·±åˆ»çš„ç†è§£ï¼ŒåªçŸ¥é“å¤§æ¦‚çš„é€»è¾‘</p>]]></content>
    
    <summary type="html">
    
      å¾ˆä¹…å¾ˆä¹…æ²¡å†™è¿‡æºç è§£æäº†ï¼Œä¸æ˜¯è‡ªå·±æ²¡æœ‰çœ‹äº†ï¼Œåªæ˜¯æ²¡æœ‰è®°å½•äº†ï¼Œå´å‘ç°ä¸è®°å½•çš„è¯ï¼Œä¼¼æ‡‚éæ‡‚ï¼Œæ—¶é—´ä¹…äº†å°±å¿˜å¾—å·®ä¸å¤šäº†ï¼Œç”¨åˆ°äº†è¿˜æ˜¯å¾—å†å­¦ä¸€éï¼Œå¿ä½æç¬”ä¸€ç¯‡ TabLayout æºç å­¦ä¹ 
    
    </summary>
    
      <category term="Android" scheme="https://wzes.github.io/categories/Android/"/>
    
    
      <category term="Android" scheme="https://wzes.github.io/tags/Android/"/>
    
      <category term="TabLayout" scheme="https://wzes.github.io/tags/TabLayout/"/>
    
  </entry>
  
  <entry>
    <title>Android Recycview åˆ†å‰²çº¿</title>
    <link href="https://wzes.github.io/2018/10/12/Android/Android%20Recycview%20Devider/"/>
    <id>https://wzes.github.io/2018/10/12/Android/Android Recycview Devider/</id>
    <published>2018-10-12T12:35:00.000Z</published>
    <updated>2019-09-02T12:17:39.545Z</updated>
    
    <content type="html"><![CDATA[<h3 id="æœ€è¿‘æœ‰ä¸€ä¸ªéœ€æ±‚éœ€è¦åšåˆ†å‰²çº¿ç½‘ä¸Šæœ‰ä¸€äº›å¤§è‡´çš„åšæ³•ä½†æ„Ÿè§‰éƒ½ä¸æ˜¯é‚£ä¹ˆé€šä¿—æ˜“æ‡‚ç„¶åè‡ªå·±æƒ³äº†æƒ³å¹²è„†è‡ªå·±å¼„å§åé¢å‘ç°äº†ä¸€ä¸ªæ¯”è¾ƒå¥½çš„éå¸¸ç®€æ´åˆ†äº«ç»™å¤§å®¶"><a class="markdownIt-Anchor" href="#æœ€è¿‘æœ‰ä¸€ä¸ªéœ€æ±‚éœ€è¦åšåˆ†å‰²çº¿ç½‘ä¸Šæœ‰ä¸€äº›å¤§è‡´çš„åšæ³•ä½†æ„Ÿè§‰éƒ½ä¸æ˜¯é‚£ä¹ˆé€šä¿—æ˜“æ‡‚ç„¶åè‡ªå·±æƒ³äº†æƒ³å¹²è„†è‡ªå·±å¼„å§åé¢å‘ç°äº†ä¸€ä¸ªæ¯”è¾ƒå¥½çš„éå¸¸ç®€æ´åˆ†äº«ç»™å¤§å®¶"></a> æœ€è¿‘æœ‰ä¸€ä¸ªéœ€æ±‚éœ€è¦åšåˆ†å‰²çº¿ï¼Œç½‘ä¸Šæœ‰ä¸€äº›å¤§è‡´çš„åšæ³•ï¼Œä½†æ„Ÿè§‰éƒ½ä¸æ˜¯é‚£ä¹ˆé€šä¿—æ˜“æ‡‚ï¼Œç„¶åè‡ªå·±æƒ³äº†æƒ³ï¼Œå¹²è„†è‡ªå·±å¼„å§ï¼Œåé¢å‘ç°äº†ä¸€ä¸ªæ¯”è¾ƒå¥½çš„ï¼Œéå¸¸ç®€æ´ï¼Œåˆ†äº«ç»™å¤§å®¶</h3><h3 id="æ•ˆæœ"><a class="markdownIt-Anchor" href="#æ•ˆæœ"></a> æ•ˆæœ</h3><p><img src="https://upload-images.jianshu.io/upload_images/7117641-a576c4213a43f594.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p><h3 id="ä»£ç "><a class="markdownIt-Anchor" href="#ä»£ç "></a> ä»£ç </h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">class GridSpanDecoration extends RecyclerView.ItemDecoration &#123;</span><br><span class="line">    private Paint mPaint;</span><br><span class="line"></span><br><span class="line">    GridSpanDecoration(int color) &#123;</span><br><span class="line">        mPaint = new Paint();</span><br><span class="line">        mPaint.setColor(color);</span><br><span class="line">        mPaint.setStyle(Paint.Style.STROKE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void getItemOffsets(Rect outRect, View view, RecyclerView parent, RecyclerView.State state) &#123;</span><br><span class="line">        super.getItemOffsets(outRect, view, parent, state);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onDraw(Canvas c, RecyclerView parent, RecyclerView.State state) &#123;</span><br><span class="line">        drawVertical(c, parent);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void drawVertical(Canvas c, RecyclerView parent) &#123;</span><br><span class="line">        final int childCount = parent.getChildCount();</span><br><span class="line">        for (int i = 0; i &lt; childCount; i++) &#123;</span><br><span class="line">            final View child = parent.getChildAt(i);</span><br><span class="line">            c.drawRect(child.getLeft(), child.getTop(), child.getRight(), child.getBottom(), mPaint);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŸç†å°±æ˜¯ç»™æ¯ä¸ªå­viewç”»ä¸€ä¸ªè¾¹æ¡†å°±è¡Œäº†ï¼æ˜¯ä¸æ˜¯å¾ˆç®€å•</p>]]></content>
    
    <summary type="html">
    
      æœ€è¿‘æœ‰ä¸€ä¸ªéœ€æ±‚éœ€è¦åšåˆ†å‰²çº¿ï¼Œç½‘ä¸Šæœ‰ä¸€äº›å¤§è‡´çš„åšæ³•ï¼Œä½†æ„Ÿè§‰éƒ½ä¸æ˜¯é‚£ä¹ˆé€šä¿—æ˜“æ‡‚ï¼Œç„¶åè‡ªå·±æƒ³äº†æƒ³ï¼Œå¹²è„†è‡ªå·±å¼„å§ï¼Œåé¢å‘ç°äº†ä¸€ä¸ªæ¯”è¾ƒå¥½çš„ï¼Œéå¸¸ç®€æ´ï¼Œåˆ†äº«ç»™å¤§å®¶
    
    </summary>
    
      <category term="Android" scheme="https://wzes.github.io/categories/Android/"/>
    
    
      <category term="Android" scheme="https://wzes.github.io/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>Effective Java3 ä»‹ç»ï¼ˆç¿»è¯‘ï¼‰</title>
    <link href="https://wzes.github.io/2018/09/30/Book%20Notes/Effective%20Java3%20%E4%BB%8B%E7%BB%8D/"/>
    <id>https://wzes.github.io/2018/09/30/Book Notes/Effective Java3 ä»‹ç»/</id>
    <published>2018-09-30T14:18:00.000Z</published>
    <updated>2019-09-02T12:22:04.691Z</updated>
    
    <content type="html"><![CDATA[<h3 id="introduction"><a class="markdownIt-Anchor" href="#introduction"></a> Introduction</h3><p>æœ¬ä¹¦æ—¨åœ¨å¸®åŠ©æ‚¨æœ‰æ•ˆåœ°ä½¿ç”¨ Java ç¼–ç¨‹è¯­è¨€åŠå…¶åŸºç¡€åº“ï¼šjava.langï¼Œjava.util å’Œ <a href="http://java.io" target="_blank" rel="noopener">java.io</a>ï¼Œä»¥åŠ java.util.concurrent å’Œ java.util.functionç­‰å­åŒ…ã€‚ ä¹Ÿä¼šæ¶‰åŠåˆ°å…¶ä»–çš„ç±»åº“ã€‚</p><p>æœ¬ä¹¦ä¸€å…±ä¹åå°èŠ‚ï¼Œæ¯ä¸ªå°èŠ‚è®²è¿°äº†ä¸€æ¡è§„åˆ™ã€‚ è¿™äº›è§„åˆ™å®è·µé€šå¸¸ä¼šä½¿é‚£äº›æœ€ä¼˜ç§€å’Œæœ€å¯Œæœ‰ç»éªŒçš„ç¨‹åºå‘˜ä»ä¸­å—ç›Šã€‚ æ‰€æœ‰çš„å†…å®¹åˆ†ä¸º11ç« ï¼Œæ¯ç« éƒ½æ¶‰åŠè½¯ä»¶è®¾è®¡çš„ä¸€ä¸ªå¹¿æ³›æ–¹é¢ã€‚ æœ¬ä¹¦ä¸æ‰“ç®—ä»å¤´åˆ°å°¾é˜…è¯»ï¼šæ¯ä¸ªå°èŠ‚éƒ½æˆ–å¤šæˆ–å°‘åœ°ç‹¬ç«‹å­˜åœ¨ã€‚ è¿™äº›å°èŠ‚æœ‰å¾ˆå¤šäº¤å‰å¼•ç”¨ï¼Œå› æ­¤æ‚¨å¯ä»¥é€šè¿‡æœ¬ä¹¦è½»æ¾ç»˜åˆ¶è‡ªå·±çš„è¯¾ç¨‹ã€‚</p><p>è‡ªæœ¬ä¹¦ä¸Šä¸€ç‰ˆå‡ºç‰ˆä»¥æ¥ï¼Œè¯¥å¹³å°å¢åŠ äº†è®¸å¤šæ–°åŠŸèƒ½ã€‚ æœ¬ä¹¦ä¸­çš„å¤§å¤šæ•°é¡¹ç›®éƒ½ä»¥æŸç§æ–¹å¼ä½¿ç”¨è¿™äº›åŠŸèƒ½ã€‚ æ­¤è¡¨æ˜¾ç¤ºäº†ä¸»è¦åŠŸèƒ½çš„ä¸»è¦è¦†ç›–èŒƒå›´:<br><img src="https://upload-images.jianshu.io/upload_images/7117641-68d157770f16a26c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Screen Shot 2018-09-30 at 9.38.24 PM.png"></p><p>å¤§å¤šæ•°é¡¹ç›®éƒ½ç”¨ç¨‹åºç¤ºä¾‹è¯´æ˜ã€‚ æœ¬ä¹¦çš„ä¸€ä¸ªå…³é”®ç‰¹æ€§æ˜¯å®ƒåŒ…å«è¯´æ˜è®¸å¤šè®¾è®¡æ¨¡å¼å’Œä¹ è¯­çš„ä»£ç ç¤ºä¾‹ã€‚ åœ¨é€‚å½“çš„æƒ…å†µä¸‹ï¼Œå®ƒä»¬ä¸è¯¥é¢†åŸŸçš„æ ‡å‡†å‚è€ƒå·¥ä½œ[Gamma95]ç›¸äº’å‚ç…§ã€‚</p><p>è®¸å¤šå°èŠ‚åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªç¨‹åºç¤ºä¾‹ï¼Œè¯´æ˜äº†è¦é¿å…çš„ä¸€äº›å®è·µã€‚ è¿™æ ·çš„ä¾‹å­ï¼Œæœ‰æ—¶è¢«ç§°ä¸ºåæ¨¡å¼ï¼Œæ¸…æ¥šåœ°æ ‡æœ‰è¯„è®ºï¼Œä¾‹å¦‚ <code>//never do thisï¼</code> åœ¨æ¯ç§æƒ…å†µä¸‹ï¼Œè¯¥é¡¹ç›®éƒ½è§£é‡Šäº†ä¸ºä»€ä¹ˆç¤ºä¾‹ä¸å¥½å¹¶æå‡ºäº†å¦ä¸€ç§æ–¹æ³•ã€‚</p><p>æœ¬ä¹¦ä¸é€‚åˆåˆå­¦è€…ï¼šå®ƒå‡è®¾æ‚¨å·²ç»ç†Ÿæ‚‰Javaã€‚ å¦‚æœä¸æ˜¯ï¼Œè¯·è€ƒè™‘è®¸å¤šä¼˜ç§€çš„å…¥é—¨çº§ä¹¦ç±ä¹‹ä¸€ï¼Œä¾‹å¦‚Peter Sestoftçš„Java Precisely [Sestoft16]ã€‚ è™½ç„¶Effective Javaæ—¨åœ¨è®©ä»»ä½•å…·æœ‰è¯¥è¯­è¨€å·¥ä½œçŸ¥è¯†çš„äººéƒ½å¯ä»¥é˜…è¯»ï¼Œä½†å®ƒåº”è¯¥ä¸ºé«˜çº§ç¨‹åºå‘˜æä¾›æ€è€ƒçš„ç©ºé—´ã€‚</p><p>æœ¬ä¹¦ä¸­çš„å¤§å¤šæ•°è§„åˆ™éƒ½æºäºä¸€äº›åŸºæœ¬åŸåˆ™ã€‚ æ¸…æ™°å’Œç®€æ´è‡³å…³é‡è¦ã€‚ ç»„ä»¶çš„ç”¨æˆ·ä¸åº”è¯¥å¯¹å…¶è¡Œä¸ºæ„Ÿåˆ°æƒŠè®¶ã€‚ ç»„ä»¶åº”å°½å¯èƒ½å°ï¼Œä½†ä¸èƒ½å°ã€‚ ï¼ˆæ­£å¦‚æœ¬ä¹¦ä¸­æ‰€ä½¿ç”¨çš„ï¼Œæœ¯è¯­ç»„ä»¶æ˜¯æŒ‡ä»»ä½•å¯é‡ç”¨çš„è½¯ä»¶å…ƒç´ ï¼Œä»å•ä¸ªæ–¹æ³•åˆ°ç”±å¤šä¸ªåŒ…ç»„æˆçš„å¤æ‚æ¡†æ¶ã€‚ï¼‰ä»£ç åº”è¯¥è¢«é‡ç”¨è€Œä¸æ˜¯è¢«å¤åˆ¶ã€‚ ç»„ä»¶ä¹‹é—´çš„ä¾èµ–å…³ç³»åº”ä¿æŒæœ€å°ã€‚ é”™è¯¯åº”è¯¥åœ¨å‘ç”Ÿåå°½å¿«æ£€æµ‹åˆ°ï¼Œç†æƒ³æƒ…å†µæ˜¯åœ¨ç¼–è¯‘æ—¶ã€‚</p><p>è™½ç„¶æœ¬ä¹¦ä¸­çš„è§„åˆ™å¹¶é100ï¼…é€‚ç”¨ï¼Œä½†åœ¨ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå®ƒä»¬éƒ½æ˜¯æœ€ä½³ç¼–ç¨‹å®è·µçš„ç‰¹å¾ã€‚ä½ ä¸åº”è¯¥ç›²ç›®åœ°éµå®ˆè¿™äº›è§„åˆ™ï¼Œè€Œåªæ˜¯å¶å°”å¹¶ä¸”æœ‰å……åˆ†çš„ç†ç”±è¿åè¿™äº›è§„åˆ™ã€‚åƒå¤§å¤šæ•°å…¶ä»–å­¦ç§‘ä¸€æ ·ï¼Œå­¦ä¹ ç¼–ç¨‹è‰ºæœ¯åŒ…æ‹¬é¦–å…ˆå­¦ä¹ è§„åˆ™ï¼Œç„¶åå­¦ä¹ ä½•æ—¶æ‰“ç ´è§„åˆ™ã€‚</p><p>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæœ¬ä¹¦ä¸æ¶‰åŠæ€§èƒ½ã€‚å®ƒæ˜¯å…³äºç¼–å†™æ¸…æ™°ï¼Œæ­£ç¡®ï¼Œå¯ç”¨ï¼Œå¥å£®ï¼Œçµæ´»å’Œå¯ç»´æŠ¤çš„ç¨‹åºã€‚å¦‚æœä½ èƒ½åšåˆ°è¿™ä¸€ç‚¹ï¼Œé‚£ä¹ˆè·å¾—æ‰€éœ€çš„æ€§èƒ½é€šå¸¸æ˜¯ä¸€ä»¶ç›¸å¯¹ç®€å•çš„äº‹æƒ…ï¼ˆç¬¬67æ¡ï¼‰ã€‚æœ‰äº›é¡¹ç›®ç¡®å®è®¨è®ºäº†æ€§èƒ½é—®é¢˜ï¼Œå…¶ä¸­ä¸€äº›é¡¹ç›®æä¾›äº†æ€§èƒ½æ•°æ®ã€‚ä½¿ç”¨çŸ­è¯­â€œåœ¨æˆ‘çš„æœºå™¨ä¸Šâ€å¼•å…¥çš„è¿™äº›æ•°å­—åº”è¯¥è¢«è®¤ä¸ºæ˜¯æœ€è¿‘çš„ã€‚</p><p>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œæˆ‘çš„æœºå™¨æ˜¯è€æ—§çš„è‡ªåˆ¶3.5GHzå››æ ¸è‹±ç‰¹å°”é…·ç¿i7-4770Kï¼Œé…å¤‡16åƒå…†ä½DDR3-1866 CL9å†…å­˜ï¼Œè¿è¡ŒAzulçš„Zulu 9.0.0.15ç‰ˆæœ¬çš„OpenJDKï¼Œåœ¨Microsoft Windows 7 Professional SP1ï¼ˆ64-ä½ï¼‰ã€‚</p><p>åœ¨è®¨è®ºJavaç¼–ç¨‹è¯­è¨€åŠå…¶åº“çš„åŠŸèƒ½æ—¶ï¼Œæœ‰æ—¶éœ€è¦å‚è€ƒç‰¹å®šç‰ˆæœ¬ã€‚ ä¸ºæ–¹ä¾¿èµ·è§ï¼Œæœ¬ä¹¦ä½¿ç”¨æ˜µç§°è€Œä¸æ˜¯æ­£å¼ç‰ˆæœ¬åç§°ã€‚ æ­¤è¡¨æ˜¾ç¤ºç‰ˆæœ¬åç§°å’Œæ˜µç§°ä¹‹é—´çš„æ˜ å°„ï¼š<br><img src="https://upload-images.jianshu.io/upload_images/7117641-e8be621975318c9f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Screen Shot 2018-09-30 at 9.48.26 PM.png"></p><p>è¿™äº›ä¾‹å­ç›¸å½“å®Œæ•´ï¼Œä½†æœ‰åˆ©äºå®Œæ•´æ€§çš„å¯è¯»æ€§ã€‚ä»–ä»¬å¯ä»¥è‡ªç”±åœ°ä½¿ç”¨java.utilå’Œjava.ioåŒ…ä¸­çš„ç±»ã€‚ä¸ºäº†ç¼–è¯‘ç¤ºä¾‹ï¼Œæ‚¨å¯èƒ½å¿…é¡»æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªå¯¼å…¥å£°æ˜æˆ–å…¶ä»–æ­¤ç±»æ ·æ¿ã€‚è¯¥ä¹¦çš„ç½‘ç«™http://joshbloch.com/effectivejavaåŒ…å«æ¯ä¸ªç¤ºä¾‹çš„æ‰©å±•ç‰ˆæœ¬ï¼Œæ‚¨å¯ä»¥ç¼–è¯‘å’Œè¿è¡Œå®ƒã€‚</p><p>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæœ¬ä¹¦ä½¿ç”¨äº†Javaè¯­è¨€è§„èŒƒJava SE 8 Edition [JLS]ä¸­å®šä¹‰çš„æŠ€æœ¯æœ¯è¯­ã€‚ä¸€äº›æœ¯è¯­å€¼å¾—ç‰¹åˆ«æåŠã€‚è¯¥è¯­è¨€æ”¯æŒå››ç§ç±»å‹ï¼šæ¥å£ï¼ˆåŒ…æ‹¬æ³¨é‡Šï¼‰ï¼Œç±»ï¼ˆåŒ…æ‹¬æšä¸¾ï¼‰ï¼Œæ•°ç»„å’ŒåŸºå…ƒã€‚å‰ä¸‰ä¸ªè¢«ç§°ä¸ºå‚è€ƒç±»å‹ã€‚ç±»å®ä¾‹å’Œæ•°ç»„æ˜¯å¯¹è±¡;åŸå§‹å€¼ä¸æ˜¯ã€‚ç±»çš„æˆå‘˜ç”±å…¶å­—æ®µï¼Œæ–¹æ³•ï¼Œæˆå‘˜ç±»å’Œæˆå‘˜æ¥å£ç»„æˆã€‚æ–¹æ³•çš„ç­¾åç”±å…¶åç§°å’Œå½¢å¼å‚æ•°çš„ç±»å‹ç»„æˆ;ç­¾åä¸åŒ…æ‹¬æ–¹æ³•çš„è¿”å›ç±»å‹ã€‚</p><p>æœ¬ä¹¦ä½¿ç”¨çš„å‡ ä¸ªæœ¯è¯­ä¸Javaè¯­è¨€è§„èŒƒä¸åŒã€‚ä¸Javaè¯­è¨€è§„èŒƒä¸åŒï¼Œæœ¬ä¹¦ä½¿ç”¨ç»§æ‰¿ inheritance ä½œä¸ºå­ç±» subclassing çš„åŒä¹‰è¯ã€‚æœ¬ä¹¦ä¸æ˜¯å¯¹æ¥å£ä½¿ç”¨æœ¯è¯­ç»§æ‰¿ï¼Œè€Œæ˜¯ç®€å•åœ°å£°æ˜ä¸€ä¸ªç±»å®ç°ä¸€ä¸ªæ¥å£æˆ–ä¸€ä¸ªæ¥å£æ‰©å±•å¦ä¸€ä¸ªæ¥å£ã€‚è¦æè¿°åœ¨æœªæŒ‡å®šæ—¶åº”ç”¨çš„è®¿é—®çº§åˆ«ï¼Œæœ¬ä¹¦ä½¿ç”¨ä¼ ç»Ÿçš„package-privateè€Œä¸æ˜¯æŠ€æœ¯ä¸Šæ­£ç¡®çš„åŒ…è®¿é—®[JLSï¼Œ6.6.1]ã€‚</p><p>æœ¬ä¹¦ä½¿ç”¨äº†ä¸€äº›æœªåœ¨Javaè¯­è¨€è§„èŒƒä¸­å®šä¹‰çš„æŠ€æœ¯æœ¯è¯­ã€‚æœ¯è¯­â€œå¯¼å‡ºAPIâ€æˆ–ç®€ç§°â€œAPIâ€æ˜¯æŒ‡ç¨‹åºå‘˜è®¿é—®ç±»ï¼Œæ¥å£æˆ–åŒ…æ—¶æ‰€ä½¿ç”¨çš„ç±»ï¼Œæ¥å£ï¼Œæ„é€ å‡½æ•°ï¼Œæˆå‘˜å’Œåºåˆ—åŒ–å½¢å¼ã€‚ ï¼ˆAPIæ˜¯åº”ç”¨ç¨‹åºç¼–ç¨‹æ¥å£çš„ç¼©å†™ï¼Œä¼˜å…ˆäºå…¶ä»–ä¼˜é€‰çš„æœ¯è¯­æ¥å£ï¼Œä»¥é¿å…ä¸è¯¥åç§°çš„è¯­è¨€ç»“æ„æ··æ·†ã€‚ï¼‰ç¼–å†™ä½¿ç”¨APIâ€‹â€‹çš„ç¨‹åºçš„ç¨‹åºå‘˜è¢«ç§°ä¸ºä½œä¸ºAPIçš„ç”¨æˆ·ã€‚å…¶å®ç°ä½¿ç”¨APIâ€‹â€‹çš„ç±»æ˜¯APIçš„å®¢æˆ·ç«¯ã€‚</p><p>ç±»ï¼Œæ¥å£ï¼Œæ„é€ å‡½æ•°ï¼Œæˆå‘˜å’Œåºåˆ—åŒ–è¡¨å•è¢«ç»Ÿç§°ä¸ºAPIå…ƒç´ ã€‚å¯¼å‡ºçš„APIåŒ…å«å¯åœ¨å®šä¹‰APIçš„åŒ…ä¹‹å¤–è®¿é—®çš„APIå…ƒç´ ã€‚è¿™äº›æ˜¯ä»»ä½•å®¢æˆ·ç«¯éƒ½å¯ä»¥ä½¿ç”¨çš„APIå…ƒç´ ï¼Œå¹¶ä¸”APIçš„ä½œè€…æ‰¿è¯ºæ”¯æŒã€‚å¹¶éå·§åˆçš„æ˜¯ï¼Œå®ƒä»¬ä¹Ÿæ˜¯Javadocå®ç”¨ç¨‹åºä»¥å…¶é»˜è®¤æ“ä½œæ¨¡å¼ç”Ÿæˆæ–‡æ¡£çš„å…ƒç´ ã€‚ç®€è€Œè¨€ä¹‹ï¼ŒåŒ…çš„å¯¼å‡ºAPIç”±åŒ…ä¸­æ¯ä¸ªå…¬å…±ç±»æˆ–æ¥å£çš„å…¬å…±æˆå‘˜å’Œå—ä¿æŠ¤æˆå‘˜ä»¥åŠæ„é€ å‡½æ•°ç»„æˆã€‚</p><p>åœ¨Java 9ä¸­ï¼Œæ¨¡å—ç³»ç»Ÿè¢«æ·»åŠ åˆ°å¹³å°ä¸­ã€‚å¦‚æœåº“ä½¿ç”¨æ¨¡å—ç³»ç»Ÿï¼Œåˆ™å…¶å¯¼å‡ºçš„APIæ˜¯åº“çš„æ¨¡å—å£°æ˜å¯¼å‡ºçš„æ‰€æœ‰åŒ…çš„å¯¼å‡ºAPIçš„å¹¶é›†ã€‚</p>]]></content>
    
    <summary type="html">
    
      æœ¬ä¹¦æ—¨åœ¨å¸®åŠ©æ‚¨æœ‰æ•ˆåœ°ä½¿ç”¨ Java ç¼–ç¨‹è¯­è¨€åŠå…¶åŸºç¡€åº“ï¼šjava.langï¼Œjava.util å’Œ java.ioï¼Œä»¥åŠ java.util.concurrent å’Œ java.util.functionç­‰å­åŒ…ã€‚ ä¹Ÿä¼šæ¶‰åŠåˆ°å…¶ä»–çš„ç±»åº“
    
    </summary>
    
      <category term="Java" scheme="https://wzes.github.io/categories/Java/"/>
    
    
      <category term="Java" scheme="https://wzes.github.io/tags/Java/"/>
    
  </entry>
  
</feed>
